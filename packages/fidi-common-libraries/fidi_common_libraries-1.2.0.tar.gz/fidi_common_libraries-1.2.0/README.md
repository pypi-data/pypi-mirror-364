# FIDI Common Libraries

Bibliotecas compartilhadas entre os projetos da FIDI, desenvolvidas seguindo as melhores pr√°ticas de desenvolvimento Python.

## üìã Vis√£o Geral

Este projeto fornece um conjunto de bibliotecas reutiliz√°veis para automa√ß√£o, integra√ß√£o AWS, processamento de dados e utilit√°rios comuns utilizados nos projetos da FIDI.

## üöÄ Funcionalidades Principais

- **Data**: Opera√ß√µes de banco de dados multi-SGBD (Oracle via oracledb, PostgreSQL, SQL Server)
- **Utils**: Sistema de logging estruturado para m√∫ltiplos SGBDs
- **Constants**: Constantes de status padronizadas e fun√ß√µes de convers√£o entre diferentes tipos de status
- **AWS**: Clientes padronizados para SQS, SNS, Lambda, S3 com configura√ß√£o centralizada
- **Config**: Gerenciamento de par√¢metros com cache e convers√£o autom√°tica de tipos
- **UI**: Componentes para automa√ß√£o de interfaces gr√°ficas (em desenvolvimento)

## üì¶ Instala√ß√£o e Configura√ß√£o

### Pr√©-requisitos
- Python 3.9+
- Poetry

### Instala√ß√£o como Biblioteca
```bash
# Instalar via Poetry (recomendado)
poetry add git+https://github.com/your-org/fidi-common-libraries.git

# Ou via pip
pip install git+https://github.com/your-org/fidi-common-libraries.git
```

### Desenvolvimento Local
```bash
# Clone o reposit√≥rio
git clone <repository-url>
cd fidi-common-libraries

# Instale as depend√™ncias
poetry install

# Ative o ambiente virtual
poetry shell
```

### Configura√ß√£o de Desenvolvimento
```bash
# Instale os hooks de pre-commit
poetry run pre-commit install

# Execute os testes
poetry run pytest

# Verifique a cobertura de testes
poetry run pytest --cov=src --cov-report=html
```

## üîß Como Usar

### M√≥dulo Data - Opera√ß√µes de Banco

```python
from fidi_common_libraries.data.db_data import DatabaseConfig, ProcessosRpaInserter, DatabaseQuery
from datetime import datetime

# Configura√ß√£o do banco
db_config = DatabaseConfig.from_env('RPA_')  # Usa vari√°veis RPA_DB_SERVER, etc.

# Inserir registro
inserter = ProcessosRpaInserter(db_config)
registro_id = inserter.insert(
    ambiente="PRD",
    produto="FIDI-ferias",
    versao="1.0.0",
    chapa="123456",
    statusexecucao="NOVO"
)

# Consulta segura
query = DatabaseQuery(db_config)
results = query.execute_query(
    "SELECT * FROM processosrpa WHERE statusexecucao = :status",
    {"status": "NOVO"}
)
```

### M√≥dulo Config - Gerenciamento de Par√¢metros

```python
from fidi_common_libraries.config.parametros import Parametros

# Inicializar o gerenciador de par√¢metros
params = Parametros(ambiente="HML", produto="FIDI-ferias")

# Obter um par√¢metro
url_api = params.get_parametro("URL_API", default="https://api.exemplo.com")

# Obter par√¢metros por grupo
config_email = params.get_parametros_por_grupo("Email")

# Obter par√¢metros por categorias espec√≠ficas
config_ti = params.get_parametros_por_grupo("TI")  # Configura√ß√µes t√©cnicas
config_negocio = params.get_parametros_por_grupo("Negocio")  # Configura√ß√µes de neg√≥cio
config_produto = params.get_parametros_por_grupo("Produto")  # Configura√ß√µes do produto

# Atualizar um par√¢metro
params.atualizar_parametro("TIMEOUT_API", 30)
```

### M√≥dulo Utils - Logging e Status

```python
from fidi_common_libraries.utils.logger import registrar_log_banco
from fidi_common_libraries.constants.status import HubStatus, DBStatus, LogStatus, convert_status
import pyodbc

# Conex√£o com banco
conn = pyodbc.connect(connection_string)

# Registrar log (detecta automaticamente o tipo de banco)
registrar_log_banco(
    conn=conn,
    ambiente="PRD",
    produto="FIDI-ferias",
    versao="1.0.0",
    nivel="INFO",
    modulo="main",
    processo="processamento",
    acao="inicio",
    lote="LOTE001",
    mensagem="Processo iniciado",
    usuario="sistema",
    status_execucao=LogStatus.SUCESSO,
    hostname="server01",
    ip_origem="192.168.1.100"
)

# Usar constantes de status
status_db = DBStatus.NOVO
status_log = convert_status(status_db, 'db', 'log')
```

### M√≥dulo AWS - Clientes Padronizados

```python
from fidi_common_libraries.aws.common_aws import AWSClientFactory, AWSConfig, create_message_with_metadata

# Configura√ß√£o AWS
config = AWSConfig.from_env()  # Usa vari√°veis AWS_REGION, AWS_ACCESS_KEY_ID, etc.
factory = AWSClientFactory(config)

# Cliente SQS
sqs = factory.get_sqs_client()
message_id = sqs.send_message(
    queue_url="https://sqs.sa-east-1.amazonaws.com/123456789/my-queue",
    message={"data": "test"},
    message_attributes={"Type": {"StringValue": "ProcessData", "DataType": "String"}}
)

# Cliente SNS
sns = factory.get_sns_client()
sns.publish_message(
    topic_arn="arn:aws:sns:sa-east-1:123456789:my-topic",
    message=create_message_with_metadata({"event": "process_completed"}),
    subject="Processo Finalizado"
)

# Cliente Lambda
lambda_client = factory.get_lambda_client()
result = lambda_client.invoke_function(
    function_name="my-function",
    payload={"action": "process", "data": "test"}
)

# Cliente S3
s3 = factory.get_s3_client()
s3.upload_file("/path/to/file.txt", "my-bucket", "uploads/file.txt")
```

## üèóÔ∏è Estrutura do Projeto

```
fidi-common-libraries/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îî‚îÄ‚îÄ fidi_common_libraries/
‚îÇ       ‚îú‚îÄ‚îÄ aws/          # Utilit√°rios AWS
‚îÇ       ‚îú‚îÄ‚îÄ config/       # Gerenciamento de configura√ß√µes e par√¢metros
‚îÇ       ‚îú‚îÄ‚îÄ constants/    # Constantes e enums compartilhados
‚îÇ       ‚îú‚îÄ‚îÄ data/         # Processamento de dados e acesso a banco
‚îÇ       ‚îú‚îÄ‚îÄ ui/           # Automa√ß√£o de UI
‚îÇ       ‚îî‚îÄ‚îÄ utils/        # Utilit√°rios gerais e logging
‚îú‚îÄ‚îÄ tests/
‚îÇ   ‚îú‚îÄ‚îÄ unit/            # Testes unit√°rios
‚îÇ   ‚îú‚îÄ‚îÄ integration/     # Testes de integra√ß√£o
‚îÇ   ‚îî‚îÄ‚îÄ e2e/            # Testes end-to-end
‚îú‚îÄ‚îÄ docs/               # Documenta√ß√£o
‚îú‚îÄ‚îÄ scripts/            # Scripts auxiliares
‚îî‚îÄ‚îÄ resources/          # Recursos est√°ticos
```

## üß™ Testes

O projeto mant√©m uma cobertura de testes superior a 85%:

```bash
# Executar todos os testes
poetry run pytest

# Executar com cobertura
poetry run pytest --cov=src --cov-report=term-missing

# Executar apenas testes unit√°rios
poetry run pytest tests/unit/
```

## üìä Qualidade de C√≥digo

Ferramentas utilizadas:
- **Black**: Formata√ß√£o autom√°tica
- **Flake8**: Linting
- **MyPy**: Verifica√ß√£o de tipos
- **Bandit**: An√°lise de seguran√ßa

```bash
# Formata√ß√£o
poetry run black src/ tests/

# Linting
poetry run flake8 src/ tests/

# Verifica√ß√£o de tipos
poetry run mypy src/

# An√°lise de seguran√ßa
poetry run bandit -r src/
```

## üìö Documenta√ß√£o

- [INSTALL.md](INSTALL.md) - Guia completo de instala√ß√£o e uso
- [CHANGELOG.md](CHANGELOG.md) - Hist√≥rico de mudan√ßas
- [STATUS_ATUAL.md](STATUS_ATUAL.md) - Estado atual do projeto
- [src/fidi_common_libraries/config/ScriptsDB_Datametria_Parametros.sql](src/fidi_common_libraries/config/ScriptsDB_Datametria_Parametros.sql) - Script SQL para cria√ß√£o dos objetos de banco de dados para par√¢metros

> **Nota**: A partir da vers√£o 1.2.0, este projeto utiliza apenas a biblioteca `oracledb` para conex√µes Oracle, removendo a depend√™ncia do `cx_Oracle`.

## ü§ù Contribui√ß√£o

1. Siga as diretrizes estabelecidas em `.amazonq/rules/`
2. Mantenha a cobertura de testes acima de 85%
3. Execute os pre-commit hooks antes de fazer commit
4. Atualize a documenta√ß√£o conforme necess√°rio

## üìÑ Licen√ßa

Este projeto est√° licenciado sob os termos definidos no arquivo [LICENSE](LICENSE).