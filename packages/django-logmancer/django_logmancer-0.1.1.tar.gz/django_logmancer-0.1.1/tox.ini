[tox]
requires = tox>=4
env_list = 
    py313-django{52, 51}
    py312-django{52, 51, 50, 42}
    py311-django{52, 51, 50, 42}
    py310-django{52, 51, 50, 42}
    py39-django{42}

[testenv]
runner = uv-venv-lock-runner
package = wheel
wheel_build_env = .pkg
set_env =
    PYTHONDEVMODE = 1
deps = 
    django>=4.2,<6.0
    pytest>=7.0
    pytest-django>=4.5
    pytest-cov
    pytest-mock
    factory-boy
    freezegun
commands =
    python -m pytest tests/ -v --cov=logmancer --cov-report=term-missing

[testenv:lint]
deps =
    flake8>=6.0
    black>=23.0
    isort>=5.12
    bandit[toml]
allowlist_externals = python
commands =
    python -m flake8 logmancer/
    python -m black --check logmancer/
    python -m isort --check-only logmancer/
    python -m bandit -r logmancer/ -ll

[testenv:format]
deps =
    black>=23.0
    isort>=5.12
allowlist_externals = python
commands =
    python -m black logmancer/ tests/
    python -m isort logmancer/ tests/

[testenv:type]
deps =
    mypy>=1.0
    django-stubs
    types-requests
allowlist_externals = python
commands =
    python -m mypy logmancer/

[testenv:coverage]
deps = 
    {[testenv]deps}
    coverage[toml]>=7.0
allowlist_externals = python
commands =
    python -m coverage run --source=logmancer -m pytest tests/
    python -m coverage report --show-missing --fail-under=80
    python -m coverage html -d htmlcov
    python -m coverage xml
