from panoptes_aggregation.reducers.polygon_reducer import process_data, \
    polygon_reducer
from .base_test_class import ReducerTest
import numpy as np
import unittest
import shapely

'''This tests the reducer by providing 3 clusters of 3 regular polygons of different
rotations, sizes and number of sides. There are three outliers. The first is
simple. The second has a single self-intersection. The third has two
self-intersections. The latter two need to be processed, the first by removing
the small extract `triangle` and the second by splitting the shape in 2.

Finally, there is repeat data but labelled as for a second tool, to test if
the reducer can reduce mutiple tools for a single task.
'''

extracted_data = [
    {
        'frame0': {
            'T0_tool0_pathX': [
                [
                    -0.011871167727739784,
                    -0.28870602933343953,
                    -0.38037475471301413,
                    -0.2331790477845634,
                    0.06665584265632145,
                    0.3434907042620213,
                    0.4351594296415958,
                    0.2879637227131452,
                    -0.0118711677277397
                ], [
                    4.630602319839481,
                    5.081828653996981,
                    5.449443973123015,
                    5.225416400970543,
                    4.719344427837162,
                    4.630602319839481
                ], [
                    -1.726260190173002,
                    -2.14338918482516,
                    -2.3456481393346444,
                    -2.1307780991919705,
                    -1.7136491045398121,
                    -1.5113901500303277,
                    -1.726260190173002
                ]
            ],
            'T0_tool0_pathY': [
                [
                    0.361724434930079,
                    0.21452872800162825,
                    -0.08530616243925668,
                    -0.3621410240449564,
                    -0.453809749424531,
                    -0.30661404249608026,
                    -0.006779152055195435,
                    0.2700557095505044,
                    0.36172443493007894
                ], [
                    3.855330076852154,
                    3.615408779166577,
                    3.9704107662937083,
                    4.429735358097605,
                    4.358611580573953,
                    3.8553300768521543
                ], [
                    2.2716019279274726,
                    2.2643209142423775,
                    1.8994361013759973,
                    1.5418323021947127,
                    1.5491133158798083,
                    1.9139981287461882,
                    2.2716019279274726
                ]
            ],
            'T0_tool1_pathX': [
                [
                    -0.011871167727739784,
                    -0.28870602933343953,
                    -0.38037475471301413,
                    -0.2331790477845634,
                    0.06665584265632145,
                    0.3434907042620213,
                    0.4351594296415958,
                    0.2879637227131452,
                    -0.0118711677277397
                ]
            ],
            'T0_tool1_pathY': [
                [
                    0.361724434930079,
                    0.21452872800162825,
                    -0.08530616243925668,
                    -0.3621410240449564,
                    -0.453809749424531,
                    -0.30661404249608026,
                    -0.006779152055195435,
                    0.2700557095505044,
                    0.36172443493007894
                ]
            ],
            'gold_standard': False
        }
    },
    {
        'frame0': {
            'T0_tool0_pathX': [
                [
                    -0.49223768418803526,
                    -0.3894572368218461,
                    -0.06253880643091841,
                    0.24234136097970757,
                    0.2956022809277974,
                    0.05713739436766835,
                    -0.2934843753237021,
                    -0.49223768418803493
                ], [
                    4.665646912973787,
                    4.9452546176219245,
                    5.272656813475263,
                    5.401312969268549,
                    5.234342375582135,
                    4.897477295041295,
                    4.644384004088639,
                    4.665646912973787
                ], [
                    -2.0530832043103215,
                    -2.347496085003458,
                    -2.2484817914071478,
                    -1.855054617117701,
                    -1.5606417364245644,
                    -1.6596560300208743,
                    -2.053083204310321
                ]
            ],
            'T0_tool0_pathY': [
                [
                    -0.03531752424854295,
                    -0.3714972196452143,
                    -0.5007448417839794,
                    -0.32573429502333007,
                    0.021747909361406553,
                    0.2800405841233082,
                    0.2546440769562919,
                    -0.03531752424854333
                ], [
                    3.894600505351456,
                    3.6988170828153155,
                    3.795354221725569,
                    4.111517487484036,
                    4.409229492419295,
                    4.4643070245969305,
                    4.235275578910275,
                    3.8946005053514554
                ], [
                    2.3322557650241134,
                    2.047944550980137,
                    1.6508199100765353,
                    1.53800648321691,
                    1.8223176972608863,
                    2.219442338164488,
                    2.3322557650241134
                ]
            ],
            'T0_tool1_pathX': [
                [
                    -0.49223768418803526,
                    -0.3894572368218461,
                    -0.06253880643091841,
                    0.24234136097970757,
                    0.2956022809277974,
                    0.05713739436766835,
                    -0.2934843753237021,
                    -0.49223768418803493
                ]
            ],
            'T0_tool1_pathY': [
                [
                    -0.03531752424854295,
                    -0.3714972196452143,
                    -0.5007448417839794,
                    -0.32573429502333007,
                    0.021747909361406553,
                    0.2800405841233082,
                    0.2546440769562919,
                    -0.03531752424854333
                ]
            ],
            'gold_standard': False
        }
    },
    {
        'frame0': {
            'T0_tool0_pathX': [
                [
                    -0.15554523195117093,
                    0.19219246615042257,
                    0.44238509316213026,
                    0.40663249794462797,
                    0.11185711391672837,
                    -0.21996918242654376,
                    -0.3389744219158122,
                    -0.15554523195117032
                ], [
                    5.144708505321773,
                    4.860757556171935,
                    4.695377487814731,
                    4.7454457013476254,
                    4.98163291632684,
                    5.265583865476678,
                    5.4309639338338815,
                    5.3808957203009875,
                    5.144708505321773
                ], [
                    -1.8100930795620302,
                    -2.0695264316885313,
                    -2.262440502917424,
                    -2.298568655319627,
                    -2.1610061248664607,
                    -1.9141199483941913,
                    -1.6734309117084105,
                    -1.5515600900350757,
                    -1.6055321952784525,
                    -1.81009307956203
                ]
            ],
            'T0_tool0_pathY': [
                [
                    -0.25714285951044563,
                    -0.29983968008123657,
                    -0.05458843226212788,
                    0.2939316921253496,
                    0.4832779309024998,
                    0.3708687043107462,
                    0.04135045270402384,
                    -0.2571428595104454
                ], [
                    4.2683409230436045,
                    4.21827270951071,
                    3.9820854945314967,
                    3.698134545381657,
                    3.5327544770244548,
                    3.582822690557349,
                    3.819009905536562,
                    4.102960854686401,
                    4.2683409230436045
                ], [
                    2.3692156886043496,
                    2.360156076316269,
                    2.186455466379812,
                    1.9293903046514933,
                    1.7092442372650303,
                    1.6290260558015568,
                    1.7262707388936125,
                    1.9554764185681563,
                    2.2093952099680867,
                    2.3692156886043496
                ]
            ],
            'T0_tool1_pathX': [
                [
                    -0.15554523195117093,
                    0.19219246615042257,
                    0.44238509316213026,
                    0.40663249794462797,
                    0.11185711391672837,
                    -0.21996918242654376,
                    -0.3389744219158122,
                    -0.15554523195117032
                ]
            ],
            'T0_tool1_pathY': [
                [
                    -0.25714285951044563,
                    -0.29983968008123657,
                    -0.05458843226212788,
                    0.2939316921253496,
                    0.4832779309024998,
                    0.3708687043107462,
                    0.04135045270402384,
                    -0.2571428595104454
                ]
            ],
            'gold_standard': False
        }
    },
    {
        'frame0': {
            'T0_tool0_pathX': [
                [
                    -0.5708915716746895,
                    -0.18726366567733527,
                    -0.1163720940026457,
                    -0.42910842832531043,
                    -0.8127363343226647,
                    -0.8836279059973544,
                    -0.5708915716746896
                ], [
                    2.5,
                    2.5,
                    3.5,
                    3.5,
                    1.5,
                    2.5
                ], [
                    0.5,
                    0.5,
                    1.5,
                    1.5,
                    -0.5,
                    0.5,
                    0.2,
                    0.5
                ]
            ],
            'T0_tool0_pathY': [
                [
                    1.597953918397208,
                    1.7375830572141175,
                    2.1396291388169097,
                    2.4020460816027924,
                    2.2624169427858827,
                    1.8603708611830907,
                    1.597953918397208
                ], [
                    2.,
                    3.,
                    3.,
                    2.,
                    2.2,
                    2.
                ], [
                    3.5,
                    4.5,
                    4.5,
                    3.5,
                    3.7,
                    5.7,
                    1.3,
                    3.5
                ]
            ],
            'gold_standard': False
        }
    }
]

kwargs_extra_data = {
    'created_at': [
        '2025-01-21 10:46:20 UTC',
        '2025-01-25 11:46:20 UTC',
        '2025-01-26 16:46:20 UTC',
        '2025-01-28 17:46:20 UTC'
    ]
}

# Ideally the comparison between the result and expectation would be done with
# shape.equal(), but that is awkward to implement, so doing it brute force here
processed_data = {
    'frame0': {
        'T0_tool0': {
            'X': [
                [0, 0],
                [1, 0],
                [2, 0],
                [3, 1],
                [4, 1],
                [5, 1],
                [6, 2],
                [7, 2],
                [8, 2],
                [9, 3],
                [10, 3],
                [11, 3]
            ],
            'data': [
                {
                    'polygon': shapely.Polygon(np.array([
                        [-0.011871167727739784, -0.28870602933343953, -0.38037475471301413, -0.2331790477845634, 0.06665584265632145, 0.3434907042620213, 0.4351594296415958, 0.2879637227131452, -0.0118711677277397],
                        [0.361724434930079, 0.21452872800162825, -0.08530616243925668, -0.3621410240449564, -0.453809749424531, -0.30661404249608026, -0.006779152055195435, 0.2700557095505044, 0.36172443493007894]
                    ]).T),
                    'gold_standard': False
                }, {
                    'polygon': shapely.Polygon(np.array([
                        [4.630602319839481, 5.081828653996981, 5.449443973123015, 5.225416400970543, 4.719344427837162, 4.630602319839481],
                        [3.855330076852154, 3.615408779166577, 3.9704107662937083, 4.429735358097605, 4.358611580573953, 3.8553300768521543]
                    ]).T),
                    'gold_standard': False
                }, {
                    'polygon': shapely.Polygon(np.array([
                        [-1.726260190173002, -2.14338918482516, -2.3456481393346444, -2.1307780991919705, -1.7136491045398121, -1.5113901500303277, -1.726260190173002],
                        [2.2716019279274726, 2.2643209142423775, 1.8994361013759973, 1.5418323021947127, 1.5491133158798083, 1.9139981287461882, 2.2716019279274726]
                    ]).T),
                    'gold_standard': False
                }, {
                    'polygon': shapely.Polygon(np.array([
                        [-0.49223768418803526, -0.3894572368218461, -0.06253880643091841, 0.24234136097970757, 0.2956022809277974, 0.05713739436766835, -0.2934843753237021, -0.49223768418803493],
                        [-0.03531752424854295, -0.3714972196452143, -0.5007448417839794, -0.32573429502333007, 0.021747909361406553, 0.2800405841233082, 0.2546440769562919, -0.03531752424854333]
                    ]).T),
                    'gold_standard': False
                }, {
                    'polygon': shapely.Polygon(np.array([
                        [4.665646912973787, 4.9452546176219245, 5.272656813475263, 5.401312969268549, 5.234342375582135, 4.897477295041295, 4.644384004088639, 4.665646912973787],
                        [3.894600505351456, 3.6988170828153155, 3.795354221725569, 4.111517487484036, 4.409229492419295, 4.4643070245969305, 4.235275578910275, 3.8946005053514554]
                    ]).T),
                    'gold_standard': False
                }, {
                    'polygon': shapely.Polygon(np.array([
                        [-2.0530832043103215, -2.347496085003458, -2.2484817914071478, -1.855054617117701, -1.5606417364245644, -1.6596560300208743, -2.053083204310321],
                        [2.3322557650241134, 2.047944550980137, 1.6508199100765353, 1.53800648321691, 1.8223176972608863, 2.219442338164488, 2.3322557650241134]
                    ]).T),
                    'gold_standard': False
                }, {
                    'polygon': shapely.Polygon(np.array([
                        [-0.15554523195117093, 0.19219246615042257, 0.44238509316213026, 0.40663249794462797, 0.11185711391672837, -0.21996918242654376, -0.3389744219158122, -0.15554523195117032],
                        [-0.25714285951044563, -0.29983968008123657, -0.05458843226212788, 0.2939316921253496, 0.4832779309024998, 0.3708687043107462, 0.04135045270402384, -0.2571428595104454]
                    ]).T),
                    'gold_standard': False
                }, {
                    'polygon': shapely.Polygon(np.array([
                        [5.144708505321773, 4.860757556171935, 4.695377487814731, 4.7454457013476254, 4.98163291632684, 5.265583865476678, 5.4309639338338815, 5.3808957203009875, 5.144708505321773],
                        [4.2683409230436045, 4.21827270951071, 3.9820854945314967, 3.698134545381657, 3.5327544770244548, 3.582822690557349, 3.819009905536562, 4.102960854686401, 4.2683409230436045]
                    ]).T),
                    'gold_standard': False
                }, {
                    'polygon': shapely.Polygon(np.array([
                        [-1.8100930795620302, -2.0695264316885313, -2.262440502917424, -2.298568655319627, -2.1610061248664607, -1.9141199483941913, -1.6734309117084105, -1.5515600900350757, -1.6055321952784525, -1.81009307956203],
                        [2.3692156886043496, 2.360156076316269, 2.186455466379812, 1.9293903046514933, 1.7092442372650303, 1.6290260558015568, 1.7262707388936125, 1.9554764185681563, 2.2093952099680867, 2.3692156886043496]
                    ]).T),
                    'gold_standard': False
                }, {
                    'polygon': shapely.Polygon(np.array([
                        [-0.5708915716746895, -0.18726366567733527, -0.1163720940026457, -0.42910842832531043, -0.8127363343226647, -0.8836279059973544, -0.5708915716746896],
                        [1.597953918397208, 1.7375830572141175, 2.1396291388169097, 2.4020460816027924, 2.2624169427858827, 1.8603708611830907, 1.597953918397208]
                    ]).T),
                    'gold_standard': False
                }, {
                    'polygon': shapely.Polygon(np.array([
                        [2.5, 2.5, 3.5, 3.5, 2.5],
                        [2.1, 3.0, 3.0, 2.0, 2.1]
                    ]).T),
                    'gold_standard': False
                }, {
                    'polygon': shapely.Polygon(np.array([
                        [0.5, 0.5, 1.5, 1.5, 0.5],
                        [3.6, 4.5, 4.5, 3.5, 3.6]
                    ]).T),
                    'gold_standard': False
                }
            ]
        },
        'T0_tool1': {
            'X': [
                [0, 0],
                [1, 1],
                [2, 2]
            ],
            'data': [
                {
                    'polygon': shapely.Polygon(np.array([
                        [-0.011871167727739784, -0.28870602933343953, -0.38037475471301413, -0.2331790477845634, 0.06665584265632145, 0.3434907042620213, 0.4351594296415958, 0.2879637227131452, -0.0118711677277397],
                        [0.361724434930079, 0.21452872800162825, -0.08530616243925668, -0.3621410240449564, -0.453809749424531, -0.30661404249608026, -0.006779152055195435, 0.2700557095505044, 0.36172443493007894]
                    ]).T),
                    'gold_standard': False
                }, {
                    'polygon': shapely.Polygon(np.array([
                        [-0.49223768418803526, -0.3894572368218461, -0.06253880643091841, 0.24234136097970757, 0.2956022809277974, 0.05713739436766835, -0.2934843753237021, -0.49223768418803493],
                        [-0.03531752424854295, -0.3714972196452143, -0.5007448417839794, -0.32573429502333007, 0.021747909361406553, 0.2800405841233082, 0.2546440769562919, -0.03531752424854333]
                    ]).T),
                    'gold_standard': False
                }, {
                    'polygon': shapely.Polygon(np.array([
                        [-0.15554523195117093, 0.19219246615042257, 0.44238509316213026, 0.40663249794462797, 0.11185711391672837, -0.21996918242654376, -0.3389744219158122, -0.15554523195117032],
                        [-0.25714285951044563, -0.29983968008123657, -0.05458843226212788, 0.2939316921253496, 0.4832779309024998, 0.3708687043107462, 0.04135045270402384, -0.2571428595104454]
                    ]).T),
                    'gold_standard': False
                }
            ]
        }
    }
}


# Test error is correctly thrown
class TestException(unittest.TestCase):
    def testexception(self):
        with self.assertRaises(Exception) as context:
            polygon_reducer._original(processed_data, **{'average_type': 'incorrect'})

        self.assertTrue("`average_type` not valid. Should be either `intersection`, `union`, `median` or `last`." in str(context.exception))


reduced_data_last = {
    'frame0':
        {
            'T0_tool0_cluster_labels': [0, 1, 2, 0, 1, 2, 0, 1, 2, -1, -1, -1],
            'T0_tool0_clusters_count': [3, 3, 3],
            'T0_tool0_consensus': [0.5723807679762805, 0.6353380315630046, 0.7645350003018981],
            'T0_tool0_clusters_x': [
                [
                    -0.15554523195117093,
                    0.19219246615042257,
                    0.44238509316213026,
                    0.40663249794462797,
                    0.11185711391672837,
                    -0.21996918242654376,
                    -0.3389744219158122,
                    -0.15554523195117032,
                    -0.15554523195117093
                ], [
                    5.144708505321773,
                    4.860757556171935,
                    4.695377487814731,
                    4.7454457013476254,
                    4.98163291632684,
                    5.265583865476678,
                    5.4309639338338815,
                    5.3808957203009875,
                    5.144708505321773
                ], [
                    -1.8100930795620302,
                    -2.0695264316885313,
                    -2.262440502917424,
                    -2.298568655319627,
                    -2.1610061248664607,
                    -1.9141199483941913,
                    -1.6734309117084105,
                    -1.5515600900350757,
                    -1.6055321952784525,
                    -1.81009307956203,
                    -1.8100930795620302
                ]
            ],
            'T0_tool0_clusters_y': [
                [
                    -0.25714285951044563,
                    -0.29983968008123657,
                    -0.05458843226212788,
                    0.2939316921253496,
                    0.4832779309024998,
                    0.3708687043107462,
                    0.04135045270402384,
                    -0.2571428595104454,
                    -0.25714285951044563
                ], [
                    4.2683409230436045,
                    4.21827270951071,
                    3.9820854945314967,
                    3.698134545381657,
                    3.5327544770244548,
                    3.582822690557349,
                    3.819009905536562,
                    4.102960854686401,
                    4.2683409230436045
                ], [
                    2.3692156886043496,
                    2.360156076316269,
                    2.186455466379812,
                    1.9293903046514933,
                    1.7092442372650303,
                    1.6290260558015568,
                    1.7262707388936125,
                    1.9554764185681563,
                    2.2093952099680867,
                    2.3692156886043496,
                    2.3692156886043496
                ]
            ],
            'T0_tool1_cluster_labels': [0, 0, 0],
            'T0_tool1_clusters_count': [3],
            'T0_tool1_consensus': [0.5723807679762805],
            'T0_tool1_clusters_x': [
                [
                    -0.15554523195117093,
                    0.19219246615042257,
                    0.44238509316213026,
                    0.40663249794462797,
                    0.11185711391672837,
                    -0.21996918242654376,
                    -0.3389744219158122,
                    -0.15554523195117032,
                    -0.15554523195117093
                ]
            ],
            'T0_tool1_clusters_y': [
                [
                    -0.25714285951044563,
                    -0.29983968008123657,
                    -0.05458843226212788,
                    0.2939316921253496,
                    0.4832779309024998,
                    0.3708687043107462,
                    0.04135045270402384,
                    -0.2571428595104454,
                    -0.25714285951044563
                ]
            ]
        },
        'parameters': {
            'eps': 0.5,
            'min_samples': 2,
            'average_type': 'last'
        }
}

TestPolygonTReducerLast = ReducerTest(
    polygon_reducer,
    process_data,
    extracted_data,
    processed_data,
    reduced_data_last,
    'Test polygon reducer with a series of polygons in 3 clusters using last average',
    kwargs={
        'eps': 0.5,
        'min_samples': 2,
        'average_type': 'last'
    },
    output_kwargs=True,
    network_kwargs=kwargs_extra_data,
    test_name='TestPolygonTReducerLast'
)

reduced_data_median = {
    'frame0':
        {
            'T0_tool0_cluster_labels': [0, 1, 2, 0, 1, 2, 0, 1, 2, -1, -1, -1],
            'T0_tool0_clusters_count': [3, 3, 3],
            'T0_tool0_consensus': [0.5723807679762805, 0.6353380315630046, 0.7645350003018981],
            'T0_tool0_clusters_x': [
                [
                    -0.011871167727739784,
                    -0.28870602933343953,
                    -0.38037475471301413,
                    -0.2331790477845634,
                    0.06665584265632145,
                    0.3434907042620213,
                    0.4351594296415958,
                    0.2879637227131452,
                    -0.0118711677277397,
                    -0.011871167727739784
                ], [
                    4.630602319839481,
                    5.081828653996981,
                    5.449443973123015,
                    5.225416400970543,
                    4.719344427837162,
                    4.630602319839481,
                    4.630602319839481
                ], [
                    -2.0530832043103215,
                    -2.347496085003458,
                    -2.2484817914071478,
                    -1.855054617117701,
                    -1.5606417364245644,
                    -1.6596560300208743,
                    -2.053083204310321,
                    -2.0530832043103215
                ]
            ],
            'T0_tool0_clusters_y': [
                [
                    0.361724434930079,
                    0.21452872800162825,
                    -0.08530616243925668,
                    -0.3621410240449564,
                    -0.453809749424531,
                    -0.30661404249608026,
                    -0.006779152055195435,
                    0.2700557095505044,
                    0.36172443493007894,
                    0.361724434930079
                ], [
                    3.855330076852154,
                    3.615408779166577,
                    3.9704107662937083,
                    4.429735358097605,
                    4.358611580573953,
                    3.8553300768521543,
                    3.855330076852154
                ], [
                    2.3322557650241134,
                    2.047944550980137,
                    1.6508199100765353,
                    1.53800648321691,
                    1.8223176972608863,
                    2.219442338164488,
                    2.3322557650241134,
                    2.3322557650241134
                ]
            ],
            'T0_tool1_cluster_labels': [0, 0, 0],
            'T0_tool1_clusters_count': [3],
            'T0_tool1_consensus': [0.5723807679762805],
            'T0_tool1_clusters_x': [
                [
                    -0.011871167727739784,
                    -0.28870602933343953,
                    -0.38037475471301413,
                    -0.2331790477845634,
                    0.06665584265632145,
                    0.3434907042620213,
                    0.4351594296415958,
                    0.2879637227131452,
                    -0.0118711677277397,
                    -0.011871167727739784
                ]
            ],
            'T0_tool1_clusters_y': [
                [
                    0.361724434930079,
                    0.21452872800162825,
                    -0.08530616243925668,
                    -0.3621410240449564,
                    -0.453809749424531,
                    -0.30661404249608026,
                    -0.006779152055195435,
                    0.2700557095505044,
                    0.36172443493007894,
                    0.361724434930079
                ]
            ]
        },
        'parameters': {
            'eps': 0.5,
            'min_samples': 2,
            'average_type': 'median'
        }
}

TestPolygonTReducerMedian = ReducerTest(
    polygon_reducer,
    process_data,
    extracted_data,
    processed_data,
    reduced_data_median,
    'Test polygon reducer with a series of polygons in 3 clusters using median average',
    kwargs={
        'eps': 0.5,
        'min_samples': 2,
        'average_type': 'median'
    },
    output_kwargs=True,
    network_kwargs=kwargs_extra_data,
    test_name='TestPolygonTReducerMedian'
)


# Now let's the intersection version
reduced_data_intersection = {
    'frame0':
        {
            'T0_tool0_cluster_labels': [0, 1, 2, 0, 1, 2, 0, 1, 2, -1, -1, -1],
            'T0_tool0_clusters_count': [3, 3, 3],
            'T0_tool0_consensus': [0.5723807679762805, 0.6353380315630046, 0.7645350003018981],
            'T0_tool0_clusters_x': [
                [
                    -0.20060780558908908,
                    0.05713739436766835,
                    0.2956022809277974,
                    0.25587931382701484,
                    0.19219246615042257,
                    -0.15554523195117093,
                    -0.15554523195117032,
                    -0.3389744219158122,
                    -0.27351395358024566,
                    -0.20060780558908908
                ], [
                    4.9452546176219245,
                    4.7171640385013776,
                    4.695377487814731,
                    4.860757556171935,
                    5.144708505321773,
                    5.3808957203009875,
                    5.386015510591181,
                    5.275562930243272,
                    5.266194425673992,
                    4.9452546176219245
                ], [
                    -1.7022599463686408,
                    -1.6346450301820536,
                    -1.5803444407979248,
                    -1.6734309117084105,
                    -1.9141199483941913,
                    -2.1610061248664607,
                    -2.298568655319627,
                    -2.288217289968108,
                    -2.1663776913581434,
                    -2.1230644265945626,
                    -1.8349423242472744,
                    -1.7022599463686408
                ]
            ],
            'T0_tool0_clusters_y': [
                [
                    0.2613713844791226,
                    0.2800405841233082,
                    0.021747909361406553,
                    -0.23741066668901195,
                    -0.29983968008123657,
                    -0.25714285951044563,
                    -0.2571428595104454,
                    0.04135045270402384,
                    0.2226064979661171,
                    0.2613713844791226
                ], [
                    3.6988170828153155,
                    3.858527825710141,
                    3.9820854945314967,
                    4.21827270951071,
                    4.2683409230436045,
                    4.102960854686401,
                    4.073925081093372,
                    3.8024957950329927,
                    3.79344873533371,
                    3.6988170828153155
                ], [
                    2.231658814592464,
                    2.1191286968822776,
                    1.9013409283006542,
                    1.7262707388936125,
                    1.6290260558015568,
                    1.7092442372650303,
                    1.9293903046514933,
                    2.0030440962590284,
                    2.222848550634506,
                    2.2646756842169427,
                    2.269704874220669,
                    2.231658814592464
                ]
            ],
            'T0_tool1_cluster_labels': [0, 0, 0],
            'T0_tool1_clusters_count': [3],
            'T0_tool1_consensus': [0.5723807679762805],
            'T0_tool1_clusters_x': [
                [
                    -0.20060780558908908,
                    0.05713739436766835,
                    0.2956022809277974,
                    0.25587931382701484,
                    0.19219246615042257,
                    -0.15554523195117093,
                    -0.15554523195117032,
                    -0.3389744219158122,
                    -0.27351395358024566,
                    -0.20060780558908908
                ]
            ],
            'T0_tool1_clusters_y': [
                [
                    0.2613713844791226,
                    0.2800405841233082,
                    0.021747909361406553,
                    -0.23741066668901195,
                    -0.29983968008123657,
                    -0.25714285951044563,
                    -0.2571428595104454,
                    0.04135045270402384,
                    0.2226064979661171,
                    0.2613713844791226
                ]
            ]
        },
        'parameters': {
            'eps': 0.5,
            'min_samples': 2,
            'average_type': 'intersection'
        }
}

TestPolygonTReducerIntersection = ReducerTest(
    polygon_reducer,
    process_data,
    extracted_data,
    processed_data,
    reduced_data_intersection,
    'Test polygon reducer with a series of polygons in 3 clusters using intersection average',
    kwargs={
        'eps': 0.5,
        'min_samples': 2,
        'average_type': 'intersection'
    },
    output_kwargs=True,
    network_kwargs=kwargs_extra_data,
    test_name='TestPolygonTReducerIntersection'
)

reduced_data_union = {
    'frame0':
        {
            'T0_tool0_cluster_labels': [0, 1, 2, 0, 1, 2, 0, 1, 2, -1, -1, -1],
            'T0_tool0_clusters_count': [3, 3, 3],
            'T0_tool0_consensus': [0.5723807679762805, 0.6353380315630046, 0.7645350003018981],
            'T0_tool0_clusters_x': [
                [
                    -0.06253880643091841,
                    -0.3894572368218461,
                    -0.49223768418803526,
                    -0.49223768418803493,
                    -0.2934843753237021,
                    -0.2610963698935616,
                    -0.21996918242654376,
                    0.11185711391672837,
                    0.40663249794462797,
                    0.44238509316213026,
                    0.4111953308040009,
                    0.3434907042620213,
                    0.06665584265632145,
                    0.035708140618821,
                    -0.06253880643091841
                ], [
                    5.4309639338338815,
                    5.265583865476678,
                    4.98163291632684,
                    4.7454457013476254,
                    4.726741378282931,
                    4.630602319839481,
                    4.630602319839481,
                    4.658295462956292,
                    4.644384004088639,
                    4.707699854782151,
                    4.719344427837162,
                    4.791954327443189,
                    4.897477295041295,
                    5.162772021619619,
                    5.225416400970543,
                    5.24259169742927,
                    5.401312969268549,
                    5.391901686905876,
                    5.449443973123015,
                    5.410841064166533,
                    5.4309639338338815
                ], [
                    -2.3456481393346444,
                    -2.3213831520236607,
                    -2.347496085003458,
                    -2.2716074328809563,
                    -2.262440502917424,
                    -2.0695264316885313,
                    -1.8100930795620302,
                    -1.81009307956203,
                    -1.6055321952784525,
                    -1.5599064027625509,
                    -1.5113901500303277,
                    -1.561128116636017,
                    -1.5606417364245644,
                    -1.5640152526307798,
                    -1.7136491045398121,
                    -1.8459444260649625,
                    -1.855054617117701,
                    -1.8834523076541,
                    -2.1307780991919705,
                    -2.1853949812266844,
                    -2.2484817914071478,
                    -2.2855174523162423,
                    -2.3456481393346444
                ]
            ],
            'T0_tool0_clusters_y': [
                [
                    -0.5007448417839794,
                    -0.3714972196452143,
                    -0.03531752424854295,
                    -0.03531752424854333,
                    0.2546440769562919,
                    0.25699003001207604,
                    0.3708687043107462,
                    0.4832779309024998,
                    0.2939316921253496,
                    -0.05458843226212788,
                    -0.08516218748775546,
                    -0.30661404249608026,
                    -0.453809749424531,
                    -0.44434808739102644,
                    -0.5007448417839794
                ], [
                    3.819009905536562,
                    3.582822690557349,
                    3.5327544770244548,
                    3.698134545381657,
                    3.8042120327267175,
                    3.855330076852154,
                    3.8553300768521543,
                    4.012385695938597,
                    4.235275578910275,
                    4.292571925109859,
                    4.358611580573953,
                    4.368816236472241,
                    4.4643070245969305,
                    4.420931264734213,
                    4.429735358097605,
                    4.394520781788013,
                    4.111517487484036,
                    4.088389936777963,
                    3.9704107662937083,
                    3.9331323704395342,
                    3.819009905536562
                ], [
                    1.8994361013759973,
                    1.943211297266067,
                    2.047944550980137,
                    2.1212293704700755,
                    2.186455466379812,
                    2.360156076316269,
                    2.3692156886043496,
                    2.3692156886043496,
                    2.2093952099680867,
                    1.9947427327289593,
                    1.9139981287461882,
                    1.8242684617394296,
                    1.8223176972608863,
                    1.8190599305289143,
                    1.5491133158798083,
                    1.5468040924528874,
                    1.53800648321691,
                    1.546149389944429,
                    1.5418323021947127,
                    1.6327300583550457,
                    1.6508199100765353,
                    1.7993618327116296,
                    1.8994361013759973
                ]
            ],
            'T0_tool1_cluster_labels': [0, 0, 0],
            'T0_tool1_clusters_count': [3],
            'T0_tool1_consensus': [0.5723807679762805],
            'T0_tool1_clusters_x': [
                [
                    -0.06253880643091841,
                    -0.3894572368218461,
                    -0.49223768418803526,
                    -0.49223768418803493,
                    -0.2934843753237021,
                    -0.2610963698935616,
                    -0.21996918242654376,
                    0.11185711391672837,
                    0.40663249794462797,
                    0.44238509316213026,
                    0.4111953308040009,
                    0.3434907042620213,
                    0.06665584265632145,
                    0.035708140618821,
                    -0.06253880643091841
                ]
            ],
            'T0_tool1_clusters_y': [
                [
                    -0.5007448417839794,
                    -0.3714972196452143,
                    -0.03531752424854295,
                    -0.03531752424854333,
                    0.2546440769562919,
                    0.25699003001207604,
                    0.3708687043107462,
                    0.4832779309024998,
                    0.2939316921253496,
                    -0.05458843226212788,
                    -0.08516218748775546,
                    -0.30661404249608026,
                    -0.453809749424531,
                    -0.44434808739102644,
                    -0.5007448417839794
                ]
            ]
        },
        'parameters': {
            'eps': 0.5,
            'min_samples': 2,
            'average_type': 'union'
        }
}

TestPolygonTReducerUnion = ReducerTest(
    polygon_reducer,
    process_data,
    extracted_data,
    processed_data,
    reduced_data_union,
    'Test polygon reducer with a series of polygons in 3 clusters using union average',
    kwargs={
        'eps': 0.5,
        'min_samples': 2,
        'average_type': 'union'
    },
    output_kwargs=True,
    network_kwargs=kwargs_extra_data,
    test_name='TestPolygonTReducerUnion'
)

# This is for the case of the strange data format
extracted_data_different_format = [
    {
        'classifier_version': 2.0,
        'frame0': {
            'T0_tool0_pathX': [
                [
                    -0.011871167727739784,
                    -0.28870602933343953,
                    -0.38037475471301413,
                    -0.2331790477845634,
                    0.06665584265632145,
                    0.3434907042620213,
                    0.4351594296415958,
                    0.2879637227131452,
                    -0.0118711677277397
                ], [
                    4.630602319839481,
                    5.081828653996981,
                    5.449443973123015,
                    5.225416400970543,
                    4.719344427837162,
                    4.630602319839481
                ], [
                    -1.726260190173002,
                    -2.14338918482516,
                    -2.3456481393346444,
                    -2.1307780991919705,
                    -1.7136491045398121,
                    -1.5113901500303277,
                    -1.726260190173002
                ]
            ],
            'T0_tool0_pathY': [
                [
                    0.361724434930079,
                    0.21452872800162825,
                    -0.08530616243925668,
                    -0.3621410240449564,
                    -0.453809749424531,
                    -0.30661404249608026,
                    -0.006779152055195435,
                    0.2700557095505044,
                    0.36172443493007894
                ], [
                    3.855330076852154,
                    3.615408779166577,
                    3.9704107662937083,
                    4.429735358097605,
                    4.358611580573953,
                    3.8553300768521543
                ], [
                    2.2716019279274726,
                    2.2643209142423775,
                    1.8994361013759973,
                    1.5418323021947127,
                    1.5491133158798083,
                    1.9139981287461882,
                    2.2716019279274726
                ]
            ],
            'T0_tool1_pathX': [
                [
                    -0.011871167727739784,
                    -0.28870602933343953,
                    -0.38037475471301413,
                    -0.2331790477845634,
                    0.06665584265632145,
                    0.3434907042620213,
                    0.4351594296415958,
                    0.2879637227131452,
                    -0.0118711677277397
                ]
            ],
            'T0_tool1_pathY': [
                [
                    0.361724434930079,
                    0.21452872800162825,
                    -0.08530616243925668,
                    -0.3621410240449564,
                    -0.453809749424531,
                    -0.30661404249608026,
                    -0.006779152055195435,
                    0.2700557095505044,
                    0.36172443493007894
                ]
            ],
            'gold_standard': False
        }
    },
    {
        'classifier_version': 2.0,
        'frame0': {
            'T0_tool0_pathX': [
                [
                    -0.49223768418803526,
                    -0.3894572368218461,
                    -0.06253880643091841,
                    0.24234136097970757,
                    0.2956022809277974,
                    0.05713739436766835,
                    -0.2934843753237021,
                    -0.49223768418803493
                ], [
                    4.665646912973787,
                    4.9452546176219245,
                    5.272656813475263,
                    5.401312969268549,
                    5.234342375582135,
                    4.897477295041295,
                    4.644384004088639,
                    4.665646912973787
                ], [
                    -2.0530832043103215,
                    -2.347496085003458,
                    -2.2484817914071478,
                    -1.855054617117701,
                    -1.5606417364245644,
                    -1.6596560300208743,
                    -2.053083204310321
                ]
            ],
            'T0_tool0_pathY': [
                [
                    -0.03531752424854295,
                    -0.3714972196452143,
                    -0.5007448417839794,
                    -0.32573429502333007,
                    0.021747909361406553,
                    0.2800405841233082,
                    0.2546440769562919,
                    -0.03531752424854333
                ], [
                    3.894600505351456,
                    3.6988170828153155,
                    3.795354221725569,
                    4.111517487484036,
                    4.409229492419295,
                    4.4643070245969305,
                    4.235275578910275,
                    3.8946005053514554
                ], [
                    2.3322557650241134,
                    2.047944550980137,
                    1.6508199100765353,
                    1.53800648321691,
                    1.8223176972608863,
                    2.219442338164488,
                    2.3322557650241134
                ]
            ],
            'T0_tool1_pathX': [
                [
                    -0.49223768418803526,
                    -0.3894572368218461,
                    -0.06253880643091841,
                    0.24234136097970757,
                    0.2956022809277974,
                    0.05713739436766835,
                    -0.2934843753237021,
                    -0.49223768418803493
                ]
            ],
            'T0_tool1_pathY': [
                [
                    -0.03531752424854295,
                    -0.3714972196452143,
                    -0.5007448417839794,
                    -0.32573429502333007,
                    0.021747909361406553,
                    0.2800405841233082,
                    0.2546440769562919,
                    -0.03531752424854333
                ]
            ],
            'gold_standard': False
        }
    },
    {
        'classifier_version': 2.0,
        'frame0': {
            'T0_tool0_pathX': [
                [
                    -0.15554523195117093,
                    0.19219246615042257,
                    0.44238509316213026,
                    0.40663249794462797,
                    0.11185711391672837,
                    -0.21996918242654376,
                    -0.3389744219158122,
                    -0.15554523195117032
                ], [
                    5.144708505321773,
                    4.860757556171935,
                    4.695377487814731,
                    4.7454457013476254,
                    4.98163291632684,
                    5.265583865476678,
                    5.4309639338338815,
                    5.3808957203009875,
                    5.144708505321773
                ], [
                    -1.8100930795620302,
                    -2.0695264316885313,
                    -2.262440502917424,
                    -2.298568655319627,
                    -2.1610061248664607,
                    -1.9141199483941913,
                    -1.6734309117084105,
                    -1.5515600900350757,
                    -1.6055321952784525,
                    -1.81009307956203
                ]
            ],
            'T0_tool0_pathY': [
                [
                    -0.25714285951044563,
                    -0.29983968008123657,
                    -0.05458843226212788,
                    0.2939316921253496,
                    0.4832779309024998,
                    0.3708687043107462,
                    0.04135045270402384,
                    -0.2571428595104454
                ], [
                    4.2683409230436045,
                    4.21827270951071,
                    3.9820854945314967,
                    3.698134545381657,
                    3.5327544770244548,
                    3.582822690557349,
                    3.819009905536562,
                    4.102960854686401,
                    4.2683409230436045
                ], [
                    2.3692156886043496,
                    2.360156076316269,
                    2.186455466379812,
                    1.9293903046514933,
                    1.7092442372650303,
                    1.6290260558015568,
                    1.7262707388936125,
                    1.9554764185681563,
                    2.2093952099680867,
                    2.3692156886043496
                ]
            ],
            'T0_tool1_pathX': [
                [
                    -0.15554523195117093,
                    0.19219246615042257,
                    0.44238509316213026,
                    0.40663249794462797,
                    0.11185711391672837,
                    -0.21996918242654376,
                    -0.3389744219158122,
                    -0.15554523195117032
                ]
            ],
            'T0_tool1_pathY': [
                [
                    -0.25714285951044563,
                    -0.29983968008123657,
                    -0.05458843226212788,
                    0.2939316921253496,
                    0.4832779309024998,
                    0.3708687043107462,
                    0.04135045270402384,
                    -0.2571428595104454
                ]
            ],
            'gold_standard': False
        }
    },
    {
        'classifier_version': 2.0,
        'frame0': {
            'T0_tool0_pathX': [
                [
                    -0.5708915716746895,
                    -0.18726366567733527,
                    -0.1163720940026457,
                    -0.42910842832531043,
                    -0.8127363343226647,
                    -0.8836279059973544,
                    -0.5708915716746896
                ],
                [
                    2.5,
                    2.5,
                    3.5,
                    3.5,
                    1.5,
                    2.5
                ], [
                    0.5,
                    0.5,
                    1.5,
                    1.5,
                    -0.5,
                    0.5,
                    0.2,
                    0.5
                ]
            ],
            'T0_tool0_pathY': [
                [
                    1.597953918397208,
                    1.7375830572141175,
                    2.1396291388169097,
                    2.4020460816027924,
                    2.2624169427858827,
                    1.8603708611830907,
                    1.597953918397208
                ], [
                    2.,
                    3.,
                    3.,
                    2.,
                    2.2,
                    2.
                ], [
                    3.5,
                    4.5,
                    4.5,
                    3.5,
                    3.7,
                    5.7,
                    1.3,
                    3.5
                ]
            ],
            'gold_standard': False
        }
    }
]


TestPolygonTReducerUnionDifferentExtractionFormat = ReducerTest(
    polygon_reducer,
    process_data,
    extracted_data_different_format,
    processed_data,
    reduced_data_union,
    'Test polygon reducer with a series of polygons in 3 clusters using union average for when classification version is included',
    kwargs={
        'eps': 0.5,
        'min_samples': 2,
        'average_type': 'union'
    },
    output_kwargs=True,
    network_kwargs=kwargs_extra_data,
    test_name='TestPolygonTReducerUnionDifferentExtractionFormat'
)


# Testing it it can handle empty intersection
extracted_data_no_overall_intersection = [
    {
        'frame0': {
            'T0_tool0_pathX': [
                [
                    0.21554927386591496,
                    0.8346610570311462,
                    0.36812686536062333,
                    -0.25098491780460797,
                    0.2155492738659148
                ]
            ],
            'T0_tool0_pathY': [
                [
                    -0.25858097547222986,
                    0.20795321619829304,
                    0.8270649993635244,
                    0.3605308076930015,
                    -0.25858097547222986
                ]
            ],
            'gold_standard': False
        }
    },
    {
        'frame0': {
            'T0_tool0_pathX': [
                [
                    0.3693081708169513,
                    0.553908720812514,
                    0.5957542682751744,
                    0.47526481648569685,
                    0.2488187190274737,
                    0.022372621569250545,
                    -0.09811683022022713,
                    -0.05627128275756679,
                    0.12832926723799587,
                    0.36930817081695105
                ]
            ],
            'T0_tool0_pathY': [
                [
                    -0.5218849589408747,
                    -0.3669867055244751,
                    -0.1296688129675387,
                    0.07902503930795732,
                    0.16144467844849417,
                    0.07902503930795748,
                    -0.1296688129675385,
                    -0.366986705524475,
                    -0.5218849589408747,
                    -0.5218849589408747
                ]
            ],
            'gold_standard': False
        }
    },
    {
        'frame0': {
            'T0_tool0_pathX': [
                [
                    0.09127357717866474,
                    0.024685520754786305,
                    -0.21171962328979593,
                    -0.5073252607061052,
                    -0.7238142284563371,
                    -0.7598889325232856,
                    -0.5986696179483486,
                    -0.3155925937742383,
                    -0.04311274566270751,
                    0.0912735771786648
                ]
            ],
            'T0_tool0_pathY': [
                [
                    0.3044349351140881,
                    0.5928594950295896,
                    0.7710035487895189,
                    0.7555115137889823,
                    0.5536322853795214,
                    0.2598273981716289,
                    0.011571424167481636,
                    -0.07497390733855891,
                    0.040686926109404054,
                    0.3044349351140878
                ]
            ],
            'gold_standard': False
        }
    }
]

kwargs_extra_data_no_overall_intersection = {
    'created_at': [
        '2025-01-21 10:46:20 UTC',
        '2025-01-25 11:46:20 UTC',
        '2025-01-26 16:46:20 UTC'
    ]
}

# Ideally the comparison between the result and expectation would be done with
# shape.equal(), but that is awkward to implement, so doing it brute force here
processed_data_no_overall_intersection = {
    'frame0': {
        'T0_tool0': {
            'X': [
                [0, 0],
                [1, 1],
                [2, 2]
            ],
            'data': [
                {
                    'polygon': shapely.Polygon(np.array([
                        [0.21554927386591496, 0.8346610570311462, 0.36812686536062333, -0.25098491780460797, 0.2155492738659148],
                        [-0.25858097547222986, 0.20795321619829304, 0.8270649993635244, 0.3605308076930015, -0.25858097547222986]
                    ]).T),
                    'gold_standard': False
                }, {
                    'polygon': shapely.Polygon(np.array([
                        [0.3693081708169513, 0.553908720812514, 0.5957542682751744, 0.47526481648569685, 0.2488187190274737, 0.022372621569250545, -0.09811683022022713, -0.05627128275756679, 0.12832926723799587, 0.36930817081695105],
                        [-0.5218849589408747, -0.3669867055244751, -0.1296688129675387, 0.07902503930795732, 0.16144467844849417, 0.07902503930795748, -0.1296688129675385, -0.366986705524475, -0.5218849589408747, -0.5218849589408747]
                    ]).T),
                    'gold_standard': False
                }, {
                    'polygon': shapely.Polygon(np.array([
                        [0.09127357717866474, 0.024685520754786305, -0.21171962328979593, -0.5073252607061052, -0.7238142284563371, -0.7598889325232856, -0.5986696179483486, -0.3155925937742383, -0.04311274566270751, 0.0912735771786648],
                        [0.3044349351140881, 0.5928594950295896, 0.7710035487895189, 0.7555115137889823, 0.5536322853795214, 0.2598273981716289, 0.011571424167481636, -0.07497390733855891, 0.040686926109404054, 0.3044349351140878]
                    ]).T),
                    'gold_standard': False
                }
            ]
        }
    }
}

reduced_data_no_overall_intersection = {
    'frame0':
        {
            'T0_tool0_cluster_labels': [0, 0, 0],
            'T0_tool0_clusters_count': [3],
            'T0_tool0_consensus': [0.07844246929976251],
            'T0_tool0_clusters_x': [[]],
            'T0_tool0_clusters_y': [[]]
        },
        'parameters': {
            'eps': 0.95,
            'min_samples': 2,
            'average_type': 'intersection'
        }
}


TestPolygonTReducerNoOverallIntersection = ReducerTest(
    polygon_reducer,
    process_data,
    extracted_data_no_overall_intersection,
    processed_data_no_overall_intersection,
    reduced_data_no_overall_intersection,
    'Test to see if a cluster with no overall intersection can be processed',
    kwargs={
        'eps': 0.95,
        'min_samples': 2,
        'average_type': 'intersection'
    },
    output_kwargs=True,
    network_kwargs=kwargs_extra_data_no_overall_intersection,
    test_name='TestPolygonTReducerNoOverallIntersection'
)

# Testing cluster of 1. This is just the original extraction
reduced_data_no_overall_intersection_cluster_of_one = {
    'frame0':
        {
            'T0_tool0_cluster_labels': [0, 1, 2],
            'T0_tool0_clusters_count': [1, 1, 1],
            'T0_tool0_consensus': [1.0, 1.0, 1.0],
            'T0_tool0_clusters_x': [
                [
                    0.21554927386591496,
                    0.8346610570311462,
                    0.36812686536062333,
                    -0.25098491780460797,
                    0.2155492738659148,
                    0.21554927386591496
                ], [
                    0.3693081708169513,
                    0.553908720812514,
                    0.5957542682751744,
                    0.47526481648569685,
                    0.2488187190274737,
                    0.022372621569250545,
                    -0.09811683022022713,
                    -0.05627128275756679,
                    0.12832926723799587,
                    0.36930817081695105,
                    0.3693081708169513
                ], [
                    0.09127357717866474,
                    0.024685520754786305,
                    -0.21171962328979593,
                    -0.5073252607061052,
                    -0.7238142284563371,
                    -0.7598889325232856,
                    -0.5986696179483486,
                    -0.3155925937742383,
                    -0.04311274566270751,
                    0.0912735771786648,
                    0.09127357717866474
                ]
            ],
            'T0_tool0_clusters_y': [
                [
                    -0.25858097547222986,
                    0.20795321619829304,
                    0.8270649993635244,
                    0.3605308076930015,
                    -0.25858097547222986,
                    -0.25858097547222986
                ], [
                    -0.5218849589408747,
                    -0.3669867055244751,
                    -0.1296688129675387,
                    0.07902503930795732,
                    0.16144467844849417,
                    0.07902503930795748,
                    -0.1296688129675385,
                    -0.366986705524475,
                    -0.5218849589408747,
                    -0.5218849589408747,
                    -0.5218849589408747
                ], [
                    0.3044349351140881,
                    0.5928594950295896,
                    0.7710035487895189,
                    0.7555115137889823,
                    0.5536322853795214,
                    0.2598273981716289,
                    0.011571424167481636,
                    -0.07497390733855891,
                    0.040686926109404054,
                    0.3044349351140878,
                    0.3044349351140881
                ]
            ]
        },
        'parameters': {
            'eps': 0.5,
            'min_samples': 1,
            'average_type': 'last'
        }
}

TestPolygonTReducerClusterOfOne = ReducerTest(
    polygon_reducer,
    process_data,
    extracted_data_no_overall_intersection,
    processed_data_no_overall_intersection,
    reduced_data_no_overall_intersection_cluster_of_one,
    'Test if clusters of one can be found',
    kwargs={
        'eps': 0.5,
        'min_samples': 1,
        'average_type': 'last'
    },
    output_kwargs=True,
    network_kwargs=kwargs_extra_data_no_overall_intersection,
    test_name='TestPolygonTReducerClusterOfOne'
)
