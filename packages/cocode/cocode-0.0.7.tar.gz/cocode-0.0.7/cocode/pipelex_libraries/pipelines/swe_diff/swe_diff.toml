domain = "swe_diff"
definition = "Pipelines for analyzing differences between two software engineering documents."

[concept]
CodeDiff = "A technical report produced by Git and enumerating the differences between two versions of a codebase."
ChangelogSection = "A specific type of change in a changelog (added, changed, fixed, removed, deprecated, security)."
ReleaseChangelog = "A text report in markdown format that summarizes the changes made to the codebase between two versions."

[pipe]
[pipe.write_changelog]
PipeSequence = "Write a comprehensive changelog for a software project"
inputs = { text = "Text", release_date = "Text" }
output = "Text"
steps = [
    { pipe = "write_changelog_from_text", result = "changelog_sections" },
    { pipe = "format_final_changelog", result = "changelog" },
]

[pipe.format_final_changelog]
PipeLLM = "Format the final changelog in markdown with proper structure"
inputs = { changelog_sections = "ChangelogSection", release_date = "Text" }
output = "Text"
llm = "llm_for_swe"
system_prompt = """
You are an expert technical writer. Your task is to format a final changelog in markdown following the Keep a Changelog format.
"""
prompt_template = """
Create a properly formatted changelog in markdown format using the following structure:

## [vX.Y.Z] - $release_date

Then organize the changes into these sections (only include sections that have content):

### Added
- [List new features]

### Changed
- [List changes to existing functionality]

### Fixed
- [List bug fixes]

### Removed
- [List removed features]

### Deprecated
- [List deprecated features]

### Security
- [List security-related changes]

Use the following analyzed changes:

@changelog_sections

Ensure each bullet point is clear, concise, and user-friendly.
Please add back ticks to the variables.
DO NOT ADD ANYTHING ELSE THAN THE MARKDOWN FORMAT.
Do not add ```markdown``` at the beginning or at the end.
"""

[pipe.write_changelog_from_text]
PipeLLM = "Write a changelog for a software project."
inputs = { text = "Text" }
output = "ReleaseChangelog"
llm = "llm_for_swe"
system_prompt = """
You are an expert technical writer and software architect. Your task is to carefully review the code diff and write a changelog in markdown format.
"""
prompt_template = """
Analyze the following code diff. Write a changelog in markdown format that summarizes the changes made to the codebase between two versions.

@text
"""

