# Generated by Django 3.0.5 on 2020-07-24 20:09

from django.db import migrations


class Migration(migrations.Migration):

    dependencies = [
        ('django_rds_iam_auth', '0020_auto_20200724_2006'),
    ]

    operations = [
        migrations.RunSQL("""
                    create function ibrag_privileged_get_owned_users_recursive(text) returns SETOF text
                        security definer
                        language sql
                    as
                    $$
                    WITH RECURSIVE subordinates AS (
                        SELECT
                            id,
                            creator_id,
                            origin_tenant_id
                        FROM
                            api_user
                        WHERE
                            id = $1
                        UNION
                            SELECT
                                e.id,
                                e.creator_id,
                                e.origin_tenant_id
                            FROM
                                api_user e
                            INNER JOIN subordinates s ON s.id = e.creator_id
                    ) SELECT
                        id
                    FROM
                        subordinates
                    $$;
                """, reverse_sql="drop function ibrag_privileged_get_owned_users_recursive(text);"),
    ]
