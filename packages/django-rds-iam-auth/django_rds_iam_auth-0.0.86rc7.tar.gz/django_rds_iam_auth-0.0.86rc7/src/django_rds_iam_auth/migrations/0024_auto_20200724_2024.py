# Generated by Django 3.0.5 on 2020-07-24 20:24

from django.db import migrations


class Migration(migrations.Migration):

    dependencies = [
        ('django_rds_iam_auth', '0024_api_is_super_policy'),
    ]

    operations = [
        migrations.RunSQL("""
                       CREATE POLICY api_user_table_policy ON api_user
                            USING (
                                ibrag_is_super_admin(current_user) or
                                (ibrag_user_has_role('tenant_admin') and ibrag_user_has_tenant(origin_tenant_id)) or
                                ibrag_priviliged_is_owner_of_user(id, current_user)
                                )
                            WITH CHECK (
                                 ibrag_is_super_admin(current_user)  or
                                (ibrag_user_has_role('tenant_admin') and ibrag_user_has_tenant(origin_tenant_id)) or
                                ibrag_priviliged_is_owner_of_user(id, current_user)
                            );
                    """, reverse_sql="drop policy api_user_table_policy on api_user;"),
        migrations.RunSQL("""ALTER TABLE api_user ENABLE ROW LEVEL SECURITY;""",
                          reverse_sql="ALTER TABLE api_user DISABLE ROW LEVEL SECURITY;"),

    ]
