import{j as bt,u as _t,r as A,s as wt,k as Ct,o as kt,l as O,m as F,w as d,n as a,p as n,q as At,t as h,v as Ut,x,y as St,z as g,A as Pt,C as Bt,D as b,E as w,G as Et,H as Rt,J as Tt,K as z,N as Vt,_ as W,O as $t,P as Ot,Q as Ft,R as j,T as Mt,X as Dt,Y as It,Z as Nt,$ as Lt,a0 as zt,a1 as Wt,a2 as jt}from"./index-CTqMS52r.js";import{loader as Zt,VueMonacoEditor as qt}from"@guolao/vue-monaco-editor";import*as Jt from"monaco-editor";import Kt from"monaco-editor/esm/vs/editor/editor.worker?worker";import Gt from"monaco-editor/esm/vs/language/json/json.worker?worker";import Ht from"monaco-editor/esm/vs/language/css/css.worker?worker";import Qt from"monaco-editor/esm/vs/language/html/html.worker?worker";import Xt from"monaco-editor/esm/vs/language/typescript/ts.worker?worker";import{newPyodideWorker as Yt}from"./frontend/tools/pyodide-worker-api.ts";import{version as te}from"pyodide";self.MonacoEnvironment={getWorker(t,e){return e==="json"?new Gt:e==="css"||e==="scss"||e==="less"?new Ht:e==="html"||e==="handlebars"||e==="razor"?new Qt:e==="typescript"||e==="javascript"?new Xt:new Kt}};function ee(){Zt.config({monaco:Jt})}const Q="3.7.7",oe=Q,k=typeof Buffer=="function",Z=typeof TextDecoder=="function"?new TextDecoder:void 0,q=typeof TextEncoder=="function"?new TextEncoder:void 0,ne="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",U=Array.prototype.slice.call(ne),B=(t=>{let e={};return t.forEach((l,p)=>e[l]=p),e})(U),re=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,u=String.fromCharCode.bind(String),J=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):t=>new Uint8Array(Array.prototype.slice.call(t,0)),X=t=>t.replace(/=/g,"").replace(/[+\/]/g,e=>e=="+"?"-":"_"),Y=t=>t.replace(/[^A-Za-z0-9\+\/]/g,""),tt=t=>{let e,l,p,c,f="";const i=t.length%3;for(let _=0;_<t.length;){if((l=t.charCodeAt(_++))>255||(p=t.charCodeAt(_++))>255||(c=t.charCodeAt(_++))>255)throw new TypeError("invalid character found");e=l<<16|p<<8|c,f+=U[e>>18&63]+U[e>>12&63]+U[e>>6&63]+U[e&63]}return i?f.slice(0,i-3)+"===".substring(i):f},I=typeof btoa=="function"?t=>btoa(t):k?t=>Buffer.from(t,"binary").toString("base64"):tt,M=k?t=>Buffer.from(t).toString("base64"):t=>{let l=[];for(let p=0,c=t.length;p<c;p+=4096)l.push(u.apply(null,t.subarray(p,p+4096)));return I(l.join(""))},E=(t,e=!1)=>e?X(M(t)):M(t),ae=t=>{if(t.length<2){var e=t.charCodeAt(0);return e<128?t:e<2048?u(192|e>>>6)+u(128|e&63):u(224|e>>>12&15)+u(128|e>>>6&63)+u(128|e&63)}else{var e=65536+(t.charCodeAt(0)-55296)*1024+(t.charCodeAt(1)-56320);return u(240|e>>>18&7)+u(128|e>>>12&63)+u(128|e>>>6&63)+u(128|e&63)}},ie=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,et=t=>t.replace(ie,ae),K=k?t=>Buffer.from(t,"utf8").toString("base64"):q?t=>M(q.encode(t)):t=>I(et(t)),C=(t,e=!1)=>e?X(K(t)):K(t),G=t=>C(t,!0),se=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,le=t=>{switch(t.length){case 4:var e=(7&t.charCodeAt(0))<<18|(63&t.charCodeAt(1))<<12|(63&t.charCodeAt(2))<<6|63&t.charCodeAt(3),l=e-65536;return u((l>>>10)+55296)+u((l&1023)+56320);case 3:return u((15&t.charCodeAt(0))<<12|(63&t.charCodeAt(1))<<6|63&t.charCodeAt(2));default:return u((31&t.charCodeAt(0))<<6|63&t.charCodeAt(1))}},ot=t=>t.replace(se,le),nt=t=>{if(t=t.replace(/\s+/g,""),!re.test(t))throw new TypeError("malformed base64.");t+="==".slice(2-(t.length&3));let e,l="",p,c;for(let f=0;f<t.length;)e=B[t.charAt(f++)]<<18|B[t.charAt(f++)]<<12|(p=B[t.charAt(f++)])<<6|(c=B[t.charAt(f++)]),l+=p===64?u(e>>16&255):c===64?u(e>>16&255,e>>8&255):u(e>>16&255,e>>8&255,e&255);return l},N=typeof atob=="function"?t=>atob(Y(t)):k?t=>Buffer.from(t,"base64").toString("binary"):nt,rt=k?t=>J(Buffer.from(t,"base64")):t=>J(N(t).split("").map(e=>e.charCodeAt(0))),at=t=>rt(it(t)),de=k?t=>Buffer.from(t,"base64").toString("utf8"):Z?t=>Z.decode(rt(t)):t=>ot(N(t)),it=t=>Y(t.replace(/[-_]/g,e=>e=="-"?"+":"/")),D=t=>de(it(t)),ue=t=>{if(typeof t!="string")return!1;const e=t.replace(/\s+/g,"").replace(/={0,2}$/,"");return!/[^\s0-9a-zA-Z\+/]/.test(e)||!/[^\s0-9a-zA-Z\-_]/.test(e)},st=t=>({value:t,enumerable:!1,writable:!0,configurable:!0}),lt=function(){const t=(e,l)=>Object.defineProperty(String.prototype,e,st(l));t("fromBase64",function(){return D(this)}),t("toBase64",function(e){return C(this,e)}),t("toBase64URI",function(){return C(this,!0)}),t("toBase64URL",function(){return C(this,!0)}),t("toUint8Array",function(){return at(this)})},dt=function(){const t=(e,l)=>Object.defineProperty(Uint8Array.prototype,e,st(l));t("toBase64",function(e){return E(this,e)}),t("toBase64URI",function(){return E(this,!0)}),t("toBase64URL",function(){return E(this,!0)})},pe=()=>{lt(),dt()},fe={version:Q,VERSION:oe,atob:N,atobPolyfill:nt,btoa:I,btoaPolyfill:tt,fromBase64:D,toBase64:C,encode:C,encodeURI:G,encodeURL:G,utob:et,btou:ot,decode:D,isValid:ue,fromUint8Array:E,toUint8Array:at,extendString:lt,extendUint8Array:dt,extendBuiltins:pe},ce={style:{display:"inline-flex","margin-right":"16px"}},me={style:{"margin-right":"-8px"}},ye={style:{"margin-left":"-8px"}},ve={class:"playground-container"},he={class:"playground-console"},H="yacv_server://model/",xe=bt({__name:"PlaygroundDialogContent",props:{initialCode:{}},emits:["close","updateModel"],setup(t,{emit:e}){_t(r=>({e0f6ee60:m.value}));const l=t,p=e;ee();const c=A(l.initialCode),f=A("");function i(r){f.value+=r;let o=1e4;f.value.length>o&&(f.value=f.value.slice(-o)),console.log(r),Wt(()=>{const s=document.querySelector(".playground-console");s&&(s.scrollTop=s.scrollHeight)})}const _={automaticLayout:!0,formatOnType:!0,formatOnPaste:!0},ut=window.matchMedia("(prefers-color-scheme: dark)").matches?"vs-dark":"vs",pt=wt(),ft=r=>pt.value=r,m=A(.9);let y=null;const v=A(!0);async function L(){v.value=!0,m.value==0&&(m.value=.9),y===null?(i(`Creating new Pyodide worker...
`),y=Yt({indexURL:`https://cdn.jsdelivr.net/pyodide/v${te}/full/`,packages:["micropip","sqlite3"]})):i(`Reusing existing Pyodide instance...
`),i(`Preloading packages...
`),await y.asyncRun(`import micropip, asyncio
micropip.set_index_urls(["https://yeicor.github.io/OCP.wasm", "https://pypi.org/simple"])
await (micropip.install("lib3mf"))
micropip.add_mock_package("py-lib3mf", "2.4.1", modules={"py_lib3mf": 'from lib3mf import *'})
await (micropip.install(["https://files.pythonhosted.org/packages/67/25/80be117f39ff5652a4fdbd761b061123c5425e379f4b0a5ece4353215d86/yacv_server-0.10.0a4-py3-none-any.whl"]))
from yacv_server import *
micropip.add_mock_package("ocp-vscode", "2.8.9", modules={"ocp_vscode": 'from yacv_server import *'})`,i,i),v.value=!1,i(`Pyodide worker initialized.
`)}async function R(){if(y===null){i(`Pyodide worker is not initialized. Please wait...
`);return}if(v.value){i(`Pyodide is already running. Please wait...
`);return}i(`Running code...
`);try{v.value=!0,await y.asyncRun(c.value,i,r=>{if(r.startsWith(H)){const o=r.slice(H.length);ct(o)}else i(r)})}catch(r){i(`Error running initial code: ${r}
`)}finally{v.value=!1}}function ct(r){i(`Model data detected... ${r.length}B
`);let o=0,s=0;for(;o<r.length&&(r[o]==="{"?s++:r[o]==="}"&&s--,s!==0);o++);if(s!==0)throw`Error: Invalid model data received: ${r}
`;const T=r.slice(0,o+1);let V=JSON.parse(T);const P=new It(V.name,"",V.hash,V.is_remove);if(i(`Model metadata: ${JSON.stringify(P)}
`),!P.isRemove){const $=fe.toUint8Array(r.slice(o+1));console.assert($.slice(0,4).toString()=="103,108,84,70","Invalid GLTF binary data received: "+$.slice(0,4).toString());const gt=new Blob([$],{type:"model/gltf-binary"});P.url=URL.createObjectURL(gt)}let xt=new Nt([P],()=>{});p("updateModel",xt)}function mt(){y&&(y.terminate(),y=null),f.value="",L()}function yt(){const r=window.location,o=new URLSearchParams(r.hash.slice(1));o.set("pg_code",Lt(zt(c.value,{level:9})));const s=`${r.origin}${r.pathname}${r.search}#${o.toString()}`;if(i(`Share link ready: ${s}
`),navigator.clipboard)navigator.clipboard.writeText(s).then(()=>i(`Link copied to clipboard!
`)).catch(T=>i(`Failed to copy link: ${T}
`));else{i(`Clipboard API not available. Please copy the link manually.
`);return}}function vt(){throw new Error("Not implemented yet!")}function ht(){throw new Error("Not implemented yet!")}(async()=>{const r=await Ct();m.value=r.pg_opacity_loading,await L(),l.initialCode!=""&&await R(),m.value=r.pg_opacity_loaded})();const S=A(null);return kt(()=>{S.value&&(console.log(S.value),S.value.addEventListener("keydown",r=>{r instanceof KeyboardEvent&&(r.key==="Enter"&&r.ctrlKey?(r.preventDefault(),R()):r.key==="Escape"&&p("close"))}))}),(r,o)=>(F(),O(n(Dt),{class:"popup-card",style:j(m.value==0?"position: absolute; top: calc(-50vh + 24px); width: calc(100vw - 64px);":"")},{default:d(()=>[a(n(At),{class:"popup"},{default:d(()=>[a(n(Ut),{style:{flex:"0 1 auto"}},{default:d(()=>o[8]||(o[8]=[x("Playground",-1)])),_:1,__:[8]}),a(n(St)),h("span",ce,[a(n(g),{path:n(Pt),type:"mdi",style:{height:"32px"}},null,8,["path"]),a(n(Bt),{modelValue:m.value,"onUpdate:modelValue":o[0]||(o[0]=s=>m.value=s),max:1,min:0,step:.1,style:{width:"100px",height:"32px"}},null,8,["modelValue"]),a(n(b),{activator:"parent",location:"bottom"},{default:d(()=>o[9]||(o[9]=[x("Opacity of the editor (0 = hidden, 1 = fully visible)",-1)])),_:1,__:[9]})]),h("span",me,[a(n(w),{icon:"",disabled:"",onClick:o[1]||(o[1]=s=>vt())},{default:d(()=>[a(n(g),{path:n(Et),type:"mdi"},null,8,["path"])]),_:1}),a(n(b),{activator:"parent",location:"bottom"},{default:d(()=>o[10]||(o[10]=[x("Save current state to a snapshot for fast startup (WIP)",-1)])),_:1,__:[10]})]),h("span",ye,[a(n(w),{icon:"",disabled:"",onClick:o[2]||(o[2]=s=>ht())},{default:d(()=>[a(n(g),{path:n(Rt),type:"mdi"},null,8,["path"])]),_:1}),a(n(b),{activator:"parent",location:"bottom"},{default:d(()=>o[11]||(o[11]=[x("Load snapshot for fast startup (WIP)",-1)])),_:1,__:[11]})]),a(n(w),{icon:"",onClick:o[3]||(o[3]=s=>mt())},{default:d(()=>[a(n(g),{path:n(Tt),type:"mdi"},null,8,["path"]),a(n(b),{activator:"parent",location:"bottom"},{default:d(()=>o[12]||(o[12]=[x("Reset Pyodide worker (this forgets all previous state and will take a little while) ",-1)])),_:1,__:[12]})]),_:1}),a(n(w),{icon:"",onClick:o[4]||(o[4]=s=>R()),disabled:v.value},{default:d(()=>[a(n(g),{path:n(Vt),type:"mdi"},null,8,["path"]),v.value?(F(),O(W,{key:0,style:{position:"absolute",top:"-16%",left:"-16%"}})):z("",!0),a(n(b),{activator:"parent",location:"bottom"},{default:d(()=>o[13]||(o[13]=[x("Run code",-1)])),_:1,__:[13]})]),_:1},8,["disabled"]),a(n(w),{icon:"",onClick:o[5]||(o[5]=s=>yt())},{default:d(()=>[a(n(g),{path:n($t),type:"mdi"},null,8,["path"]),a(n(b),{activator:"parent",location:"bottom"},{default:d(()=>o[14]||(o[14]=[x("Share link that auto-runs the code",-1)])),_:1,__:[14]})]),_:1}),a(n(w),{icon:"",onClick:o[6]||(o[6]=s=>p("close"))},{default:d(()=>[a(n(g),{path:n(Ot),type:"mdi"},null,8,["path"]),a(n(b),{activator:"parent",location:"bottom"},{default:d(()=>o[15]||(o[15]=[x("Close (Pyodide remains loaded)",-1)])),_:1,__:[15]})]),_:1})]),_:1}),a(n(Ft),{class:"popup-card-text",style:j(m.value==0?"display: none":"")},{default:d(()=>[h("div",ve,[h("div",{class:"playground-editor",ref_key:"editorRef",ref:S},[a(n(qt),{value:c.value,"onUpdate:value":o[7]||(o[7]=s=>c.value=s),theme:n(ut),options:_,language:"python",onMount:ft},null,8,["value","theme"])],512),h("div",he,[o[16]||(o[16]=h("h3",null,"Console Output",-1)),h("pre",null,Mt(f.value),1),v.value?(F(),O(W,{key:0})):z("",!0)])])]),_:1},8,["style"])]),_:1},8,["style"]))}}),Pe=jt(xe,[["__scopeId","data-v-d96ca1a4"]]);export{Pe as default};
//# sourceMappingURL=PlaygroundDialogContent-CrnXWO2O.js.map
