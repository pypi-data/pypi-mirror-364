{# Template principal del plugin #}
{% extends "djangocms_zb_repository/base.html" %}
{% load i18n cms_tags zb_tags %}
{% block content %}
    <div style="text-align: center; margin-bottom: 2rem">
        <h1>
            {% if instance.category.has_files %}
                <a href="?category={{ instance.category.id }}#file-default"
                        {% if request.GET.category == instance.category.id|stringformat:"i" %}
                   class="select"
                        {% endif %}
                        {% if not request.GET.category %}
                   class="select"
                        {% endif %}
                >
                    {{ instance.category.name }}
                </a>
            {% else %}
                {{ instance.category.name }}
            {% endif %}
            {% if request.toolbar.edit_mode_active and perms.zb_repository.change_category %}
                {% render_model_icon instance.category %}
            {% endif %}
        </h1>
    </div>
    {# Formulario de busqueda #}
    <form action="#file-default" method="GET" style="float: right; margin-bottom: 2rem">
        <label for="search" aria-hidden="true"></label>
        <input type="text" placeholder="{% trans "Search..." %}" name="search" id="search"
               value="{{ request.GET.search }}"
               style="border-radius: 5px; padding-left: 10px">
        <button type="submit" style="border-radius: 5px">{% trans 'Search' %}</button>
    </form>
    <a id="file-default"></a>
    <p class="zb-breadcrumb">{{ full_category_name }}</p>
    <table style="width: 100%;">
        <tr>
            <th style="width: 40%; text-align: center; padding: 0.3rem">
                <h5>
                    {% trans 'Categories' %}
                    {% if request.toolbar.edit_mode_active and perms.zb_repository.add_category %}
                        {% render_model_add instance.category %}
                    {% endif %}
                </h5>
            </th>
            <th style="width: 60%; text-align: center; padding: 0.3rem">
                <h5>
                    {% trans 'Files' %}
                    {% if request.toolbar.edit_mode_active and perms.zb_repository.add_file and perms.zb_repository.add_fileextended and files %}
                        {% render_model_add files.0 %}
                    {% endif %}
                </h5>
            </th>
        </tr>
        <tr>
            <td style="padding-left: 1rem; padding-right: 1rem">
                {# Menu de categorias #}
                <br>
                <ul>
                    {% for category in categories %}
                        <li>
                        <a href="?category={{ category.id }}#file-default"
                                {% if request.GET.category == category.id|stringformat:"i" %}
                           class="select" {% endif %}>
                            {{ forloop.counter }} {{ category.name }}
                        </a>
                        {% if request.toolbar.edit_mode_active and perms.zb_repository.change_category %}
                            {% render_model_icon category %}
                        {% endif %}
                        {% zb_concat "djangocms_zb_repository/" instance.template "/includes/category.html" as template %}
                        {% include template with parent_cons=forloop.counter %}
                    {% endfor %}
                </ul>
            </td>
            <td rowspan="{{ categories.count }}" style="padding-left: 1rem; padding-right: 1rem">
                {# Archivos #}
                {% if request.GET.search %}
                    <p>
                        {% trans 'Search results for' %} "{{ request.GET.search }}".

                    </p>
                {% endif %}
                {# Include Template File List #}
                {% if files %}
                    {% zb_concat "djangocms_zb_repository/" instance.template "/includes/file_list.html" as template %}
                    {% include template %}
                {% else %}
                    {% if not request.GET.search %}
                        <h6>{% trans 'Select a category with files.' %}</h6>
                    {% endif %}
                {% endif %}
            </td>
        </tr>
    </table>
{% endblock %}

{% comment %}
    {{ instance.category }}
    {{ instance.pagination }} #Number of items per page
    {{ instance.target }}
    {{ files }}
    {{ categories }}
    # files list variables:
    {{ file_extended }} object
    {{ description }}
    {{ file_url }}
    # file_extended list variables:
    {{ title }}
    {{ category }} object
    {{ published }}
    # categories list variables:
    {{ name }}
    {{ parent }}
    {{ published }}
    {{ children }}
    # pagination list variables:
    {{ info_publications.has_previous }}
    {{ info_publications.has_next }}
    {{ info_publications.previous_page_number }}
    {{ info_publications.next_page_number }}
    {{ info_publications.number }}
    {{ paginator.page_range }}
    {{ paginator.num_pages }}
{% endcomment %}