"use strict";(self.webpackChunkjupyterlab_ipyflow=self.webpackChunkjupyterlab_ipyflow||[]).push([[568],{568:(e,t,l)=>{l.r(t),l.d(t,{default:()=>H});var s,n,i,o=l(777),c=l(329),d=l(423),a=l(761),r=l.n(a),u=function(e,t,l,s){if("a"===l&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===l?s:"a"===l?s.call(e):s?s.value:t.get(e)};const m="waiting-cell",v="ready-cell",C="ready-making-cell",h="ready-making-input-cell",f="linked-waiting",y="linked-ready-maker",g="ipyflow-slice",x="ipyflow-slice-execute",p="ipyflow-classic-colors",w=new Event("cleanup");class _{constructor(){s.add(this),this.comm=null,this.notebook=null,this.session=null,this.isIpyflowCommConnected=!1,this.selectedCells=[],this.executedCells=new Set,this.dirtyCells=new Set,this.waitingCells=new Set,this.readyCells=new Set,this.waiterLinks={},this.readyMakerLinks={},this.staleParents={},this.staleParentsByExecutedCellByChild={},this.staleParentsByChildByExecutedCell={},this.prevActiveCell=null,this.activeCell=null,this.cellsById={},this.orderIdxById={},this.cellPendingExecution=null,this.isReactivelyExecuting=!1,this.numAltModeExecutes=0,this.altModeExecuteCells=null,this.lastExecutionHighlights=null,this.executedReactiveReadyCells=new Set,this.newReadyCells=new Set,this.forcedReactiveCells=new Set,this.forcedCascadingReactiveCells=new Set,this.numPendingForcedReactiveCounterBumps=0,this.cellParents={},this.cellChildren={},this.settings={},this.lastCellMetadataMap=null}gatherCellMetadataAndContent(){const e={};return this.notebook.widgets.forEach(((t,l)=>{const s=t.model;e[s.id]={index:l,content:s.sharedModel.getSource(),type:s.type}})),e}requestComputeExecSchedule(){this.comm.send({type:"compute_exec_schedule",cell_metadata_by_id:this.gatherCellMetadataAndContent(),is_reactively_executing:this.isReactivelyExecuting})}isBatchReactive(){var e,t,l;return null!==(e=this.isIpyflowCommConnected)&&void 0!==e&&e&&"reactive"===(null===(t=this.settings)||void 0===t?void 0:t.exec_mode)&&"batch"===(null===(l=this.settings)||void 0===l?void 0:l.reactivity_mode)}executeCells(e){if(0===e.length)return;let t=0;for(const l of e)c.CodeCell.execute(l,this.session).then((()=>{var s;(null===(s=l.promptNode.textContent)||void 0===s?void 0:s.includes("[*]"))?l.setPrompt(""):this.executedCells.add(l.model.id),++t===e.length&&(this.isReactivelyExecuting=!1,setTimeout((()=>this.requestComputeExecSchedule()),0))}))}executeClosure(e){if(0===e.length)return;const t=e.map((e=>e.model.id)),l=this.computeTransitiveClosure(t);this.executeCells(l)}toggleReactivity(){return"reactive"===this.settings.exec_mode?this.settings.exec_mode="normal":"normal"===this.settings.exec_mode&&(this.settings.exec_mode="reactive"),this.session.session.kernel.requestExecute({code:"%flow toggle-reactivity",silent:!0,store_history:!1})}bumpForcedReactiveCounter(){return this.numPendingForcedReactiveCounterBumps--,this.session.session.kernel.requestExecute({code:"%flow bump-min-forced-reactive-counter",silent:!0,store_history:!1})}computeTransitiveClosureHelper(e,t,l,s=!1,n=!1){var i,o,c;if(!n&&e.has(t))return;s||e.add(t);const d=null==l?void 0:l[t];if(void 0===d)return;const a=e.size;if(d.forEach((t=>{this.computeTransitiveClosureHelper(e,t,l,s)})),s&&(e.size>a||!this.executedCells.has(t)||this.readyCells.has(t)||this.waitingCells.has(t)||this.dirtyCells.has(t))&&e.add(t),s&&e.has(t)){d.forEach((n=>{var i,o,c,d;if(e.has(n))return;let a=null===(o=null===(i=this.staleParents)||void 0===i?void 0:i[t])||void 0===o?void 0:o.includes(n);if(!a)for(const[l,s]of Object.entries(null!==(d=null===(c=this.staleParentsByExecutedCellByChild)||void 0===c?void 0:c[t])&&void 0!==d?d:{}))if(e.has(l)&&(a=s.includes(n),a))break;a&&(e.add(n),this.computeTransitiveClosureHelper(e,n,l,s,!0))}));for(const[n,d]of Object.entries(null!==(o=null===(i=this.staleParentsByChildByExecutedCell)||void 0===i?void 0:i[t])&&void 0!==o?o:{}))if(e.has(n))for(const t of d)!e.has(t)&&(null===(c=null==l?void 0:l[n])||void 0===c?void 0:c.includes(t))&&(e.add(t),this.computeTransitiveClosureHelper(e,t,l,s,!0))}}cellIdsToCells(e){const t="any_order"===this.settings.flow_order?u(this,s,"m",i).call(this):this.orderIdxById;return e.filter((e=>void 0!==this.cellsById[e])).filter((e=>void 0!==this.orderIdxById[e])).sort(((e,l)=>t[e]-t[l])).map((e=>this.cellsById[e]))}computeTransitiveClosure(e,t=!0,l=!1){var s,n;let i=e;const o=new Set(i);for(;;){for(const e of i)l?this.computeTransitiveClosureHelper(o,e,this.cellParents,!1,!0):this.computeTransitiveClosureHelper(o,e,this.cellChildren,!1,!0);if(l||null===(s=this.settings.pull_reactive_updates)||void 0===s||!s)break;for(const e of o)this.computeTransitiveClosureHelper(o,e,this.cellParents,!0,!0);if(i.length===o.size||null===(n=this.settings.push_reactive_updates_to_cousins)||void 0===n||!n)break;i=Array.from(o)}if(!t)for(const t of e)o.delete(t);return this.cellIdsToCells(Array.from(o))}}s=new WeakSet,n=function e(t,l,n){var i,o,c;if(!n.has(t)&&"code"===(null===(o=null===(i=this.cellsById[t])||void 0===i?void 0:i.model)||void 0===o?void 0:o.type)){n.add(t);for(const i of null!==(c=this.cellChildren[t])&&void 0!==c?c:[])u(this,s,"m",e).call(this,i,l,n);l.unshift(t)}},i=function(){const e=[],t=new Set;for(const l of Object.keys(this.cellsById))u(this,s,"m",n).call(this,l,e,t);const l={};return e.forEach(((e,t)=>{l[e]=t})),l};const E={},b=[];function k(e){delete E[e]}function R(e,t){const l={};for(const e in t)l[e]=t[e];for(const t in e)l[t]=e[t];return l}const B={id:"jupyterlab-ipyflow",requires:[d.INotebookTracker,o.ICommandPalette],autoStart:!0,activate:(e,t,l)=>{e.commands.addCommand("execute-stale",{label:"Execute Ready Cells",isEnabled:()=>!0,isVisible:()=>!0,isToggled:()=>!1,execute:()=>{var e,l;const s=t.currentWidget.sessionContext;if(!s.isReady)return;const n=null!==(e=E[s.session.id])&&void 0!==e?e:{};if(null===(l=n.isIpyflowCommConnected)||void 0===l||!l)return;const i=Array.from(new Set([...n.dirtyCells,...n.readyCells]));let o;o="batch"===n.settings.reactivity_mode?n.computeTransitiveClosure(i):n.cellIdsToCells(i),n.executeCells(o)}}),e.commands.addCommand("alt-mode-execute",{label:"Alt Mode Execute",isEnabled:()=>!0,isVisible:()=>!0,isToggled:()=>!1,execute:()=>{var l,s;const n=t.currentWidget.sessionContext;if(!n.isReady)return;e.commands.execute("notebook:enter-command-mode");const i=null!==(l=E[n.session.id])&&void 0!==l?l:{},o=i.altModeExecuteCells;if(i.altModeExecuteCells=null,null===(s=i.isIpyflowCommConnected)||void 0===s||!s)return i.executedCells.add(t.activeCell.model.id),void c.CodeCell.execute(t.activeCell,n);if(("batch"===i.settings.reactivity_mode||null===o)&&"code"===t.activeCell.model.type)if(i.numAltModeExecutes++,"incremental"===i.settings.reactivity_mode)1===i.numAltModeExecutes?i.toggleReactivity().done.then((()=>{i.executedCells.add(t.activeCell.model.id),c.CodeCell.execute(t.activeCell,n)})):(i.executedCells.add(t.activeCell.model.id),c.CodeCell.execute(t.activeCell,n));else if("batch"===i.settings.reactivity_mode){let e=null!=o?o:[t.activeCell];"normal"===i.settings.exec_mode&&null===o&&(e=i.computeTransitiveClosure([t.activeCell.model.id])),1===i.numAltModeExecutes?i.toggleReactivity().done.then((()=>i.executeCells(e))):i.executeCells(e)}else console.error(`Unknown reactivity mode: ${i.settings.reactivity_mode}`)}}),e.commands.addKeyBinding({command:"alt-mode-execute",keys:["Accel Shift Enter"],selector:".jp-Notebook"}),e.commands.addKeyBinding({command:"alt-mode-execute",keys:["Ctrl Shift Enter"],selector:".jp-Notebook"}),e.commands.addKeyBinding({command:"execute-stale",keys:["Space"],selector:".jp-Notebook.jp-mod-commandMode"}),l.addItem({command:"alt-mode-execute",category:"execution",args:{}});const s=l=>{var s,n;const i=t.currentWidget.sessionContext;if(!i.isReady)return;const o=null!==(s=E[i.session.id])&&void 0!==s?s:{};if(null===(n=o.isIpyflowCommConnected)||void 0===n||!n)return;e.commands.execute("notebook:enter-command-mode");const c=o.computeTransitiveClosure([o.activeCell.model.id],!0,l);o.numPendingForcedReactiveCounterBumps++,"normal"===o.settings.exec_mode?o.executeCells(c):(o.altModeExecuteCells=c,e.commands.execute("alt-mode-execute"))};let n,i,o;e.commands.addCommand("execute-forward-slice",{label:"Execute Forward Slice",isEnabled:()=>!0,isVisible:()=>!0,isToggled:()=>!1,execute:()=>s(!1)}),e.commands.addKeyBinding({command:"execute-forward-slice",keys:["Accel J"],selector:".jp-Notebook"}),e.commands.addKeyBinding({command:"execute-forward-slice",keys:["Accel ArrowDown"],selector:".jp-Notebook"}),e.commands.addCommand("execute-backward-slice",{label:"Execute Backward Slice",isEnabled:()=>!0,isVisible:()=>!0,isToggled:()=>!1,execute:()=>s(!0)}),e.commands.addKeyBinding({command:"execute-backward-slice",keys:["Accel K"],selector:".jp-Notebook"}),e.commands.addKeyBinding({command:"execute-backward-slice",keys:["Accel ArrowUp"],selector:".jp-Notebook"});try{n=e.commands._commands.get("notebook:run-cell"),i=e.commands._commands.get("notebook:run-cell-and-select-next"),o=e.commands._commands.get("runmenu:run")}catch(t){n=e.commands._commands["notebook:run-cell"],i=e.commands._commands["notebook:run-cell-and-select-next"],o=e.commands._commands["runmenu:run"]}const d=n.execute,a=i.execute,r=o.execute,u=()=>{var e;const l=t.currentWidget.sessionContext;return l.isReady&&null!==(e=E[l.session.id])&&void 0!==e?e:{}};[[n,d,"notebook:run-cell"],[i,a,"notebook:run-cell-and-select-next"],[o,r,"runmenu:run"]].forEach((([l,s,n])=>{l.execute=(...i)=>{var o,c,d;const a=u(),r=t.currentWidget,v=r.content;if("ipyflow"!==r.sessionContext.session.kernel.name||null!==(o=null==a?void 0:a.isIpyflowCommConnected)&&void 0!==o&&o)if(u().isBatchReactive()&&"code"===(null===(d=null===(c=null==a?void 0:a.activeCell)||void 0===c?void 0:c.model)||void 0===d?void 0:d.type)){e.commands.execute("notebook:enter-command-mode");const t=a.notebook.widgets[a.notebook.widgets.length-1],l=a.activeCell.model.id===t.model.id;m(),["notebook:run-cell-and-select-next","runmenu:run"].includes(n)&&(l?e.commands.execute("notebook:insert-cell-below"):e.commands.execute("notebook:move-cursor-down"))}else s.call(l,i),a.requestComputeExecSchedule();else for(const e of v.widgets)v.isSelectedOrActive(e)&&(e.setPrompt("*"),b.push(e))}}));const m=(e=!1)=>{var t;const l=u();if(null!==(t=l.isIpyflowCommConnected)&&void 0!==t&&t){const t=[];for(const e of l.notebook.widgets)l.notebook.isSelectedOrActive(e)&&t.push(e.model.id);let s=l.computeTransitiveClosure(t,!0);e&&(s=s.splice(1)),s.length>0?l.executeCells(s):l.requestComputeExecSchedule()}};t.currentChanged.connect(((e,t)=>{const l=t.sessionContext;window.ipyflow=E[l.session.id]})),t.widgetAdded.connect(((e,l)=>{const s=l.sessionContext;let n=()=>k(s.session.id);const i=()=>{s.session.kernel.registerCommTarget("ipyflow-client",((e,i)=>{e.onMsg=e=>{var i;const o=e.content.data;(null===(i=o.success)||void 0===i||i)&&("unestablish"===o.type?n():"establish"===o.type&&(n(),n=j(s,t,l.content)))},n(),n=j(s,t,l.content)}))};s.ready.then((()=>{T(l.content),i(),n(),n=j(s,t,l.content),s.kernelChanged.connect(((e,o)=>{null!=o.newValue&&(T(l.content),n(),k(s.session.id),n=()=>k(s.session.id),s.ready.then((()=>{i(),n=j(s,t,l.content)})))}))}))}))}},I=e=>{if(null==e)return null;const t=e.children.item(1);return null===t?null:t.firstElementChild},S=e=>{if(null==e)return null;const t=e.children.item(2);return null===t?null:t.firstElementChild},L=(e,t,l)=>{const s=()=>{e.removeEventListener(t,l),e.removeEventListener("cleanup",s)};e.addEventListener(t,l),e.addEventListener("cleanup",s)},M=(e,t,l,s,n)=>{null!==e&&null!==t&&L(e,l,(()=>{t.firstElementChild.classList[s](n)}))},P=(e,t)=>{M(I(e),S(e),"mouseover","add",f),M(I(e),S(e),"mouseout","remove",f),M(S(e),I(e),"mouseover","add",t),M(S(e),I(e),"mouseout","remove",t)},T=e=>{e.widgets.forEach((e=>{e.node.classList.remove(p),e.node.classList.remove(m),e.node.classList.remove(C),e.node.classList.remove(v),e.node.classList.remove(h),e.node.classList.remove(g),e.node.classList.remove(x);const t=I(e.node);null!==t&&(t.firstElementChild.classList.remove(f),t.firstElementChild.classList.remove(y),t.dispatchEvent(w));const l=S(e.node);null!==l&&(l.firstElementChild.classList.remove(f),l.firstElementChild.classList.remove(y),l.dispatchEvent(w))}))},A=(e,t,l,s,n,i,o)=>{if(null===e)return;const c=()=>{for(const e of t){let t=y;o.has(e)&&(t=f);const n=s(l[e].node);if(null===n||null===n.firstElementChild)return;n.firstElementChild.classList[i](t)}};e.addEventListener(n,c),L(e,n,c)},j=(e,t,l)=>{var s,n,i,o,d;!function(e){const t=new _;E[e]=t,window.ipyflow=t}(e.session.id);const a=E[e.session.id];a.activeCell=l.activeCell;const u=e.session.kernel.createComm("ipyflow","ipyflow");a.comm=u,a.notebook=l,a.session=e;let w=!1;const B=e=>{null!==e&&null!==e.model&&(e.model.isDirty?a.dirtyCells.add(e.model.id):a.dirtyCells.delete(e.model.id))},L=r().debounce((()=>{if(w)return l.model.contentChanged.disconnect(L),void l.model.cells.changed.disconnect(L);const e=a.gatherCellMetadataAndContent();r().isEqual(e,a.lastCellMetadataMap)||(a.lastCellMetadataMap=e,l.widgets.forEach(B),u.send({type:"notify_content_changed",cell_metadata_by_id:e}))}),500),M=(e,t)=>{w?e.stateChanged.disconnect(M):"executionCount"===t.name&&null!==t.newValue&&(a.executedCells.add(e.id),a.dirtyCells.delete(e.id),l.widgets.forEach((t=>{t.model.id===e.id&&(t.node.classList.remove(v),t.node.classList.remove(h))})),"incremental"===a.settings.reactivity_mode&&a.requestComputeExecSchedule())};for(const e of l.widgets)e.model.stateChanged.connect(M);const j=(e,t)=>{if(w)l.model.cells.changed.disconnect(j);else if("add"===t.type)for(const e of t.newValues)null==e||e.stateChanged.connect(M);else if("remove"===t.type)for(const e of t.oldValues)null==e||e.stateChanged.disconnect(M)};l.model.cells.changed.connect(j);const H=e=>{a.cellsById={},a.orderIdxById={},e.widgets.forEach(((e,t)=>{a.cellsById[e.model.id]=e,a.orderIdxById[e.model.id]=t}))},q=(e,t)=>{var s,n;l===e&&(w?l.activeCellChanged.disconnect(q):((e=>{if(null==e.id)return;let t=-1;l.widgets.forEach(((l,s)=>{l.model.id===e.id&&(t=s)}));const s={type:"change_active_cell",active_cell_id:e.id,active_cell_order_idx:t};u.send(s)})(t.model),a.prevActiveCell=a.activeCell,a.activeCell=t,null!==a.activeCell&&null!==a.activeCell.model&&"code"===a.activeCell.model.type&&(a.dirtyCells.has(a.activeCell.model.id)&&(null===(n=(s=a.activeCell.model)._setDirty)||void 0===n||n.call(s,!0)),K(l))))},N=[{action:"mouseover",update:"add"},{action:"mouseout",update:"remove"}],F=(e,t,l,s)=>{var n;const{model:i,node:o}=e,c=i.id;"code"===i.type&&("classic"===(null!==(n=a.settings.color_scheme)&&void 0!==n?n:"normal")&&o.classList.add(p),l?o.classList.add(x):o.classList.remove(x),t&&!l?o.classList.add(g):o.classList.remove(g),s&&(a.waitingCells.has(c)?(o.classList.add(m),o.classList.add(v),o.classList.remove(h),P(o,f)):a.readyCells.has(c)&&(o.classList.add(h),o.classList.add(v),P(o,y)),"reactive"!==a.settings.exec_mode&&(void 0!==a.waiterLinks[c]&&N.forEach((({action:e,update:t})=>{A(I(o),a.waiterLinks[c],a.cellsById,I,e,t,a.waitingCells),A(S(o),a.waiterLinks[c],a.cellsById,I,e,t,a.waitingCells)})),void 0!==a.readyMakerLinks[c]&&(a.waitingCells.has(c)||(o.classList.add(C),o.classList.add(v)),N.forEach((({action:e,update:t})=>{A(I(o),a.readyMakerLinks[c],a.cellsById,I,e,t,a.waitingCells),A(I(o),a.readyMakerLinks[c],a.cellsById,S,e,t,a.waitingCells)}))))))},K=e=>{var t,l;T(e),H(e);let s=a.selectedCells;0===s.length&&(s=[a.activeCell.model.id]);const n=new Set(s);for(;;){for(const e of s)a.computeTransitiveClosureHelper(n,e,a.cellChildren,!1,!0);if(null===(t=a.settings.pull_reactive_updates)||void 0===t||!t)break;for(const e of n)a.computeTransitiveClosureHelper(n,e,a.cellParents,!0,!0);if(n.size===s.length||null===(l=a.settings.push_reactive_updates_to_cousins)||void 0===l||!l)break;s=Array.from(n)}const i=new Set(n);for(const e of s)i.delete(e),a.computeTransitiveClosureHelper(i,e,a.cellParents);for(const t of e.widgets){const e=t.model.id;F(t,i.has(e),n.has(e),"none"!==a.lastExecutionHighlights)}},V=()=>{var e,l,s;w&&t.selectionChanged.disconnect(V);const n=null==t?void 0:t.currentWidget,i=null==n?void 0:n.sessionContext;if(null===(e=null==i?void 0:i.isReady)||void 0===e||!e)return;const o=null!==(l=E[i.session.id])&&void 0!==l?l:{};if(null===(s=o.isIpyflowCommConnected)||void 0===s||!s)return;const c=n.content;o.selectedCells=c.widgets.filter((e=>"code"===e.model.type&&c.isSelected(e))).map((e=>e.model.id)),K(c)};t.selectionChanged.connect(V);const W=r().debounce((()=>{var e;const l=t.currentWidget;null!==(e=l.model.collaborative)&&void 0!==e&&e||l.context.save()}),200);u.onMsg=t=>{var s,n,i,o,d,r,m,v,C;const h=t.content.data;if(!w&&(null===(s=h.success)||void 0===s||s))if("establish"===h.type)a.isIpyflowCommConnected=!0,H(l),l.activeCellChanged.connect(q),l.activeCell.model.stateChanged.connect(M),q(l,l.activeCell),l.model.contentChanged.connect(L),l.model.cells.changed.connect(L),a.requestComputeExecSchedule();else if("set_exec_mode"===h.type)a.numAltModeExecutes=0,a.settings.exec_mode=h.exec_mode;else if("compute_exec_schedule"===h.type){a.settings=h.settings;const t=null!==(o=null===(i=(n=l.model).getMetadata)||void 0===i?void 0:i.call(n,"ipyflow"))&&void 0!==o?o:{},s=null!==(d=null==t?void 0:t.cell_parents)&&void 0!==d?d:{},f=null!==(r=null==t?void 0:t.cell_children)&&void 0!==r?r:{};a.cellParents=R(h.cell_parents,s),a.cellChildren=R(h.cell_children,f),a.executedCells=new Set(h.executed_cells),null===(v=(m=l.model).setMetadata)||void 0===v||v.call(m,"ipyflow",{cell_parents:a.cellParents,cell_children:a.cellChildren}),W(),a.waitingCells=new Set(h.waiting_cells),a.readyCells=new Set(h.ready_cells),0===a.numPendingForcedReactiveCounterBumps?(a.forcedReactiveCells=new Set([...a.forcedReactiveCells,...h.forced_reactive_cells]),a.forcedCascadingReactiveCells=new Set([...a.forcedCascadingReactiveCells,...h.forced_cascading_reactive_cells])):(a.forcedReactiveCells=new Set,a.forcedCascadingReactiveCells=new Set),a.waiterLinks=h.waiter_links,a.readyMakerLinks=h.ready_maker_links,a.staleParents=h.stale_parents,a.staleParentsByExecutedCellByChild=h.stale_parents_by_executed_cell_by_child,a.staleParentsByChildByExecutedCell=h.stale_parents_by_child_by_executed_cell,a.cellPendingExecution=null;const y=h.exec_mode;a.isReactivelyExecuting=a.isReactivelyExecuting||null!==(C=null==h?void 0:h.is_reactively_executing)&&void 0!==C&&C||"reactive"===y,a.newReadyCells="reactive"===y?new Set([...a.newReadyCells,...h.new_ready_cells]):new Set;const g=h.flow_order,x=h.exec_schedule;a.lastExecutionHighlights=h.highlights;const p=h.last_executed_cell_id;if(a.executedReactiveReadyCells.add(p),b.length>0){const e=b.splice(0,b.length);return void(a.isBatchReactive()?a.executeClosure(e):a.executeCells(e))}let w=!1;if(h.last_execution_was_error)w=!0;else if("batch"===a.settings.reactivity_mode){const e=a.computeTransitiveClosure(Array.from(a.forcedCascadingReactiveCells).filter((e=>!a.executedReactiveReadyCells.has(e)))).map((e=>e.model.id));let t;t="reactive"===y?a.computeTransitiveClosure([...a.newReadyCells,...a.forcedReactiveCells,...e].filter((e=>!a.executedReactiveReadyCells.has(e)))).filter((e=>!a.executedReactiveReadyCells.has(e.model.id))):[...a.forcedReactiveCells,...e].filter((e=>!a.executedReactiveReadyCells.has(e)&&void 0!==a.cellsById[e]&&void 0!==a.orderIdxById[e])).sort(((e,t)=>a.orderIdxById[e]-a.orderIdxById[t])).map((e=>a.cellsById[e])),0===t.length?w=!0:(a.isReactivelyExecuting=!0,a.executedReactiveReadyCells=new Set([...a.executedReactiveReadyCells,...t.map((e=>e.model.id))]),a.executeCells(t))}else if("incremental"===a.settings.reactivity_mode){let t=!1;for(const e of l.widgets){if(!t&&(t=e.model.id===p,"in_order"===g||"strict"===x))continue;if("code"!==e.model.type||a.executedReactiveReadyCells.has(e.model.id))continue;if(!(a.forcedReactiveCells.has(e.model.id)||a.newReadyCells.has(e.model.id)&&"reactive"===y))continue;const l=e;if(null===a.cellPendingExecution){if(a.cellPendingExecution=l,"in_order"===g||"strict"===x)break}else null==l.model.executionCount||l.model.executionCount<a.cellPendingExecution.model.executionCount&&(a.cellPendingExecution=l)}null===a.cellPendingExecution?w=!0:(a.isReactivelyExecuting=!0,a.executedCells.add(a.cellPendingExecution.model.id),c.CodeCell.execute(a.cellPendingExecution,e))}w&&(a.isReactivelyExecuting&&("reactive"===a.lastExecutionHighlights&&(a.readyCells=a.executedReactiveReadyCells),u.send({type:"reactivity_cleanup"})),a.numAltModeExecutes>0&&0==--a.numAltModeExecutes&&a.toggleReactivity(),a.numPendingForcedReactiveCounterBumps>0&&a.bumpForcedReactiveCounter(),a.forcedReactiveCells=new Set,a.forcedCascadingReactiveCells=new Set,a.newReadyCells=new Set,a.executedReactiveReadyCells=new Set,a.isReactivelyExecuting=!1,K(l))}};const O=null!==(i=null===(n=(s=l.model).getMetadata)||void 0===n?void 0:n.call(s,"ipyflow"))&&void 0!==i?i:{};return u.open({interface:"jupyterlab",cell_metadata_by_id:a.gatherCellMetadataAndContent(),cell_parents:null!==(o=null==O?void 0:O.cell_parents)&&void 0!==o?o:{},cell_children:null!==(d=null==O?void 0:O.cell_children)&&void 0!==d?d:{}}),()=>{u.dispose(),w=!0,a.isIpyflowCommConnected=!1,k(e.session.id)}},H=B}}]);