[tox]
envlist = py{311,312,313}, lint, type
minversion = 4.0
isolated_build = True
skip_missing_interpreters = True

[testenv]
description = Run tests with pytest under {basepython}
deps =
    pytest>=8.4.1
    pytest-cov>=6.2.1
    python-dateutil>=2.8.0
extras = upload-progress
commands =
    pytest {posargs:-v --cov=aceiot_models --cov-report=term-missing}

[testenv:lint]
description = Run linting with ruff
deps = ruff>=0.12.4
skip_install = True
commands =
    ruff check .
    ruff format --check .

[testenv:type]
description = Run type checking with pyrefly
deps = 
    pyrefly>=0.25.0
    -e .
commands =
    pyrefly

[testenv:format]
description = Auto-format code with ruff
deps = ruff>=0.12.4
skip_install = True
commands =
    ruff check --fix .
    ruff format .

[testenv:pre-commit]
description = Run pre-commit hooks
deps = pre-commit>=3.6.0
skip_install = True
commands =
    pre-commit run --all-files

[testenv:build]
description = Build the package
deps = build
skip_install = True
commands =
    python -m build

[testenv:release]
description = Check if package is ready for release
deps =
    build
    twine
skip_install = True
commands =
    python -m build
    twine check dist/*

# Test configuration
[pytest]
addopts = 
    --strict-markers
    --strict-config
    -ra

# Coverage configuration
[coverage:run]
source = aceiot_models
omit = 
    tests/*
    */tests/*

[coverage:report]
exclude_lines =
    pragma: no cover
    def __repr__
    raise AssertionError
    raise NotImplementedError
    if __name__ == .__main__.