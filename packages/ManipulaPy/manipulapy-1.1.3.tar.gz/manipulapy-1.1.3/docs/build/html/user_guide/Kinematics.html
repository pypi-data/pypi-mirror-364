

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="Kinematics User Guide" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://manipulapy.readthedocs.io/user_guide/Kinematics.html" />
<meta property="og:site_name" content="ManipulaPy Documentation" />
<meta property="og:description" content="This guide covers the SerialManipulator class in ManipulaPy, which provides forward kinematics, inverse kinematics, and Jacobian computations for serial robot manipulators using modern screw theory..." />
<meta name="description" content="This guide covers the SerialManipulator class in ManipulaPy, which provides forward kinematics, inverse kinematics, and Jacobian computations for serial robot manipulators using modern screw theory..." />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Kinematics User Guide &mdash; ManipulaPy 1.1.0 Documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
      <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=b4417981" />
      <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
      <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=b4417981" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=fc837d61"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../_static/copybutton.js?v=fd10adb8"></script>
      <script>let toggleHintShow = 'Click to show';</script>
      <script>let toggleHintHide = 'Click to hide';</script>
      <script>let toggleOpenOnPrint = 'true';</script>
      <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
      <script src="../_static/design-tabs.js?v=f930bc37"></script>
      <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
      <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
      <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Dynamics User Guide" href="Dynamics.html" />
    <link rel="prev" title="User Guide" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #2980B9" >

          
          
          <a href="../index.html" class="icon icon-home">
            ManipulaPy
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">🚀 Get Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/index.html">Getting Started with ManipulaPy</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">🛠️ API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">🔧 API Reference Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">📚 User Guides</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">User Guide</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html#complete-guide-overview">📚 Complete Guide Overview</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Kinematics User Guide</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#what-is-robot-kinematics">What is Robot Kinematics?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mathematical-foundation">Mathematical Foundation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#serialmanipulator-class">SerialManipulator Class</a></li>
<li class="toctree-l4"><a class="reference internal" href="#creating-a-robot-model">Creating a Robot Model</a></li>
<li class="toctree-l4"><a class="reference internal" href="#forward-kinematics">Forward Kinematics</a></li>
<li class="toctree-l4"><a class="reference internal" href="#inverse-kinematics">Inverse Kinematics</a></li>
<li class="toctree-l4"><a class="reference internal" href="#jacobian-matrix">Jacobian Matrix</a></li>
<li class="toctree-l4"><a class="reference internal" href="#velocity-kinematics">Velocity Kinematics</a></li>
<li class="toctree-l4"><a class="reference internal" href="#state-management">State Management</a></li>
<li class="toctree-l4"><a class="reference internal" href="#working-examples">Working Examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="#common-issues-and-solutions">Common Issues and Solutions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#best-practices">Best Practices</a></li>
<li class="toctree-l4"><a class="reference internal" href="#next-steps">Next Steps</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="Dynamics.html">Dynamics User Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="Control.html">Control Module User Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="URDF_Processor.html">URDF Processor User Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="Trajectory_Planning.html">Trajectory Planning User Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="Simulation.html">Simulation Module User Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="Singularity_Analysis.html">Singularity Analysis User Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="Collision_Checker.html">Collision Checker Module User Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="Potential_Field.html">Potential Field Module User Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="Perception.html">Perception User Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="Singularity_Analysis.html">Singularity Analysis User Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="CUDA_Kernels.html">CUDA Kernels User Guide</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#learning-pathways">🗺️ Learning Pathways</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#guide-categories">📖 Guide Categories</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#quick-reference">🎯 Quick Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#study-tips">💡 Study Tips</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#need-help">🆘 Need Help?</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Kinematics User Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#what-is-robot-kinematics">What is Robot Kinematics?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#mathematical-foundation">Mathematical Foundation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#product-of-exponentials-formula">Product of Exponentials Formula</a></li>
<li class="toctree-l3"><a class="reference internal" href="#screw-axes">Screw Axes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#jacobian-computation">Jacobian Computation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#inverse-kinematics-newtonraphson-damped-least-squares">Inverse Kinematics (Newton–Raphson / Damped Least Squares)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#serialmanipulator-class">SerialManipulator Class</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#constructor">Constructor</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#creating-a-robot-model">Creating a Robot Model</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#from-urdf-recommended">From URDF (Recommended)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#manual-definition">Manual Definition</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#forward-kinematics">Forward Kinematics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#basic-forward-kinematics">Basic Forward Kinematics</a></li>
<li class="toctree-l3"><a class="reference internal" href="#space-vs-body-frames">Space vs Body Frames</a></li>
<li class="toctree-l3"><a class="reference internal" href="#end-effector-pose-as-vector">End-Effector Pose as Vector</a></li>
<li class="toctree-l3"><a class="reference internal" href="#multiple-configurations">Multiple Configurations</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#inverse-kinematics">Inverse Kinematics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#basic-inverse-kinematics">Basic Inverse Kinematics</a></li>
<li class="toctree-l3"><a class="reference internal" href="#advanced-ik-options">Advanced IK Options</a></li>
<li class="toctree-l3"><a class="reference internal" href="#multiple-ik-solutions">Multiple IK Solutions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#jacobian-matrix">Jacobian Matrix</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#computing-the-jacobian">Computing the Jacobian</a></li>
<li class="toctree-l3"><a class="reference internal" href="#jacobian-analysis">Jacobian Analysis</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#velocity-kinematics">Velocity Kinematics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#end-effector-velocity">End-Effector Velocity</a></li>
<li class="toctree-l3"><a class="reference internal" href="#joint-velocities-from-desired-motion">Joint Velocities from Desired Motion</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#state-management">State Management</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#robot-state-tracking">Robot State Tracking</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#working-examples">Working Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#complete-workflow-example">Complete Workflow Example</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#common-issues-and-solutions">Common Issues and Solutions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#troubleshooting-ik-convergence">Troubleshooting IK Convergence</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#best-practices">Best Practices</a></li>
<li class="toctree-l2"><a class="reference internal" href="#next-steps">Next Steps</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#api-reference">API Reference</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Dynamics.html">Dynamics User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="Control.html">Control Module User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="Trajectory_Planning.html">Trajectory Planning User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="Simulation.html">Simulation Module User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="URDF_Processor.html">URDF Processor User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="Singularity_Analysis.html">Singularity Analysis User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="Perception.html">Perception User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="vision.html">Vision User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="Potential_Field.html">Potential Field Module User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="Collision_Checker.html">Collision Checker Module User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="CUDA_Kernels.html">CUDA Kernels User Guide</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #2980B9" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">ManipulaPy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">User Guide</a></li>
      <li class="breadcrumb-item active">Kinematics User Guide</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/user_guide/Kinematics.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="kinematics-user-guide">
<h1>Kinematics User Guide<a class="headerlink" href="#kinematics-user-guide" title="Link to this heading"></a></h1>
<p>This guide covers the <strong>SerialManipulator</strong> class in ManipulaPy, which provides forward kinematics, inverse kinematics, and Jacobian computations for serial robot manipulators using modern screw theory.</p>
<nav class="contents local" id="quick-navigation">
<p class="topic-title"><strong>Quick Navigation</strong></p>
<ul class="simple">
<li><p><a class="reference internal" href="#what-is-robot-kinematics" id="id1">What is Robot Kinematics?</a></p></li>
<li><p><a class="reference internal" href="#mathematical-foundation" id="id2">Mathematical Foundation</a></p>
<ul>
<li><p><a class="reference internal" href="#product-of-exponentials-formula" id="id3">Product of Exponentials Formula</a></p></li>
<li><p><a class="reference internal" href="#screw-axes" id="id4">Screw Axes</a></p></li>
<li><p><a class="reference internal" href="#jacobian-computation" id="id5">Jacobian Computation</a></p></li>
<li><p><a class="reference internal" href="#inverse-kinematics-newtonraphson-damped-least-squares" id="id6">Inverse Kinematics (Newton–Raphson / Damped Least Squares)</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#serialmanipulator-class" id="id7">SerialManipulator Class</a></p>
<ul>
<li><p><a class="reference internal" href="#constructor" id="id8">Constructor</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#creating-a-robot-model" id="id9">Creating a Robot Model</a></p>
<ul>
<li><p><a class="reference internal" href="#from-urdf-recommended" id="id10">From URDF (Recommended)</a></p></li>
<li><p><a class="reference internal" href="#manual-definition" id="id11">Manual Definition</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#forward-kinematics" id="id12">Forward Kinematics</a></p>
<ul>
<li><p><a class="reference internal" href="#basic-forward-kinematics" id="id13">Basic Forward Kinematics</a></p></li>
<li><p><a class="reference internal" href="#space-vs-body-frames" id="id14">Space vs Body Frames</a></p></li>
<li><p><a class="reference internal" href="#end-effector-pose-as-vector" id="id15">End-Effector Pose as Vector</a></p></li>
<li><p><a class="reference internal" href="#multiple-configurations" id="id16">Multiple Configurations</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#inverse-kinematics" id="id17">Inverse Kinematics</a></p>
<ul>
<li><p><a class="reference internal" href="#basic-inverse-kinematics" id="id18">Basic Inverse Kinematics</a></p></li>
<li><p><a class="reference internal" href="#advanced-ik-options" id="id19">Advanced IK Options</a></p></li>
<li><p><a class="reference internal" href="#multiple-ik-solutions" id="id20">Multiple IK Solutions</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#jacobian-matrix" id="id21">Jacobian Matrix</a></p>
<ul>
<li><p><a class="reference internal" href="#computing-the-jacobian" id="id22">Computing the Jacobian</a></p></li>
<li><p><a class="reference internal" href="#jacobian-analysis" id="id23">Jacobian Analysis</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#velocity-kinematics" id="id24">Velocity Kinematics</a></p>
<ul>
<li><p><a class="reference internal" href="#end-effector-velocity" id="id25">End-Effector Velocity</a></p></li>
<li><p><a class="reference internal" href="#joint-velocities-from-desired-motion" id="id26">Joint Velocities from Desired Motion</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#state-management" id="id27">State Management</a></p>
<ul>
<li><p><a class="reference internal" href="#robot-state-tracking" id="id28">Robot State Tracking</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#working-examples" id="id29">Working Examples</a></p>
<ul>
<li><p><a class="reference internal" href="#complete-workflow-example" id="id30">Complete Workflow Example</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#common-issues-and-solutions" id="id31">Common Issues and Solutions</a></p>
<ul>
<li><p><a class="reference internal" href="#troubleshooting-ik-convergence" id="id32">Troubleshooting IK Convergence</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#best-practices" id="id33">Best Practices</a></p></li>
<li><p><a class="reference internal" href="#next-steps" id="id34">Next Steps</a></p>
<ul>
<li><p><a class="reference internal" href="#api-reference" id="id35">API Reference</a></p></li>
</ul>
</li>
</ul>
</nav>
<section id="what-is-robot-kinematics">
<h2><a class="toc-backref" href="#id1" role="doc-backlink">What is Robot Kinematics?</a><a class="headerlink" href="#what-is-robot-kinematics" title="Link to this heading"></a></h2>
<p><strong>Robot kinematics</strong> studies the geometry of manipulator motion without considering forces. The key problems are:</p>
<ul class="simple">
<li><p><strong>Forward Kinematics (FK):</strong> Given joint angles → find end-effector pose</p></li>
<li><p><strong>Inverse Kinematics (IK):</strong> Given desired pose → find joint angles</p></li>
<li><p><strong>Jacobian Analysis:</strong> Relationship between joint velocities and end-effector motion</p></li>
</ul>
<p>ManipulaPy uses the <strong>Product of Exponentials (PoE)</strong> formulation with screw theory for numerically stable computations.</p>
</section>
<section id="mathematical-foundation">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Mathematical Foundation</a><a class="headerlink" href="#mathematical-foundation" title="Link to this heading"></a></h2>
<section id="product-of-exponentials-formula">
<h3><a class="toc-backref" href="#id3" role="doc-backlink">Product of Exponentials Formula</a><a class="headerlink" href="#product-of-exponentials-formula" title="Link to this heading"></a></h3>
<p>The forward kinematics is computed using:</p>
<p><strong>Space Frame:</strong></p>
<div class="math notranslate nohighlight">
\[T(\boldsymbol\theta)
  = \exp\!\bigl([\mathcal S_{1}]\;\theta_{1}\bigr)\,
    \exp\!\bigl([\mathcal S_{2}]\;\theta_{2}\bigr)\,
    \cdots\,
    \exp\!\bigl([\mathcal S_{n}]\;\theta_{n}\bigr)\,M\]</div>
<p><strong>Body Frame:</strong></p>
<div class="math notranslate nohighlight">
\[T(\boldsymbol\theta)
  = M\,
    \exp\!\bigl([\mathcal B_{1}]\;\theta_{1}\bigr)\,
    \exp\!\bigl([\mathcal B_{2}]\;\theta_{2}\bigr)\,
    \cdots\,
    \exp\!\bigl([\mathcal B_{n}]\;\theta_{n}\bigr)\]</div>
<p>where</p>
<div class="math notranslate nohighlight">
\[\begin{split}[\mathcal S]
  = \begin{bmatrix}
      [\boldsymbol\omega]_\times &amp; \mathbf v \\
      \mathbf0^T                &amp; 0
    \end{bmatrix}
\quad\text{and}\quad
[\mathcal B]
  = \begin{bmatrix}
      [\boldsymbol\omega]_\times &amp; \mathbf v \\
      \mathbf0^T                &amp; 0
    \end{bmatrix}\end{split}\]</div>
<p>with <span class="math notranslate nohighlight">\([\boldsymbol\omega]_\times\)</span> the usual 3×3 skew‐symmetric matrix of <span class="math notranslate nohighlight">\(\boldsymbol\omega\)</span>.</p>
</section>
<section id="screw-axes">
<h3><a class="toc-backref" href="#id4" role="doc-backlink">Screw Axes</a><a class="headerlink" href="#screw-axes" title="Link to this heading"></a></h3>
<p>Each joint’s motion is encoded as a 6-vector</p>
<div class="math notranslate nohighlight">
\[\begin{split}\mathcal S
  = \begin{bmatrix}\boldsymbol\omega\\\mathbf v\end{bmatrix}\,\in\mathbb R^6\end{split}\]</div>
<p>with three canonical cases:</p>
<ul>
<li><p><strong>Revolute joint</strong> about axis <span class="math notranslate nohighlight">\(\boldsymbol\omega\)</span> through point <span class="math notranslate nohighlight">\(\mathbf r\)</span></p>
<div class="math notranslate nohighlight">
\[\begin{split}\mathbf v = \mathbf r \times \boldsymbol\omega,\qquad
\mathcal S
  = \begin{bmatrix}
      \boldsymbol\omega \\
      \mathbf r \times \boldsymbol\omega
    \end{bmatrix}\end{split}\]</div>
</li>
<li><p><strong>Prismatic joint</strong> translating along unit vector <span class="math notranslate nohighlight">\(\mathbf v\)</span></p>
<div class="math notranslate nohighlight">
\[\begin{split}\mathcal S
  = \begin{bmatrix}
      \mathbf0 \\
      \mathbf v
    \end{bmatrix},\quad \|\mathbf v\|=1\end{split}\]</div>
</li>
<li><p><strong>General (helical) screw</strong> with pitch <span class="math notranslate nohighlight">\(h\)</span></p>
<div class="math notranslate nohighlight">
\[\begin{split}\mathcal S
  = \begin{bmatrix}
      \boldsymbol\omega \\
      \mathbf r \times \boldsymbol\omega + h\,\boldsymbol\omega
    \end{bmatrix}\end{split}\]</div>
</li>
</ul>
</section>
<section id="jacobian-computation">
<h3><a class="toc-backref" href="#id5" role="doc-backlink">Jacobian Computation</a><a class="headerlink" href="#jacobian-computation" title="Link to this heading"></a></h3>
<p><strong>Space Jacobian</strong> for an n-DOF manipulator:</p>
<div class="math notranslate nohighlight">
\[J_{s}(\boldsymbol\theta)
  = \bigl[\,\mathrm{Ad}_{T_{0}^{-1}(\boldsymbol\theta)}\,\mathcal S_{1}\;,\;
            \mathrm{Ad}_{T_{1}^{-1}(\boldsymbol\theta)}\,\mathcal S_{2}\;,\;
            \dots\;,\;
            \mathrm{Ad}_{T_{n-1}^{-1}(\boldsymbol\theta)}\,\mathcal S_{n}\bigr]\]</div>
<p>where</p>
<div class="math notranslate nohighlight">
\[T_{i}(\boldsymbol\theta)
  = \exp\!\bigl([\mathcal S_{1}]\theta_{1}\bigr)\,
    \exp\!\bigl([\mathcal S_{2}]\theta_{2}\bigr)\,\cdots\,
    \exp\!\bigl([\mathcal S_{i}]\theta_{i}\bigr)\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[\begin{split}\mathrm{Ad}_{T}
  = \begin{bmatrix}
      R &amp; \mathbf0 \\
      [\mathbf p]_\times R &amp; R
    \end{bmatrix}
\quad\text{for}\quad
T = \begin{bmatrix}R &amp; \mathbf p\\\mathbf0^T&amp;1\end{bmatrix}.\end{split}\]</div>
<p><strong>Body Jacobian</strong> follows by</p>
<div class="math notranslate nohighlight">
\[J_{b}(\boldsymbol\theta)
  = \mathrm{Ad}_{T(\boldsymbol\theta)^{-1}}\,J_{s}(\boldsymbol\theta)\]</div>
</section>
<section id="inverse-kinematics-newtonraphson-damped-least-squares">
<h3><a class="toc-backref" href="#id6" role="doc-backlink">Inverse Kinematics (Newton–Raphson / Damped Least Squares)</a><a class="headerlink" href="#inverse-kinematics-newtonraphson-damped-least-squares" title="Link to this heading"></a></h3>
<p><strong>Error twist:</strong></p>
<div class="math notranslate nohighlight">
\[\mathbf V_{\mathrm{error}}
  = \bigl(\log\!\bigl(T_{\mathrm{desired}}\,T(\boldsymbol\theta)^{-1}\bigr)\bigr)^\vee\]</div>
<p><strong>Update step:</strong></p>
<div class="math notranslate nohighlight">
\[\boldsymbol\theta_{k+1}
  = \boldsymbol\theta_{k}
    + \alpha\,(J^{T}J + \lambda I)^{-1}J^{T}\,\mathbf V_{\mathrm{error}}\]</div>
<p>with damping <span class="math notranslate nohighlight">\(\lambda\)</span> for numerical stability.</p>
</section>
</section>
<section id="serialmanipulator-class">
<h2><a class="toc-backref" href="#id7" role="doc-backlink">SerialManipulator Class</a><a class="headerlink" href="#serialmanipulator-class" title="Link to this heading"></a></h2>
<section id="constructor">
<h3><a class="toc-backref" href="#id8" role="doc-backlink">Constructor</a><a class="headerlink" href="#constructor" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ManipulaPy.kinematics</span> <span class="kn">import</span> <span class="n">SerialManipulator</span>

<span class="n">robot</span> <span class="o">=</span> <span class="n">SerialManipulator</span><span class="p">(</span>
    <span class="n">M_list</span><span class="p">,</span>           <span class="c1"># Home configuration (4×4 matrix)</span>
    <span class="n">omega_list</span><span class="p">,</span>       <span class="c1"># Joint axes (3×n matrix)</span>
    <span class="n">r_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>      <span class="c1"># Points on joint axes (optional)</span>
    <span class="n">b_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>      <span class="c1"># Body frame points (optional)</span>
    <span class="n">S_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>      <span class="c1"># Space frame screw axes (6×n matrix)</span>
    <span class="n">B_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>      <span class="c1"># Body frame screw axes (6×n matrix)</span>
    <span class="n">G_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>      <span class="c1"># Inertia matrices (for dynamics)</span>
    <span class="n">joint_limits</span><span class="o">=</span><span class="kc">None</span> <span class="c1"># Joint limits [(min, max), ...]</span>
<span class="p">)</span>
</pre></div>
</div>
<p><strong>Key Parameters:</strong>
- <strong>M_list</strong>: 4×4 transformation matrix representing the home pose
- <strong>omega_list</strong>: 3×n matrix of joint rotation axes
- <strong>S_list</strong>: 6×n matrix of space frame screw axes (auto-computed if not provided)
- <strong>joint_limits</strong>: List of (min, max) tuples for each joint</p>
</section>
</section>
<section id="creating-a-robot-model">
<h2><a class="toc-backref" href="#id9" role="doc-backlink">Creating a Robot Model</a><a class="headerlink" href="#creating-a-robot-model" title="Link to this heading"></a></h2>
<section id="from-urdf-recommended">
<h3><a class="toc-backref" href="#id10" role="doc-backlink">From URDF (Recommended)</a><a class="headerlink" href="#from-urdf-recommended" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ManipulaPy.urdf_processor</span> <span class="kn">import</span> <span class="n">URDFToSerialManipulator</span>
<span class="kn">from</span> <span class="nn">ManipulaPy.ManipulaPy_data.xarm</span> <span class="kn">import</span> <span class="n">urdf_file</span> <span class="k">as</span> <span class="n">xarm_urdf</span>

<span class="c1"># Load built-in xArm robot</span>
<span class="n">processor</span> <span class="o">=</span> <span class="n">URDFToSerialManipulator</span><span class="p">(</span><span class="n">xarm_urdf</span><span class="p">)</span>
<span class="n">robot</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">serial_manipulator</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Robot has </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">robot</span><span class="o">.</span><span class="n">joint_limits</span><span class="p">)</span><span class="si">}</span><span class="s2"> joints&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Home position: </span><span class="si">{</span><span class="n">robot</span><span class="o">.</span><span class="n">M_list</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="manual-definition">
<h3><a class="toc-backref" href="#id11" role="doc-backlink">Manual Definition</a><a class="headerlink" href="#manual-definition" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># Example: 2-DOF planar robot</span>
<span class="k">def</span> <span class="nf">create_2dof_planar_robot</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a simple 2-DOF planar RR robot.&quot;&quot;&quot;</span>

    <span class="c1"># Link lengths</span>
    <span class="n">L1</span><span class="p">,</span> <span class="n">L2</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.3</span>

    <span class="c1"># Home configuration (fully extended)</span>
    <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">L1</span> <span class="o">+</span> <span class="n">L2</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="p">])</span>

    <span class="c1"># Space frame screw axes (both Z-axis rotations)</span>
    <span class="n">S_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
        <span class="c1"># Joint 1 at origin</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="c1"># Joint 2 at (L1, 0, 0)</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">L1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="p">])</span><span class="o">.</span><span class="n">T</span>  <span class="c1"># Shape: (6, 2)</span>

    <span class="c1"># Extract omega_list for constructor</span>
    <span class="n">omega_list</span> <span class="o">=</span> <span class="n">S_list</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:]</span>

    <span class="c1"># Joint limits</span>
    <span class="n">joint_limits</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)]</span>

    <span class="n">robot</span> <span class="o">=</span> <span class="n">SerialManipulator</span><span class="p">(</span>
        <span class="n">M_list</span><span class="o">=</span><span class="n">M</span><span class="p">,</span>
        <span class="n">omega_list</span><span class="o">=</span><span class="n">omega_list</span><span class="p">,</span>
        <span class="n">S_list</span><span class="o">=</span><span class="n">S_list</span><span class="p">,</span>
        <span class="n">joint_limits</span><span class="o">=</span><span class="n">joint_limits</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">robot</span>

<span class="c1"># Create the robot</span>
<span class="n">planar_robot</span> <span class="o">=</span> <span class="n">create_2dof_planar_robot</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>
<section id="forward-kinematics">
<h2><a class="toc-backref" href="#id12" role="doc-backlink">Forward Kinematics</a><a class="headerlink" href="#forward-kinematics" title="Link to this heading"></a></h2>
<section id="basic-forward-kinematics">
<h3><a class="toc-backref" href="#id13" role="doc-backlink">Basic Forward Kinematics</a><a class="headerlink" href="#basic-forward-kinematics" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define joint angles</span>
<span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.3</span><span class="p">])</span>  <span class="c1"># radians</span>

<span class="c1"># Compute forward kinematics</span>
<span class="n">T</span> <span class="o">=</span> <span class="n">robot</span><span class="o">.</span><span class="n">forward_kinematics</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="s2">&quot;space&quot;</span><span class="p">)</span>

<span class="c1"># Extract position and orientation</span>
<span class="n">position</span> <span class="o">=</span> <span class="n">T</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">rotation_matrix</span> <span class="o">=</span> <span class="n">T</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;End-effector position: </span><span class="si">{</span><span class="n">position</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;End-effector orientation:</span><span class="se">\n</span><span class="si">{</span><span class="n">rotation_matrix</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="space-vs-body-frames">
<h3><a class="toc-backref" href="#id14" role="doc-backlink">Space vs Body Frames</a><a class="headerlink" href="#space-vs-body-frames" title="Link to this heading"></a></h3>
<aside class="system-message">
<p class="system-message-title">System Message: WARNING/2 (<span class="docutils literal">/home/abo/Desktop/ManipulaPy/docs/source/user_guide/Kinematics.rst</span>, line 274)</p>
<p>Title underline too short.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Space</span> <span class="n">vs</span> <span class="n">Body</span> <span class="n">Frames</span>
<span class="o">~~~~~~~~~~~~~~~~~~~</span>
</pre></div>
</div>
</aside>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">])</span>

<span class="c1"># Both methods give the same result</span>
<span class="n">T_space</span> <span class="o">=</span> <span class="n">robot</span><span class="o">.</span><span class="n">forward_kinematics</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="s2">&quot;space&quot;</span><span class="p">)</span>
<span class="n">T_body</span> <span class="o">=</span> <span class="n">robot</span><span class="o">.</span><span class="n">forward_kinematics</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="s2">&quot;body&quot;</span><span class="p">)</span>

<span class="c1"># Verify they&#39;re identical</span>
<span class="n">error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">T_space</span> <span class="o">-</span> <span class="n">T_body</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Space vs Body frame error: </span><span class="si">{</span><span class="n">error</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># Should be ~0</span>
</pre></div>
</div>
</section>
<section id="end-effector-pose-as-vector">
<h3><a class="toc-backref" href="#id15" role="doc-backlink">End-Effector Pose as Vector</a><a class="headerlink" href="#end-effector-pose-as-vector" title="Link to this heading"></a></h3>
<aside class="system-message">
<p class="system-message-title">System Message: WARNING/2 (<span class="docutils literal">/home/abo/Desktop/ManipulaPy/docs/source/user_guide/Kinematics.rst</span>, line 289)</p>
<p>Title underline too short.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">End</span><span class="o">-</span><span class="n">Effector</span> <span class="n">Pose</span> <span class="k">as</span> <span class="n">Vector</span>
<span class="o">~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
</pre></div>
</div>
</aside>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get pose as [x, y, z, roll, pitch, yaw]</span>
<span class="n">pose_vector</span> <span class="o">=</span> <span class="n">robot</span><span class="o">.</span><span class="n">end_effector_pose</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>

<span class="n">position</span> <span class="o">=</span> <span class="n">pose_vector</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
<span class="n">euler_angles</span> <span class="o">=</span> <span class="n">pose_vector</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span>  <span class="c1"># in radians</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Position: </span><span class="si">{</span><span class="n">position</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Orientation (degrees): </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">euler_angles</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="multiple-configurations">
<h3><a class="toc-backref" href="#id16" role="doc-backlink">Multiple Configurations</a><a class="headerlink" href="#multiple-configurations" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_multiple_configurations</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test FK for multiple joint configurations.&quot;&quot;&quot;</span>

    <span class="c1"># Test configurations</span>
    <span class="n">test_configs</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]),</span>      <span class="c1"># Home position</span>
        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span><span class="p">]),</span>  <span class="c1"># 45° configuration</span>
        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]),</span>      <span class="c1"># Elbow up</span>
        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">])</span>       <span class="c1"># Forearm up</span>
    <span class="p">]</span>

    <span class="n">config_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Home&quot;</span><span class="p">,</span> <span class="s2">&quot;45° config&quot;</span><span class="p">,</span> <span class="s2">&quot;Elbow up&quot;</span><span class="p">,</span> <span class="s2">&quot;Forearm up&quot;</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">config</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">test_configs</span><span class="p">,</span> <span class="n">config_names</span><span class="p">):</span>
        <span class="n">T</span> <span class="o">=</span> <span class="n">robot</span><span class="o">.</span><span class="n">forward_kinematics</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">T</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">:</span><span class="s2">12</span><span class="si">}</span><span class="s2">: position = [</span><span class="si">{</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">pos</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>

<span class="n">test_multiple_configurations</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>
<section id="inverse-kinematics">
<h2><a class="toc-backref" href="#id17" role="doc-backlink">Inverse Kinematics</a><a class="headerlink" href="#inverse-kinematics" title="Link to this heading"></a></h2>
<section id="basic-inverse-kinematics">
<h3><a class="toc-backref" href="#id18" role="doc-backlink">Basic Inverse Kinematics</a><a class="headerlink" href="#basic-inverse-kinematics" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define target pose</span>
<span class="n">T_target</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">T_target</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>  <span class="c1"># desired position</span>

<span class="c1"># Initial guess</span>
<span class="n">theta_initial</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>

<span class="c1"># Solve inverse kinematics</span>
<span class="n">solution</span><span class="p">,</span> <span class="n">success</span><span class="p">,</span> <span class="n">iterations</span> <span class="o">=</span> <span class="n">robot</span><span class="o">.</span><span class="n">iterative_inverse_kinematics</span><span class="p">(</span>
    <span class="n">T_desired</span><span class="o">=</span><span class="n">T_target</span><span class="p">,</span>
    <span class="n">thetalist0</span><span class="o">=</span><span class="n">theta_initial</span><span class="p">,</span>
    <span class="n">eomg</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">,</span>              <span class="c1"># rotation error tolerance</span>
    <span class="n">ev</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">,</span>                <span class="c1"># translation error tolerance</span>
    <span class="n">max_iterations</span><span class="o">=</span><span class="mi">1000</span>
<span class="p">)</span>

<span class="k">if</span> <span class="n">success</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✅ IK converged in </span><span class="si">{</span><span class="n">iterations</span><span class="si">}</span><span class="s2"> iterations&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Solution: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">solution</span><span class="p">)</span><span class="si">}</span><span class="s2"> degrees&quot;</span><span class="p">)</span>

    <span class="c1"># Verify solution</span>
    <span class="n">T_achieved</span> <span class="o">=</span> <span class="n">robot</span><span class="o">.</span><span class="n">forward_kinematics</span><span class="p">(</span><span class="n">solution</span><span class="p">)</span>
    <span class="n">error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">T_achieved</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">T_target</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Position error: </span><span class="si">{</span><span class="n">error</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2"> m&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;❌ IK failed to converge&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="advanced-ik-options">
<h3><a class="toc-backref" href="#id19" role="doc-backlink">Advanced IK Options</a><a class="headerlink" href="#advanced-ik-options" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># More robust IK with damping</span>
<span class="n">solution</span><span class="p">,</span> <span class="n">success</span><span class="p">,</span> <span class="n">iterations</span> <span class="o">=</span> <span class="n">robot</span><span class="o">.</span><span class="n">iterative_inverse_kinematics</span><span class="p">(</span>
    <span class="n">T_desired</span><span class="o">=</span><span class="n">T_target</span><span class="p">,</span>
    <span class="n">thetalist0</span><span class="o">=</span><span class="n">theta_initial</span><span class="p">,</span>
    <span class="n">eomg</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">,</span>
    <span class="n">ev</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">,</span>
    <span class="n">max_iterations</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
    <span class="n">plot_residuals</span><span class="o">=</span><span class="kc">True</span>    <span class="c1"># Save convergence plot</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="multiple-ik-solutions">
<h3><a class="toc-backref" href="#id20" role="doc-backlink">Multiple IK Solutions</a><a class="headerlink" href="#multiple-ik-solutions" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">find_multiple_solutions</span><span class="p">(</span><span class="n">robot</span><span class="p">,</span> <span class="n">target_pos</span><span class="p">,</span> <span class="n">n_attempts</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Find multiple IK solutions for the same target.&quot;&quot;&quot;</span>

    <span class="n">T_target</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">T_target</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">target_pos</span>

    <span class="n">solutions</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_attempts</span><span class="p">):</span>
        <span class="c1"># Random initial guess</span>
        <span class="n">joint_limits</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">robot</span><span class="o">.</span><span class="n">joint_limits</span><span class="p">)</span>
        <span class="n">theta_init</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">joint_limits</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">joint_limits</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>

        <span class="n">solution</span><span class="p">,</span> <span class="n">success</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">robot</span><span class="o">.</span><span class="n">iterative_inverse_kinematics</span><span class="p">(</span>
            <span class="n">T_desired</span><span class="o">=</span><span class="n">T_target</span><span class="p">,</span>
            <span class="n">thetalist0</span><span class="o">=</span><span class="n">theta_init</span><span class="p">,</span>
            <span class="n">max_iterations</span><span class="o">=</span><span class="mi">500</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
            <span class="c1"># Check if this is a new solution</span>
            <span class="n">is_new</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">for</span> <span class="n">existing_sol</span> <span class="ow">in</span> <span class="n">solutions</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">solution</span> <span class="o">-</span> <span class="n">existing_sol</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.1</span><span class="p">:</span>
                    <span class="n">is_new</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">break</span>

            <span class="k">if</span> <span class="n">is_new</span><span class="p">:</span>
                <span class="n">solutions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">solution</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Solution </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">solutions</span><span class="p">)</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">solution</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">solutions</span>

<span class="c1"># Test multiple solutions</span>
<span class="n">target</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
<span class="n">multiple_solutions</span> <span class="o">=</span> <span class="n">find_multiple_solutions</span><span class="p">(</span><span class="n">robot</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">multiple_solutions</span><span class="p">)</span><span class="si">}</span><span class="s2"> distinct solutions&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="jacobian-matrix">
<h2><a class="toc-backref" href="#id21" role="doc-backlink">Jacobian Matrix</a><a class="headerlink" href="#jacobian-matrix" title="Link to this heading"></a></h2>
<section id="computing-the-jacobian">
<h3><a class="toc-backref" href="#id22" role="doc-backlink">Computing the Jacobian</a><a class="headerlink" href="#computing-the-jacobian" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.3</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">])</span>

<span class="c1"># Compute Jacobian in space frame</span>
<span class="n">J_space</span> <span class="o">=</span> <span class="n">robot</span><span class="o">.</span><span class="n">jacobian</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="s2">&quot;space&quot;</span><span class="p">)</span>

<span class="c1"># Compute Jacobian in body frame</span>
<span class="n">J_body</span> <span class="o">=</span> <span class="n">robot</span><span class="o">.</span><span class="n">jacobian</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="s2">&quot;body&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Space Jacobian shape: </span><span class="si">{</span><span class="n">J_space</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># (6, n_joints)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Body Jacobian shape: </span><span class="si">{</span><span class="n">J_body</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>    <span class="c1"># (6, n_joints)</span>
</pre></div>
</div>
</section>
<section id="jacobian-analysis">
<h3><a class="toc-backref" href="#id23" role="doc-backlink">Jacobian Analysis</a><a class="headerlink" href="#jacobian-analysis" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">analyze_jacobian</span><span class="p">(</span><span class="n">robot</span><span class="p">,</span> <span class="n">theta</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Analyze Jacobian properties at a configuration.&quot;&quot;&quot;</span>

    <span class="n">J</span> <span class="o">=</span> <span class="n">robot</span><span class="o">.</span><span class="n">jacobian</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>

    <span class="c1"># Basic properties</span>
    <span class="n">rank</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">matrix_rank</span><span class="p">(</span><span class="n">J</span><span class="p">)</span>
    <span class="n">condition_number</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">cond</span><span class="p">(</span><span class="n">J</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Jacobian Analysis:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Shape: </span><span class="si">{</span><span class="n">J</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Rank: </span><span class="si">{</span><span class="n">rank</span><span class="si">}</span><span class="s2"> (full rank: </span><span class="si">{</span><span class="n">rank</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">min</span><span class="p">(</span><span class="n">J</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Condition number: </span><span class="si">{</span><span class="n">condition_number</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Singularity check</span>
    <span class="k">if</span> <span class="n">condition_number</span> <span class="o">&gt;</span> <span class="mf">1e6</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ⚠️  Configuration is near singular!&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ✅ Configuration is well-conditioned&quot;</span><span class="p">)</span>

    <span class="c1"># Manipulability (for square Jacobians)</span>
    <span class="k">if</span> <span class="n">J</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">J</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">manipulability</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">J</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Manipulability: </span><span class="si">{</span><span class="n">manipulability</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># For non-square Jacobians</span>
        <span class="n">manipulability</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">J</span> <span class="o">@</span> <span class="n">J</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Manipulability: </span><span class="si">{</span><span class="n">manipulability</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">J</span><span class="p">,</span> <span class="n">condition_number</span>

<span class="c1"># Analyze current configuration</span>
<span class="n">J</span><span class="p">,</span> <span class="n">cond_num</span> <span class="o">=</span> <span class="n">analyze_jacobian</span><span class="p">(</span><span class="n">robot</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="velocity-kinematics">
<h2><a class="toc-backref" href="#id24" role="doc-backlink">Velocity Kinematics</a><a class="headerlink" href="#velocity-kinematics" title="Link to this heading"></a></h2>
<section id="end-effector-velocity">
<h3><a class="toc-backref" href="#id25" role="doc-backlink">End-Effector Velocity</a><a class="headerlink" href="#end-effector-velocity" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Current configuration and joint velocities</span>
<span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">])</span>
<span class="n">theta_dot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">])</span>  <span class="c1"># rad/s</span>

<span class="c1"># Compute end-effector velocity</span>
<span class="n">V_ee</span> <span class="o">=</span> <span class="n">robot</span><span class="o">.</span><span class="n">end_effector_velocity</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">theta_dot</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="s2">&quot;space&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Joint velocities: </span><span class="si">{</span><span class="n">theta_dot</span><span class="si">}</span><span class="s2"> rad/s&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;End-effector velocity: </span><span class="si">{</span><span class="n">V_ee</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Decompose spatial velocity</span>
<span class="n">linear_velocity</span> <span class="o">=</span> <span class="n">V_ee</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>    <span class="c1"># [vx, vy, vz]</span>
<span class="n">angular_velocity</span> <span class="o">=</span> <span class="n">V_ee</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span>   <span class="c1"># [ωx, ωy, ωz]</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Linear velocity: </span><span class="si">{</span><span class="n">linear_velocity</span><span class="si">}</span><span class="s2"> m/s&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Angular velocity: </span><span class="si">{</span><span class="n">angular_velocity</span><span class="si">}</span><span class="s2"> rad/s&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="joint-velocities-from-desired-motion">
<h3><a class="toc-backref" href="#id26" role="doc-backlink">Joint Velocities from Desired Motion</a><a class="headerlink" href="#joint-velocities-from-desired-motion" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Desired end-effector motion</span>
<span class="n">V_desired</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">])</span>  <span class="c1"># Move +X, rotate +Z</span>

<span class="c1"># Compute required joint velocities</span>
<span class="n">theta_dot_required</span> <span class="o">=</span> <span class="n">robot</span><span class="o">.</span><span class="n">joint_velocity</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">V_desired</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="s2">&quot;space&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Desired EE velocity: </span><span class="si">{</span><span class="n">V_desired</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Required joint velocities: </span><span class="si">{</span><span class="n">theta_dot_required</span><span class="si">}</span><span class="s2"> rad/s&quot;</span><span class="p">)</span>

<span class="c1"># Verify by forward computation</span>
<span class="n">V_achieved</span> <span class="o">=</span> <span class="n">robot</span><span class="o">.</span><span class="n">end_effector_velocity</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">theta_dot_required</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="s2">&quot;space&quot;</span><span class="p">)</span>
<span class="n">error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">V_achieved</span> <span class="o">-</span> <span class="n">V_desired</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Velocity error: </span><span class="si">{</span><span class="n">error</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="state-management">
<h2><a class="toc-backref" href="#id27" role="doc-backlink">State Management</a><a class="headerlink" href="#state-management" title="Link to this heading"></a></h2>
<section id="robot-state-tracking">
<h3><a class="toc-backref" href="#id28" role="doc-backlink">Robot State Tracking</a><a class="headerlink" href="#robot-state-tracking" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Update robot state</span>
<span class="n">robot</span><span class="o">.</span><span class="n">update_state</span><span class="p">(</span>
    <span class="n">joint_positions</span><span class="o">=</span><span class="n">theta</span><span class="p">,</span>
    <span class="n">joint_velocities</span><span class="o">=</span><span class="n">theta_dot</span>
<span class="p">)</span>

<span class="c1"># Access current state</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Current positions: </span><span class="si">{</span><span class="n">robot</span><span class="o">.</span><span class="n">joint_positions</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Current velocities: </span><span class="si">{</span><span class="n">robot</span><span class="o">.</span><span class="n">joint_velocities</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Compute current end-effector state</span>
<span class="n">current_pose</span> <span class="o">=</span> <span class="n">robot</span><span class="o">.</span><span class="n">end_effector_pose</span><span class="p">(</span><span class="n">robot</span><span class="o">.</span><span class="n">joint_positions</span><span class="p">)</span>
<span class="n">current_velocity</span> <span class="o">=</span> <span class="n">robot</span><span class="o">.</span><span class="n">end_effector_velocity</span><span class="p">(</span>
    <span class="n">robot</span><span class="o">.</span><span class="n">joint_positions</span><span class="p">,</span>
    <span class="n">robot</span><span class="o">.</span><span class="n">joint_velocities</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Current EE pose: </span><span class="si">{</span><span class="n">current_pose</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Current EE velocity: </span><span class="si">{</span><span class="n">current_velocity</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="working-examples">
<h2><a class="toc-backref" href="#id29" role="doc-backlink">Working Examples</a><a class="headerlink" href="#working-examples" title="Link to this heading"></a></h2>
<section id="complete-workflow-example">
<h3><a class="toc-backref" href="#id30" role="doc-backlink">Complete Workflow Example</a><a class="headerlink" href="#complete-workflow-example" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">complete_kinematics_example</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Complete example showing all kinematic functions.&quot;&quot;&quot;</span>

    <span class="c1"># Create a simple 3-DOF robot</span>
    <span class="k">def</span> <span class="nf">create_3dof_robot</span><span class="p">():</span>
        <span class="n">L1</span><span class="p">,</span> <span class="n">L2</span><span class="p">,</span> <span class="n">L3</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.15</span>

        <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">L1</span> <span class="o">+</span> <span class="n">L2</span> <span class="o">+</span> <span class="n">L3</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="p">])</span>

        <span class="n">S_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">L1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">L1</span><span class="o">+</span><span class="n">L2</span><span class="p">),</span> <span class="mi">0</span><span class="p">]</span>
        <span class="p">])</span><span class="o">.</span><span class="n">T</span>

        <span class="n">omega_list</span> <span class="o">=</span> <span class="n">S_list</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">joint_limits</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)]</span> <span class="o">*</span> <span class="mi">3</span>

        <span class="k">return</span> <span class="n">SerialManipulator</span><span class="p">(</span>
            <span class="n">M_list</span><span class="o">=</span><span class="n">M</span><span class="p">,</span>
            <span class="n">omega_list</span><span class="o">=</span><span class="n">omega_list</span><span class="p">,</span>
            <span class="n">S_list</span><span class="o">=</span><span class="n">S_list</span><span class="p">,</span>
            <span class="n">joint_limits</span><span class="o">=</span><span class="n">joint_limits</span>
        <span class="p">)</span>

    <span class="n">robot</span> <span class="o">=</span> <span class="n">create_3dof_robot</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Complete Kinematics Example ===&quot;</span><span class="p">)</span>

    <span class="c1"># 1. Forward Kinematics</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">])</span>
    <span class="n">T</span> <span class="o">=</span> <span class="n">robot</span><span class="o">.</span><span class="n">forward_kinematics</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;1. Forward Kinematics:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Joint angles: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="si">}</span><span class="s2"> deg&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   End-effector position: </span><span class="si">{</span><span class="n">T</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># 2. Inverse Kinematics</span>
    <span class="n">T_target</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">T_target</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>

    <span class="n">solution</span><span class="p">,</span> <span class="n">success</span><span class="p">,</span> <span class="n">iterations</span> <span class="o">=</span> <span class="n">robot</span><span class="o">.</span><span class="n">iterative_inverse_kinematics</span><span class="p">(</span>
        <span class="n">T_desired</span><span class="o">=</span><span class="n">T_target</span><span class="p">,</span>
        <span class="n">thetalist0</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>
    <span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">2. Inverse Kinematics:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Target position: </span><span class="si">{</span><span class="n">T_target</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Success: </span><span class="si">{</span><span class="n">success</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Solution: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">solution</span><span class="p">)</span><span class="si">}</span><span class="s2"> deg&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Iterations: </span><span class="si">{</span><span class="n">iterations</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># 3. Jacobian Analysis</span>
    <span class="n">J</span> <span class="o">=</span> <span class="n">robot</span><span class="o">.</span><span class="n">jacobian</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">cond_num</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">cond</span><span class="p">(</span><span class="n">J</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">3. Jacobian Analysis:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Shape: </span><span class="si">{</span><span class="n">J</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Condition number: </span><span class="si">{</span><span class="n">cond_num</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># 4. Velocity Kinematics</span>
    <span class="n">theta_dot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">])</span>
    <span class="n">V_ee</span> <span class="o">=</span> <span class="n">robot</span><span class="o">.</span><span class="n">end_effector_velocity</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">theta_dot</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">4. Velocity Kinematics:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Joint velocities: </span><span class="si">{</span><span class="n">theta_dot</span><span class="si">}</span><span class="s2"> rad/s&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   EE linear velocity: </span><span class="si">{</span><span class="n">V_ee</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span><span class="si">}</span><span class="s2"> m/s&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   EE angular velocity: </span><span class="si">{</span><span class="n">V_ee</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span><span class="si">}</span><span class="s2"> rad/s&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">robot</span>

<span class="c1"># Run the complete example</span>
<span class="n">example_robot</span> <span class="o">=</span> <span class="n">complete_kinematics_example</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>
<section id="common-issues-and-solutions">
<h2><a class="toc-backref" href="#id31" role="doc-backlink">Common Issues and Solutions</a><a class="headerlink" href="#common-issues-and-solutions" title="Link to this heading"></a></h2>
<section id="troubleshooting-ik-convergence">
<h3><a class="toc-backref" href="#id32" role="doc-backlink">Troubleshooting IK Convergence</a><a class="headerlink" href="#troubleshooting-ik-convergence" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">troubleshoot_ik</span><span class="p">(</span><span class="n">robot</span><span class="p">,</span> <span class="n">T_target</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Helper function to troubleshoot IK issues.&quot;&quot;&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;🔍 IK Troubleshooting:&quot;</span><span class="p">)</span>

    <span class="c1"># Check if target is reasonable</span>
    <span class="n">target_pos</span> <span class="o">=</span> <span class="n">T_target</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="n">target_distance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">target_pos</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Target position: </span><span class="si">{</span><span class="n">target_pos</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Target distance from origin: </span><span class="si">{</span><span class="n">target_distance</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> m&quot;</span><span class="p">)</span>

    <span class="c1"># Try different initial guesses</span>
    <span class="n">joint_limits</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">robot</span><span class="o">.</span><span class="n">joint_limits</span><span class="p">)</span>

    <span class="n">attempts</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">joint_limits</span><span class="p">)),</span>                          <span class="c1"># Zero guess</span>
        <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">joint_limits</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>                       <span class="c1"># Middle of ranges</span>
        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">joint_limits</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">joint_limits</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>  <span class="c1"># Random</span>
    <span class="p">]</span>

    <span class="n">attempt_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Zero&quot;</span><span class="p">,</span> <span class="s2">&quot;Middle&quot;</span><span class="p">,</span> <span class="s2">&quot;Random&quot;</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">theta_init</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">attempts</span><span class="p">,</span> <span class="n">attempt_names</span><span class="p">)):</span>
        <span class="n">solution</span><span class="p">,</span> <span class="n">success</span><span class="p">,</span> <span class="n">iterations</span> <span class="o">=</span> <span class="n">robot</span><span class="o">.</span><span class="n">iterative_inverse_kinematics</span><span class="p">(</span>
            <span class="n">T_desired</span><span class="o">=</span><span class="n">T_target</span><span class="p">,</span>
            <span class="n">thetalist0</span><span class="o">=</span><span class="n">theta_init</span><span class="p">,</span>
            <span class="n">max_iterations</span><span class="o">=</span><span class="mi">500</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
            <span class="n">T_achieved</span> <span class="o">=</span> <span class="n">robot</span><span class="o">.</span><span class="n">forward_kinematics</span><span class="p">(</span><span class="n">solution</span><span class="p">)</span>
            <span class="n">error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">T_achieved</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">target_pos</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> init: ✅ Success (error: </span><span class="si">{</span><span class="n">error</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">, iter: </span><span class="si">{</span><span class="n">iterations</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">solution</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> init: ❌ Failed after </span><span class="si">{</span><span class="n">iterations</span><span class="si">}</span><span class="s2"> iterations&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  All attempts failed. Target may be unreachable.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">None</span>
</pre></div>
</div>
</section>
</section>
<section id="best-practices">
<h2><a class="toc-backref" href="#id33" role="doc-backlink">Best Practices</a><a class="headerlink" href="#best-practices" title="Link to this heading"></a></h2>
<ol class="arabic simple">
<li><p><strong>Robot Definition</strong>
- Use URDF files when possible for real robots
- Validate screw axes are unit vectors for revolute joints
- Set realistic joint limits</p></li>
<li><p><strong>Forward Kinematics</strong>
- Both space and body frames give identical results
- Choose the frame that makes your calculations easier</p></li>
<li><p><strong>Inverse Kinematics</strong>
- Provide good initial guesses (avoid singularities)
- Use damping for stability near singularities
- Try multiple initial guesses for difficult targets</p></li>
<li><p><strong>Jacobian Analysis</strong>
- Monitor condition number to detect singularities
- Use velocity kinematics for real-time control</p></li>
<li><p><strong>Performance</strong>
- Cache Jacobian computations when configuration doesn’t change
- Use appropriate tolerances (don’t over-specify)</p></li>
</ol>
</section>
<section id="next-steps">
<h2><a class="toc-backref" href="#id34" role="doc-backlink">Next Steps</a><a class="headerlink" href="#next-steps" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p><strong>Dynamics</strong>: Add forces and inertias → <a class="reference internal" href="Dynamics.html"><span class="doc">Dynamics User Guide</span></a></p></li>
<li><p><strong>Trajectory Planning</strong>: Plan smooth motions → <a class="reference internal" href="Trajectory_Planning.html"><span class="doc">Trajectory Planning User Guide</span></a></p></li>
<li><p><strong>Control</strong>: Implement feedback controllers → <a class="reference internal" href="Control.html"><span class="doc">Control Module User Guide</span></a></p></li>
<li><p><strong>Simulation</strong>: Test in PyBullet → <a class="reference internal" href="Simulation.html"><span class="doc">Simulation Module User Guide</span></a></p></li>
</ul>
<section id="api-reference">
<h3><a class="toc-backref" href="#id35" role="doc-backlink">API Reference</a><a class="headerlink" href="#api-reference" title="Link to this heading"></a></h3>
<p>For complete function documentation: <a class="reference internal" href="../api/kinematics.html"><span class="doc">Kinematics API Reference</span></a></p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="User Guide" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="Dynamics.html" class="btn btn-neutral float-right" title="Dynamics User Guide" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Mohamed Aboelnar.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>