

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="Control Module User Guide" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://manipulapy.readthedocs.io/user_guide/Control.html" />
<meta property="og:site_name" content="ManipulaPy Documentation" />
<meta property="og:description" content="The ManipulaPy Control Module provides comprehensive control algorithms for robotic manipulators with GPU acceleration using CuPy. This guide covers all available control methods, their parameters,..." />
<meta name="description" content="The ManipulaPy Control Module provides comprehensive control algorithms for robotic manipulators with GPU acceleration using CuPy. This guide covers all available control methods, their parameters,..." />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Control Module User Guide &mdash; ManipulaPy 1.1.0 Documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
      <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=b4417981" />
      <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
      <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=b4417981" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=fc837d61"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../_static/copybutton.js?v=fd10adb8"></script>
      <script>let toggleHintShow = 'Click to show';</script>
      <script>let toggleHintHide = 'Click to hide';</script>
      <script>let toggleOpenOnPrint = 'true';</script>
      <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
      <script src="../_static/design-tabs.js?v=f930bc37"></script>
      <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
      <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
      <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="URDF Processor User Guide" href="URDF_Processor.html" />
    <link rel="prev" title="Dynamics User Guide" href="Dynamics.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #2980B9" >

          
          
          <a href="../index.html" class="icon icon-home">
            ManipulaPy
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">üöÄ Get Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/index.html">Getting Started with ManipulaPy</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">üõ†Ô∏è API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">üîß API Reference Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">üìö User Guides</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">User Guide</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html#complete-guide-overview">üìö Complete Guide Overview</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="Kinematics.html">Kinematics User Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="Dynamics.html">Dynamics User Guide</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Control Module User Guide</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mathematical-foundation">Mathematical Foundation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#installation-and-setup">Installation and Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="#quick-start">Quick Start</a></li>
<li class="toctree-l4"><a class="reference internal" href="#controller-types">Controller Types</a></li>
<li class="toctree-l4"><a class="reference internal" href="#advanced-features">Advanced Features</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tuning-methods">Tuning Methods</a></li>
<li class="toctree-l4"><a class="reference internal" href="#plotting-and-analysis">Plotting and Analysis</a></li>
<li class="toctree-l4"><a class="reference internal" href="#cartesian-space-control">Cartesian Space Control</a></li>
<li class="toctree-l4"><a class="reference internal" href="#examples">Examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l4"><a class="reference internal" href="#api-reference">API Reference</a></li>
<li class="toctree-l4"><a class="reference internal" href="#additional-resources">Additional Resources</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="URDF_Processor.html">URDF Processor User Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="Trajectory_Planning.html">Trajectory Planning User Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="Simulation.html">Simulation Module User Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="Singularity_Analysis.html">Singularity Analysis User Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="Collision_Checker.html">Collision Checker Module User Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="Potential_Field.html">Potential Field Module User Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="Perception.html">Perception User Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="Singularity_Analysis.html">Singularity Analysis User Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="CUDA_Kernels.html">CUDA Kernels User Guide</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#learning-pathways">üó∫Ô∏è Learning Pathways</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#guide-categories">üìñ Guide Categories</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#quick-reference">üéØ Quick Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#study-tips">üí° Study Tips</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#need-help">üÜò Need Help?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Kinematics.html">Kinematics User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="Dynamics.html">Dynamics User Guide</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Control Module User Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#mathematical-foundation">Mathematical Foundation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#computed-torque-inverse-dynamics-control">Computed-Torque (Inverse Dynamics) Control</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pid-control">PID Control</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pd-feedforward-control">PD Feedforward Control</a></li>
<li class="toctree-l3"><a class="reference internal" href="#adaptive-control">Adaptive Control</a></li>
<li class="toctree-l3"><a class="reference internal" href="#robust-control">Robust Control</a></li>
<li class="toctree-l3"><a class="reference internal" href="#kalman-filter-state-estimation">Kalman-Filter State Estimation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#installation-and-setup">Installation and Setup</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="#basic-import">Basic Import</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#quick-start">Quick Start</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#initialize-controller">Initialize Controller</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#controller-types">Controller Types</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">PID Control</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pd-control">PD Control</a></li>
<li class="toctree-l3"><a class="reference internal" href="#computed-torque-control">Computed Torque Control</a></li>
<li class="toctree-l3"><a class="reference internal" href="#feedforward-control">Feedforward Control</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id2">PD + Feedforward Control</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id3">Robust Control</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id4">Adaptive Control</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#advanced-features">Advanced Features</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#joint-and-torque-limit-enforcement">Joint and Torque Limit Enforcement</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id5">Kalman Filter State Estimation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#tuning-methods">Tuning Methods</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#ziegler-nichols-tuning">Ziegler-Nichols Tuning</a></li>
<li class="toctree-l3"><a class="reference internal" href="#automatic-ultimate-gain-finding">Automatic Ultimate Gain Finding</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#plotting-and-analysis">Plotting and Analysis</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#steady-state-response-analysis">Steady-State Response Analysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="#performance-metrics">Performance Metrics</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#cartesian-space-control">Cartesian Space Control</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#joint-space-control">Joint Space Control</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id6">Cartesian Space Control</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#examples">Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#complete-control-loop-example">Complete Control Loop Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="#trajectory-tracking-example">Trajectory Tracking Example</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#troubleshooting">Troubleshooting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#common-issues-and-solutions">Common Issues and Solutions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#best-practices">Best Practices</a></li>
<li class="toctree-l3"><a class="reference internal" href="#error-handling">Error Handling</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#api-reference">API Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="#additional-resources">Additional Resources</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Trajectory_Planning.html">Trajectory Planning User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="Simulation.html">Simulation Module User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="URDF_Processor.html">URDF Processor User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="Singularity_Analysis.html">Singularity Analysis User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="Perception.html">Perception User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="vision.html">Vision User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="Potential_Field.html">Potential Field Module User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="Collision_Checker.html">Collision Checker Module User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="CUDA_Kernels.html">CUDA Kernels User Guide</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #2980B9" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">ManipulaPy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">User Guide</a></li>
      <li class="breadcrumb-item active">Control Module User Guide</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/user_guide/Control.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="control-module-user-guide">
<h1>Control Module User Guide<a class="headerlink" href="#control-module-user-guide" title="Link to this heading">ÔÉÅ</a></h1>
<p>The ManipulaPy Control Module provides comprehensive control algorithms for robotic manipulators with GPU acceleration using CuPy. This guide covers all available control methods, their parameters, and usage examples.</p>
<nav class="contents local" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#overview" id="id7">Overview</a></p></li>
<li><p><a class="reference internal" href="#mathematical-foundation" id="id8">Mathematical Foundation</a></p>
<ul>
<li><p><a class="reference internal" href="#computed-torque-inverse-dynamics-control" id="id9">Computed-Torque (Inverse Dynamics) Control</a></p></li>
<li><p><a class="reference internal" href="#pid-control" id="id10">PID Control</a></p></li>
<li><p><a class="reference internal" href="#pd-feedforward-control" id="id11">PD Feedforward Control</a></p></li>
<li><p><a class="reference internal" href="#adaptive-control" id="id12">Adaptive Control</a></p></li>
<li><p><a class="reference internal" href="#robust-control" id="id13">Robust Control</a></p></li>
<li><p><a class="reference internal" href="#kalman-filter-state-estimation" id="id14">Kalman-Filter State Estimation</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#installation-and-setup" id="id15">Installation and Setup</a></p>
<ul>
<li><p><a class="reference internal" href="#prerequisites" id="id16">Prerequisites</a></p></li>
<li><p><a class="reference internal" href="#basic-import" id="id17">Basic Import</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#quick-start" id="id18">Quick Start</a></p>
<ul>
<li><p><a class="reference internal" href="#initialize-controller" id="id19">Initialize Controller</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#controller-types" id="id20">Controller Types</a></p>
<ul>
<li><p><a class="reference internal" href="#id1" id="id21">PID Control</a></p></li>
<li><p><a class="reference internal" href="#pd-control" id="id22">PD Control</a></p></li>
<li><p><a class="reference internal" href="#computed-torque-control" id="id23">Computed Torque Control</a></p></li>
<li><p><a class="reference internal" href="#feedforward-control" id="id24">Feedforward Control</a></p></li>
<li><p><a class="reference internal" href="#id2" id="id25">PD + Feedforward Control</a></p></li>
<li><p><a class="reference internal" href="#id3" id="id26">Robust Control</a></p></li>
<li><p><a class="reference internal" href="#id4" id="id27">Adaptive Control</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#advanced-features" id="id28">Advanced Features</a></p>
<ul>
<li><p><a class="reference internal" href="#joint-and-torque-limit-enforcement" id="id29">Joint and Torque Limit Enforcement</a></p></li>
<li><p><a class="reference internal" href="#id5" id="id30">Kalman Filter State Estimation</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#tuning-methods" id="id31">Tuning Methods</a></p>
<ul>
<li><p><a class="reference internal" href="#ziegler-nichols-tuning" id="id32">Ziegler-Nichols Tuning</a></p></li>
<li><p><a class="reference internal" href="#automatic-ultimate-gain-finding" id="id33">Automatic Ultimate Gain Finding</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#plotting-and-analysis" id="id34">Plotting and Analysis</a></p>
<ul>
<li><p><a class="reference internal" href="#steady-state-response-analysis" id="id35">Steady-State Response Analysis</a></p></li>
<li><p><a class="reference internal" href="#performance-metrics" id="id36">Performance Metrics</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#cartesian-space-control" id="id37">Cartesian Space Control</a></p>
<ul>
<li><p><a class="reference internal" href="#joint-space-control" id="id38">Joint Space Control</a></p></li>
<li><p><a class="reference internal" href="#id6" id="id39">Cartesian Space Control</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#examples" id="id40">Examples</a></p>
<ul>
<li><p><a class="reference internal" href="#complete-control-loop-example" id="id41">Complete Control Loop Example</a></p></li>
<li><p><a class="reference internal" href="#trajectory-tracking-example" id="id42">Trajectory Tracking Example</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#troubleshooting" id="id43">Troubleshooting</a></p>
<ul>
<li><p><a class="reference internal" href="#common-issues-and-solutions" id="id44">Common Issues and Solutions</a></p></li>
<li><p><a class="reference internal" href="#best-practices" id="id45">Best Practices</a></p></li>
<li><p><a class="reference internal" href="#error-handling" id="id46">Error Handling</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#api-reference" id="id47">API Reference</a></p></li>
<li><p><a class="reference internal" href="#additional-resources" id="id48">Additional Resources</a></p></li>
</ul>
</nav>
<section id="overview">
<h2><a class="toc-backref" href="#id7" role="doc-backlink">Overview</a><a class="headerlink" href="#overview" title="Link to this heading">ÔÉÅ</a></h2>
<p>The control module implements various control strategies:</p>
<ul class="simple">
<li><p><strong>PID Control</strong>: Classic feedback control</p></li>
<li><p><strong>Computed Torque Control</strong>: Model-based linearizing control</p></li>
<li><p><strong>Adaptive Control</strong>: Online parameter adaptation</p></li>
<li><p><strong>Robust Control</strong>: Disturbance rejection</p></li>
<li><p><strong>Feedforward Control</strong>: Open-loop compensation</p></li>
<li><p><strong>Kalman Filter</strong>: State estimation and control</p></li>
</ul>
<p>All algorithms are GPU-accelerated and designed for real-time performance.</p>
</section>
<section id="mathematical-foundation">
<h2><a class="toc-backref" href="#id8" role="doc-backlink">Mathematical Foundation</a><a class="headerlink" href="#mathematical-foundation" title="Link to this heading">ÔÉÅ</a></h2>
<p>This section summarizes the key control-law equations implemented in the <code class="docutils literal notranslate"><span class="pre">ManipulatorController</span></code> class.</p>
<section id="computed-torque-inverse-dynamics-control">
<h3><a class="toc-backref" href="#id9" role="doc-backlink">Computed-Torque (Inverse Dynamics) Control</a><a class="headerlink" href="#computed-torque-inverse-dynamics-control" title="Link to this heading">ÔÉÅ</a></h3>
<p>Compute the required joint-torques to achieve a desired trajectory while compensating for the robot‚Äôs nonlinear dynamics:</p>
<div class="math notranslate nohighlight">
\[\begin{split}e &amp;= q_d - q, \quad \dot{e} = \dot{q}_d - \dot{q}, \quad \int e\,dt = \sum e\,dt \\
\tau_{ff} &amp;= M(q)\,\bigl(\ddot{q}_d + K_d\,\dot{e} + K_p\,e + K_i\,\!\!\int e\,dt\bigr) + C(q,\dot{q})\,\dot{q} + G(q)\end{split}\]</div>
<p>Where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(q,\dot{q},\ddot{q}\)</span> ‚Äì actual joint angles, velocities, accelerations</p></li>
<li><p><span class="math notranslate nohighlight">\(q_d,\dot{q}_d,\ddot{q}_d\)</span> ‚Äì desired joint trajectory</p></li>
<li><p><span class="math notranslate nohighlight">\(M(q)\)</span> ‚Äì mass-inertia matrix</p></li>
<li><p><span class="math notranslate nohighlight">\(C(q,\dot{q})\)</span> ‚Äì Coriolis/centrifugal matrix</p></li>
<li><p><span class="math notranslate nohighlight">\(G(q)\)</span> ‚Äì gravity vector</p></li>
<li><p><span class="math notranslate nohighlight">\(K_p,K_i,K_d\)</span> ‚Äì proportional, integral, derivative gains</p></li>
</ul>
</section>
<section id="pid-control">
<h3><a class="toc-backref" href="#id10" role="doc-backlink">PID Control</a><a class="headerlink" href="#pid-control" title="Link to this heading">ÔÉÅ</a></h3>
<p>A simpler joint-space PID law (no dynamics compensation):</p>
<div class="math notranslate nohighlight">
\[\tau_{PID} = K_p\,e + K_i\,\int e\,dt + K_d\,\dot{e}\]</div>
</section>
<section id="pd-feedforward-control">
<h3><a class="toc-backref" href="#id11" role="doc-backlink">PD Feedforward Control</a><a class="headerlink" href="#pd-feedforward-control" title="Link to this heading">ÔÉÅ</a></h3>
<p>Combine a PD feedback term with pure feedforward dynamics:</p>
<div class="math notranslate nohighlight">
\[\tau = K_p\,e + K_d\,\dot{e} + \underbrace{M(q)\,\ddot{q}_d + C(q,\dot{q})\,\dot{q}_d + G(q)}_{\text{feedforward torque}}\]</div>
</section>
<section id="adaptive-control">
<h3><a class="toc-backref" href="#id12" role="doc-backlink">Adaptive Control</a><a class="headerlink" href="#adaptive-control" title="Link to this heading">ÔÉÅ</a></h3>
<p>Adjusts internal dynamic parameters online to compensate for modelling errors:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\hat{\theta}_{k+1} &amp;= \hat{\theta}_k + \gamma \,e \\
\tau &amp;= M(q)\,\ddot{q}_d + C(q,\dot{q})\,\dot{q}_d + G(q) + Y(q,\dot{q},\ddot{q})\,\hat{\theta}\end{split}\]</div>
<p>Where <span class="math notranslate nohighlight">\(\hat{\theta}\)</span> is the estimated parameter vector and <span class="math notranslate nohighlight">\(\gamma\)</span> the adaptation gain.</p>
</section>
<section id="robust-control">
<h3><a class="toc-backref" href="#id13" role="doc-backlink">Robust Control</a><a class="headerlink" href="#robust-control" title="Link to this heading">ÔÉÅ</a></h3>
<p>Adds a disturbance-rejection term to a computed-torque core:</p>
<div class="math notranslate nohighlight">
\[\tau = M(q)\,\ddot{q} + C(q,\dot{q})\,\dot{q} + G(q) + J(q)^T\,F_{ext} + \alpha\,\hat{d}\]</div>
<p>With <span class="math notranslate nohighlight">\(\hat{d}\)</span> the estimated disturbance and <span class="math notranslate nohighlight">\(\alpha\)</span> its gain.</p>
</section>
<section id="kalman-filter-state-estimation">
<h3><a class="toc-backref" href="#id14" role="doc-backlink">Kalman-Filter State Estimation</a><a class="headerlink" href="#kalman-filter-state-estimation" title="Link to this heading">ÔÉÅ</a></h3>
<p>Predict-update loop for joint state <span class="math notranslate nohighlight">\(x = [q;\dot{q}]\)</span>:</p>
<ol class="arabic">
<li><p><strong>Prediction</strong></p>
<div class="math notranslate nohighlight">
\[\hat{x}^- = F\,\hat{x} + B\,u, \quad P^- = F\,P\,F^T + Q\]</div>
</li>
<li><p><strong>Update</strong></p>
<div class="math notranslate nohighlight">
\[\begin{split}K &amp;= P^-\,H^T(H\,P^-\,H^T + R)^{-1} \\
\hat{x} &amp;= \hat{x}^- + K(y - H\,\hat{x}^-), \quad P = (I - K\,H)P^-\end{split}\]</div>
</li>
</ol>
<p>Where <span class="math notranslate nohighlight">\(Q,R\)</span> are process/measurement covariances.</p>
<p>These formulas correspond exactly to the methods in <code class="xref py py-class docutils literal notranslate"><span class="pre">ManipulatorController</span></code>.</p>
</section>
</section>
<section id="installation-and-setup">
<h2><a class="toc-backref" href="#id15" role="doc-backlink">Installation and Setup</a><a class="headerlink" href="#installation-and-setup" title="Link to this heading">ÔÉÅ</a></h2>
<section id="prerequisites">
<h3><a class="toc-backref" href="#id16" role="doc-backlink">Prerequisites</a><a class="headerlink" href="#prerequisites" title="Link to this heading">ÔÉÅ</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>cupy-cuda11x<span class="w">  </span><span class="c1"># or cupy-cuda12x for CUDA 12</span>
pip<span class="w"> </span>install<span class="w"> </span>numpy<span class="w"> </span>matplotlib
</pre></div>
</div>
</section>
<section id="basic-import">
<h3><a class="toc-backref" href="#id17" role="doc-backlink">Basic Import</a><a class="headerlink" href="#basic-import" title="Link to this heading">ÔÉÅ</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">cupy</span> <span class="k">as</span> <span class="nn">cp</span>
<span class="kn">from</span> <span class="nn">ManipulaPy.control</span> <span class="kn">import</span> <span class="n">ManipulatorController</span>
<span class="kn">from</span> <span class="nn">ManipulaPy.dynamics</span> <span class="kn">import</span> <span class="n">ManipulatorDynamics</span>
</pre></div>
</div>
</section>
</section>
<section id="quick-start">
<h2><a class="toc-backref" href="#id18" role="doc-backlink">Quick Start</a><a class="headerlink" href="#quick-start" title="Link to this heading">ÔÉÅ</a></h2>
<section id="initialize-controller">
<h3><a class="toc-backref" href="#id19" role="doc-backlink">Initialize Controller</a><a class="headerlink" href="#initialize-controller" title="Link to this heading">ÔÉÅ</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Assuming you have a dynamics object</span>
<span class="n">controller</span> <span class="o">=</span> <span class="n">ManipulatorController</span><span class="p">(</span><span class="n">dynamics</span><span class="p">)</span>

<span class="c1"># Basic PID control example</span>
<span class="n">Kp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>  <span class="c1"># Proportional gains</span>
<span class="n">Ki</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">])</span>   <span class="c1"># Integral gains</span>
<span class="n">Kd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">])</span>   <span class="c1"># Derivative gains</span>

<span class="c1"># Desired and current states</span>
<span class="n">thetalistd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>  <span class="c1"># Desired angles</span>
<span class="n">thetalist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>    <span class="c1"># Current angles</span>
<span class="n">dthetalistd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>  <span class="c1"># Desired velocities</span>
<span class="n">dthetalist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>   <span class="c1"># Current velocities</span>

<span class="c1"># Control signal</span>
<span class="n">tau</span> <span class="o">=</span> <span class="n">controller</span><span class="o">.</span><span class="n">pid_control</span><span class="p">(</span>
    <span class="n">thetalistd</span><span class="p">,</span> <span class="n">dthetalistd</span><span class="p">,</span> <span class="n">thetalist</span><span class="p">,</span> <span class="n">dthetalist</span><span class="p">,</span>
    <span class="n">dt</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">Kp</span><span class="o">=</span><span class="n">Kp</span><span class="p">,</span> <span class="n">Ki</span><span class="o">=</span><span class="n">Ki</span><span class="p">,</span> <span class="n">Kd</span><span class="o">=</span><span class="n">Kd</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="controller-types">
<h2><a class="toc-backref" href="#id20" role="doc-backlink">Controller Types</a><a class="headerlink" href="#controller-types" title="Link to this heading">ÔÉÅ</a></h2>
<section id="id1">
<h3><a class="toc-backref" href="#id21" role="doc-backlink">PID Control</a><a class="headerlink" href="#id1" title="Link to this heading">ÔÉÅ</a></h3>
<p><strong>Description</strong>: Classic Proportional-Integral-Derivative control for joint space regulation.</p>
<p><strong>Example</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define gains for 6-DOF manipulator</span>
<span class="n">Kp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">15.0</span><span class="p">,</span> <span class="mf">12.0</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">])</span>
<span class="n">Ki</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">])</span>
<span class="n">Kd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">])</span>

<span class="n">tau</span> <span class="o">=</span> <span class="n">controller</span><span class="o">.</span><span class="n">pid_control</span><span class="p">(</span>
    <span class="n">thetalistd</span><span class="o">=</span><span class="n">desired_angles</span><span class="p">,</span>
    <span class="n">dthetalistd</span><span class="o">=</span><span class="n">desired_velocities</span><span class="p">,</span>
    <span class="n">thetalist</span><span class="o">=</span><span class="n">current_angles</span><span class="p">,</span>
    <span class="n">dthetalist</span><span class="o">=</span><span class="n">current_velocities</span><span class="p">,</span>
    <span class="n">dt</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
    <span class="n">Kp</span><span class="o">=</span><span class="n">Kp</span><span class="p">,</span> <span class="n">Ki</span><span class="o">=</span><span class="n">Ki</span><span class="p">,</span> <span class="n">Kd</span><span class="o">=</span><span class="n">Kd</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="pd-control">
<h3><a class="toc-backref" href="#id22" role="doc-backlink">PD Control</a><a class="headerlink" href="#pd-control" title="Link to this heading">ÔÉÅ</a></h3>
<p><strong>Description</strong>: Proportional-Derivative control without integral term.</p>
<p><strong>Example</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Kp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">20.0</span><span class="p">,</span> <span class="mf">15.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">])</span>
<span class="n">Kd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>

<span class="n">tau</span> <span class="o">=</span> <span class="n">controller</span><span class="o">.</span><span class="n">pd_control</span><span class="p">(</span>
    <span class="n">desired_position</span><span class="o">=</span><span class="n">desired_angles</span><span class="p">,</span>
    <span class="n">desired_velocity</span><span class="o">=</span><span class="n">desired_velocities</span><span class="p">,</span>
    <span class="n">current_position</span><span class="o">=</span><span class="n">current_angles</span><span class="p">,</span>
    <span class="n">current_velocity</span><span class="o">=</span><span class="n">current_velocities</span><span class="p">,</span>
    <span class="n">Kp</span><span class="o">=</span><span class="n">Kp</span><span class="p">,</span> <span class="n">Kd</span><span class="o">=</span><span class="n">Kd</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="computed-torque-control">
<h3><a class="toc-backref" href="#id23" role="doc-backlink">Computed Torque Control</a><a class="headerlink" href="#computed-torque-control" title="Link to this heading">ÔÉÅ</a></h3>
<p><strong>Description</strong>: Model-based control that linearizes the nonlinear robot dynamics.</p>
<p><strong>Example</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Higher gains can be used due to linearization</span>
<span class="n">Kp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">50.0</span><span class="p">,</span> <span class="mf">40.0</span><span class="p">,</span> <span class="mf">30.0</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">,</span> <span class="mf">15.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">])</span>
<span class="n">Ki</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">])</span>
<span class="n">Kd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">8.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>

<span class="n">gravity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.81</span><span class="p">])</span>

<span class="n">tau</span> <span class="o">=</span> <span class="n">controller</span><span class="o">.</span><span class="n">computed_torque_control</span><span class="p">(</span>
    <span class="n">thetalistd</span><span class="o">=</span><span class="n">desired_angles</span><span class="p">,</span>
    <span class="n">dthetalistd</span><span class="o">=</span><span class="n">desired_velocities</span><span class="p">,</span>
    <span class="n">ddthetalistd</span><span class="o">=</span><span class="n">desired_accelerations</span><span class="p">,</span>
    <span class="n">thetalist</span><span class="o">=</span><span class="n">current_angles</span><span class="p">,</span>
    <span class="n">dthetalist</span><span class="o">=</span><span class="n">current_velocities</span><span class="p">,</span>
    <span class="n">g</span><span class="o">=</span><span class="n">gravity</span><span class="p">,</span>
    <span class="n">dt</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
    <span class="n">Kp</span><span class="o">=</span><span class="n">Kp</span><span class="p">,</span> <span class="n">Ki</span><span class="o">=</span><span class="n">Ki</span><span class="p">,</span> <span class="n">Kd</span><span class="o">=</span><span class="n">Kd</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="feedforward-control">
<h3><a class="toc-backref" href="#id24" role="doc-backlink">Feedforward Control</a><a class="headerlink" href="#feedforward-control" title="Link to this heading">ÔÉÅ</a></h3>
<p><strong>Description</strong>: Open-loop control based on desired trajectory dynamics.</p>
<p><strong>Example</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">gravity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.81</span><span class="p">])</span>
<span class="n">external_forces</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>  <span class="c1"># No external forces</span>

<span class="n">tau_ff</span> <span class="o">=</span> <span class="n">controller</span><span class="o">.</span><span class="n">feedforward_control</span><span class="p">(</span>
    <span class="n">desired_position</span><span class="o">=</span><span class="n">trajectory_positions</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
    <span class="n">desired_velocity</span><span class="o">=</span><span class="n">trajectory_velocities</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
    <span class="n">desired_acceleration</span><span class="o">=</span><span class="n">trajectory_accelerations</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
    <span class="n">g</span><span class="o">=</span><span class="n">gravity</span><span class="p">,</span>
    <span class="n">Ftip</span><span class="o">=</span><span class="n">external_forces</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id2">
<h3><a class="toc-backref" href="#id25" role="doc-backlink">PD + Feedforward Control</a><a class="headerlink" href="#id2" title="Link to this heading">ÔÉÅ</a></h3>
<p><strong>Description</strong>: Combines feedback PD control with feedforward compensation.</p>
<p><strong>Example</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">tau</span> <span class="o">=</span> <span class="n">controller</span><span class="o">.</span><span class="n">pd_feedforward_control</span><span class="p">(</span>
    <span class="n">desired_position</span><span class="o">=</span><span class="n">trajectory_positions</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
    <span class="n">desired_velocity</span><span class="o">=</span><span class="n">trajectory_velocities</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
    <span class="n">desired_acceleration</span><span class="o">=</span><span class="n">trajectory_accelerations</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
    <span class="n">current_position</span><span class="o">=</span><span class="n">current_angles</span><span class="p">,</span>
    <span class="n">current_velocity</span><span class="o">=</span><span class="n">current_velocities</span><span class="p">,</span>
    <span class="n">Kp</span><span class="o">=</span><span class="n">Kp</span><span class="p">,</span> <span class="n">Kd</span><span class="o">=</span><span class="n">Kd</span><span class="p">,</span>
    <span class="n">g</span><span class="o">=</span><span class="n">gravity</span><span class="p">,</span>
    <span class="n">Ftip</span><span class="o">=</span><span class="n">external_forces</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id3">
<h3><a class="toc-backref" href="#id26" role="doc-backlink">Robust Control</a><a class="headerlink" href="#id3" title="Link to this heading">ÔÉÅ</a></h3>
<p><strong>Description</strong>: Control with disturbance rejection capabilities.</p>
<p><strong>Example</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">disturbance_estimate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01</span><span class="p">])</span>
<span class="n">adaptation_gain</span> <span class="o">=</span> <span class="mf">0.5</span>

<span class="n">tau</span> <span class="o">=</span> <span class="n">controller</span><span class="o">.</span><span class="n">robust_control</span><span class="p">(</span>
    <span class="n">thetalist</span><span class="o">=</span><span class="n">current_angles</span><span class="p">,</span>
    <span class="n">dthetalist</span><span class="o">=</span><span class="n">current_velocities</span><span class="p">,</span>
    <span class="n">ddthetalist</span><span class="o">=</span><span class="n">desired_accelerations</span><span class="p">,</span>
    <span class="n">g</span><span class="o">=</span><span class="n">gravity</span><span class="p">,</span>
    <span class="n">Ftip</span><span class="o">=</span><span class="n">external_forces</span><span class="p">,</span>
    <span class="n">disturbance_estimate</span><span class="o">=</span><span class="n">disturbance_estimate</span><span class="p">,</span>
    <span class="n">adaptation_gain</span><span class="o">=</span><span class="n">adaptation_gain</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id4">
<h3><a class="toc-backref" href="#id27" role="doc-backlink">Adaptive Control</a><a class="headerlink" href="#id4" title="Link to this heading">ÔÉÅ</a></h3>
<p><strong>Description</strong>: Control with online parameter adaptation.</p>
<p><strong>Example</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">measurement_error</span> <span class="o">=</span> <span class="n">current_angles</span> <span class="o">-</span> <span class="n">estimated_angles</span>
<span class="n">adaptation_gain</span> <span class="o">=</span> <span class="mf">0.1</span>

<span class="n">tau</span> <span class="o">=</span> <span class="n">controller</span><span class="o">.</span><span class="n">adaptive_control</span><span class="p">(</span>
    <span class="n">thetalist</span><span class="o">=</span><span class="n">current_angles</span><span class="p">,</span>
    <span class="n">dthetalist</span><span class="o">=</span><span class="n">current_velocities</span><span class="p">,</span>
    <span class="n">ddthetalist</span><span class="o">=</span><span class="n">desired_accelerations</span><span class="p">,</span>
    <span class="n">g</span><span class="o">=</span><span class="n">gravity</span><span class="p">,</span>
    <span class="n">Ftip</span><span class="o">=</span><span class="n">external_forces</span><span class="p">,</span>
    <span class="n">measurement_error</span><span class="o">=</span><span class="n">measurement_error</span><span class="p">,</span>
    <span class="n">adaptation_gain</span><span class="o">=</span><span class="n">adaptation_gain</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="advanced-features">
<h2><a class="toc-backref" href="#id28" role="doc-backlink">Advanced Features</a><a class="headerlink" href="#advanced-features" title="Link to this heading">ÔÉÅ</a></h2>
<section id="joint-and-torque-limit-enforcement">
<h3><a class="toc-backref" href="#id29" role="doc-backlink">Joint and Torque Limit Enforcement</a><a class="headerlink" href="#joint-and-torque-limit-enforcement" title="Link to this heading">ÔÉÅ</a></h3>
<p><strong>Example</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define limits</span>
<span class="n">joint_limits</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
    <span class="p">[</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">],</span>     <span class="c1"># Joint 1</span>
    <span class="p">[</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span> <span class="c1"># Joint 2</span>
    <span class="p">[</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">],</span>     <span class="c1"># Joint 3</span>
    <span class="p">[</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">],</span>     <span class="c1"># Joint 4</span>
    <span class="p">[</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span> <span class="c1"># Joint 5</span>
    <span class="p">[</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">]</span>      <span class="c1"># Joint 6</span>
<span class="p">])</span>

<span class="n">torque_limits</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
    <span class="p">[</span><span class="o">-</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">],</span>  <span class="c1"># Joint 1 torque limits (Nm)</span>
    <span class="p">[</span><span class="o">-</span><span class="mi">40</span><span class="p">,</span> <span class="mi">40</span><span class="p">],</span>  <span class="c1"># Joint 2</span>
    <span class="p">[</span><span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="mi">30</span><span class="p">],</span>  <span class="c1"># Joint 3</span>
    <span class="p">[</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">],</span>  <span class="c1"># Joint 4</span>
    <span class="p">[</span><span class="o">-</span><span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">],</span>  <span class="c1"># Joint 5</span>
    <span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>   <span class="c1"># Joint 6</span>
<span class="p">])</span>

<span class="c1"># Apply limits</span>
<span class="n">safe_angles</span><span class="p">,</span> <span class="n">safe_velocities</span><span class="p">,</span> <span class="n">safe_torques</span> <span class="o">=</span> <span class="n">controller</span><span class="o">.</span><span class="n">enforce_limits</span><span class="p">(</span>
    <span class="n">thetalist</span><span class="o">=</span><span class="n">current_angles</span><span class="p">,</span>
    <span class="n">dthetalist</span><span class="o">=</span><span class="n">current_velocities</span><span class="p">,</span>
    <span class="n">tau</span><span class="o">=</span><span class="n">computed_torques</span><span class="p">,</span>
    <span class="n">joint_limits</span><span class="o">=</span><span class="n">joint_limits</span><span class="p">,</span>
    <span class="n">torque_limits</span><span class="o">=</span><span class="n">torque_limits</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id5">
<h3><a class="toc-backref" href="#id30" role="doc-backlink">Kalman Filter State Estimation</a><a class="headerlink" href="#id5" title="Link to this heading">ÔÉÅ</a></h3>
<p><strong>Example</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define noise covariances</span>
<span class="n">Q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.01</span>  <span class="c1"># Process noise (12x12 for 6 positions + 6 velocities)</span>
<span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.1</span>   <span class="c1"># Measurement noise</span>

<span class="c1"># Use Kalman filter for state estimation</span>
<span class="n">estimated_angles</span><span class="p">,</span> <span class="n">estimated_velocities</span> <span class="o">=</span> <span class="n">controller</span><span class="o">.</span><span class="n">kalman_filter_control</span><span class="p">(</span>
    <span class="n">thetalistd</span><span class="o">=</span><span class="n">desired_angles</span><span class="p">,</span>
    <span class="n">dthetalistd</span><span class="o">=</span><span class="n">desired_velocities</span><span class="p">,</span>
    <span class="n">thetalist</span><span class="o">=</span><span class="n">measured_angles</span><span class="p">,</span>
    <span class="n">dthetalist</span><span class="o">=</span><span class="n">measured_velocities</span><span class="p">,</span>
    <span class="n">taulist</span><span class="o">=</span><span class="n">applied_torques</span><span class="p">,</span>
    <span class="n">g</span><span class="o">=</span><span class="n">gravity</span><span class="p">,</span>
    <span class="n">Ftip</span><span class="o">=</span><span class="n">external_forces</span><span class="p">,</span>
    <span class="n">dt</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
    <span class="n">Q</span><span class="o">=</span><span class="n">Q</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="n">R</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="tuning-methods">
<h2><a class="toc-backref" href="#id31" role="doc-backlink">Tuning Methods</a><a class="headerlink" href="#tuning-methods" title="Link to this heading">ÔÉÅ</a></h2>
<section id="ziegler-nichols-tuning">
<h3><a class="toc-backref" href="#id32" role="doc-backlink">Ziegler-Nichols Tuning</a><a class="headerlink" href="#ziegler-nichols-tuning" title="Link to this heading">ÔÉÅ</a></h3>
<p><strong>Example</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Find ultimate gain and period first</span>
<span class="n">ultimate_gain</span><span class="p">,</span> <span class="n">ultimate_period</span><span class="p">,</span> <span class="n">gain_history</span><span class="p">,</span> <span class="n">error_history</span> <span class="o">=</span> <span class="n">controller</span><span class="o">.</span><span class="n">find_ultimate_gain_and_period</span><span class="p">(</span>
    <span class="n">thetalist</span><span class="o">=</span><span class="n">initial_angles</span><span class="p">,</span>
    <span class="n">desired_joint_angles</span><span class="o">=</span><span class="n">target_angles</span><span class="p">,</span>
    <span class="n">dt</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
    <span class="n">max_steps</span><span class="o">=</span><span class="mi">1000</span>
<span class="p">)</span>

<span class="c1"># Tune controller gains</span>
<span class="n">Kp</span><span class="p">,</span> <span class="n">Ki</span><span class="p">,</span> <span class="n">Kd</span> <span class="o">=</span> <span class="n">controller</span><span class="o">.</span><span class="n">ziegler_nichols_tuning</span><span class="p">(</span>
    <span class="n">Ku</span><span class="o">=</span><span class="n">ultimate_gain</span><span class="p">,</span>
    <span class="n">Tu</span><span class="o">=</span><span class="n">ultimate_period</span><span class="p">,</span>
    <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;PID&quot;</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tuned gains - Kp: </span><span class="si">{</span><span class="n">Kp</span><span class="si">}</span><span class="s2">, Ki: </span><span class="si">{</span><span class="n">Ki</span><span class="si">}</span><span class="s2">, Kd: </span><span class="si">{</span><span class="n">Kd</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="automatic-ultimate-gain-finding">
<h3><a class="toc-backref" href="#id33" role="doc-backlink">Automatic Ultimate Gain Finding</a><a class="headerlink" href="#automatic-ultimate-gain-finding" title="Link to this heading">ÔÉÅ</a></h3>
<p><strong>Example</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Automatically find critical parameters</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">controller</span><span class="o">.</span><span class="n">find_ultimate_gain_and_period</span><span class="p">(</span>
    <span class="n">thetalist</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span>
    <span class="n">desired_joint_angles</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]),</span>
    <span class="n">dt</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
    <span class="n">max_steps</span><span class="o">=</span><span class="mi">500</span>
<span class="p">)</span>

<span class="n">ultimate_gain</span><span class="p">,</span> <span class="n">ultimate_period</span><span class="p">,</span> <span class="n">gain_history</span><span class="p">,</span> <span class="n">error_history</span> <span class="o">=</span> <span class="n">results</span>

<span class="c1"># Use results for tuning</span>
<span class="n">Kp</span><span class="p">,</span> <span class="n">Ki</span><span class="p">,</span> <span class="n">Kd</span> <span class="o">=</span> <span class="n">controller</span><span class="o">.</span><span class="n">tune_controller</span><span class="p">(</span><span class="n">ultimate_gain</span><span class="p">,</span> <span class="n">ultimate_period</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;PID&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="plotting-and-analysis">
<h2><a class="toc-backref" href="#id34" role="doc-backlink">Plotting and Analysis</a><a class="headerlink" href="#plotting-and-analysis" title="Link to this heading">ÔÉÅ</a></h2>
<section id="steady-state-response-analysis">
<h3><a class="toc-backref" href="#id35" role="doc-backlink">Steady-State Response Analysis</a><a class="headerlink" href="#steady-state-response-analysis" title="Link to this heading">ÔÉÅ</a></h3>
<p><strong>Example</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Simulate control response</span>
<span class="n">time_steps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
<span class="n">response_data</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Your simulation data</span>
<span class="n">set_point</span> <span class="o">=</span> <span class="mf">0.5</span>

<span class="n">controller</span><span class="o">.</span><span class="n">plot_steady_state_response</span><span class="p">(</span>
    <span class="n">time</span><span class="o">=</span><span class="n">time_steps</span><span class="p">,</span>
    <span class="n">response</span><span class="o">=</span><span class="n">response_data</span><span class="p">,</span>
    <span class="n">set_point</span><span class="o">=</span><span class="n">set_point</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Joint 1 Step Response&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="performance-metrics">
<h3><a class="toc-backref" href="#id36" role="doc-backlink">Performance Metrics</a><a class="headerlink" href="#performance-metrics" title="Link to this heading">ÔÉÅ</a></h3>
<p>Calculate control performance metrics:</p>
<p><strong>Example</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate individual metrics</span>
<span class="n">rise_time</span> <span class="o">=</span> <span class="n">controller</span><span class="o">.</span><span class="n">calculate_rise_time</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">set_point</span><span class="p">)</span>
<span class="n">overshoot</span> <span class="o">=</span> <span class="n">controller</span><span class="o">.</span><span class="n">calculate_percent_overshoot</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">set_point</span><span class="p">)</span>
<span class="n">settling_time</span> <span class="o">=</span> <span class="n">controller</span><span class="o">.</span><span class="n">calculate_settling_time</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">set_point</span><span class="p">)</span>
<span class="n">steady_error</span> <span class="o">=</span> <span class="n">controller</span><span class="o">.</span><span class="n">calculate_steady_state_error</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">set_point</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Rise Time: </span><span class="si">{</span><span class="n">rise_time</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Overshoot: </span><span class="si">{</span><span class="n">overshoot</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Settling Time: </span><span class="si">{</span><span class="n">settling_time</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Steady-State Error: </span><span class="si">{</span><span class="n">steady_error</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="cartesian-space-control">
<h2><a class="toc-backref" href="#id37" role="doc-backlink">Cartesian Space Control</a><a class="headerlink" href="#cartesian-space-control" title="Link to this heading">ÔÉÅ</a></h2>
<section id="joint-space-control">
<h3><a class="toc-backref" href="#id38" role="doc-backlink">Joint Space Control</a><a class="headerlink" href="#joint-space-control" title="Link to this heading">ÔÉÅ</a></h3>
</section>
<section id="id6">
<h3><a class="toc-backref" href="#id39" role="doc-backlink">Cartesian Space Control</a><a class="headerlink" href="#id6" title="Link to this heading">ÔÉÅ</a></h3>
</section>
</section>
<section id="examples">
<h2><a class="toc-backref" href="#id40" role="doc-backlink">Examples</a><a class="headerlink" href="#examples" title="Link to this heading">ÔÉÅ</a></h2>
<section id="complete-control-loop-example">
<h3><a class="toc-backref" href="#id41" role="doc-backlink">Complete Control Loop Example</a><a class="headerlink" href="#complete-control-loop-example" title="Link to this heading">ÔÉÅ</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">cupy</span> <span class="k">as</span> <span class="nn">cp</span>
<span class="kn">from</span> <span class="nn">ManipulaPy.control</span> <span class="kn">import</span> <span class="n">ManipulatorController</span>

<span class="k">def</span> <span class="nf">control_loop_example</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="n">dynamics</span><span class="p">):</span>
    <span class="c1"># Initialize states</span>
    <span class="n">current_angles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
    <span class="n">current_velocities</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
    <span class="n">desired_angles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">])</span>

    <span class="c1"># Control parameters</span>
    <span class="n">Kp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">20.0</span><span class="p">,</span> <span class="mf">15.0</span><span class="p">,</span> <span class="mf">12.0</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">])</span>
    <span class="n">Ki</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">])</span>
    <span class="n">Kd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">])</span>

    <span class="n">dt</span> <span class="o">=</span> <span class="mf">0.01</span>
    <span class="n">simulation_time</span> <span class="o">=</span> <span class="mf">5.0</span>
    <span class="n">steps</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">simulation_time</span> <span class="o">/</span> <span class="n">dt</span><span class="p">)</span>

    <span class="c1"># Storage for plotting</span>
    <span class="n">time_history</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">angle_history</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">torque_history</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">steps</span><span class="p">):</span>
        <span class="c1"># Compute control signal</span>
        <span class="n">tau</span> <span class="o">=</span> <span class="n">controller</span><span class="o">.</span><span class="n">computed_torque_control</span><span class="p">(</span>
            <span class="n">thetalistd</span><span class="o">=</span><span class="n">desired_angles</span><span class="p">,</span>
            <span class="n">dthetalistd</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span>
            <span class="n">ddthetalistd</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span>
            <span class="n">thetalist</span><span class="o">=</span><span class="n">current_angles</span><span class="p">,</span>
            <span class="n">dthetalist</span><span class="o">=</span><span class="n">current_velocities</span><span class="p">,</span>
            <span class="n">g</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.81</span><span class="p">]),</span>
            <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span>
            <span class="n">Kp</span><span class="o">=</span><span class="n">Kp</span><span class="p">,</span> <span class="n">Ki</span><span class="o">=</span><span class="n">Ki</span><span class="p">,</span> <span class="n">Kd</span><span class="o">=</span><span class="n">Kd</span>
        <span class="p">)</span>

        <span class="c1"># Simulate dynamics (simplified)</span>
        <span class="n">accelerations</span> <span class="o">=</span> <span class="n">dynamics</span><span class="o">.</span><span class="n">forward_dynamics</span><span class="p">(</span>
            <span class="n">current_angles</span><span class="p">,</span> <span class="n">current_velocities</span><span class="p">,</span>
            <span class="n">cp</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">(</span><span class="n">tau</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.81</span><span class="p">]),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Update states</span>
        <span class="n">current_velocities</span> <span class="o">+=</span> <span class="n">accelerations</span> <span class="o">*</span> <span class="n">dt</span>
        <span class="n">current_angles</span> <span class="o">+=</span> <span class="n">current_velocities</span> <span class="o">*</span> <span class="n">dt</span>

        <span class="c1"># Store data</span>
        <span class="n">time_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">step</span> <span class="o">*</span> <span class="n">dt</span><span class="p">)</span>
        <span class="n">angle_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_angles</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
        <span class="n">torque_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cp</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">(</span><span class="n">tau</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">time_history</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">angle_history</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">torque_history</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="trajectory-tracking-example">
<h3><a class="toc-backref" href="#id42" role="doc-backlink">Trajectory Tracking Example</a><a class="headerlink" href="#trajectory-tracking-example" title="Link to this heading">ÔÉÅ</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">trajectory_tracking_example</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="n">trajectory</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Example of tracking a predefined trajectory using PD+Feedforward control</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">positions</span> <span class="o">=</span> <span class="n">trajectory</span><span class="p">[</span><span class="s2">&quot;positions&quot;</span><span class="p">]</span>
    <span class="n">velocities</span> <span class="o">=</span> <span class="n">trajectory</span><span class="p">[</span><span class="s2">&quot;velocities&quot;</span><span class="p">]</span>
    <span class="n">accelerations</span> <span class="o">=</span> <span class="n">trajectory</span><span class="p">[</span><span class="s2">&quot;accelerations&quot;</span><span class="p">]</span>

    <span class="c1"># Control gains</span>
    <span class="n">Kp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">25.0</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">,</span> <span class="mf">15.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">])</span>
    <span class="n">Kd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">])</span>

    <span class="n">current_state</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
    <span class="n">current_velocity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>

    <span class="n">tracking_errors</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">positions</span><span class="p">)):</span>
        <span class="c1"># Compute control with feedforward</span>
        <span class="n">tau</span> <span class="o">=</span> <span class="n">controller</span><span class="o">.</span><span class="n">pd_feedforward_control</span><span class="p">(</span>
            <span class="n">desired_position</span><span class="o">=</span><span class="n">positions</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
            <span class="n">desired_velocity</span><span class="o">=</span><span class="n">velocities</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
            <span class="n">desired_acceleration</span><span class="o">=</span><span class="n">accelerations</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
            <span class="n">current_position</span><span class="o">=</span><span class="n">current_state</span><span class="p">,</span>
            <span class="n">current_velocity</span><span class="o">=</span><span class="n">current_velocity</span><span class="p">,</span>
            <span class="n">Kp</span><span class="o">=</span><span class="n">Kp</span><span class="p">,</span> <span class="n">Kd</span><span class="o">=</span><span class="n">Kd</span><span class="p">,</span>
            <span class="n">g</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.81</span><span class="p">]),</span>
            <span class="n">Ftip</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Calculate tracking error</span>
        <span class="n">error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">positions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">current_state</span><span class="p">)</span>
        <span class="n">tracking_errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>

        <span class="c1"># Update state (simplified integration)</span>
        <span class="c1"># In practice, you would use your robot&#39;s dynamics</span>
        <span class="n">current_state</span> <span class="o">=</span> <span class="n">positions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>  <span class="c1"># Perfect tracking for demo</span>

    <span class="k">return</span> <span class="n">tracking_errors</span>
</pre></div>
</div>
</section>
</section>
<section id="troubleshooting">
<h2><a class="toc-backref" href="#id43" role="doc-backlink">Troubleshooting</a><a class="headerlink" href="#troubleshooting" title="Link to this heading">ÔÉÅ</a></h2>
<section id="common-issues-and-solutions">
<h3><a class="toc-backref" href="#id44" role="doc-backlink">Common Issues and Solutions</a><a class="headerlink" href="#common-issues-and-solutions" title="Link to this heading">ÔÉÅ</a></h3>
<ol class="arabic simple">
<li><p><strong>Controller Instability</strong></p>
<ul class="simple">
<li><p><strong>Cause</strong>: Gains too high or improper tuning</p></li>
<li><p><strong>Solution</strong>: Use Ziegler-Nichols tuning or reduce gains systematically</p></li>
</ul>
</li>
<li><p><strong>CuPy Memory Errors</strong></p>
<ul class="simple">
<li><p><strong>Cause</strong>: GPU memory exhaustion</p></li>
<li><p><strong>Solution</strong>: Use smaller batch sizes or convert to CPU arrays when needed</p></li>
</ul>
</li>
<li><p><strong>Numerical Issues</strong></p>
<ul class="simple">
<li><p><strong>Cause</strong>: Ill-conditioned matrices or extreme values</p></li>
<li><p><strong>Solution</strong>: Add regularization or use more robust numerical methods</p></li>
</ul>
</li>
<li><p><strong>Slow Performance</strong></p>
<ul class="simple">
<li><p><strong>Cause</strong>: Frequent CPU-GPU transfers</p></li>
<li><p><strong>Solution</strong>: Keep computations on GPU as much as possible</p></li>
</ul>
</li>
</ol>
</section>
<section id="best-practices">
<h3><a class="toc-backref" href="#id45" role="doc-backlink">Best Practices</a><a class="headerlink" href="#best-practices" title="Link to this heading">ÔÉÅ</a></h3>
<ol class="arabic simple">
<li><p><strong>Gain Tuning</strong>:</p>
<ul class="simple">
<li><p>Start with conservative gains and increase gradually</p></li>
<li><p>Use automatic tuning methods when possible</p></li>
<li><p>Test stability margins before deployment</p></li>
</ul>
</li>
<li><p><strong>GPU Usage</strong>:</p>
<ul class="simple">
<li><p>Convert to CuPy arrays early in the pipeline</p></li>
<li><p>Minimize data transfers between CPU and GPU</p></li>
<li><p>Use batch operations when possible</p></li>
</ul>
</li>
<li><p><strong>Safety</strong>:</p>
<ul class="simple">
<li><p>Always enforce joint and torque limits</p></li>
<li><p>Implement emergency stops</p></li>
<li><p>Validate control signals before application</p></li>
</ul>
</li>
<li><p><strong>Performance</strong>:</p>
<ul class="simple">
<li><p>Profile your control loop to identify bottlenecks</p></li>
<li><p>Use appropriate time steps for your application</p></li>
<li><p>Consider predictive control for better performance</p></li>
</ul>
</li>
</ol>
</section>
<section id="error-handling">
<h3><a class="toc-backref" href="#id46" role="doc-backlink">Error Handling</a><a class="headerlink" href="#error-handling" title="Link to this heading">ÔÉÅ</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">tau</span> <span class="o">=</span> <span class="n">controller</span><span class="o">.</span><span class="n">computed_torque_control</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

    <span class="c1"># Check for NaN or infinite values</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">cp</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">(</span><span class="n">tau</span><span class="p">))):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Control signal contains invalid values&quot;</span><span class="p">)</span>

    <span class="c1"># Enforce safety limits</span>
    <span class="n">safe_tau</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">tau</span><span class="p">,</span> <span class="n">torque_limits</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">torque_limits</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>

<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Control error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># Implement fallback strategy</span>
    <span class="n">tau</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>  <span class="c1"># Safe fallback</span>
</pre></div>
</div>
</section>
</section>
<section id="api-reference">
<h2><a class="toc-backref" href="#id47" role="doc-backlink">API Reference</a><a class="headerlink" href="#api-reference" title="Link to this heading">ÔÉÅ</a></h2>
</section>
<section id="additional-resources">
<h2><a class="toc-backref" href="#id48" role="doc-backlink">Additional Resources</a><a class="headerlink" href="#additional-resources" title="Link to this heading">ÔÉÅ</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="Trajectory_Planning.html"><span class="doc">Trajectory Planning User Guide</span></a> - Motion planning and trajectory generation</p></li>
<li><p><a class="reference internal" href="../api/control.html"><span class="doc">Control API Reference</span></a> - Complete API reference</p></li>
</ul>
<p>For issues and questions:</p>
<ul class="simple">
<li><p>GitHub Issues: <a class="reference external" href="https://github.com/boelnasr/ManipulaPy/issues">ManipulaPy Issues</a></p></li>
<li><p>Documentation: <a class="reference external" href="https://boelnasr.github.io/ManipulaPy/">ManipulaPy Docs</a></p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Dynamics.html" class="btn btn-neutral float-left" title="Dynamics User Guide" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="URDF_Processor.html" class="btn btn-neutral float-right" title="URDF Processor User Guide" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Mohamed Aboelnar.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>