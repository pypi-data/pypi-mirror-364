# üß† –£–º–Ω—ã–π CI/CD –¥–ª—è DmDSLab

## üéØ –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

–ù–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ CI/CD –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –≤–µ—Ä—Å–∏–π –∏ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–π.

### ‚ú® –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:

1. **–£–º–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–π** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –Ω–∞ PyPI/TestPyPI
2. **–£—Å–ª–æ–≤–Ω–∞—è –ø—É–±–ª–∏–∫–∞—Ü–∏—è** - –ø—É–±–ª–∏–∫–∞—Ü–∏—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤–µ—Ä—Å–∏—è –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
3. **–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è** - –ø–æ–¥—Ä–æ–±–Ω—ã–µ –æ—Ç—á–µ—Ç—ã –æ —Å—Ç–∞—Ç—É—Å–µ –≤–µ—Ä—Å–∏–π
4. **–£–¥–æ–±–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã** - —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–µ—Ä—Å–∏—è–º–∏ –ª–æ–∫–∞–ª—å–Ω–æ

## üîÑ –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

```mermaid
graph TD
    A[Push/Release] --> B[Build Package]
    B --> C[Get Version]
    C --> D[Check PyPI]
    C --> E[Check TestPyPI]
    
    D --> F{Version exists on PyPI?}
    E --> G{Version exists on TestPyPI?}
    
    F -->|No| H[‚úÖ Can publish to PyPI]
    F -->|Yes| I[‚è≠Ô∏è Skip PyPI]
    
    G -->|No| J[‚úÖ Can publish to TestPyPI]  
    G -->|Yes| K[‚è≠Ô∏è Skip TestPyPI]
    
    H --> L[Publish to PyPI]
    J --> M[Publish to TestPyPI]
    I --> N[Show skip message]
    K --> O[Show skip message]
```

## üõ†Ô∏è –õ–æ–∫–∞–ª—å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –≤–µ—Ä—Å–∏–π

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â—É—é –≤–µ—Ä—Å–∏—é
python scripts/check_version.py

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –≤–µ—Ä—Å–∏—é  
python scripts/check_version.py --version 1.2.3

# –ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å —Å–ª–µ–¥—É—é—â—É—é –¥–æ—Å—Ç—É–ø–Ω—É—é –≤–µ—Ä—Å–∏—é
python scripts/check_version.py --suggest-next
```

**–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:**
```
üì¶ Package: DmDSLab
üî¢ Current version: 1.0.0

============================================================
Repository      Exists     Latest          Status
============================================================
PyPI            False      N/A             ‚úÖ Available
TestPyPI        True       1.0.0           ‚ùå Exists
============================================================
‚ö†Ô∏è  Version exists on TestPyPI, will skip TestPyPI publication
‚úÖ Can publish to PyPI
```

### 2. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏—è–º–∏

```bash
# –£–≤–µ–ª–∏—á–∏—Ç—å patch –≤–µ—Ä—Å–∏—é (1.0.0 -> 1.0.1)
python scripts/bump_version.py patch

# –£–≤–µ–ª–∏—á–∏—Ç—å minor –≤–µ—Ä—Å–∏—é (1.0.0 -> 1.1.0)
python scripts/bump_version.py minor

# –£–≤–µ–ª–∏—á–∏—Ç—å major –≤–µ—Ä—Å–∏—é (1.0.0 -> 2.0.0)  
python scripts/bump_version.py major

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –≤–µ—Ä—Å–∏—é
python scripts/bump_version.py --to 1.2.3

# –° –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º git commit
python scripts/bump_version.py patch --git-commit

# –° —Å–æ–∑–¥–∞–Ω–∏–µ–º git tag –¥–ª—è release
python scripts/bump_version.py patch --git-tag
```

### 3. Makefile –∫–æ–º–∞–Ω–¥—ã

```bash
# –ü–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—É—â—É—é –≤–µ—Ä—Å–∏—é
make version

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –≤–µ—Ä—Å–∏–∏
make check-version

# –ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å —Å–ª–µ–¥—É—é—â—É—é –≤–µ—Ä—Å–∏—é
make suggest-version

# –ë—ã—Å—Ç—Ä–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–π
make bump-patch    # patch + commit
make bump-minor    # minor + commit  
make bump-major    # major + commit

# –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–ª–∏–∑–æ–≤
make release-patch # patch + commit + tag
make release-minor # minor + commit + tag
make release-major # major + commit + tag
```

## üöÄ Workflow –ø—É–±–ª–∏–∫–∞—Ü–∏–∏

### –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ (TestPyPI)

1. **–†–∞–±–æ—Ç–∞ –≤ develop branch:**
   ```bash
   git checkout develop
   
   # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –≤–µ—Ä—Å–∏–∏
   make check-version
   
   # –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –≤–µ—Ä—Å–∏—é
   make bump-patch
   
   # Push –∑–∞–ø—É—Å–∫–∞–µ—Ç CI
   git push origin develop
   ```

2. **CI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:**
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –≤–µ—Ä—Å–∏–∏ –Ω–∞ TestPyPI
   - –ï—Å–ª–∏ –≤–µ—Ä—Å–∏—è –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç ‚Üí –ø—É–±–ª–∏–∫—É–µ—Ç
   - –ï—Å–ª–∏ –≤–µ—Ä—Å–∏—è —Å—É—â–µ—Å—Ç–≤—É–µ—Ç ‚Üí –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º

### –†–µ–ª–∏–∑ (PyPI)

1. **–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ä–µ–ª–∏–∑–∞:**
   ```bash
   git checkout main
   git merge develop
   
   # –°–æ–∑–¥–∞—Ç—å —Ä–µ–ª–∏–∑ —Å —Ç–µ–≥–æ–º
   make release-minor  # –∏–ª–∏ release-patch/release-major
   
   # Push —Ç–µ–≥
   git push origin main
   git push origin v1.1.0
   ```

2. **–°–æ–∑–¥–∞–Ω–∏–µ GitHub Release:**
   - –ü–µ—Ä–µ–π—Ç–∏ –≤ GitHub ‚Üí Releases ‚Üí Create new release
   - –í—ã–±—Ä–∞—Ç—å —Å–æ–∑–¥–∞–Ω–Ω—ã–π —Ç–µ–≥
   - –ó–∞–ø–æ–ª–Ω–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ
   - Publish release

3. **CI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:**
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –≤–µ—Ä—Å–∏–∏ –Ω–∞ PyPI
   - –ï—Å–ª–∏ –≤–µ—Ä—Å–∏–∏ –Ω–µ—Ç ‚Üí –ø—É–±–ª–∏–∫—É–µ—Ç (—Å manual approval)
   - –ï—Å–ª–∏ –≤–µ—Ä—Å–∏—è –µ—Å—Ç—å ‚Üí –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç workflow —Å –æ—à–∏–±–∫–æ–π

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ GitHub Actions

### Build Summary

–ö–∞–∂–¥—ã–π –∑–∞–ø—É—Å–∫ —Å–æ–∑–¥–∞–µ—Ç –ø–æ–¥—Ä–æ–±–Ω—ã–π –æ—Ç—á–µ—Ç:

```markdown
## üìä Build Summary

**Package Version:** 1.0.1

### Status Check Results:
- **TestPyPI exists:** false
- **PyPI exists:** false

‚úÖ **TestPyPI:** Published successfully
‚ùå **PyPI:** Not applicable for this run
```

### –°—Ç–∞—Ç—É—Å—ã jobs

- ‚úÖ **publish-test** - —É—Å–ø–µ—à–Ω–∞—è –ø—É–±–ª–∏–∫–∞—Ü–∏—è –Ω–∞ TestPyPI
- ‚è≠Ô∏è **skip-test** - –≤–µ—Ä—Å–∏—è —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –Ω–∞ TestPyPI
- üöÄ **publish-pypi** - —É—Å–ø–µ—à–Ω–∞—è –ø—É–±–ª–∏–∫–∞—Ü–∏—è –Ω–∞ PyPI  
- ‚ö†Ô∏è **skip-pypi** - –≤–µ—Ä—Å–∏—è —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –Ω–∞ PyPI (—Å –æ—à–∏–±–∫–æ–π)

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –û–±–Ω–æ–≤–∏—Ç–µ CI workflow

–ó–∞–º–µ–Ω–∏—Ç–µ `.github/workflows/ci.yaml` –Ω–∞ —É–º–Ω—É—é –≤–µ—Ä—Å–∏—é –∏–∑ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞ –≤—ã—à–µ.

### 2. –°–æ–∑–¥–∞–π—Ç–µ scripts –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é

```bash
mkdir -p scripts
# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç—ã check_version.py –∏ bump_version.py
```

### 3. –û–±–Ω–æ–≤–∏—Ç–µ Makefile

–î–æ–±–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–µ—Ä—Å–∏—è–º–∏ (–∏–∑ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞ –≤—ã—à–µ).

### 4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Trusted Publishing

- –°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ Trusted Publishing
- –°–æ–∑–¥–∞–π—Ç–µ environments `testpypi` –∏ `pypi` –≤ GitHub

## üêõ –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –í–µ—Ä—Å–∏—è —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç

**–ü—Ä–æ–±–ª–µ–º–∞:** CI –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç –ø—É–±–ª–∏–∫–∞—Ü–∏—é
**–†–µ—à–µ–Ω–∏–µ:** 
```bash
make suggest-version  # –£–∑–Ω–∞—Ç—å —Å–ª–µ–¥—É—é—â—É—é –¥–æ—Å—Ç—É–ø–Ω—É—é –≤–µ—Ä—Å–∏—é  
make bump-patch       # –û–±–Ω–æ–≤–∏—Ç—å –≤–µ—Ä—Å–∏—é
git push              # –ó–∞–ø—É—Å—Ç–∏—Ç—å CI —Å–Ω–æ–≤–∞
```

### –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ä–µ–ª–∏–∑–∞

**–ü—Ä–æ–±–ª–µ–º–∞:** Release –Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è –Ω–∞ PyPI
**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤–µ—Ä—Å–∏—è –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –Ω–∞ PyPI
2. –£–±–µ–¥–∏—Ç—å—Å—è –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ Trusted Publishing
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å manual approval –≤ environment `pypi`

### Git tag —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç

**–ü—Ä–æ–±–ª–µ–º–∞:** `git tag` –≤—ã–¥–∞–µ—Ç –æ—à–∏–±–∫—É
**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –£–¥–∞–ª–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–π —Ç–µ–≥
git tag -d v1.0.1

# –£–¥–∞–ª–∏—Ç—å —É–¥–∞–ª–µ–Ω–Ω—ã–π —Ç–µ–≥
git push origin :refs/tags/v1.0.1

# –°–æ–∑–¥–∞—Ç—å –∑–∞–Ω–æ–≤–æ
make release-patch
```

## üìà –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã

1. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è** - –Ω–µ—Ç –æ—à–∏–±–æ–∫ "file already exists"
2. **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è** - –º–∏–Ω–∏–º—É–º —Ä—É—á–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π
3. **–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–æ—Å—Ç—å** - –ø–æ–¥—Ä–æ–±–Ω—ã–µ –æ—Ç—á–µ—Ç—ã –æ —Å—Ç–∞—Ç—É—Å–µ
4. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - Trusted Publishing –±–µ–∑ —Ç–æ–∫–µ–Ω–æ–≤
5. **–£–¥–æ–±—Å—Ç–≤–æ** - –ø—Ä–æ—Å—Ç—ã–µ –∫–æ–º–∞–Ω–¥—ã —á–µ—Ä–µ–∑ Makefile
6. **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å** - –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ–¥ –ø—É–±–ª–∏–∫–∞—Ü–∏–µ–π

## üéØ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π workflow

```bash
# –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
git checkout develop
# ... —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ ...
make check-version     # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω—É–∂–Ω–æ –ª–∏ –æ–±–Ω–æ–≤–∏—Ç—å –≤–µ—Ä—Å–∏—é
make bump-patch        # –ï—Å–ª–∏ –Ω—É–∂–Ω–æ
git push origin develop

# –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–ª–∏–∑–∞ (—Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é/–º–µ—Å—è—Ü)
git checkout main
git merge develop
make release-minor     # –°–æ–∑–¥–∞—Ç—å —Ä–µ–ª–∏–∑
git push origin main
git push origin v1.1.0
# –°–æ–∑–¥–∞—Ç—å GitHub Release —á–µ—Ä–µ–∑ UI
```

–≠—Ç–∞ —Å–∏—Å—Ç–µ–º–∞ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø–ª–∞–≤–Ω—ã–π –∏ –Ω–∞–¥–µ–∂–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –±–µ–∑ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –≤–µ—Ä—Å–∏–π!