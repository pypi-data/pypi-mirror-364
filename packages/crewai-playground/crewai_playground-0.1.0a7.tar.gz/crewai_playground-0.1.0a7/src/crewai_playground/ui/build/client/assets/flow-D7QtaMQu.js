import{w as de,u as ue}from"./store-BDLt0vbv.js";import{q as se,r as a,l as e}from"./chunk-GNGMS2XR-KLeu_BA0.js";import{B as ie}from"./sun-CQoWRrLL.js";import{L as me,T as fe,I as he}from"./textarea-DtCtS8Wd.js";import{S as pe,i as xe,j as ge,k as we,l as ye}from"./select-Dsrp1aXH.js";import{L as je}from"./Layout-Ny4hAXj2.js";import{A as ne,a as re,b as oe}from"./alert-C8ewgBGD.js";import"./tabs-Rg-Jy3Im.js";import{d as ae,u as be,f as Ne,M as Q,i as ve,B as Se,c as Ee,e as $e,H as G,P as Z}from"./index-K9TuxQyt.js";import{B as Y}from"./badge-BrVE-78x.js";import{C as ke}from"./card-Cd_s9Lcu.js";import{L as X}from"./loader-circle-BOkGL-CS.js";import{M as te}from"./index-ChbM4Wl4.js";import"./index-BKaxNvVC.js";import"./chevron-down-7prL2jkC.js";import"./transform-BEtJ_6wc.js";const Fe=[],We=[],P=new ae.graphlib.Graph().setDefaultEdgeLabel(()=>({}));function He(t){let n=180,j=80;return t.forEach(c=>{var E,C,i,D,M,$,A;let N=220,h=100;if((E=c.data)!=null&&E.measured&&typeof c.data.measured=="object"&&"width"in c.data.measured&&"height"in c.data.measured){const v=c.data.measured;typeof v.width=="number"&&typeof v.height=="number"&&v.width>0&&v.height>0&&(N=v.width+20,h=v.height+10)}else{if((C=c.data)!=null&&C.label&&typeof c.data.label=="string"){const v=c.data.label.length;N=Math.max(180,v*12)}if((i=c.data)!=null&&i.description&&(h+=25),(D=c.data)!=null&&D.error&&(h+=40),(M=c.data)!=null&&M.dependencies&&Array.isArray(c.data.dependencies)&&(h+=30+c.data.dependencies.length*20),($=c.data)!=null&&$.flowMethod&&(h+=25),(A=c.data)!=null&&A.outputs&&typeof c.data.outputs=="object"){const v=JSON.stringify(c.data.outputs).length;h+=Math.min(200,v/5)}}N=Math.max(180,Math.min(400,N)),h=Math.max(80,Math.min(400,h)),n=Math.max(n,N),j=Math.max(j,h)}),{width:n,height:j}}function q(t,y,u="TB"){if(t.length===0)return{nodes:[],edges:[],fullWidth:0,fullHeight:0};const{width:w,height:l}=He(t);P.setGraph({}),P.setGraph({rankdir:u,ranksep:100,nodesep:80}),t.forEach(h=>{P.removeNode(h.id)}),t.forEach(h=>{P.setNode(h.id,{width:w,height:l})}),y.forEach(h=>{P.setEdge(h.source,h.target)}),ae.layout(P);const n=P.graph(),j=n&&n.width?n.width/2:0,c=n&&n.height?n.height/2:0;return{nodes:t.map(h=>{const E=P.node(h.id);return E?{...h,position:{x:E.x-w/2,y:E.y-l/2},data:{...h.data,uniformWidth:w,uniformHeight:l}}:(console.warn(`No dagre node found for id: ${h.id}`),h)}),edges:y,fullWidth:j,fullHeight:c}}function K(){const t=a.useRef(null),[y,u]=a.useState({width:0,height:0});return a.useEffect(()=>{const w=()=>{if(t.current){const{offsetWidth:j,offsetHeight:c}=t.current;j>0&&c>0&&u({width:j,height:c})}},l=setTimeout(w,0);let n=null;try{n=new ResizeObserver(()=>{t.current&&w()}),t.current&&n.observe(t.current)}catch(j){console.error("ResizeObserver error:",j)}return()=>{if(clearTimeout(l),n&&t.current)try{n.unobserve(t.current),n.disconnect()}catch(j){console.error("Error cleaning up ResizeObserver:",j)}}},[]),{ref:t,dimensions:y}}const Te=({data:t})=>{const{ref:y,dimensions:u}=K();a.useEffect(()=>{u.width>0&&u.height>0&&(t.measured=u)},[u,t]);const w=n=>{switch(n){case"running":return"bg-blue-500";case"completed":return"bg-green-500";case"failed":return"bg-red-500";default:return"bg-gray-500"}},l=t.uniformWidth&&t.uniformHeight?{width:`${t.uniformWidth}px`,height:`${t.uniformHeight}px`,minWidth:`${t.uniformWidth}px`,minHeight:`${t.uniformHeight}px`}:{};return e.jsx("div",{ref:y,className:`px-4 py-2 shadow-md rounded-md border bg-card flex flex-col justify-center ${t.uniformWidth&&t.uniformHeight?"uniform-sized":""}`,style:l,children:e.jsxs("div",{className:"flex flex-col h-full justify-center",children:[e.jsxs("div",{className:"flex items-center justify-center mb-2",children:[e.jsx("div",{className:`w-3 h-3 rounded-full mr-2 ${w(t.status)}`}),e.jsx("div",{className:"font-bold text-lg text-center",children:t.label})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx(Y,{variant:t.status==="running"?"secondary":t.status==="completed"?"outline":t.status==="failed"?"destructive":"outline",children:t.status})})]})})},Ce=({data:t})=>{const{ref:y,dimensions:u}=K();a.useEffect(()=>{u.width>0&&u.height>0&&(t.measured=u)},[u,t]);const w=n=>{switch(n){case"running":return"bg-blue-500";case"completed":return"bg-green-500";case"failed":return"bg-red-500";case"initializing":return"bg-purple-500";case"pending":return"bg-gray-500";default:return"bg-gray-500"}},l=t.uniformWidth&&t.uniformHeight?{width:`${t.uniformWidth}px`,height:`${t.uniformHeight}px`,minWidth:`${t.uniformWidth}px`,minHeight:`${t.uniformHeight}px`}:{};return e.jsxs("div",{ref:y,className:`px-4 py-2 shadow-md rounded-md border bg-card relative overflow-hidden ${t.uniformWidth&&t.uniformHeight?"uniform-sized":""}`,style:l,children:[!t.isFirst&&e.jsx(G,{type:"target",position:Z.Top,className:"w-2 h-2 bg-slate-500"}),!t.isLast&&e.jsx(G,{type:"source",position:Z.Bottom,className:"w-2 h-2 bg-slate-500"}),e.jsxs("div",{className:"flex flex-col h-full justify-center",children:[e.jsxs("div",{className:"flex items-center justify-center mb-1",children:[e.jsx("div",{className:`w-3 h-3 rounded-full mr-2 ${w(t.status)}`}),e.jsx("div",{className:"font-bold text-center truncate",children:t.label})]}),t.description&&e.jsx("div",{className:"mt-1 text-xs text-muted-foreground text-center truncate",children:t.description}),e.jsx("div",{className:"mt-2 flex justify-center",children:e.jsxs(Y,{variant:t.status==="running"?"secondary":t.status==="completed"?"outline":t.status==="failed"?"destructive":t.status==="initializing"?"default":"outline",className:`${t.status==="completed"?"bg-green-100 text-green-800 border-green-500 dark:bg-green-900/20 dark:text-green-400 dark:border-green-800":""} ${t.status==="running"?"animate-pulse":""}`,children:[t.status==="running"&&e.jsx("span",{className:"mr-1",children:"⚡"}),t.status==="completed"&&e.jsx("span",{className:"mr-1",children:"✓"}),t.status==="failed"&&e.jsx("span",{className:"mr-1",children:"✗"}),t.status]})}),t.error&&e.jsxs("div",{className:"mt-2 p-2 bg-red-100 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded text-xs text-red-500 dark:text-red-400 text-center max-h-16 overflow-y-auto",children:[e.jsx("div",{className:"font-semibold",children:"Error:"}),e.jsx("div",{children:t.error})]}),t.dependencies&&Array.isArray(t.dependencies)&&t.dependencies.length>0&&e.jsxs("div",{className:"mt-2 text-xs text-muted-foreground",children:[e.jsx("div",{className:"font-semibold text-center",children:"Dependencies:"}),e.jsx("div",{className:"max-h-16 overflow-y-auto",children:t.dependencies.map((n,j)=>e.jsx("div",{className:"ml-2 truncate",children:n},j))})]}),t.flowMethod&&e.jsxs("div",{className:"mt-1 text-xs text-muted-foreground text-center truncate",children:[e.jsx("span",{className:"font-semibold",children:"Method:"})," ",t.flowMethod]})]})]})},Me=({data:t})=>{const{ref:y,dimensions:u}=K();a.useEffect(()=>{u.width>0&&u.height>0&&(t.measured=u)},[u,t]);const w=t.uniformWidth&&t.uniformHeight?{width:`${t.uniformWidth}px`,height:`${t.uniformHeight}px`,minWidth:`${t.uniformWidth}px`,minHeight:`${t.uniformHeight}px`}:{};return e.jsx("div",{ref:y,className:`px-4 py-2 shadow-md rounded-md border bg-card overflow-hidden ${t.uniformWidth&&t.uniformHeight?"uniform-sized":""}`,style:w,children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx("div",{className:"font-bold mb-2 text-center",children:"Flow Output"}),e.jsx("div",{className:"text-xs overflow-auto flex-1",children:t.output?JSON.stringify(t.output):"No output yet"})]})})},Ae=({data:t})=>{const{ref:y,dimensions:u}=K();a.useEffect(()=>{u.width>0&&u.height>0&&(t.measured=u)},[u,t]);const w=t.uniformWidth&&t.uniformHeight?{width:`${t.uniformWidth}px`,height:`${t.uniformHeight}px`,minWidth:`${t.uniformWidth}px`,minHeight:`${t.uniformHeight}px`}:{};return e.jsxs("div",{ref:y,className:`px-4 py-2 shadow-md rounded-md border bg-card relative overflow-hidden ${t.uniformWidth&&t.uniformHeight?"uniform-sized":""}`,style:w,children:[!t.isFirst&&e.jsx(G,{type:"target",position:Z.Top,className:"w-2 h-2 bg-slate-500"}),!t.isLast&&e.jsx(G,{type:"source",position:Z.Bottom,className:"w-2 h-2 bg-slate-500"}),e.jsxs("div",{className:"flex flex-col h-full justify-center",children:[e.jsxs("div",{className:"flex items-center justify-center mb-1",children:[t.is_step&&e.jsx(Y,{variant:"secondary",className:"mr-2",children:"Step"}),e.jsx("div",{className:"font-bold text-center truncate",children:t.label})]}),t.description&&e.jsx("div",{className:"mt-1 text-xs text-muted-foreground text-center truncate",children:t.description}),t.dependencies&&t.dependencies.length>0&&e.jsxs("div",{className:"mt-2 text-xs",children:[e.jsx("div",{className:"font-medium text-center",children:"Dependencies:"}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1 justify-center max-h-16 overflow-y-auto",children:t.dependencies.map(l=>e.jsx(Y,{variant:"outline",className:"text-xs",children:l},l))})]})]})]})},ze=({flowId:t,isRunning:y,resetKey:u})=>{const w=se(),[l,n,j]=be(Fe),[c,N,h]=Ne(We),[E,C]=a.useState(null),[i,D]=a.useState(null),[M,$]=a.useState(null),[A,v]=a.useState(!1),[W,B]=a.useState("TB"),J=a.useCallback(()=>{if(l.length>0){const{nodes:s,edges:m}=q(l,c,W);n([...s]),N([...m]),setTimeout(()=>{const{nodes:r,edges:d}=q(s,m,W);n([...r]),N([...d])},100)}},[l,c,W,n,N]);a.useCallback(()=>{B(s=>s==="TB"?"LR":"TB"),setTimeout(()=>J(),100)},[B,J]);const[U,f]=a.useState(null),[g,x]=a.useState(!1);a.useEffect(()=>{D(null),$(null),E&&(E.close(),C(null))},[u]),a.useEffect(()=>{if(!t)return;(async()=>{x(!0),$(null);try{const r=await(await fetch("/api/flows")).json();if(r.status==="success"&&!r.flows.some(S=>S.id===t)){$(`Flow with ID ${t} not found. Please select a valid flow.`),x(!1);return}const d=await fetch(`/api/flows/${t}/structure`);if(!d.ok){d.status===404?$(`Flow with ID ${t} not found. Please select a valid flow.`):$(`Error fetching flow structure: ${d.statusText}`),x(!1);return}const o=await d.json();o.status==="success"&&o.flow?(f(o.flow),ce(o.flow)):$(o.detail||"Failed to fetch flow structure")}catch(m){console.error("Error fetching flow structure:",m),$("Failed to fetch flow structure. Please try again.")}finally{x(!1)}})()},[t]),a.useEffect(()=>{if(!t||!y)return;v(!0),$(null);let s=0;const m=3;let r=null;const d=()=>{const L=`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/ws/flow/${t}`,S=new WebSocket(L),H=setTimeout(()=>{S.readyState!==WebSocket.OPEN&&(console.warn("WebSocket connection timeout"),S.close(),s<m?(s++,r=setTimeout(d,1e3)):($("Failed to connect to flow execution after multiple attempts. Please try again."),v(!1)))},5e3);S.onopen=()=>{clearTimeout(H),v(!1)},S.onmessage=O=>{try{const b=JSON.parse(O.data);b.type==="flow_state"?D(I=>{if(!I)return b.payload;const T=JSON.parse(JSON.stringify(I));if(T.status=b.payload.status,b.payload.outputs&&(T.outputs=b.payload.outputs),b.payload.steps&&Array.isArray(b.payload.steps)){const V=new Map(T.steps.map(R=>[R.id,R]));b.payload.steps.forEach(R=>{V.set(R.id,{...V.get(R.id)||{},...R})}),T.steps=Array.from(V.values())}return b.payload.errors&&Array.isArray(b.payload.errors)&&(T.errors=[...T.errors||[],...b.payload.errors]),T}):b.type==="error"&&$(b.message||"An error occurred during flow execution")}catch(b){console.error("Error parsing WebSocket message:",b)}},S.onerror=O=>{console.error("WebSocket error:",O),clearTimeout(H),s>=m&&($("Failed to connect to flow execution. Please try again."),v(!1))},S.onclose=O=>{clearTimeout(H),O.code!==1e3&&O.code!==1001&&s<m&&(s++,r=setTimeout(d,1e3))},C(S)};return d(),()=>{E&&E.close(),r&&clearTimeout(r)}},[t,y,u]),a.useEffect(()=>{i&&(n(s=>{if(s.length===0)return s;new Map(s.map(o=>[o.id,o]));const m=`flow-${i.id}`,r=[...s],d=s.findIndex(o=>o.id===m);return d>=0&&(r[d]={...s[d],data:{...s[d].data,status:i.status}}),i.steps.forEach(o=>{const L=`method-${o.id}`,S=s.findIndex(H=>H.id===L);S>=0&&(r[S]={...s[S],data:{...s[S].data,status:o.status,outputs:o.outputs,error:o.error},className:le(o.status)})}),r}),N(s=>{const m=[...s];if(i.steps.forEach(r=>{const d=`method-${r.id}`;m.forEach((o,L)=>{(o.source===d||o.target===d)&&(m[L]={...o,animated:r.status==="running",style:{...o.style,stroke:ee(r.status),strokeWidth:r.status==="running"?3:2,opacity:r.status==="pending"?.6:1},markerEnd:o.markerEnd?{...o.markerEnd,color:ee(r.status)}:void 0})})}),i.status==="completed"&&i.outputs&&(typeof i.outputs=="string"?i.outputs.trim().length>0:Object.keys(i.outputs).length>0)&&!s.some(r=>r.id==="flow-to-output")){const r=`flow-${i.id}`;m.push({id:"flow-to-output",source:r,target:"output-node",type:"smoothstep",style:{stroke:"#4caf50",strokeWidth:2},markerEnd:{type:Q.ArrowClosed,color:"#4caf50"}})}return m}))},[i]);const[k,z]=a.useState(!1);a.useEffect(()=>{if(l.length===0||k&&(i==null?void 0:i.status)!=="pending")return;const s=l.some(d=>{var o;return((o=d.data)==null?void 0:o.measured)&&typeof d.data.measured=="object"&&"width"in d.data.measured&&"height"in d.data.measured}),{nodes:m,edges:r}=q(l,c,W);n(m),N(r),s?setTimeout(()=>{const{nodes:d,edges:o}=q(m,r,W);n(d),N(o),z(!0)},150):z(!0)},[l.length,c.length,W,i==null?void 0:i.status]);const ee=s=>{switch(s){case"running":return"#2196f3";case"completed":return"#4caf50";case"failed":return"#f44336";case"pending":return"#9e9e9e";case"initializing":return"#9c27b0";default:return"#9e9e9e"}},le=s=>{switch(s){case"running":return"animate-pulse-subtle";case"initializing":return"animate-fade-in";default:return""}},ce=s=>{if(!s||!s.methods)return;const m=[],r=[],d={id:`flow-${s.id}`,type:"flowNode",position:{x:0,y:0},data:{label:s.name,status:"pending",id:s.id}};m.push(d);const o=200,L=0,S=150,H={};s.methods.forEach(p=>{H[p.id]=p});const O=new Set,b=new Set,I=[],T=p=>{if(b.has(p)||O.has(p))return;b.add(p);const F=H[p];F&&F.dependencies&&F.dependencies.forEach(_=>{H[_]&&T(_)}),b.delete(p),O.add(p),F&&I.push(F)};s.methods.forEach(p=>{T(p.id)}),I.forEach((p,F)=>{const _=S+F*o;m.push({id:`method-${p.id}`,type:"methodNode",position:{x:L,y:_},data:{label:p.name,description:p.description,is_step:p.is_step,dependencies:p.dependencies||[],isFirst:F===0,isLast:F===I.length-1}}),(!p.dependencies||p.dependencies.length===0)&&r.push({id:`edge-flow-${p.id}`,source:`flow-${s.id}`,target:`method-${p.id}`,type:"smoothstep",markerEnd:{type:Q.ArrowClosed,color:"#2196f3"},style:{stroke:"#2196f3",strokeWidth:2}})}),I.forEach(p=>{p.dependencies&&p.dependencies.length>0&&p.dependencies.forEach(F=>{H[F]&&r.push({id:`edge-${F}-to-${p.id}`,source:`method-${F}`,target:`method-${p.id}`,type:"smoothstep",markerEnd:{type:Q.ArrowClosed,color:"#ff9800"},style:{stroke:"#ff9800",strokeWidth:2,strokeDasharray:"5 5"}})})});const{nodes:V,edges:R}=q(m,r,W);n(V),N(R)};return e.jsxs(ke,{className:"p-6 mb-6 overflow-hidden",children:[e.jsxs("div",{className:"p-4 flex justify-between items-center flex-shrink-0",children:[e.jsx("h3",{className:"font-semibold text-lg",children:"Flow Visualization"}),e.jsx(ie,{variant:"outline",size:"sm",onClick:()=>w("/flow/traces"),children:"View Traces"})]}),(A||g)&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center z-10 bg-background/80",children:e.jsxs("div",{className:"text-center",children:[e.jsx(X,{className:"h-8 w-8 animate-spin mx-auto mb-2 text-primary"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:A?"Connecting to flow execution...":"Loading flow structure..."})]})}),M&&e.jsx("div",{className:"p-4",children:e.jsxs(ne,{children:[e.jsx(re,{children:"Error"}),e.jsx(oe,{children:M})]})}),!U&&l.length===0&&!A&&!g&&!M&&e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Flow Visualization"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Select a flow to visualize its structure."})]})}),e.jsx("div",{className:"h-[600px] border rounded-md overflow-hidden mb-6",children:e.jsxs(ve,{nodes:l,edges:c,onNodesChange:j,onEdgesChange:h,nodeTypes:Le,fitView:!0,fitViewOptions:{padding:.2,includeHiddenNodes:!1,minZoom:.1,maxZoom:1.5},minZoom:.1,maxZoom:2,defaultViewport:{x:0,y:0,zoom:.8},children:[e.jsx(Se,{}),e.jsx(Ee,{}),e.jsx($e,{})]})}),(i==null?void 0:i.status)==="completed"&&(i==null?void 0:i.outputs)&&(typeof i.outputs=="string"?i.outputs.trim().length>0:Object.keys(i.outputs).length>0)&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Flow Results"}),e.jsx("div",{className:"p-6 rounded-lg border bg-card overflow-auto",children:e.jsx("div",{className:"text-base leading-7",children:typeof i.outputs=="string"?e.jsx(te,{components:{h1:({...s})=>e.jsx("h1",{className:"text-2xl font-bold mt-6 mb-4",...s}),h2:({...s})=>e.jsx("h2",{className:"text-xl font-bold mt-5 mb-3",...s}),h3:({...s})=>e.jsx("h3",{className:"text-lg font-bold mt-4 mb-2",...s}),p:({...s})=>e.jsx("p",{className:"mb-4",...s}),ul:({...s})=>e.jsx("ul",{className:"list-disc pl-6 mb-4",...s}),ol:({...s})=>e.jsx("ol",{className:"list-decimal pl-6 mb-4",...s}),li:({...s})=>e.jsx("li",{className:"mb-1",...s}),a:({...s})=>e.jsx("a",{className:"text-blue-500 hover:underline",...s}),blockquote:({...s})=>e.jsx("blockquote",{className:"border-l-4 border-muted pl-4 italic my-4",...s}),code:({children:s,className:m,...r})=>!/language-(\w+)/.exec(m||"")&&!(s!=null&&s.toString().includes(`
`))?e.jsx("code",{className:"bg-muted px-1 py-0.5 rounded",...r,children:s}):e.jsx("pre",{className:"bg-muted p-4 rounded-md overflow-x-auto mb-4",children:e.jsx("code",{className:m,...r,children:s})})},children:i.outputs}):e.jsx("div",{className:"space-y-4",children:Object.entries(i.outputs).map(([s,m])=>e.jsxs("div",{className:"border-b border-muted pb-4 last:border-b-0",children:[e.jsx("h4",{className:"font-semibold text-sm uppercase tracking-wide text-muted-foreground mb-2",children:s}),e.jsx("div",{className:"text-sm",children:typeof m=="string"?e.jsx(te,{components:{p:({...r})=>e.jsx("p",{className:"mb-2",...r}),code:({children:r,className:d,...o})=>!/language-(\w+)/.exec(d||"")&&!(r!=null&&r.toString().includes(`
`))?e.jsx("code",{className:"bg-muted px-1 py-0.5 rounded",...o,children:r}):e.jsx("pre",{className:"bg-muted p-2 rounded-md overflow-x-auto mb-2",children:e.jsx("code",{className:d,...o,children:r})})},children:m}):e.jsx("pre",{className:"bg-muted p-2 rounded-md overflow-x-auto text-xs",children:JSON.stringify(m,null,2)})})]},s))})})})]})]})},Le={flowNode:Te,stepNode:Ce,outputNode:Me,methodNode:Ae};function Xe(){return[{title:"CrewAI - Flow Mode"},{name:"description",content:"Run a flow directly with specific inputs"}]}const et=de(function(){se();const{flows:y,setFlows:u}=ue(),[w,l]=a.useState(!1),[n,j]=a.useState(""),[c,N]=a.useState(null),[h,E]=a.useState([]),[C,i]=a.useState(null),[D,M]=a.useState(null),[$,A]=a.useState(!1),[v,W]=a.useState(0);a.useEffect(()=>{A(!1),M(null),i(null),W(1)},[]),a.useEffect(()=>{(async()=>{l(!0);try{const x=await(await fetch("/api/flows")).json();x.flows&&(u(x.flows),x.flows.length>0?x.flows.some(z=>z.id===n)||j(x.flows[0].id):(j(""),N(null),E([]),i("No flows available. Please check your configuration.")))}catch(g){console.error("Error fetching flows:",g),i("Failed to fetch flows. Please try again later.")}finally{l(!1)}})()},[u]),a.useEffect(()=>{(async()=>{if(!n){N(null),E([]);return}try{l(!0);const g=y.find(z=>z.id===n);if(!g){i(`Flow with ID ${n} not found. Please select a valid flow.`),l(!1);return}const x=await fetch(`/api/flows/${n}/initialize`);if(!x.ok){x.status===404?i(`Flow with ID ${n} not found. Please select a valid flow.`):i(`Error fetching flow details: ${x.statusText}`),l(!1);return}const k=await x.json();k.status==="success"?(N({id:g.id,name:g.name,description:g.description,required_inputs:k.required_inputs||[]}),E((k.required_inputs||[]).map(z=>({name:z.name,description:z.description,value:""})))):i(k.detail||"Failed to fetch flow details")}catch(g){console.error("Error fetching flow details:",g),i("Failed to fetch flow details. Please try again later.")}finally{l(!1)}})()},[n,y]);const B=(f,g)=>{E(x=>x.map(k=>k.name===f?{...k,value:g}:k))},J=async f=>{if(f.preventDefault(),!n)return;l(!0),i(null),M(null),A(!0),W(x=>x+1);const g={};h.forEach(x=>{g[x.name]=x.value});try{const k=await(await fetch(`/api/flows/${n}/execute`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({inputs:g})})).json();k.status==="success"||i(k.detail||"Failed to run flow")}catch(x){console.error("Error running flow:",x),i("Failed to run flow. Please try again later.")}finally{l(!1)}},U=e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Select a Flow"}),e.jsxs(pe,{value:n,onValueChange:f=>{j(f),W(g=>g+1)},disabled:w,children:[e.jsx(xe,{id:"flow-select",className:"w-full",children:e.jsx(ge,{placeholder:"Select a flow"})}),e.jsx(we,{children:y.map(f=>e.jsx(ye,{value:f.id,children:f.name},f.id))})]})]}),c&&e.jsxs("div",{className:"p-4 rounded-lg border bg-accent/50",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:c.name}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:c.description})]}),e.jsxs("form",{onSubmit:J,className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Required Inputs"}),h.map(f=>e.jsxs("div",{className:"space-y-2",children:[e.jsx(me,{htmlFor:f.name,children:f.name}),f.name.toLowerCase().includes("prompt")?e.jsx(fe,{id:f.name,placeholder:f.description,value:f.value,onChange:g=>B(f.name,g.target.value),className:"min-h-[100px]"}):e.jsx(he,{id:f.name,placeholder:f.description,value:f.value,onChange:g=>B(f.name,g.target.value)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:f.description})]},f.name)),e.jsx(ie,{type:"submit",className:"w-full",disabled:w||h.some(f=>!f.value),children:w?e.jsxs(e.Fragment,{children:[e.jsx(X,{className:"mr-2 h-4 w-4 animate-spin"}),"Running Flow..."]}):"Run Flow"})]})]});return e.jsxs(je,{rightSidebar:U,children:[C&&e.jsxs(ne,{variant:"destructive",className:"mb-6",children:[e.jsx(re,{children:"Error"}),e.jsx(oe,{children:C})]}),n&&e.jsx(ze,{flowId:n,isRunning:$,resetKey:v}),!C&&!n&&e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Run a Flow Directly"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Select a flow from the sidebar, provide the required inputs, and run it to see results here."}),w&&e.jsx("div",{className:"flex justify-center mt-8",children:e.jsx(X,{className:"h-8 w-8 animate-spin text-primary"})})]})})]})});export{et as default,Xe as meta};
