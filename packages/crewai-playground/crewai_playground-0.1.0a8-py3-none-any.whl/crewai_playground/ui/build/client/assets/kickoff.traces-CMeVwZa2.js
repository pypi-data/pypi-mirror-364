import{w as U,u as X}from"./store-BDLt0vbv.js";import{q as Y,x as Z,p as ee,r as l,l as e}from"./chunk-GNGMS2XR-KLeu_BA0.js";import{L as se}from"./Layout-Ny4hAXj2.js";import{K as te}from"./KickoffNavigation-BbFNlkdN.js";import{C as h,a as b,b as w,c as g,d as I}from"./card-Cd_s9Lcu.js";import{T as ae,a as re,b as T,c as k}from"./tabs-Rg-Jy3Im.js";import{B as u}from"./badge-BrVE-78x.js";import{S as ie,I as ne,T as de,a as ce,A as O,b as L,c as $,d as M}from"./scroll-area-DfJgwTXN.js";import"./separator-DFnxFCCM.js";import{L as F}from"./loader-circle-BOkGL-CS.js";import"./sun-CQoWRrLL.js";import"./index-BKaxNvVC.js";import"./chevron-down-7prL2jkC.js";import"./transform-BEtJ_6wc.js";function ke(){return[{title:"CrewAI - Execution Traces"},{name:"description",content:"View execution traces for your CrewAI agents"}]}const Se=U(function(){Y(),Z();const{isDarkMode:me}=X(),[P]=ee(),j=P.get("crewId"),[S,V]=l.useState([]),[t,_]=l.useState(null),[D,C]=l.useState(!0),[E,B]=l.useState(null),[J,K]=l.useState("overview"),[p,A]=l.useState(null),q=l.useMemo(()=>{if(!t)return[];const a=[],s=new Date(t.start_time),i=t.end_time?new Date(t.end_time):null,m=i?i.getTime()-s.getTime():0,n={id:t.id,name:`Crew: ${t.crew_name}`,startTime:s,endTime:i,status:t.status,depth:0,duration:m,serviceName:"crew",operation:"execution",children:[]};a.push(n),Object.values(t.agents).forEach(r=>{const x=new Date(r.start_time),o=r.end_time?new Date(r.end_time):null,y=o?o.getTime()-x.getTime():0,f={id:r.id,name:`Agent: ${r.name}`,startTime:x,endTime:o,status:r.status,parentId:t.id,depth:1,duration:y,serviceName:"agent",operation:r.role,children:[]};a.push(f)}),Object.values(t.tasks).forEach(r=>{const x=new Date(r.start_time),o=r.end_time?new Date(r.end_time):null,y=o?o.getTime()-x.getTime():0,f={id:r.id,name:r.description.length>30?`${r.description.substring(0,30)}...`:r.description,startTime:x,endTime:o,status:r.status,parentId:r.agent_id||t.id,depth:2,duration:y,serviceName:"task",operation:"execution",children:[]};a.push(f)});const c=new Map;return a.forEach(r=>c.set(r.id,r)),a.forEach(r=>{r.parentId&&c.has(r.parentId)&&c.get(r.parentId).children.push(r)}),a},[t]);l.useMemo(()=>{if(!t)return 0;const a=new Date(t.start_time).getTime();return(t.end_time?new Date(t.end_time).getTime():Date.now())-a},[t]);const z=a=>{A(a)};l.useEffect(()=>{async function a(){try{C(!0);const s=await fetch(`/api/crews/${j}/traces`);if(!s.ok)throw new Error(`Failed to fetch traces: ${s.statusText}`);const i=await s.json();V(i),i.length>0&&_(i[0])}catch(s){B(s instanceof Error?s.message:String(s))}finally{C(!1)}}a()},[j]);const d=a=>new Date(a).toLocaleString(),v=(a,s)=>{if(!a||!s)return"N/A";try{const i=new Date(a).getTime(),n=new Date(s).getTime()-i;if(n<1e3)return`${n}ms`;if(n<6e4)return`${(n/1e3).toFixed(2)}s`;{const c=Math.floor(n/6e4),r=(n%6e4/1e3).toFixed(2);return`${c}m ${r}s`}}catch{return"Invalid time"}},N=a=>{switch(a.toLowerCase()){case"running":case"initializing":return"bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-300 border-blue-200 dark:border-blue-800";case"completed":return"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-300 border-green-200 dark:border-green-800";case"failed":return"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-300 border-red-200 dark:border-red-800";case"pending":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/20 dark:text-yellow-300 border-yellow-200 dark:border-yellow-800";default:return"bg-gray-100 text-gray-800 dark:bg-gray-900/20 dark:text-gray-300 border-gray-200 dark:border-gray-800"}},H=()=>D?e.jsxs("div",{className:"flex items-center justify-center p-4",children:[e.jsx(F,{className:"h-6 w-6 animate-spin mr-2"}),e.jsx("span",{children:"Loading traces..."})]}):E?e.jsx("div",{className:"p-4 text-red-500",children:E}):S.length===0?e.jsx("div",{className:"p-4 text-gray-500 dark:text-gray-400",children:"No traces found."}):e.jsx("div",{className:"space-y-2",children:S.map(a=>e.jsxs("div",{className:`p-4 rounded-lg cursor-pointer hover:bg-accent/50 ${(t==null?void 0:t.id)===a.id?"bg-accent/50 border border-accent":"border"}`,onClick:()=>{_(a),A(null)},children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"font-medium",children:a.crew_name}),e.jsx(u,{variant:a.status==="completed"?"outline":a.status==="running"?"default":"destructive",children:a.status})]}),e.jsxs("div",{className:"flex justify-between items-center text-xs text-muted-foreground mt-1",children:[e.jsx("div",{children:d(a.start_time)}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{children:[Object.keys(a.agents).length," agents"]}),e.jsxs("span",{children:[Object.keys(a.tasks).length," tasks"]})]})]})]},a.id))}),R=()=>{if(!t)return null;const a=Object.keys(t.agents).length,s=Object.keys(t.tasks).length,i=t.events.length,m=Object.values(t.agents).filter(c=>c.status==="completed").length,n=Object.values(t.tasks).filter(c=>c.status==="completed").length;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(h,{children:e.jsxs(g,{className:"pt-6",children:[e.jsx("div",{className:"text-2xl font-bold",children:a}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Agents (",m," completed)"]})]})}),e.jsx(h,{children:e.jsxs(g,{className:"pt-6",children:[e.jsx("div",{className:"text-2xl font-bold",children:s}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Tasks (",n," completed)"]})]})}),e.jsx(h,{children:e.jsxs(g,{className:"pt-6",children:[e.jsx("div",{className:"text-2xl font-bold",children:i}),e.jsx("div",{className:"text-sm text-gray-500",children:"Events"})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Execution Details"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Crew ID"}),e.jsx("div",{className:"text-sm font-mono",children:t.crew_id}),e.jsx("div",{className:"text-sm text-gray-500",children:"Trace ID"}),e.jsx("div",{className:"text-sm font-mono",children:t.id}),e.jsx("div",{className:"text-sm text-gray-500",children:"Status"}),e.jsx("div",{children:e.jsx(u,{className:N(t.status),children:t.status})}),e.jsx("div",{className:"text-sm text-gray-500",children:"Start Time"}),e.jsx("div",{className:"text-sm",children:d(t.start_time)}),t.end_time&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"End Time"}),e.jsx("div",{className:"text-sm",children:d(t.end_time)}),e.jsx("div",{className:"text-sm text-gray-500",children:"Duration"}),e.jsx("div",{className:"text-sm",children:v(t.start_time,t.end_time)})]})]})]}),e.jsxs(h,{children:[e.jsxs(b,{className:"pb-2",children:[e.jsx(w,{className:"text-lg",children:"Execution Timeline"}),e.jsx(I,{children:"A hierarchical view of the execution spans"})]}),e.jsx(g,{children:e.jsx(de,{spans:q,onSpanClick:z})})]}),p&&e.jsxs(h,{children:[e.jsxs(b,{className:"pb-2",children:[e.jsx(w,{className:"text-lg",children:"Span Details"}),e.jsxs(I,{children:["Detailed information for the selected span: ",p.name]})]}),e.jsx(g,{children:e.jsx(ce,{span:p})})]})]})},W=()=>{if(!t)return null;const a=Object.values(t.agents);return a.length===0?e.jsx("div",{className:"p-4 text-gray-500 dark:text-gray-400",children:"No agent data available."}):e.jsx("div",{className:"space-y-4",children:e.jsx(O,{type:"single",collapsible:!0,className:"w-full",children:a.map(s=>e.jsxs(L,{value:s.id,children:[e.jsx($,{className:"hover:bg-gray-50 dark:hover:bg-gray-800/50 px-4",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(u,{className:N(s.status),variant:"outline",children:s.status}),e.jsx("span",{className:"ml-2 font-medium",children:s.name}),e.jsxs("span",{className:"ml-2 text-sm text-gray-500 dark:text-gray-400",children:["(",s.role,")"]})]}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:v(s.start_time,s.end_time)})]})}),e.jsx(M,{className:"px-4 py-2 space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Agent ID"}),e.jsx("div",{className:"text-sm font-mono",children:s.id}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Start Time"}),e.jsx("div",{children:d(s.start_time)}),s.end_time&&e.jsxs("div",{className:"grid grid-cols-2 col-span-2",children:[e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"End Time"}),e.jsx("div",{children:d(s.end_time)})]}),s.output&&e.jsxs("div",{className:"col-span-2",children:[e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:"Output"}),e.jsx("div",{className:"bg-gray-50 dark:bg-gray-800/50 p-2 rounded-md text-sm whitespace-pre-wrap font-mono",children:s.output})]}),s.events.length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:"Events"}),e.jsx("div",{className:"border rounded-md divide-y dark:divide-gray-700 col-span-2",children:s.events.map((i,m)=>e.jsxs("div",{className:"p-2 text-sm hover:bg-gray-50 dark:hover:bg-gray-800/50",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx(u,{variant:"outline",children:i.type}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:d(i.timestamp)})]}),Object.keys(i.data).length>0&&e.jsx("div",{className:"mt-1 text-xs font-mono bg-gray-50 dark:bg-gray-800/50 p-1 rounded",children:JSON.stringify(i.data,null,2)})]},m))})]})]})})]},s.id))})})},G=()=>{if(!t)return null;const a=Object.values(t.tasks);return a.length===0?e.jsx("div",{className:"p-4 text-gray-500 dark:text-gray-400",children:"No task data available."}):e.jsx("div",{className:"space-y-4",children:e.jsx(O,{type:"single",collapsible:!0,className:"w-full",children:a.map(s=>e.jsxs(L,{value:s.id,children:[e.jsx($,{className:"hover:bg-gray-50 dark:hover:bg-gray-800/50 px-4",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(u,{className:N(s.status),variant:"outline",children:s.status}),e.jsx("span",{className:"ml-2 font-medium truncate max-w-md",children:s.description})]}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:v(s.start_time,s.end_time)})]})}),e.jsx(M,{className:"px-4 py-2 space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Task ID"}),e.jsx("div",{className:"text-sm font-mono",children:s.id}),s.agent_id&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Assigned Agent"}),e.jsx("div",{className:"text-sm font-mono",children:s.agent_id})]}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Start Time"}),e.jsx("div",{children:d(s.start_time)}),s.end_time&&e.jsxs("div",{className:"grid grid-cols-2 col-span-2",children:[e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"End Time"}),e.jsx("div",{children:d(s.end_time)})]}),s.output&&e.jsxs("div",{className:"col-span-2",children:[e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:"Output"}),e.jsx("div",{className:"bg-gray-50 dark:bg-gray-800/50 p-2 rounded-md text-sm whitespace-pre-wrap font-mono",children:s.output})]}),s.events.length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:"Events"}),e.jsx("div",{className:"border rounded-md divide-y dark:divide-gray-700 col-span-2",children:s.events.map((i,m)=>e.jsxs("div",{className:"p-2 text-sm hover:bg-gray-50 dark:hover:bg-gray-800/50",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx(u,{variant:"outline",children:i.type}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:d(i.timestamp)})]}),Object.keys(i.data).length>0&&e.jsx("div",{className:"mt-1 text-xs font-mono bg-gray-50 dark:bg-gray-800/50 p-1 rounded",children:JSON.stringify(i.data,null,2)})]},m))})]})]})})]},s.id))})})},Q=e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Traces"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Select a trace to view details"})]}),e.jsx(ie,{className:"h-[500px] border rounded-md",children:e.jsx("div",{className:"p-4",children:H()})})]});return e.jsx(se,{rightSidebar:Q,children:e.jsxs("div",{className:"w-full",children:[e.jsx(te,{crewId:j||void 0}),e.jsx("div",{className:"w-full",children:t?e.jsxs(h,{children:[e.jsx(b,{children:e.jsx(w,{children:t.crew_name})}),e.jsx(g,{children:e.jsxs(ae,{defaultValue:"overview",value:J,onValueChange:K,className:"w-full",children:[e.jsxs(re,{className:"grid grid-cols-3 mb-4",children:[e.jsxs(T,{value:"overview",className:"flex items-center gap-1",children:[e.jsx(ne,{className:"h-4 w-4"}),e.jsx("span",{children:"Overview"})]}),e.jsx(T,{value:"agents",children:"Agents"}),e.jsx(T,{value:"tasks",children:"Tasks"})]}),e.jsx(k,{value:"overview",children:R()}),e.jsx(k,{value:"agents",children:W()}),e.jsx(k,{value:"tasks",children:G()})]})})]}):D?e.jsx("div",{className:"flex justify-center items-center p-8",children:e.jsx(F,{className:"h-8 w-8 animate-spin"})}):e.jsx("div",{className:"text-center p-8 text-gray-500",children:"Select a trace to view details"})})]})})});export{Se as default,ke as meta};
