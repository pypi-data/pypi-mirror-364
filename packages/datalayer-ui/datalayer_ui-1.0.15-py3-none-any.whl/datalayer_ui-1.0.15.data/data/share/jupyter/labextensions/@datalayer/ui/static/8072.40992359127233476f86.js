"use strict";(self.webpackChunk_datalayer_ui=self.webpackChunk_datalayer_ui||[]).push([[8072],{57848:(e,t,s)=>{s.d(t,{A:()=>a});var n=s(16551),o=s.n(n),r=s(1992),i=s.n(r)()(o());i.push([e.id,"/* -----------------------------------------------------------------------------\n| Copyright (c) Jupyter Development Team.\n| Distributed under the terms of the Modified BSD License.\n|---------------------------------------------------------------------------- */\n\n.jp-timelineSliderWrapper .jp-sliderContainer{\n  display: flex;\n  align-items: center;\n}\n\n.jp-Slider {\n  height: 4.5px\n}\n\n#jp-slider-status-bar {\n  display: flex;\n}\n\n.jp-timestampDisplay {\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  gap: 6px;\n}\n\n.jp-restoreBtnContainer {\n  width: 192px;\n}\n\n.jp-ToolbarButtonComponent.jp-restoreBtn {\n  cursor: pointer;\n  color: var(--jp-layout-color2);\n  width: 100%;\n  background: var(--jp-accept-color-normal)\n}\n",""]);const a=i},88072:(e,t,s)=>{s.r(t),s.d(t,{ForkManager:()=>ce,IForkManagerToken:()=>ie,JUPYTER_COLLABORATION_FORK_EVENTS_URI:()=>ae,NotebookCellServerExecutor:()=>x,ROOM_FORK_URL:()=>D,RtcContentProvider:()=>A,TimelineWidget:()=>re,WebSocketAwarenessProvider:()=>S,WebSocketProvider:()=>N,requestAPI:()=>I,requestDocSession:()=>$,requestDocumentTimeline:()=>P,requestUndoRedo:()=>F}),s(92206);var n=s(36669),o=s(64191),r=s(71891),i=s(57882),a=s(46353),c=s(44208),d=s(64781),l=s(5739),h=s(63616),u=s(6653),p=s(42735),m=s(65606);const g=[];g[0]=(e,t,s,n,o)=>{r.zd(e,0);const i=a.VU(t,e,s.doc,s);n&&i===a.Zg&&!s.synced&&(s.synced=!0)},g[3]=(e,t,s,n,o)=>{r.zd(e,1),r.Gu(e,d.X3(s.awareness,Array.from(s.awareness.getStates().keys())))},g[1]=(e,t,s,n,o)=>{d.tQ(s.awareness,i.bo(t),s)},g[2]=(e,t,s,n,o)=>{c.gU(t,s.doc,(e,t)=>v(s,t))};const v=(e,t)=>console.warn(`Permission denied to access ${e.url}.\n${t}`),y=(e,t,s)=>{const n=i.$C(t),o=r.xv(),a=i.cw(n),c=e.messageHandlers[a];return c?c(o,n,e,s,a):console.error("Unable to compute message"),o},_=e=>{if(e.shouldConnect&&null===e.ws){const t=new e._WS(e.url);t.binaryType="arraybuffer",e.ws=t,e.wsconnecting=!0,e.wsconnected=!1,e.synced=!1,t.onmessage=s=>{e.wsLastMessageReceived=o._g();const n=y(e,new Uint8Array(s.data),!0);r.Bw(n)>1&&t.send(r.Fo(n))},t.onerror=t=>{e.emit("connection-error",[t,e])},t.onclose=t=>{e.emit("connection-close",[t,e]),e.ws=null,e.wsconnecting=!1,e.wsconnected?(e.wsconnected=!1,e.synced=!1,d._g(e.awareness,Array.from(e.awareness.getStates().keys()).filter(t=>t!==e.doc.clientID),e),e.emit("status",[{status:"disconnected"}])):e.wsUnsuccessfulReconnects++,setTimeout(_,h.jk(100*h.n7(2,e.wsUnsuccessfulReconnects),e.maxBackoffTime),e)},t.onopen=()=>{e.wsLastMessageReceived=o._g(),e.wsconnecting=!1,e.wsconnected=!0,e.wsUnsuccessfulReconnects=0,e.emit("status",[{status:"connected"}]);const s=r.xv();if(r.zd(s,0),a.ue(s,e.doc),t.send(r.Fo(s)),null!==e.awareness.getLocalState()){const s=r.xv();r.zd(s,1),r.Gu(s,d.X3(e.awareness,[e.doc.clientID])),t.send(r.Fo(s))}},e.emit("status",[{status:"connecting"}])}},w=(e,t)=>{const s=e.ws;e.wsconnected&&s&&s.readyState===s.OPEN&&s.send(t),e.bcconnected&&n.mk(e.bcChannel,t,e)};class f extends l.c{constructor(e,t,s,{connect:i=!0,awareness:c=new d.ww(s),params:l={},WebSocketPolyfill:h=WebSocket,resyncInterval:v=-1,maxBackoffTime:_=2500,disableBc:f=!1}={}){for(super();"/"===e[e.length-1];)e=e.slice(0,e.length-1);const S=u.V(l);this.maxBackoffTime=_,this.bcChannel=e+"/"+t,this.url=e+"/"+t+(0===S.length?"":"?"+S),this.roomname=t,this.doc=s,this._WS=h,this.awareness=c,this.wsconnected=!1,this.wsconnecting=!1,this.bcconnected=!1,this.disableBc=f,this.wsUnsuccessfulReconnects=0,this.messageHandlers=g.slice(),this._synced=!1,this.ws=null,this.wsLastMessageReceived=0,this.shouldConnect=i,this._resyncInterval=0,v>0&&(this._resyncInterval=setInterval(()=>{if(this.ws&&this.ws.readyState===WebSocket.OPEN){const e=r.xv();r.zd(e,0),a.ue(e,s),this.ws.send(r.Fo(e))}},v)),this._bcSubscriber=(e,t)=>{if(t!==this){const t=y(this,new Uint8Array(e),!1);r.Bw(t)>1&&n.mk(this.bcChannel,r.Fo(t),this)}},this._updateHandler=(e,t)=>{if(t!==this){const t=r.xv();r.zd(t,0),a.f7(t,e),w(this,r.Fo(t))}},this.doc.on("update",this._updateHandler),this._awarenessUpdateHandler=({added:e,updated:t,removed:s},n)=>{const o=e.concat(t).concat(s),i=r.xv();r.zd(i,1),r.Gu(i,d.X3(c,o)),w(this,r.Fo(i))},this._exitHandler=()=>{d._g(this.awareness,[s.clientID],"app closed")},p.Ll&&void 0!==m&&m.on("exit",this._exitHandler),c.on("update",this._awarenessUpdateHandler),this._checkInterval=setInterval(()=>{this.wsconnected&&3e4<o._g()-this.wsLastMessageReceived&&this.ws.close()},3e3),i&&this.connect()}get synced(){return this._synced}set synced(e){this._synced!==e&&(this._synced=e,this.emit("synced",[e]),this.emit("sync",[e]))}destroy(){0!==this._resyncInterval&&clearInterval(this._resyncInterval),clearInterval(this._checkInterval),this.disconnect(),p.Ll&&void 0!==m&&m.off("exit",this._exitHandler),this.awareness.off("update",this._awarenessUpdateHandler),this.doc.off("update",this._updateHandler),super.destroy()}connectBc(){if(this.disableBc)return;this.bcconnected||(n.B1(this.bcChannel,this._bcSubscriber),this.bcconnected=!0);const e=r.xv();r.zd(e,0),a.ue(e,this.doc),n.mk(this.bcChannel,r.Fo(e),this);const t=r.xv();r.zd(t,0),a.nh(t,this.doc),n.mk(this.bcChannel,r.Fo(t),this);const s=r.xv();r.zd(s,3),n.mk(this.bcChannel,r.Fo(s),this);const o=r.xv();r.zd(o,1),r.Gu(o,d.X3(this.awareness,[this.doc.clientID])),n.mk(this.bcChannel,r.Fo(o),this)}disconnectBc(){const e=r.xv();r.zd(e,1),r.Gu(e,d.X3(this.awareness,[this.doc.clientID],new Map)),w(this,r.Fo(e)),this.bcconnected&&(n.al(this.bcChannel,this._bcSubscriber),this.bcconnected=!1)}disconnect(){this.shouldConnect=!1,this.disconnectBc(),null!==this.ws&&this.ws.close()}connect(){this.shouldConnect=!0,this.wsconnected||null!==this.ws||(_(this),this.connectBc())}}class S extends f{constructor(e){super(e.url,e.roomID,e.awareness.doc,{awareness:e.awareness}),this._isDisposed=!1,this._awareness=e.awareness,this._user=e.user,this._user.ready.then(()=>this._onUserChanged(this._user)).catch(e=>console.error(e)),this._user.userChanged.connect(this._onUserChanged,this)}get isDisposed(){return this._isDisposed}dispose(){this._isDisposed||(this._user.userChanged.disconnect(this._onUserChanged,this),this._isDisposed=!0,this.destroy())}_onUserChanged(e){this._awareness.setLocalStateField("user",e.identity)}}var b=s(14326),k=s(78635),C=s(55236),U=s(2280);class x{constructor(e){var t;this._serverSettings=null!==(t=e.serverSettings)&&void 0!==t?t:C.ServerConnection.makeSettings()}async runCell({cell:e,notebook:t,notebookConfig:s,onCellExecuted:n,onCellExecutionScheduled:o,sessionContext:r,sessionDialogs:i,translator:a}){var c,d,l;const h=(a=null!=a?a:U.nullTranslator).load("jupyterlab");switch(e.model.type){case"markdown":e.rendered=!0,e.inputHidden=!1,n({cell:e,success:!0});break;case"code":if(r){if(r.isTerminating){await(0,b.showDialog)({title:h.__("Kernel Terminating"),body:h.__("The kernel for %1 appears to be terminating. You can not run any cell for now.",null===(c=r.session)||void 0===c?void 0:c.path),buttons:[b.Dialog.okButton()]});break}if(r.pendingInput)return await(0,b.showDialog)({title:h.__("Cell not executed due to pending input"),body:h.__("The cell has not been executed to avoid kernel deadlock as there is another pending input! Submit your pending input and try again."),buttons:[b.Dialog.okButton()]}),!1;if(r.hasNoKernel&&await r.startKernel()&&i&&await i.selectKernel(r),r.hasNoKernel)return e.model.sharedModel.transact(()=>{e.model.clearExecution()}),!0;const s=null===(l=null===(d=null==r?void 0:r.session)||void 0===d?void 0:d.kernel)||void 0===l?void 0:l.id,a=k.URLExt.join(this._serverSettings.baseUrl,`api/kernels/${s}/execute`),u=e.model.sharedModel.getId(),p=t.sharedModel.getState("document_id"),m={method:"POST",body:JSON.stringify({cell_id:u,document_id:p})};o({cell:e});let g=!1;try{g=(await C.ServerConnection.makeRequest(a,m,this._serverSettings)).ok}catch(t){if(n({cell:e,success:!1}),e.isDisposed)return!1;throw t}return n({cell:e,success:g}),!0}e.model.sharedModel.transact(()=>{e.model.clearExecution()},!1)}return Promise.resolve(!0)}}const R="api/collaboration/session",T="api/collaboration/undo_redo",E="api/collaboration/timeline",D="api/collaboration/fork";async function I(e="",t={}){const s=C.ServerConnection.makeSettings(),n=k.URLExt.join(s.baseUrl,e);let o;try{o=await C.ServerConnection.makeRequest(n,t,s)}catch(e){throw new C.ServerConnection.NetworkError(e)}let r=await o.text();if(r.length>0)try{r=JSON.parse(r)}catch(e){console.error("Not a JSON response body.",o)}if(!o.ok)throw new C.ServerConnection.ResponseError(o,r.message||r);return r}async function $(e,t,s){const n=C.ServerConnection.makeSettings(),o=k.URLExt.join(n.baseUrl,R,encodeURIComponent(s)),r={method:"PUT",body:JSON.stringify({format:e,type:t})};let i;try{i=await C.ServerConnection.makeRequest(o,r,n)}catch(e){throw new C.ServerConnection.NetworkError(e)}let a=await i.text();if(a.length>0)try{a=JSON.parse(a)}catch(e){console.log("Not a JSON response body.",i)}if(!i.ok)throw new C.ServerConnection.ResponseError(i,a.message||a);return a}async function P(e,t,s){const n=C.ServerConnection.makeSettings();let o=k.URLExt.join(n.baseUrl,E,s);o=o.concat(`?format=${e}&&type=${t}`);const r={method:"GET"};let i;try{i=await C.ServerConnection.makeRequest(o,r,n)}catch(e){throw new C.ServerConnection.NetworkError(e)}return i}async function F(e,t,s,n){const o=C.ServerConnection.makeSettings();let r=k.URLExt.join(o.baseUrl,T,encodeURIComponent(e));r=r.concat(`?action=${t}&&steps=${s}&&forkRoom=${n}`);const i={method:"PUT"};let a;try{a=await C.ServerConnection.makeRequest(r,i,o)}catch(e){throw new C.ServerConnection.NetworkError(e)}let c=await a.text();if(c.length>0)try{c=JSON.parse(c)}catch(e){console.log("Not a JSON response body.",a)}if(!a.ok)throw new C.ServerConnection.ResponseError(a,c.message||c);return c}var L=s(67262),j=s(74602);class N{constructor(e){this._onConnectionClosed=e=>{1003===e.code&&(console.error("Document provider closed:",e.reason),(0,b.showErrorMessage)(this._trans.__("Document session error"),e.reason,[b.Dialog.okButton()]),this._sharedModel.dispose())},this._onSync=e=>{e&&(this._yWebsocketProvider&&(this._yWebsocketProvider.off("sync",this._onSync),this._sharedModel.ydoc.getMap("state").set("document_id",this._yWebsocketProvider.roomname)),this._ready.resolve())},this._ready=new L.PromiseDelegate,this._isDisposed=!1,this._path=e.path,this._contentType=e.contentType,this._format=e.format,this._serverUrl=e.url,this._sharedModel=e.model,this._awareness=e.model.awareness,this._yWebsocketProvider=null,this._trans=e.translator;const t=e.user;t.ready.then(()=>{this._onUserChanged(t)}).catch(e=>console.error(e)),t.userChanged.connect(this._onUserChanged,this),this._connect().catch(e=>console.warn(e))}get isDisposed(){return this._isDisposed}get ready(){return this._ready.promise}get contentType(){return this._contentType}get format(){return this._format}dispose(){var e,t,s;this.isDisposed||(this._isDisposed=!0,null===(e=this._yWebsocketProvider)||void 0===e||e.off("connection-close",this._onConnectionClosed),null===(t=this._yWebsocketProvider)||void 0===t||t.off("sync",this._onSync),null===(s=this._yWebsocketProvider)||void 0===s||s.destroy(),this._disconnect(),j.Signal.clearData(this))}async reconnect(){this._disconnect(),this._connect()}async _connect(){const e=await $(this._format,this._contentType,this._path);this._yWebsocketProvider=new f(this._serverUrl,`${e.format}:${e.type}:${e.fileId}`,this._sharedModel.ydoc,{disableBc:!0,params:{sessionId:e.sessionId},awareness:this._awareness}),this._yWebsocketProvider.on("sync",this._onSync),this._yWebsocketProvider.on("connection-close",this._onConnectionClosed)}async connectToForkDoc(e,t){this._disconnect(),this._yWebsocketProvider=new f(this._serverUrl,e,this._sharedModel.ydoc,{disableBc:!0,params:{sessionId:t},awareness:this._awareness})}get wsProvider(){return this._yWebsocketProvider}_disconnect(){var e,t,s;null===(e=this._yWebsocketProvider)||void 0===e||e.off("connection-close",this._onConnectionClosed),null===(t=this._yWebsocketProvider)||void 0===t||t.off("sync",this._onSync),null===(s=this._yWebsocketProvider)||void 0===s||s.destroy(),this._yWebsocketProvider=null}_onUserChanged(e){this._awareness.setLocalStateField("user",e.identity)}}const M="true"===k.PageConfig.getOption("disableRTC");class A extends C.RestContentProvider{constructor(e){super(e),this._onCreate=(e,t)=>{var s,n,o,r,i,a;if("string"!=typeof e.format)return;const c=null===(o=null===(n=null===(s=this._docmanagerSettings)||void 0===s?void 0:s.composite)||void 0===n?void 0:n.autosave)||void 0===o||o;t.awareness.setLocalStateField("autosave",c),null===(r=this._docmanagerSettings)||void 0===r||r.changed.connect(()=>{var e,s,n;const o=null===(n=null===(s=null===(e=this._docmanagerSettings)||void 0===e?void 0:e.composite)||void 0===s?void 0:s.autosave)||void 0===n||n;t.awareness.setLocalStateField("autosave",o)});try{const s=new N({url:k.URLExt.join(this._serverSettings.wsUrl,"api/collaboration/room"),path:e.path,format:e.format,contentType:e.contentType,model:t,user:this._user,translator:this._trans}),n=((null===(i=this._globalAwareness)||void 0===i?void 0:i.getLocalState())||{}).documents||[];n.includes(e.path)||(n.push(e.path),null===(a=this._globalAwareness)||void 0===a||a.setLocalStateField("documents",n));const o=`${e.format}:${e.contentType}:${e.path}`;this._providers.set(o,s),t.changed.connect(async(s,n)=>{var o;if(!n.stateChange)return;const r=n.stateChange.filter(e=>"hash"===e.name);if(0===r.length)return;r.length>1&&console.error("Unexpected multiple changes to hash value in a single transaction");const i=r[0],a=null!==(o=t.state.path)&&void 0!==o?o:e.path,c=await this.get(a,{content:!1});this._ydriveFileChanged.emit({type:"save",newValue:{...c,hash:i.newValue},oldValue:{hash:i.oldValue}})}),t.disposed.connect(()=>{var t,s;const n=this._providers.get(o);n&&(n.dispose(),this._providers.delete(o));const r=((null===(t=this._globalAwareness)||void 0===t?void 0:t.getLocalState())||{}).documents||[],i=r.indexOf(e.path);i>-1&&r.splice(i,1),null===(s=this._globalAwareness)||void 0===s||s.setLocalStateField("documents",r)})}catch(t){console.error(`Failed to open websocket connection for ${e.path}.\n:${t}`)}},this._saveCounter=0,this._ydriveFileChanged=new j.Signal(this),this._user=e.user,this._trans=e.trans,this._globalAwareness=e.globalAwareness,this._serverSettings=e.serverSettings,this.sharedModelFactory=new W(this._onCreate),this._providers=new Map,this._docmanagerSettings=e.docmanagerSettings}get providers(){return this._providers}async get(e,t){if(t&&t.format&&t.type){const s=`${t.format}:${t.type}:${e}`,n=this._providers.get(s);if(n){const[s]=await Promise.all([super.get(e,{...t,content:!1}),n.ready]);return{...s,format:t.format}}}return super.get(e,t)}async save(e,t={}){var s;if(t.format&&t.type){const n=`${t.format}:${t.type}:${e}`,o=this._providers.get(n),a=++this._saveCounter;if(o){const n=null===(s=o.wsProvider)||void 0===s?void 0:s.ws;if(n){const e=new L.PromiseDelegate,t=t=>{const s=new Uint8Array(t.data),n=i.$C(s);try{if(2!==i.cw(n))return}catch(e){return}const o=i.t3(n);let r=null;try{r=JSON.parse(o)}catch(e){console.debug("The raw reply received was not a JSON reply")}r&&"save"===r.type&&r.responseTo===a&&("success"===r.status?e.resolve():"failed"===r.status?e.reject("Saving failed"):"skipped"===r.status?e.reject("Saving already in progress"):e.reject("Unrecognised save reply status"))};n.addEventListener("message",t);const s=r.xv();r.zd(s,2),r.Qj(s,"save"),r.zd(s,a);const o=r.Fo(s);n.send(o),await e.promise,n.removeEventListener("message",t)}const c={type:t.type,format:t.format,content:!1};return this.get(e,c)}}return super.save(e,t)}get fileChanged(){return this._ydriveFileChanged}}class W{constructor(e){this._onCreate=e,this.collaborative=!M,this.documentFactories=new Map}registerDocumentFactory(e,t){if(this.documentFactories.has(e))throw new Error(`The content type ${e} already exists`);this.documentFactories.set(e,t)}createNew(e){if("string"==typeof e.format){if(this.collaborative&&e.collaborative&&this.documentFactories.has(e.contentType)){const t=this.documentFactories.get(e.contentType)(e);return this._onCreate(e,t),t}}else console.warn(`Only defined format are supported; got ${e.format}.`)}}var B=s(93345),O=s.n(B),z=s(48318),J=s.n(z),H=s(25879),q=s.n(H),G=s(10237),K=s.n(G),V=s(74862),X=s.n(V),Q=s(51050),Y=s.n(Q),Z=s(68495),ee=s.n(Z),te=s(57848),se={};se.styleTagTransform=ee(),se.setAttributes=X(),se.insert=K().bind(null,"head"),se.domAPI=q(),se.insertStyleElement=Y(),J()(te.A,se),te.A&&te.A.locals&&te.A.locals;var ne=s(54250);const oe=({apiURL:e,provider:t,contentType:s,format:n,documentTimelineUrl:o})=>{const[r,i]=(0,B.useState)({roomId:"",timestamps:[],forkRoom:"",sessionId:""}),[a,c]=(0,B.useState)(r.timestamps.length-1),[d,l]=(0,B.useState)(!1),[h,u]=(0,B.useState)(!1),p=(0,B.useRef)(!0),m=(0,B.useRef)(!0),g=(0,B.useRef)(null);function v(e){try{const t=new URL(e).pathname,s=t.lastIndexOf(o);if(-1===s)throw new Error(`API segment "${o}" not found in URL.`);return t.slice(s+o.length)}catch(e){return console.error("Invalid URL or unable to extract filename:",e),""}}return O().createElement("div",{className:"jp-sliderContainer"},O().createElement("div",{onClick:()=>{!async function(o){try{if(p.current){const r=await P(n,s,o);if(!r.ok)throw 404===r.status?new Error("Not found"):503===r.status?new Error("WebSocket closed"):new Error(`Failed to fetch data: ${r.statusText}`);const a=await r.text();let d={roomId:"",timestamps:[],forkRoom:"",sessionId:""};return a&&(b.Notification.warning("Document is now in read-only mode. Changes will not be saved.",{autoClose:2500}),d=JSON.parse(a),i(d),c(d.timestamps.length-1),t.connectToForkDoc(d.forkRoom,d.sessionId),g.current=await $(n,s,v(e))),l(!0),p.current=!1,d}}catch(e){console.error("Error fetching data:",e)}}(v(e))},className:"jp-mod-highlighted",title:"Document Timeline"},O().createElement(ne.historyIcon.react,{marginRight:"4px"})),d&&O().createElement("div",{className:"jp-timestampDisplay"},O().createElement("input",{type:"range",min:0,max:r.timestamps.length-1,value:a,onChange:async e=>{const t=parseInt(e.target.value),s=Math.abs(t-a);try{const e=function(e){return e<a?"undo":"redo"}(t);if(c(t),m.current&&(u(!0),m.current=!1),!g.current)return void console.error("Session is not initialized");await F(`${g.current.format}:${g.current.type}:${g.current.fileId}`,e,s,r.forkRoom)}catch(e){console.error("Error fetching or applying updates:",e)}},className:"jp-Slider"}),O().createElement("div",null,O().createElement("strong",null,v(e).split("/").pop()," ")," "),h&&O().createElement("div",{className:"jp-restoreBtnContainer"},O().createElement("button",{onClick:async()=>{if(!g.current)return void console.error("Session is not initialized");const e=await F(`${g.current.format}:${g.current.type}:${g.current.fileId}`,"restore",0,r.forkRoom);200===e.code?(b.Notification.success(e.status,{autoClose:4e3}),t.reconnect(),l(!1),p.current=!0):b.Notification.error(e.status,{autoClose:4e3})},className:"jp-ToolbarButtonComponent jp-restoreBtn"},"Restore version"," ",(e=>{const t=new Date(1e3*e);return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")} ${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}:${String(t.getSeconds()).padStart(2,"0")}`})(r.timestamps[a])))))};class re extends b.ReactWidget{constructor(e,t,s,n,o){super(),this.apiURL=e,this.provider=t,this.contentType=s,this.format=n,this.documentTimelineUrl=o,this.addClass("jp-timelineSliderWrapper")}render(){return B.createElement(oe,{key:this.apiURL,apiURL:this.apiURL,provider:this.provider,contentType:this.contentType,format:this.format,documentTimelineUrl:this.documentTimelineUrl})}updateContent(e,t){this.apiURL=e,this.provider=t,this.contentType=this.provider.contentType,this.format=this.provider.format,this.update()}}const ie=new L.Token("@jupyter/docprovider:IForkManagerToken"),ae="https://schema.jupyter.org/jupyter_collaboration/fork/v1";class ce{constructor(e){this._disposed=!1,this._forkAddedSignal=new j.Signal(this),this._forkDeletedSignal=new j.Signal(this);const{contentProvider:t,eventManager:s}=e;this._contentProvider=t,this._eventManager=s,this._eventManager.stream.connect(this._handleEvent,this)}get isDisposed(){return this._disposed}get forkAdded(){return this._forkAddedSignal}get forkDeleted(){return this._forkDeletedSignal}dispose(){var e;this._disposed||(null===(e=this._eventManager)||void 0===e||e.stream.disconnect(this._handleEvent),this._disposed=!0)}async createFork(e){const{rootId:t,title:s,description:n,synchronize:o}=e,r={method:"PUT",body:JSON.stringify({title:s,description:n,synchronize:o})},i=k.URLExt.join(D,t);return await I(i,r)}async getAllForks(e){const t=k.URLExt.join(D,e);return await I(t,{method:"GET"})}async deleteFork(e){const{forkId:t,merge:s}=e,n=k.URLExt.join(D,t),o=k.URLExt.objectToQueryString({merge:s});await I(`${n}${o}`,{method:"DELETE"})}getProvider(e){const{documentPath:t,format:s,type:n}=e,o=this._contentProvider;if(o){const e=t;return o.providers.get(`${s}:${n}:${e}`)}}_handleEvent(e,t){if(t.schema_id===ae)switch(t.action){case"create":this._forkAddedSignal.emit(t);break;case"delete":this._forkDeletedSignal.emit(t)}}}}}]);