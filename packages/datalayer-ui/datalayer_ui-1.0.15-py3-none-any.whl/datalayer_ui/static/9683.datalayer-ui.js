"use strict";(self.webpackChunk_datalayer_ui=self.webpackChunk_datalayer_ui||[]).push([[9683],{46916:(e,t,n)=>{n.d(t,{E:()=>l});var s=n(71791),r=n(99180),a=n(38621),i=n(9387),o=n(18683);function l(e){const{commandRegistry:t,runtimeDesc:n,save:l,sessionConnection:c}=e,[d,u]=(0,i.useState)();return(0,i.useEffect)(()=>{const e=()=>{u(c?.kernel?.status)};return e(),c?.statusChanged.connect(e),c?.connectionStatusChanged.connect(e),()=>{c?.statusChanged.disconnect(e),c?.connectionStatusChanged.disconnect(e)}},[c]),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(r.Q,{variant:"invisible",size:"small",leadingVisual:a.udU,disabled:!n?.location||"busy"===d,onClick:e=>t?.execute(s.nx.runAll),children:"Run all"}),(0,o.jsx)(r.Q,{variant:"invisible",size:"small",leadingVisual:a.wFz,disabled:!n?.location||"busy"!==d,onClick:e=>t?.execute(s.nx.interrupt),children:"Interrupt"})]})}},49683:(e,t,n)=>{n.r(t),n.d(t,{NotebookEdit:()=>ht,default:()=>gt});var s=n(9387),r=n(20568),a=n(97789),i=n(16950),o=n(53330),l=n(3345),c=n(49261),d=n(99180),u=n(15115),m=n(58875),p=n(80736),h=n(93054),g=n(48453),x=n(84514),f=n(24860),v=n(92243),j=n(3556),b=n(80006),y=n(38621),k=n(32916),C=n(42389),w=n(16476),S=n(2159),A=n(5700),_=n(2606),N=n(73553),I=n(9403),R=n(18683);const $=e=>{const{data:t,fileName:n,variant:s,extension:r}=e;return(0,R.jsx)(d.Q,{variant:s,leadingVisual:y.s3U,onClick:e=>(0,I.xD)(t,n,r),children:"Download"})};$.defaultProps={variant:"default",name:"data",extension:"json"};var M=n(154),T=n(50596),P=n(88106),U=n(59179),D=n(5279),E=n(98754),L=n(65047),O=n(63948),V=n(43),W=n(50787),z=n(26690),F=function(e){return e[e.None=0]="None",e[e.New=1]="New",e[e.Transfer=2]="Transfer",e}(F||{});function B(e){const{assignRuntime:t,sessionConnection:n}=e,{runtimeModels:r,multiServiceManager:a,jupyterLabAdapter:i}=(0,z.c6)(),[o,l]=(0,s.useState)(),[c,m]=(0,s.useState)({}),[h,g]=(0,s.useState)(F.None),[x,f]=(0,s.useState)("");(0,s.useEffect)(()=>{if(n){function e(e){f(`Runtime ${e.kernel?.connectionStatus} - Status: ${e.kernel?.status}`)}return e(n),n?.statusChanged.connect(e),n?.connectionStatusChanged.connect(e),()=>{n?.statusChanged.disconnect(e),n?.connectionStatusChanged.disconnect(e)}}f("No kernel")},[n]);const v=(0,s.useCallback)(async()=>{a?.remote?.runtimesManager&&await a.remote.runtimesManager.refresh()},[a?.remote?.runtimesManager]),j=(0,s.useCallback)(()=>{g(F.New)},[]),b=(0,s.useCallback)(e=>{if(e)switch(h){case F.New:v().then(()=>{l("remote"),t({runtimeDesc:e,runtimeModel:a?.remote?.runtimesManager.get().find(t=>t.id===e.kernelId)})});break;case F.Transfer:l("remote"),t({runtimeDesc:e,transferState:!0})}g(F.None)},[v,a?.remote,h]);return(0,s.useEffect)(()=>{i?Promise.all([i.jupyterLab.resolveOptionalService(D.co),i.jupyterLab.resolveOptionalService(U.zG)]).then(e=>{m({[D.co.name]:e[0],[U.zG.name]:e[1]})}):m({})},[i]),(0,R.jsxs)(R.Fragment,{children:[(0,R.jsxs)(u.W,{children:[(0,R.jsx)(u.W.Button,{leadingVisual:()=>{switch(o){case"browser":return(0,R.jsx)(O.A,{});case"remote":return(0,R.jsx)(y.hpF,{});case void 0:return(0,R.jsx)(y.bMW,{})}return(0,R.jsx)(M.Cx,{type:"runtime"})},trailingVisual:()=>n?(0,R.jsx)(E.A,{sx:{paddingTop:"5px"},children:(0,R.jsx)(P.T1,{kernel:n.kernel})}):(0,R.jsx)(R.Fragment,{}),size:"small",variant:"invisible",children:(0,R.jsx)(L.m,{text:x,direction:"s",children:(0,R.jsx)(d.Q,{variant:"invisible",size:"small",children:n?.kernel?.name??"Runtimes"})})}),(0,R.jsx)(u.W.Overlay,{width:"medium",children:(0,R.jsxs)(p.l,{selectionVariant:"single",showDividers:!0,children:[(0,R.jsxs)(p.l.Group,{children:[(0,R.jsxs)(p.l.Item,{selected:void 0===o&&void 0===n,onSelect:()=>{l(void 0),t({runtimeDesc:void 0})},children:[(0,R.jsx)(p.l.LeadingVisual,{children:(0,R.jsx)(y.bMW,{})}),"Viewer",(0,R.jsx)(p.l.Description,{variant:"block",children:"A simple Notebook Viewer without Runtime."})]}),(0,R.jsxs)(p.l.Item,{selected:"browser"===o,onSelect:()=>{l("browser"),t({runtimeDesc:{name:"pyodide",location:"browser",language:"python"}})},children:[(0,R.jsx)(p.l.LeadingVisual,{children:(0,R.jsx)(O.A,{})}),"Browser Runtime",(0,R.jsx)(p.l.Description,{variant:"block",children:"A Browser Runtime based on Pyodide."})]})]}),r.length>0&&(0,R.jsxs)(p.l.Group,{children:[(0,R.jsx)(p.l.GroupHeading,{children:"Cloud Runtimes"}),r.map(e=>(0,R.jsxs)(p.l.Item,{selected:n?.kernel?.id===e.id,onSelect:()=>{l("remote"),t({runtimeDesc:{name:e.environment_name,language:"",location:"remote",displayName:e.given_name,kernelId:e.id,burningRate:e.burning_rate,podName:e.pod_name},runtimeModel:e})},children:[(0,R.jsx)(p.l.LeadingVisual,{children:(0,R.jsx)(M.Cx,{type:"runtime"})}),e.given_name,(0,R.jsx)(p.l.Description,{variant:"block",children:e.environment_name})]},e.id))]}),(0,R.jsx)(p.l.Divider,{}),(0,R.jsxs)(p.l.Group,{children:[(0,R.jsxs)(p.l.Item,{selected:!1,onSelect:j,children:[(0,R.jsx)(p.l.LeadingVisual,{children:(0,R.jsx)(V.A,{})}),"Launch a new Runtimeâ€¦"]}),(0,R.jsxs)(p.l.Item,{disabled:"browser"!==o,selected:!1,onSelect:()=>{g(F.Transfer)},title:"Transfer the state of the current Runtime to a new Remote Runtime.",children:[(0,R.jsx)(p.l.LeadingVisual,{children:(0,R.jsx)(y.e0J,{})}),"Transfer state to a new Runtimeâ€¦"]})]})]})})]}),a?.remote&&h>0&&(0,R.jsx)(W.s,{dialogTitle:h===F.Transfer?"Switch to a new Cloud Runtime":void 0,manager:a.remote,onSubmit:b,markdownParser:c[D.co.name],sanitizer:c[U.zG.name],startKernel:h===F.Transfer?"defer":h===F.New})]})}var G=n(59651),K=n(46343),H=n(11471),Q=n(92664),J=n(10680),q=n(55682),Y=n(97734),X=n(24991),Z=n(47775),ee=n(61783);function te(e){const{children:t,connection:n,podName:r,multiServiceManager:a,disabled:i}=e,{addRuntimeSnapshot:o,runtimesRunUrl:l,runtimeSnapshots:c,setRuntimeSnapshots:d}=(0,z.c6)(),{trackAsyncTask:m}=(0,Y.d)(),[h,g]=(0,s.useState)(!1),[f,v]=(0,s.useState)(!1),[j,b]=(0,s.useState)(!1),[y,k]=(0,s.useState)(c[0]?.id??""),[C,w]=(0,s.useState)();(0,s.useEffect)(()=>{(0,X.v2)().then(e=>{d(e),!y&&e.length>0&&k(e[0].id)}).catch(e=>{console.error(`Failed to fetch remote kernel snapshots; ${e}`)})},[l]);const S=(0,s.useCallback)(()=>{w(void 0),g(!0)},[]),A=(0,s.useCallback)(e=>{k(e.target.value)},[]),_=(0,s.useCallback)(async({id:e,connection:t,podName:n})=>{n?await(0,X.Wm)({id:n,from:e}):t&&await(0,Z.M)({connection:t,id:e})},[]),N=(0,s.useCallback)(async()=>{try{let e,t;b(!0);let s="",i="";if(r&&a?.remote)i=(0,ee.m)("cloud"),t=a.remote.runtimesManager.snapshot({podName:r,name:i,description:i,stop:!1}),s=r.split("-",2).reverse()[0],t.then(t=>{e=t});else if(n&&a?.browser){const r=n.model;s=r.id,i=(0,ee.m)("browser");let o=!0;t=(0,Z._)({connection:a.browser.kernels.connectTo({model:r}),metadata:{filename:`${i}.data`},onUploadProgress:()=>{o&&(o=!1,(0,X.v2)().then(t=>{e=t.find(e=>e.name===i)}))}})}t&&(m(t,{error:{message:(e,t)=>"Empty snapshot"===e?`Runtime ${s} will not be snapshotted as it does not contain any serializable state.`:`Failed to pause runtime ${s} - ${e}`},pending:{message:`Taking a snapshot of runtime ${s}â€¦`},success:{message:()=>`Runtime ${s} successfully snapshotted as ${i}.`}}),await t,e&&o(e))}finally{b(!1)}},[n,r,a]);return(0,R.jsxs)(R.Fragment,{children:[(0,R.jsxs)(u.W,{children:[(0,R.jsx)(u.W.Button,{leadingVisual:K.A,variant:"invisible",size:"small",disabled:f||j||i,children:t}),(0,R.jsx)(u.W.Overlay,{children:(0,R.jsxs)(p.l,{children:[(0,R.jsx)(p.l.Item,{onSelect:S,disabled:f||0===c.length,children:"Load a runtime snapshotâ€¦"}),(0,R.jsx)(p.l.Item,{onSelect:N,disabled:j,children:"Take a runtime snapshot"})]})})]}),h&&(0,R.jsx)(q.l,{title:"Choose a runtime snapshot to load",onClose:()=>{g(!1)},footerButtons:[{buttonType:"default",content:"Cancel",onClick:e=>{e.defaultPrevented||(e.preventDefault(),g(!1))}},{buttonType:"primary",content:f?(0,R.jsx)(H.A,{size:"small"}):"Load",disabled:f,onClick:async e=>{if(!e.defaultPrevented){e.preventDefault(),v(!0);try{w(void 0);const e=c.find(e=>e.id===y);e&&(n||r)?await _({connection:n,id:e.id,podName:r}):w("No runtime snapshot found.")}finally{v(!1),g(!1)}}},autoFocus:!0}],children:(0,R.jsxs)(E.A,{as:"form",children:[(0,R.jsxs)(x.A,{children:[(0,R.jsx)(x.A.Label,{children:"Snapshot"}),(0,R.jsx)(Q.A,{name:"snapshot",value:y,onChange:A,block:!0,children:c.map(e=>(0,R.jsx)(Q.A.Option,{value:e.id,children:e.name?`${e.name} (${e.id})`:e.id},e.id))})]}),C&&(0,R.jsx)(J.A,{variant:"danger",children:C})]})})]})}te.defaultProps={disabled:!1};var ne=n(63711),se=n(98238),re=n(6606),ae=n(8222),ie=n(48461),oe=n(55285),le=n(2381);function ce(e,t){let n=e.map(e=>({...e,fileType:t?.getFileTypeForModel(e)}));return n=n.filter(e=>!e.name.startsWith(".")),n.sort((e,t)=>"directory"===e.type&&"directory"!==t.type?-1:"directory"!==e.type&&"directory"===t.type?1:e.name.localeCompare(t.name)),n}function de(e){const{item:t,contents:n,current:r,documentRegistry:a,onContextMenu:i,onSelect:o}=e,l=(0,s.useRef)(null),[c,d]=(0,s.useState)(null),[u,m]=(0,s.useState)(!1),p=(0,s.useCallback)(()=>{m(!0),n.get(t.path).then(e=>{m(!1),d(ce(e.content,a))}).catch(()=>{m(!1)})},[n,t,a]),h=(0,s.useCallback)(async e=>{null===c&&e&&p()},[c,t,n]);return(0,R.jsxs)(re.G.Item,{ref:l,id:`${t.type}-${t.name}`,onExpandedChange:h,onSelect:()=>{o(t,p)},current:t.path===r?.path,children:[(0,R.jsx)(re.G.LeadingVisual,{children:(0,R.jsx)(re.G.DirectoryIcon,{})}),(0,R.jsx)("span",{onContextMenu:e=>{e.preventDefault(),r?.path!==t.path&&o(t,p),i(l)},children:t.name}),(0,R.jsx)(re.G.SubTree,{state:u?"loading":(c?.length??-1)>=0?"done":"initial",children:c?.map(e=>"directory"===e.type?(0,R.jsx)(de,{item:e,contents:n,current:r,documentRegistry:a,onContextMenu:i,onSelect:o},e.name):(0,R.jsx)(ue,{item:e,current:e.path===r?.path,onSelect:e=>o(e,p),onContextMenu:i},e.name))})]})}function ue(e){const{item:t,current:n,onSelect:r,onContextMenu:a}=e,i=(0,s.useRef)(null),o=t.fileType?.icon;return(0,R.jsxs)(re.G.Item,{ref:i,id:`${t.type}-${t.name}`,current:n,onSelect:()=>{r(t)},children:[(0,R.jsx)(re.G.LeadingVisual,{children:o?(0,R.jsx)(o.react,{tag:"span"}):(0,R.jsx)(y.oSV,{})}),(0,R.jsx)("span",{onContextMenu:e=>{e.preventDefault(),n||r(t),a(i)},children:t.name})]},t.name)}const me=1048576;function pe(e){const{contents:t,localContents:n,documentRegistry:r}=e,a=(0,oe.aq)(),{trackAsyncTask:i}=(0,Y.d)(),[o,l]=(0,s.useState)(null),[c,d]=(0,s.useState)(!0),[h,g]=(0,s.useState)(null),[x,f]=(0,s.useState)(null),[v,b]=(0,s.useState)(!1),[y,k]=(0,s.useState)(!1),C=(0,s.useCallback)(()=>{t.get("").then(e=>{d(!1),l(ce(e.content,r))}).catch(e=>{d(!1),console.error(`Failed to fetch folder '' content for manager ${t.serverSettings.appUrl}.`,e)})},[t]);(0,s.useEffect)(()=>{C()},[C]);const w=(0,s.useCallback)(async e=>{const n=()=>{if(!a())return Promise.reject(`Failed to upload ${e.name}; StorageBrowser component is unmounted.`)};n();const s=e.size>me,r=h?"directory"===h.type?h.path:ne.PathExt.dirname(h.path):"",o=r?ne.PathExt.join(r,e.name):e.name,l=e.name,c=async(s,r)=>{n();const a=new FileReader;a.readAsDataURL(s),await new Promise((t,n)=>{a.onload=t,a.onerror=t=>n(`Failed to upload "${e.name}":`+t)}),n();const i=a.result.split(",")[1],c={type:"file",format:"base64",name:l,chunk:r,content:i};return await t.save(o,c)},d={error:{message:t=>{const n=`Failed to upload ${e.name}.`;return console.error(n,t),n}},pending:{message:`Uploading ${e.name}â€¦`},success:{message:()=>`${e.name} uploaded.`}};if(!s){const t=c(e);return i(t,d),t.then(()=>{h?h.refresh():C()}),t}{const t=new se.PromiseDelegate;i(t.promise,d);try{let n;for(let s=0;!n;s+=me){const r=s+me,a=r>=e.size,i=a?-1:r/me,o=await c(e.slice(s,r),i);a&&(n=o,t.resolve(n))}return h?h.refresh():C(),n}catch(e){throw t.reject(e),e}}},[t,h,C]),S=(0,s.useCallback)(e=>{f(x===e?null:e)},[x]),A=(0,s.useCallback)(()=>{b(!0)},[]),_=(0,s.useCallback)(()=>{if(h){const e=t.delete(h.path);i(e,{success:{message:()=>`${h.path} deleted.`},pending:{message:`Deleting ${h.path}â€¦`},error:{message:e=>{const t=`Failed to delete ${h.path}.`;return console.error(t,e),t}}}),e.finally(()=>{h.refresh()})}b(!1)},[t,h]),N=(0,s.useCallback)(()=>{k(!0)},[]),I=(0,s.useCallback)(()=>{h&&n&&t.get(h.path).then(e=>{const t=n?.save(e.path,e);i(t,{success:{message:()=>`${h.path} copied to local.`},pending:{message:`Copying to local ${h.path}â€¦`},error:{message:e=>{const t=`Failed to copy to local ${h.path}.`;return console.error(t,e),t}}}),t.finally(()=>{h.refresh()}),k(!1)})},[n,h]),$=(0,s.useCallback)((e,t)=>{g(e.path===h?.path?null:{...e,refresh:t})},[h]);return(0,R.jsxs)(E.A,{sx:{display:"grid",gridTemplateAreas:'"header" "content"'},children:[(0,R.jsxs)(E.A,{sx:{gridArea:"header",display:"flex",alignItems:"center"},children:[(0,R.jsx)(j.A,{as:"h4",sx:{fontSize:"var(--text-title-size-small)",lineHeight:"var(--text-title-lineHeight-medium)",fontWeight:"var(--text-title-weight-medium)",flex:"1 1 auto"},children:"Contents Browser"}),(0,R.jsxs)(E.A,{children:[(0,R.jsx)(m.K,{variant:"invisible","aria-label":"Refresh contents browser.",title:"Refresh contents browser.",icon:ie.A,onClick:C}),(0,R.jsx)(le.HF,{label:"Upload a file",multiple:!0,upload:w})]})]}),c?(0,R.jsx)(E.A,{sx:{gridArea:"content",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"40px",height:"100vh"},children:(0,R.jsx)(H.A,{})}):(0,R.jsx)(E.A,{sx:{gridArea:"content"},children:o?(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(re.G,{children:o?.map(e=>(e.fileType,"directory"===e.type?(0,R.jsx)(de,{item:e,contents:t,current:h,documentRegistry:r,onContextMenu:S,onSelect:$},e.name):(0,R.jsx)(ue,{item:e,current:h?.path===e.path,onSelect:e=>{$(e,C)},onContextMenu:S},e.name)))}),(0,R.jsx)(u.W,{anchorRef:x??void 0,open:null!==x?.current,onOpenChange:()=>{f(null)},children:(0,R.jsx)(u.W.Overlay,{children:(0,R.jsxs)(p.l,{children:[(0,R.jsx)(p.l.Item,{title:"Delete the active item.",onSelect:A,children:"Deleteâ€¦"}),n&&(0,R.jsx)(p.l.Item,{title:"Copy the active item to the local drive.",onSelect:N,children:"Copy to local driveâ€¦"})]})})}),v&&(0,R.jsx)(q.l,{title:"Confirm deletion",onClose:()=>{b(!1)},footerButtons:[{buttonType:"default",content:"Cancel",onClick:()=>{b(!1)}},{buttonType:"danger",content:"Delete",onClick:()=>{_()}}],children:`Are you sure you want to delete ${h?.path}?`}),y&&(0,R.jsx)(q.l,{title:"Confirm copy to local",onClose:()=>{k(!1)},footerButtons:[{buttonType:"default",content:"Cancel",onClick:()=>{k(!1)}},{buttonType:"danger",content:"Copy to local",onClick:()=>{I()}}],children:`Are you sure you want to copy to local ${h?.path}?`})]}):(0,R.jsx)(ae.E,{children:(0,R.jsx)(ae.E.Heading,{children:"No contents"})})})]})}var he=n(46916),ge=n(26878),xe=n(77606),fe=n(10815),ve=n(68822);const je=28,be="DatalayerSpacer",ye=3e4;var ke=function(e){return e.PROGRESS="var(--borderColor-accent-emphasis)",e.ERROR="var(--borderColor-danger-emphasis)",e.SUCCESS="var(--borderColor-success-emphasis)",e}(ke||{});const Ce={"-1":ke.ERROR,0:ke.PROGRESS,1:ke.SUCCESS};function we({awareness:e,currentUserHandle:t}){const[n,r]=(0,s.useState)([]);return(0,s.useEffect)(()=>{const n=()=>{const n=e.getStates();r(Array.from(n.values()).filter(e=>e.user&&e.user?.name!==t&&!(e.user?.agent??"").startsWith(be)).reduce((e,t)=>{const n=t.user,s=!((t.notification?.timestamp??0)+ye<Date.now()),r=n.agent?{avatarUrl:"https://static.vecteezy.com/system/resources/previews/006/662/139/large_2x/artificial-intelligence-ai-processor-chip-icon-symbol-for-graphic-design-logo-web-site-social-media-mobile-app-ui-illustration-free-vector.jpg",color:n.color,displayName:n.agent,handle:"agent",initials:"AI",username:n.agent,notification:s?`${t.notification?.message} ${(0,fe.g)(new Date(t.notification.timestamp))}`:void 0,notificationType:s&&void 0!==t.notification?.message_type?Ce[t.notification?.message_type.toString()]:void 0}:{avatarUrl:n.avatar_url,color:n.color,displayName:n.display_name,handle:n.name,initials:n.initials,username:n.username};return e.map(e=>e.username).includes(r.username)||e.push(r),e},[]))};n(),e.on("change",n);const s=setInterval(n,ye/3);return()=>{clearInterval(s),e.off("change",n)}},[e,t]),(0,R.jsx)(ge.A,{children:n.map(e=>{let t=`${e.displayName}\n${e.handle}`;return e.notification&&(t+=`\n${e.notification}`),(0,R.jsx)(xe.A,{sx:{border:e.notificationType?`var(--borderWidth-thick) solid ${e.notificationType}`:"none"},title:t,src:e.avatarUrl?(0,ve.$K)(e.avatarUrl):(n=e.color,s=e.initials,"data:image/svg+xml;charset=utf-8,"+encodeURIComponent(`<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><circle cx="12" cy="12" r="12" fill="${n}" stroke="none" /><text x="12" y="12" fill="black">${s}</text></svg>`)),size:je},e.displayName);var n,s})})}var Se=n(17810),Ae=n(23530),_e=n(81390),Ne=n(64991);var Ie=n(48716),Re=n(54087),$e=n(320),Me=n(44536),Te=n(27199),Pe=n(97283),Ue=n(7282);const De=(0,Pe.y)((e,t)=>({datasources:[],updateDatasources:t=>e(e=>({datasources:t}))}));function Ee(e){return(0,Ue.Pj)(De,e)}var Le=n(18491),Oe=n(88037),Ve=n(41630);function We(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class ze extends Oe._Q{constructor(e){super(),We(this,"_rows",void 0),We(this,"_mimeType",void 0),this._mimeType=e.mimeType,this._rows=[]}renderModel(e){const t=e.data[this._mimeType].split("\n").map(e=>e.split(";"));return this._rows=t,Promise.resolve()}render(){return 0===(this._rows.length>0?this._rows[0].length:0)?(0,R.jsx)("div",{children:"No data found!"}):(0,R.jsx)(Ve.NP,{children:this._rows.map(e=>(0,R.jsx)(E.A,{mt:3,children:e}))})}}const Fe={safe:!0,mimeTypes:["application/vnd.datalayer.csv"],createRenderer:e=>new ze(e)};var Be=n(66741),Ge=n(25344),Ke=n(14809),He=n(17310),Qe=n(16181);function Je(e){const{createAIAgent:t}=(0,Ne.w)(),{aiAgents:n,addAIAgent:r}=(0,_e.Ks)(),{cell:a,extensionProps:i}=e,{notebookId:o}=i,[l,c]=(0,s.useState)(!1),[p,h]=(0,s.useState)(),[g,f]=(0,s.useState)({prompt:""}),[j,b]=(0,s.useState)({prompt:void 0});(0,s.useEffect)(()=>{const e=(e,t)=>{if("datalayer"===t.key&&p)for(const e of a.model.sharedModel.getMetadata("datalayer")?.ai?.messages??[])if(e.parent_id===p){h(void 0);break}};return a.model.sharedModel.metadataChanged.connect(e),()=>{a.model?.sharedModel.metadataChanged.disconnect(e)}},[a,p]),(0,s.useEffect)(()=>{p||c(!1)},[p]),(0,s.useEffect)(()=>{b({...j,prompt:void 0===g.prompt?void 0:g.prompt.length>0})},[g]);const k=(0,s.useCallback)(async()=>{const e=i.panel.context.sessionContext.session?.kernel,s=e?.serverSettings,l=e?.id;n.find(e=>e.documentId===o&&e.runtimeId===l)||(await t(o,"notebook_persist",s?.baseUrl,s?.token,l),r({documentId:o,runtimeId:l}));const c=(0,Qe.f)();!function(e,t,n){const s=e.model.getMetadata("datalayer")??{},r=s.ai??{prompts:[],messages:[]},a=r.prompts??[];a.push({id:t,prompt:n,username:void 0,timestamp:Date.now()}),r.prompts=a,s.ai=r,e.model.setMetadata("datalayer",s)}(a,c,g.prompt),h(c)},[n,a,i.panel.context.sessionContext.session?.kernel,g.prompt,o,t]),C=(0,s.useCallback)(e=>{e.ctrlKey&&"Enter"===e.key&&k()},[k]);return(0,R.jsx)(Ve.NP,{children:(0,R.jsx)(E.A,{display:"flex",style:{justifyContent:"right"},children:(0,R.jsx)(E.A,{className:"dla-Cell-ai-agent-button",children:(0,R.jsxs)(u.W,{open:l,onOpenChange:e=>c(e),children:[(0,R.jsx)(u.W.Anchor,{id:"custom-anchor-id",children:(0,R.jsx)(m.K,{icon:y.SD8,variant:"invisible","aria-label":"AI Agents menu"})}),(0,R.jsx)(u.W.Overlay,{width:"large",children:(0,R.jsxs)(E.A,{as:"form",m:3,children:[(0,R.jsxs)(x.A,{children:[(0,R.jsx)(x.A.Label,{visuallyHidden:!0}),(0,R.jsx)(v.Ay,{block:!0,value:g.prompt,onChange:e=>{f(t=>({...t,prompt:e.target.value}))},disabled:!!p,onKeyDown:C})]}),(0,R.jsxs)(E.A,{sx:{display:"flex",width:"100%",gap:"2px",marginTop:"var(--stack-gap-normal)"},children:[(0,R.jsx)(E.A,{flexGrow:1}),(0,R.jsx)(d.Q,{onClick:e=>c(!1),variant:"default",children:"Cancel"}),(0,R.jsx)(d.Q,{leadingVisual:He.A,onClick:k,disabled:!j.prompt||!!p,variant:"primary",children:p?(0,R.jsx)(H.A,{size:"small"}):"Ask AI"})]})]})})]})})})})}var qe=n(94247);const Ye=e=>{const{cell:t}=e,{datasources:n}=Ee(),[r,a]=(0,s.useState)(),[i,o]=(0,s.useState)("df");(0,s.useEffect)(()=>{const e=(e,t)=>{if("datalayer"===(t?.key??"datalayer")){const t=(e=>{const t=e.getMetadata("datalayer");if(t){const e=t.datasource;if(e)return e.id}})(e);if(t)for(const e of n)if(t===e.id){a(t);break}}};return e(t.model),t.model.metadataChanged.connect(e),()=>{t.model?.metadataChanged.disconnect(e)}},[t,n]);const l=e=>{const n=t.model.getMetadata("datalayer");e?(t.model.setMetadata("datalayer",{...n,sql:!0,datasource:{id:e.id,variant:e.variant,name:e.name,description:e.description,database:e.database,outputBucket:e.outputBucket,destinationVar:i??"df"}}),a(e.id),t.editor.model.mimeType=qe.bd):(t.model.setMetadata("datalayer",{...n,sql:!1,datasource:{}}),a(void 0),t.editor.model.mimeType=qe.dC)};return(0,R.jsx)(Ve.NP,{children:(0,R.jsx)(T.a,{display:"flex",style:{justifyContent:"right"},children:(0,R.jsx)(T.a,{className:"dla-Cell-datasource-button",children:(0,R.jsxs)(u.W,{children:[(0,R.jsx)(u.W.Anchor,{id:"custom-anchor-id",children:(0,R.jsx)(m.K,{icon:y.bN0,variant:"invisible","aria-label":"Open Datasources menu"})}),(0,R.jsx)(u.W.Overlay,{width:"medium",children:(0,R.jsx)(p.l,{selectionVariant:"single",showDividers:!0,children:(0,R.jsxs)(p.l.Group,{children:[(0,R.jsx)(p.l.GroupHeading,{children:"Datasources"}),0===n.length&&(0,R.jsxs)(p.l.Item,{onSelect:()=>{},children:["No Datasource available",(0,R.jsx)(p.l.Description,{variant:"block",children:"Create a new Datasource to connect your cell."})]}),n.map(e=>(0,R.jsxs)(p.l.Item,{onSelect:()=>l(e),selected:e.id===r,children:[e.name,(0,R.jsx)(p.l.Description,{variant:"block",children:e.description})]},e.id)),(0,R.jsx)(p.l.Divider,{}),(0,R.jsx)(p.l.Item,{onSelect:e=>{e.preventDefault()},children:(0,R.jsxs)(x.A,{children:[(0,R.jsx)(x.A.Label,{children:"Destination variable"}),(0,R.jsx)(f.A,{size:"small",value:i,disabled:!r,onChange:e=>(e=>{o(e);const n=t.model.getMetadata("datalayer");t.model.setMetadata("datalayer",{...n,sql:!0,datasource:{...n.datasource,destinationVar:e??"df"}})})(e.target.value)})]})}),(0,R.jsx)(p.l.Divider,{}),(0,R.jsx)(p.l.Item,{variant:"danger",onSelect:()=>l(void 0),children:"None"})]})})})]})})})})};function Xe(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const Ze="dla-CellToolbar-Container";class et extends Oe._Q{constructor(e,t){super(),Xe(this,"_cell",void 0),Xe(this,"_props",void 0),this._cell=e,this._props=t,this.addClass(Ze)}render(){return(0,R.jsxs)(T.a,{display:"flex",children:[(0,R.jsx)(T.a,{flexGrow:1}),(0,R.jsxs)(r.fS,{initialEntries:["/"],children:[(0,R.jsx)(r.BV,{children:(0,R.jsx)(r.qh,{path:"*",element:(0,R.jsx)(Je,{cell:this._cell,extensionProps:this._props})})}),(0,R.jsx)(Ye,{cell:this._cell,extensionProps:this._props})]})]})}}function tt(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class nt extends Ke.x0{constructor(e,t){super(),tt(this,"_panel",void 0),tt(this,"_props",void 0),this._panel=e,this._props=t,this.updateConnectedCell=this.updateConnectedCell.bind(this);const n=()=>{const e=this._panel.content.model?.cells;if(e){e.changed.connect(this.updateConnectedCell);for(let t=0;t<e.length;++t)this._registerCellChanges(e.get(t))}};n(),this._panel.content.modelChanged.connect(()=>{n()})}updateConnectedCell(e,t){t.oldValues.forEach(this._deregisterCellChanges.bind(this)),t.newValues.forEach(this._registerCellChanges.bind(this))}_deregisterCellChanges(e){}_registerCellChanges(e){const t=this._getCodeCell(e);t?(t.displayChanged.connect(()=>{this._updateCodeCell(t)}),t.inViewportChanged.connect(()=>{this._updateCodeCell(t)}),this._updateCodeCell(t)):"code"===e.type&&console.error(`Could not find code cell for model: ${e}`)}_getCodeCell(e){return"code"===e.type?this._panel.content.widgets.find(t=>t.model===e):null}_updateCodeCell(e){if(e.inputArea){const t=e.layout;if(t){const n=t;n.widgets[1].hasClass(Ze)||n.insertWidget(1,new et(e,this._props))}}}}class st{constructor(){var e,t,n;e=this,n=void 0,(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t="_props"))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}init(e){this._props=e}createNew(e,t){new nt(e,this._props)}get component(){return null}}var rt=n(56230),at=n(10481),it=n(78989),ot=n(22619);const lt=({isOpen:e,chevronClasses:t})=>(0,R.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:`${t.base} ${e?t.open:""} ${t.hover}`,stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:(0,R.jsx)("polyline",{points:"9 18 15 12 9 6"})});function ct({status:e,name:t="",args:n,result:r}){const[a,i]=(0,s.useState)(!1),o={container:"bg-white rounded-xl overflow-hidden w-full border-2 border-gray-200 shadow-md transition-all duration-200 hover:shadow-xl my-1",header:"p-4 flex items-center cursor-pointer group bg-gray-50 border-b border-gray-200",title:"text-gray-900 font-semibold overflow-hidden text-ellipsis",statusContainer:"ml-auto flex items-center gap-2",statusText:"text-xs text-gray-700 font-medium mr-1",content:"px-5 pb-5 pt-3 text-gray-800 font-mono text-xs",section:"mb-4",sectionTitle:"text-gray-700 text-xs uppercase tracking-wider mb-2 font-sans font-bold",codeBlock:"whitespace-pre-wrap max-h-[200px] overflow-auto text-gray-900 bg-gray-50 p-3 rounded border border-gray-200",chevron:{base:"text-gray-700 mr-2 transition-transform duration-200",open:"rotate-90",hover:"group-hover:text-gray-900"},contentWrapper:{base:"overflow-hidden transition-all duration-300 ease-in-out",open:"max-h-[600px] opacity-100",closed:"max-h-0 opacity-0"}},l={complete:"bg-emerald-500 shadow-emerald-500/40",inProgress:"bg-amber-500 shadow-amber-500/40",executing:"bg-blue-500 shadow-blue-500/40"},c=e=>e?"object"==typeof e?(0,R.jsx)("span",{children:JSON.stringify(e,null,2)}):(0,R.jsx)("span",{children:String(e)}):null;return(0,R.jsxs)("div",{className:o.container,children:[(0,R.jsxs)("div",{className:o.header,onClick:()=>i(!a),children:[(0,R.jsx)(lt,{isOpen:a,chevronClasses:o.chevron}),(0,R.jsx)("span",{className:o.title,children:t||"MCP Tool Call"}),(0,R.jsxs)("div",{className:o.statusContainer,children:[(0,R.jsx)("span",{className:o.statusText,children:"complete"===e?"Completed":"inProgress"===e?"In Progress":"Executing"}),(0,R.jsx)("div",{className:`w-3 h-3 rounded-full ${(()=>{const t=l[e].split(" ")[0],n=l[e].split(" ")[1];return`${t} ${"inProgress"===e||"executing"===e?"animate-pulse":""} shadow-[0_0_10px] ${n}`})()}`})]})]}),(0,R.jsx)("div",{className:`${o.contentWrapper.base} ${a?o.contentWrapper.open:o.contentWrapper.closed}`,children:(0,R.jsxs)("div",{className:o.content,children:[(0,R.jsxs)("div",{className:o.section,children:[(0,R.jsx)("div",{className:o.sectionTitle,children:"Name"}),(0,R.jsx)("pre",{className:o.codeBlock,children:t})]}),n&&(0,R.jsxs)("div",{className:o.section,children:[(0,R.jsx)("div",{className:o.sectionTitle,children:"Parameters"}),(0,R.jsx)("pre",{className:o.codeBlock,children:c(n)})]}),"complete"===e&&r&&(0,R.jsxs)("div",{className:o.section,children:[(0,R.jsx)("div",{className:o.sectionTitle,children:"Result"}),(0,R.jsx)("pre",{className:o.codeBlock,children:c(r)})]})]})})]})}n(82231);const dt=e=>{const{copilotkitServerUrl:t,jupyterMCPServerUrl:n}=e,{mcpServers:r,setMcpServers:a}=(0,rt.U)();return(0,s.useEffect)(()=>{n&&t&&a([{endpoint:n}])},[n,t]),(0,at.a)({name:"*",render:({name:e,status:t,args:n,result:s})=>(0,R.jsx)(ct,{status:t,name:e,args:n,result:s})}),(0,it.D)({maxSuggestions:3,instructions:"Give the user a short and concise suggestion based on the conversation and your available tools. If you have no tools, don't suggest anything."}),(0,R.jsx)(R.Fragment,{children:n&&t?(0,R.jsx)(ot.R,{clickOutsideToClose:!1,defaultOpen:!0,labels:{title:"AI Agents",initial:"ðŸ‘‹ Hi, there! You're chatting with an LLM that can use MCP servers.\n\n What can I do for you?"}}):(0,R.jsx)(R.Fragment,{})})},ut=e=>{const{code:t}=e;return(0,R.jsx)("pre",{style:{fontSize:"12px",wordBreak:"break-all",wordWrap:"break-word",whiteSpace:"pre-wrap"},children:t})},mt=e=>{const{roomServer:t,runtimeId:n,runtimeSettings:s}=e;return(0,R.jsxs)(T.a,{children:[(0,R.jsxs)(j.A,{children:[(0,R.jsx)(k.A,{})," MCP Server"]}),(0,R.jsxs)(R.Fragment,{children:[(0,R.jsxs)(T.a,{children:[(0,R.jsx)(b.A,{children:"Start a Jupyter MCP Server"}),(0,R.jsx)(ut,{code:`jupyter-mcp-server start   --transport streamable-http   --provider datalayer   --room-url ${t.baseURL}   --room-id ${t.roomName}   --room-token ${t.token}   --runtime-url ${s.baseUrl}   --start-new-runtime false   --runtime-id ${n}   --runtime-token ${s.token}   --port 4040\n`})]}),(0,R.jsxs)(T.a,{sx:{mb:2},children:[(0,R.jsx)(b.A,{children:"Connect a running Jupyter MCP Server"}),(0,R.jsx)(ut,{code:`jupyter-mcp-server start   --transport streamable-http   --provider datalayer   --start-new-runtime false\n \njupyter-mcp-server connect   --provider datalayer   --room-url ${t.baseURL}   --room-id ${t.roomName}   --room-token ${t.token}   --runtime-url ${s.baseUrl}   --runtime-id ${n}   --runtime-token ${s.token}   --jupyter-mcp-server-url http://localhost:4040\n`})]}),(0,R.jsxs)(T.a,{sx:{mb:2},children:[(0,R.jsx)(b.A,{children:"Run Code on the Runtime"}),(0,R.jsx)(ut,{code:`import os\n\nfrom platform import node\nfrom jupyter_kernel_client import KernelClient\n\nkernel = KernelClient(\n  server_url="${s.baseUrl}",\n  kernel_id="${n}",\n  token="${s.token}"\n)\nkernel.start()\ncode = """import os\nfrom platform import node\nx=f"Hey {os.environ.get('USER', 'Foo Bar')} from {node()}."\nprint(x)\n"""\nreply = kernel.execute(code)\nprint(reply)\nassert reply["execution_count"] > 1\nassert reply["status"] == "ok"\nassert len(reply["outputs"]) > 0\n\n`})]}),(0,R.jsxs)(T.a,{children:[(0,R.jsx)(b.A,{children:"Connect to the Room, add a Cell and run it."}),(0,R.jsx)(ut,{code:`from jupyter_nbmodel_client import NbModelClient, get_notebook_websocket_url\n\nws_url = get_notebook_websocket_url(\n  server_url = "${t.baseURL}",\n  path = "${t.roomName}",\n  token = "${t.token}",\n  provider = "datalayer"\n)\n\nasync with NbModelClient(ws_url) as notebook:\n    cell_index = notebook.add_code_cell("1+1")\n    results = notebook.execute_cell(cell_index, kernel)\n    print(results)\n    assert results["status"] == "ok"\n    assert len(results["outputs"]) > 0\n\n`})]})]})]})},pt=new C.Od;function ht(){const{notebookId:e}=(0,r.g)();if(!e)return(0,R.jsx)(R.Fragment,{});const t=(0,Se.J)(),C=(0,l.S)(),I=(0,Ae.Z)(),P=function(e){const{getAIAgent:t}=(0,Ne.w)(),{aiAgents:n,addAIAgent:r,deleteAIAgent:a,updateAIAgent:i}=(0,_e.Ks)();return(0,s.useEffect)(()=>{let s;const o=setInterval(async()=>{s=new AbortController;try{const o=await t(e,{signal:s.signal});if(!o.success)return void a(e);const l=n.find(t=>t.documentId===e),c=o.agent.runtime?.id;l?l.runtimeId!==c&&i(e,c):r({documentId:e,runtimeId:c})}catch(t){a(e)}},6e4);return()=>{s?.abort("Component unmounted"),clearInterval(o)}},[n,e]),n.find(t=>t.documentId===e)}(e),{checkIsPlatformFeaturesPreviewer:U}=(0,Ie.x)(),D=U(t),{configuration:E}=(0,$e._O)(),{credits:L,token:O}=(0,Me.Y)(),{configuration:V,multiServiceManager:W,jupyterLabAdapter:F,runtimeModels:K}=(0,z.c6)(),[H,Q]=(0,s.useState)(pt),[J,q]=(0,s.useState)(void 0),[ee,ne]=(0,s.useState)(),[se,re]=(0,s.useState)(!1),[ae,ie]=(0,s.useState)(),[oe,le]=(0,s.useState)(!1),[ce,de]=(0,s.useState)(!0),[ue,me]=(0,s.useState)(""),[ge,xe]=(0,s.useState)(null),[fe,ve]=(0,s.useState)(),[je,be]=(0,s.useState)(),[ye,ke]=(0,s.useState)(),[Ce,Pe]=(0,s.useState)(),[Ue,De]=(0,s.useState)(),[Oe,Ve]=(0,s.useState)({name:"",nameConfirm:"",description:""}),[We,ze]=(0,s.useState)({name:void 0,nameConfirm:void 0,description:void 0}),{enqueueToast:Ke,trackAsyncTask:He}=(0,Y.d)(),{selectNotebookModel:Qe,reset:Je}=(0,w.Gx)(),{hideBackdrop:qe,screenCapture:Ye,setItem:Xe,setScreenCapture:Ze,showBackdrop:et,showScreenshot:tt,space:nt,triggerItemsRefresh:rt}=(0,Te.l5)(),{cloneNotebook:at,deleteItem:it,getDatasources:ot,getNotebook:lt,refreshDatasources:ct,refreshNotebook:ut,updateNotebook:ht,updateNotebookModel:gt}=(0,Re.E)(),{updateDatasources:xt}=Ee(),{updateAIAgent:ft}=(0,_e.Ks)(),{patchAIAgent:vt}=(0,Ne.w)(),jt=(0,s.useMemo)(()=>({baseURL:E.spacerRunUrl,token:O,roomName:e,type:"datalayer"}),[E.spacerRunUrl,e,O]),bt=(0,s.useMemo)(()=>[new st,new S._({factory:A.N})],[]),yt=(0,s.useMemo)(()=>new i.J,[]),kt=(0,s.useMemo)(()=>[Fe],[]),Ct=(0,s.useMemo)(()=>(0,Le.Kp)(),[]);(0,s.useEffect)(()=>{(0,Be.wj)()},[]),(0,s.useEffect)(()=>{if(K&&K.length>0&&!ae){const e=K[0];St({runtimeDesc:{name:e.environment_name,language:"",location:"remote",displayName:e.given_name,kernelId:e.id,burningRate:e.burning_rate,podName:e.pod_name},runtimeModel:e})}},[K]),(0,s.useEffect)(()=>{ge&&ge.sharedModel.awareness.setLocalStateField("user",{username:t.id,name:t.handle,display_name:t.displayName,initials:`${t.firstName[0]?.toLocaleUpperCase()??"?"}${t.lastName[0]?.toLocaleUpperCase()||"?"}`,color:Ct,avatar_url:t.avatarUrl})},[ge,t,Ct]),(0,s.useEffect)(()=>(et(),ut(e).then(t=>{if(qe(),t.success){const t=lt(e);t?(ve(t),be(t.nbformat),Xe(t),Ve({name:t.name,nameConfirm:"",description:t.description})):I("/")}else Ke(t.message,{variant:"error"})}).finally(()=>{qe()}),()=>{H.dispose(),ve(void 0),Je(),Xe(void 0)}),[e]),(0,s.useEffect)(()=>{ct().then(e=>{if(e.success){const e=ot();xt(e)}})},[e]),(0,s.useEffect)(()=>{P&&ue&&P.runtimeId!==J&&(vt(e,H.serverSettings.baseUrl,H.serverSettings.token,J),ft(e,J))},[P,J,e,ue,H]),(0,s.useEffect)(()=>{ze({...We,name:void 0===Oe.name?void 0:Oe.name.length>2,nameConfirm:Oe.nameConfirm===fe?.name,description:void 0===Oe.description?void 0:Oe.description.length>2})},[Oe]);const wt=(0,s.useCallback)(async()=>{et(),ht(e,Oe.name,Oe.description).then(e=>{e.success&&(Ke("The notebook is successfully updated.",{variant:"success"}),rt(),ve({...fe,name:Oe.name,description:Oe.description}))}).finally(()=>{qe()})},[e,Oe.name,Oe.description,fe]),St=(0,s.useCallback)(async({runtimeDesc:s,runtimeModel:r,transferState:i})=>{const o=Qe(e);o?.model&&be(o.model.toJSON()),ne(s);const l=s?.location;switch(me(""),l){case void 0:q(void 0),de(!0),re(!1),Q(pt);break;case"browser":if(W?.browser){if(F){if(!F.jupyterLab.hasPlugin("@jupyterlite/pyodide-kernel-extension:kernel")){const e=await Promise.all([n.e(484),n.e(5378)]).then(n.bind(n,28924));F.jupyterLab.registerPluginModule(e)}F.jupyterLab.isPluginActivated("@jupyterlite/pyodide-kernel-extension:kernel")||await F.jupyterLab.activatePlugin("@jupyterlite/pyodide-kernel-extension:kernel")}q(void 0),de(!1),re(!0),Q(W.browser)}else console.error("Unable to use browser kernel. No service manager for it.");break;case"remote":{if(!W?.remote){console.error("Unable to use a remote runtime. No service manager for it.");break}let e;if(i&&H&&H===W?.browser&&ae?.kernel)try{et();let t=!0;const n=ae.kernel.id,s=`pyodide-${n}`,r=(0,Z._)({connection:ae.kernel,metadata:{filename:`${s}.data`},onUploadProgress:()=>{t&&(t=!1,(0,X.v2)().then(t=>{e=t.find(e=>e.name===s)}))}});if(He(r,{error:{message:e=>`Failed to save the browser kernel state. ${e}`},pending:{message:"Saving the browser kernel stateâ€¦"},success:{message:()=>"Browser kernel state saved."}}),await r,!e)throw Error("Unable to find snapshot for pyodide state.");await W.browser.kernels.shutdown(n)}finally{qe()}if(!r){const{name:n,displayName:a,params:i}=s,o=await(W?.remote?.runtimesManager.startNew({environmentName:n,type:"notebook",givenName:a,creditsLimit:i?.creditsLimit??(L?.available??0)/Math.max(V.maxCellRuntimes-K.filter(e=>"cell"!==e.type).length,1),capabilities:i?.capabilities,snapshot:e?.id},{username:t?.handle,handleComms:!0}));r=await W.remote.runtimesManager.findById(o.id),o.dispose()}re(!1),q(r.id),de(!1);const n=W.remote.runtimesManager.getServices(r.pod_name);me(r.pod_name);const o=new a.ServiceManager({contents:n?.contents,kernels:n?.kernels,kernelspecs:n?.kernelspecs,serverSettings:n?.serverSettings,sessions:n?.sessions,events:{dispose:()=>{}},terminals:{connectionFailure:{connect:()=>{}},dispose:()=>{},isAvailable:()=>!1}});Q(o),ke("storage");const l=n?.serverSettings.baseUrl.replace("/jupyter/server","/api/copilotkit")+"/api/copilotkit",c=n?.serverSettings.baseUrl.replace("/jupyter/server","/mcp")+"/mcp/";fetch(c+"../api/connect",{method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({provider:"datalayer",runtime_url:n?.serverSettings.baseUrl,runtime_id:r.id,runtime_token:n?.serverSettings.token,room_url:jt.baseURL,room_id:jt.roomName,room_token:jt.token})}).then(e=>{Ke("Jupyter MCP Server connected successfully.",{variant:"success"}),ke("ai-agents"),De(c),Pe(l)})}}Nt(void 0)},[V,L,F,e,W,K,H,ae]),At=(0,s.useCallback)(async()=>{C({title:"Are you sure?",content:"Please confirm you want to clone this notebook in your private library."}).then(t=>{t&&(et(),at(e).then(e=>{qe(),e.success&&(Ke(e.message,{variant:"success"}),rt(),I("/my-library"))}))})},[C,fe]),_t=(0,s.useCallback)(e=>{xe(e)},[]),Nt=(0,s.useCallback)(e=>{ie(e||void 0)},[]),It=(0,s.useCallback)(()=>{if(!ce&&ge?.cells){et("Saving the notebook...");const t=ge.toJSON();gt(e,t).then(n=>{n.success&&(Ke("The notebook is successfully updated.",{variant:"success"}),ve({...fe,id:e,nbformat:t}))}).finally(()=>{qe()})}},[e,ge,ce]),Rt=(0,s.useCallback)(()=>{ke("storage"!==ye&&H&&H!==pt?"storage":void 0)},[ye,H]);return(0,R.jsxs)(R.Fragment,{children:[(0,R.jsxs)(c.z,{"aria-label":"Notebook Editor",children:[(0,R.jsx)(c.z.TitleArea,{variant:"subtitle",children:(0,R.jsx)(c.z.Title,{children:"Notebook Editor"})}),(0,R.jsx)(c.z.Actions,{children:fe&&nt&&(0,R.jsxs)(T.a,{sx:{flex:"0 0 auto",display:"flex",alignItems:"center"},children:[W?.remote&&ae&&ae.kernel&&(0,R.jsx)(G.m,{kernelId:ae.kernel.id,serviceManager:W.remote,onClick:()=>{I("/runtimes")}},"credits-indicator"),(0,R.jsx)(B,{assignRuntime:St,sessionConnection:ae},"kernel-picker"),(0,R.jsx)(te,{connection:ae?.kernel??void 0,multiServiceManager:W,podName:ue,disabled:void 0===ee?.location,children:"Snapshots"}),(0,R.jsx)(d.Q,{title:"Browse content on the Remote Runtime",variant:"invisible",size:"small",disabled:!H||H===pt,leadingVisual:()=>(0,R.jsx)(M.Cx,{type:"content"}),onClick:Rt,children:"Storage"},"content"),(0,R.jsx)(he.E,{commandRegistry:yt,runtimeDesc:ee,save:It,sessionConnection:ae},"toolbar"),(0,R.jsx)(d.Q,{variant:"invisible",size:"small",leadingVisual:y.tSI,onClick:e=>ke("ai-agents"===ye?void 0:"ai-agents"),children:"AI Agent"},"clone"),(0,R.jsxs)(u.W,{children:[(0,R.jsx)(u.W.Anchor,{children:(0,R.jsx)(m.K,{variant:"invisible",icon:y.tno,"aria-label":"Open menu"})}),(0,R.jsx)(u.W.Overlay,{width:"medium",children:(0,R.jsxs)(p.l,{children:[(0,R.jsxs)(p.l.Item,{onSelect:()=>At(),children:[(0,R.jsx)(p.l.LeadingVisual,{children:(0,R.jsx)(y.Nc$,{})}),"Duplicate"]}),D&&(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(p.l.Divider,{}),(0,R.jsxs)(p.l.Item,{onSelect:()=>{tt()},children:[(0,R.jsx)(p.l.LeadingVisual,{children:(0,R.jsx)(y.rVi,{})}),"Capture Screen"]}),(0,R.jsxs)(p.l.Item,{onSelect:()=>le(!oe),children:[(0,R.jsx)(p.l.LeadingVisual,{children:(0,R.jsx)(M.Cx,{type:"share"})}),"Share"]}),(0,R.jsxs)(p.l.Item,{onSelect:()=>I(`/new/page/notebook/${e}`),children:[(0,R.jsx)(p.l.LeadingVisual,{children:(0,R.jsx)(M.Cx,{type:"page"})}),"Publish"]})]}),(0,R.jsx)(p.l.Divider,{}),(0,R.jsxs)(p.l.Item,{onSelect:()=>ke("mcp-server"===ye?void 0:"mcp-server"),children:[(0,R.jsx)(p.l.LeadingVisual,{children:(0,R.jsx)(k.A,{})}),"MCP Server"]}),(0,R.jsx)(p.l.Divider,{}),(0,R.jsxs)(p.l.Item,{onSelect:()=>ke("properties"===ye?void 0:"properties"),children:[(0,R.jsx)(p.l.LeadingVisual,{children:(0,R.jsx)(y.L64,{})}),"Properties"]})]})})]}),"datalayer"===jt.type&&ge&&(0,R.jsx)(we,{awareness:ge.sharedModel.awareness,currentUserHandle:t.handle},"peers")]})})]}),(0,R.jsxs)(h.O7,{children:[(0,R.jsxs)(h.O7.Content,{"aria-label":"Notebook Editor",width:"full",padding:"none",children:[Ye&&(0,R.jsx)(T.a,{mt:3,children:(0,R.jsxs)(T.a,{display:"flex",children:[(0,R.jsx)(T.a,{children:(0,R.jsx)("img",{src:Ye})}),(0,R.jsx)(T.a,{children:(0,R.jsx)(g.A,{href:"javascript: return false;",onClick:e=>Ze(void 0),children:(0,R.jsx)(y.uv5,{})})})]})}),oe&&(0,R.jsx)(T.a,{sx:{flexGrow:1},children:(0,R.jsx)(Ge.a,{})}),je&&(void 0===ee?.location?(0,R.jsx)(T.a,{sx:{"& .jp-Cell":{marginTop:30}},children:(0,R.jsx)(_.j,{nbformat:je,outputs:!0})}):(0,R.jsx)(T.a,{children:(0,R.jsx)(N.k,{commands:yt,extensions:bt,id:e,collaborationServer:jt,nbformat:je,readonly:ce,renderers:kt,kernelId:J,serviceManager:H,startDefaultKernel:se,height:"calc(100vh - 150px)",maxHeight:"calc(100vh - 150px)",cellSidebarMargin:32,onNotebookModelChanged:_t,onSessionConnection:Nt})}))]}),ye&&(0,R.jsxs)(h.O7.Pane,{"aria-label":"Notebook Sidebar",position:"start",width:"large",children:["storage"===ye&&H.contents&&(0,R.jsx)(pe,{contents:H.contents,documentRegistry:F?.jupyterLab.docRegistry}),"properties"===ye&&(0,R.jsxs)(T.a,{as:"form",sx:{label:{marginTop:2}},children:[(0,R.jsxs)(x.A,{children:[(0,R.jsx)(x.A.Label,{children:"Name"}),(0,R.jsx)(f.A,{block:!0,value:Oe.name,onChange:e=>{Ve(t=>({...t,name:e.target.value}))}}),!1===We.name&&(0,R.jsx)(x.A.Validation,{variant:"error",children:"Name must have more than 2 characters."})]}),(0,R.jsxs)(x.A,{children:[(0,R.jsx)(x.A.Label,{children:"Description"}),(0,R.jsx)(v.Ay,{block:!0,value:Oe.description,onChange:e=>{Ve(t=>({...t,description:e.target.value}))}}),!1===We.description&&(0,R.jsx)(x.A.Validation,{variant:"error",children:"Description must have more than 2 characters."})]}),(0,R.jsx)(x.A,{children:(0,R.jsx)(d.Q,{variant:"primary",disabled:!We.name||!We.description,style:{marginTop:2},onClick:wt,children:"Update Notebook Properties"})}),(0,R.jsx)(T.a,{mt:3}),(0,R.jsx)($,{variant:"default",data:je,fileName:`notebook-${e}`,extension:"ipynb"}),(0,R.jsxs)(T.a,{sx:{marginTop:3},children:[(0,R.jsx)(j.A,{as:"h2",sx:{fontSize:4,fontWeight:"normal",color:"danger.fg",mb:2},children:"Danger zone"}),(0,R.jsxs)(T.a,{sx:{border:"1px solid",borderColor:"danger.emphasis",borderRadius:2,p:3,alignItems:"center",justifyContent:"space-between",gap:3},children:[(0,R.jsxs)(T.a,{sx:{display:"grid",gap:1},children:[(0,R.jsx)(b.A,{sx:{fontSize:1,fontWeight:"bold",color:"danger.fg"},children:"Confirm the notebook name to delete"}),(0,R.jsx)(x.A,{children:(0,R.jsx)(f.A,{block:!0,value:Oe.nameConfirm,onChange:e=>{Ve(t=>({...t,nameConfirm:e.target.value}))}})}),(0,R.jsx)(b.A,{sx:{fontSize:1,color:"fg.muted"},children:"This operation is not reversible."})]}),(0,R.jsx)(d.Q,{variant:"danger",disabled:!We.nameConfirm,onClick:async()=>{et("Deleting the notebook..."),it(fe.id).then(e=>{e.success&&(Ke("The notebook is successfully deleted.",{variant:"success"}),I("/my-library"))}).finally(()=>{qe()})},children:"Delete notebook"})]})]})]}),"ai-agents"===ye&&Ue&&Ce&&(0,R.jsx)(o.zP,{runtimeUrl:Ce,children:(0,R.jsx)(dt,{jupyterMCPServerUrl:Ue,copilotkitServerUrl:Ce})}),"mcp-server"===ye&&jt&&ae&&ae.kernel&&(0,R.jsx)(mt,{roomServer:jt,runtimeId:ae.kernel.id,runtimeSettings:ae.serverSettings})]})]})]})}const gt=ht},64991:(e,t,n)=>{n.d(t,{w:()=>i});var s=n(63711),r=n(320),a=n(49370);const i=(e="api/ai-agents/v1")=>{const{configuration:t}=(0,r._O)(),{requestRun:n}=(0,a.X)({notifyOnError:!1});return{createAIAgent:(r,a,i,o,l,{signal:c,baseUrl:d=e}={})=>n({url:s.URLExt.join(t.aiagentsRunUrl,d,"agents"),method:"POST",body:{room_id:r,room_type:a,runtime:{ingress:i,token:o,kernel_id:l}},signal:c}),getAIAgents:({signal:r,baseUrl:a=e}={})=>n({url:s.URLExt.join(t.aiagentsRunUrl,a,"agents"),method:"GET",signal:r}),deleteAIAgent:(r,{signal:a,baseUrl:i=e}={})=>n({url:s.URLExt.join(t.aiagentsRunUrl,i,"agents",r),method:"DELETE",signal:a}),getAIAgent:(r,{signal:a,baseUrl:i=e}={})=>n({url:s.URLExt.join(t.aiagentsRunUrl,i,"agents",r),method:"GET",signal:a}),patchAIAgent:(r,a,i,o,{signal:l,baseUrl:c=e}={})=>n({url:s.URLExt.join(t.aiagentsRunUrl,c,"agents",r),method:"PATCH",body:{runtime:a&&i&&o?{ingress:a,token:i,kernel_id:o}:null},signal:l})}}},81390:(e,t,n)=>{n.d(t,{Ks:()=>i});var s=n(97283),r=n(7282);const a=(0,s.y)(e=>({aiAgents:[],addAIAgent:t=>{e(e=>e.aiAgents.includes(t)?{}:{aiAgents:e.aiAgents.concat([t])})},deleteAIAgent:t=>{e(e=>({aiAgents:e.aiAgents.filter(e=>e.documentId===t)}))},updateAIAgent:(t,n)=>{e(e=>{const s=e.aiAgents.findIndex(e=>e.documentId===t);return s>=0?(e.aiAgents[s].runtimeId=n,{aiAgents:[...e.aiAgents]}):{}})}}));function i(e){return(0,r.Pj)(a,e)}}}]);