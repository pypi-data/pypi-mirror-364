"use strict";(self.webpackChunk_datalayer_ui=self.webpackChunk_datalayer_ui||[]).push([[3799],{83799:(e,t,n)=>{n.d(t,{f:()=>J});var s=n(18683),o=n(9387),a=n(55881),r=n(98754),i=n(42968),l=n(17402),c=n(50059),d=n(14809),u=n(38921),h=n(16950),p=n(80578),m=n(99650),g=n(84939),_=n(63527),w=n(1290),C=n(30574),x=n(62097),y=n(37706),f=n(71784),k=n(89492),S=n(67004),v=n(53054),I=n(89915),M=n(97789),b=n(13855),K=n(75987),j=n(85112),E=n(92727),D=n(89462),T=n(5190),A=n(41120);const B="completer:invoke",N="completer:select";var O=n(19326);class L{_id;_outputs;_cell;_kernel;_panel;_sessionContext;_type;constructor(e){const{id:t,type:n,source:s,outputs:o,serverSettings:a,kernel:r,boxOptions:i}=e;this._id=t,this._outputs=o,this._kernel=r,this._type=n,this.setupCell(n,s,a,r,i)}setupCell(e="code",t,s,o,r){const i=o.kernelManager??new M.KernelManager({serverSettings:s}),l=o.sessionManager??new M.SessionManager({serverSettings:s,kernelManager:i}),c=o.kernelSpecManager??new M.KernelSpecManager({serverSettings:s}),j=o?{id:o.id,shouldStart:!1,autoStartDefault:!1,shutdownOnDispose:!1}:{name:"python",shouldStart:!0,autoStartDefault:!0,shutdownOnDispose:!0};this._sessionContext=new p.I({name:o?.path,path:o?.path,sessionManager:l,specsManager:c,type:"python",kernelPreference:j}),this._sessionContext._initialize=async()=>{const e=this._sessionContext.sessionManager;await e.ready,await e.refreshRunning();const t=(0,u.find)(e.running(),e=>e.kernel?.id===this._kernel.id);if(t)try{const n=e.connectTo({model:t,kernelConnectionOptions:{handleComms:!0}});this._sessionContext._handleNewSession(n)}catch(e){return this._sessionContext._handleSessionError(e),Promise.reject(e)}return await this._sessionContext._startIfNecessary()};const O=new w.k8;for(const e of w.k8.getDefaultThemes())O.addTheme(e);const L=new w.T9;for(const e of w.T9.getDefaultLanguages())L.addLanguage(e);L.addLanguage({name:"ipythongfm",mime:"text/x-ipythongfm",load:async()=>(await Promise.all([n.e(6636),n.e(9946),n.e(2899),n.e(5949)]).then(n.bind(n,15949))).markdown({codeLanguages:e=>L.findBest(e)})});const J=new w.mN(L),P=new h.J;document.addEventListener("keydown",e=>{const t=document.activeElement;t&&t.closest(".dla-Jupyter-Cell")===this._cell.node&&P.processKeydownEvent(e)},!0);const R=new v.K({initialFactories:I.dn,latexTypesetter:new C.p,markdownParser:(0,A.A)(L)}),F=new E.y({loader:T.l});R.addFactory({safe:!1,mimeTypes:[D.a],createRenderer:e=>new D.u(e,F)},0),F.registerWithKernel(o.connection);const z=new w.Ez({extensions:(()=>{const e=new w.AG;for(const t of w.AG.getDefaultExtensions({themes:O}))e.addExtension(t);return e.addExtension({name:"shared-model-binding",factory:e=>{const t=e.model.sharedModel;return w.AG.createImmutableExtension((0,w.rX)({ytext:t.ysource,undoManager:t.undoManager??void 0}))}}),e})(),languages:L}),G=(0,K.MQ)({cell_type:e,source:t,outputs:this._outputs,metadata:{}}),W=new a.fh.ContentFactory({editorFactory:z.newInlineEditor.bind(z)});"code"===e?this._cell=new a.Yr({rendermime:R,model:new _.DJ({sharedModel:G}),contentFactory:W}):"markdown"===e&&(this._cell=new a.KI({rendermime:R,model:new _.Xr({sharedModel:G}),contentFactory:W})),this._cell.addClass("dla-Jupyter-Cell"),this._cell.initializeState(),"markdown"===this._type&&(this._cell.rendered=!1),this._sessionContext.kernelChanged.connect((e,t)=>{const n=t.newValue;console.log("Current Jupyter Kernel Connection",n),n&&!n.handleComms&&(console.warn("Jupyter Kernel Connection does not handle Comms",n.id),n.handleComms=!0,console.log("Jupyter Kernel Connection is updated to enforce Comms support",n.handleComms)),F.registerWithKernel(n)}),this._sessionContext.kernelChanged.connect(()=>{this._sessionContext.session?.kernel?.info.then(e=>{if("code"===this._type){const t=e.language_info,n=J.getMimeTypeByLanguage(t);this._cell.model&&(this._cell.model.mimeType=n)}})});const Y=this._cell.editor,H=new x.X,Q=new y.A({editor:Y,model:H}),V=new f.G,X=new k.C({context:{widget:this._cell,editor:Y,session:this._sessionContext.session},providers:[V],timeout:1e3}),$=new S.$({completer:Q,reconciliator:X});this._sessionContext.ready.then(()=>{const e=new f.G;$.reconciliator=new k.C({context:{widget:this._cell,editor:Y,session:this._sessionContext.session},providers:[e],timeout:1e3})}),this._cell.ready.then(()=>{$.editor=this._cell&&this._cell.editor}),((e,t,n,s)=>{e.addCommand(B,{label:"Completer: Invoke",execute:()=>n.invoke()}),e.addCommand(N,{label:"Completer: Select",execute:()=>n.completer.selectActive()}),e.addCommand("run:cell",{execute:()=>{t instanceof a.Yr?s.execute():t instanceof a.KI&&(t.rendered=!0)}}),e.addKeyBinding({selector:".jp-InputArea-editor.jp-mod-completer-enabled",keys:["Tab"],command:B}),e.addKeyBinding({selector:".jp-InputArea-editor",keys:["Shift Enter"],command:"run:cell"}),[{selector:".jp-InputArea-editor.jp-mod-completer-active",keys:["Enter"],command:N}].map(t=>e.addKeyBinding(t))})(P,this._cell,$,this),Q.hide(),Q.addClass("jp-Completer-Cell"),d.x0.attach(Q,document.body);const U=new m.M7;U.addItem("spacer",m.M7.createSpacerItem());const q=new g.IB({icon:b.J7,onClick:()=>{"code"===this._type?this.execute():"markdown"===this._type&&(this._cell.rendered=!0)},tooltip:"Run"});U.addItem("run",q),U.addItem("interrupt",m.M7.createInterruptButton(this._sessionContext)),U.addItem("restart",m.M7.createRestartButton(this._sessionContext)),U.addItem("status",m.M7.createKernelStatusItem(this._sessionContext)),"code"===this._type&&(this._cell.outputsScrolled=!1),this._cell.activate(),this._panel=new d.e6,this._panel.direction="top-to-bottom",this._panel.spacing=0,!1!==r?.showToolbar&&this._panel.addWidget(U),this._panel.addWidget(this._cell),!1!==r?.showToolbar&&d.e6.setStretch(U,0),d.e6.setStretch(this._cell,1),window.addEventListener("resize",()=>{this._panel.update()}),this._panel.update()}get panel(){return this._panel}get cell(){return this._cell}get sessionContext(){return this._sessionContext}get kernel(){return this._kernel}execute=()=>{"code"===this._type?this._execute(this._cell):"markdown"===this._type&&(this._cell.rendered=!0)};async _execute(e,t){O.vw.getState().setIsExecuting(this._id,!0);const n=e.model,s=n.sharedModel.getSource();if(!s.trim()||!this.kernel)return n.sharedModel.transact(()=>{n.clearExecution()},!1),O.vw.getState().setIsExecuting(this._id,!1),new Promise(()=>{});const o={cellId:n.sharedModel.getId()};t={...n.metadata,...t,...o};const{recordTiming:a}=t;let r;n.sharedModel.transact(()=>{n.clearExecution(),e.outputHidden=!1},!1),e.setPrompt("*"),n.trusted=!0;try{const o=(0,j.g)(this._id,s,e.outputArea,this._kernel,t);if(a){const t=e=>{let t;switch(e.header.msg_type){case"status":t=`status.${e.content.execution_state}`;break;case"execute_input":t="execute_input";break;default:return!0}const s=e.header.date||(new Date).toISOString(),o=Object.assign({},n.getMetadata("execution"));return o[`iopub.${t}`]=s,n.setMetadata("execution",o),!0};e.outputArea.future.registerMessageHook(t)}else n.deleteMetadata("execution");r=e.outputArea.future;const i=await o;if(n.executionCount=i.content.execution_count,a){const e=Object.assign({},n.getMetadata("execution")),t=i.metadata.started;t&&(e["shell.execute_reply.started"]=t);const s=i.header.date;e["shell.execute_reply"]=s||(new Date).toISOString(),n.setMetadata("execution",e)}return O.vw.getState().setIsExecuting(this._id,!1),i}catch(t){if(O.vw.getState().setIsExecuting(this._id,!1),r&&!e.isDisposed&&e.outputArea.future===r&&(e.setPrompt(""),a&&r.isDisposed)){const e=Object.assign({},n.getMetadata("execution"));e.execution_failed=(new Date).toISOString(),n.setMetadata("execution",e)}throw t}}}const J=e=>{const{autoStart:t,outputs:n=[],showToolbar:d,source:u="",startDefaultKernel:h,type:p,kernel:m}=e,{defaultKernel:g,serverSettings:_}=(0,i.PD)({startDefaultKernel:h}),[w]=(0,o.useState)(e.id||(0,l.YG)()),[C,x]=(0,o.useState)(),y=(0,O.Ui)();return(0,o.useEffect)(()=>{const e=m||g;w&&_&&e&&e.ready.then(()=>{const s=new L({id:w,type:p,source:u,outputs:n,serverSettings:_,kernel:e,boxOptions:{showToolbar:d}});y.setAdapter(w,s),y.setSource(w,u),(e=>{e.cell.model.contentChanged.connect((e,t)=>{y.setSource(w,e.sharedModel.getSource())}),e.cell instanceof a.Yr&&e.cell.outputArea.outputLengthChanged?.connect((e,t)=>{y.setOutputsCount(w,t)}),e.sessionContext.initialize().then(()=>{t&&e.cell.model&&e.execute()}),e.sessionContext.kernelChanged.connect(()=>{e.sessionContext.session?.kernel?.info.then(e=>{y.setKernelSessionAvailable(w,!0)})})})(s),x(s);const o=e=>{let t=e.target;for(;t&&!t.classList.contains("jp-MarkdownOutput");)t=t.parentElement;t&&t.classList.contains("jp-MarkdownOutput")&&(s.cell.rendered=!1)};return document.addEventListener("dblclick",o),()=>{document.removeEventListener("dblclick",o)}})},[u,g,m,_]),C?(0,s.jsx)(r.A,{sx:{"& .dla-Jupyter-Cell":{position:"relative !important",contain:"content !important"},"& .jp-Toolbar":{height:"auto !important",position:"relative"},"& .lm-BoxPanel":{position:"relative"},"& .jp-Cell":{position:"relative"},"& .jp-CodeCell":{height:"auto !important",position:"relative"},"& .jp-MarkdownCell":{height:"auto !important",minHeight:"65px",position:"relative"},"& .jp-Cell-outputArea":{paddingBottom:"30px"},"& .jp-CodeMirrorEditor":{cursor:"text !important"}},children:(0,s.jsx)(c.j,{children:C.panel})}):(0,s.jsx)(r.A,{children:"Loading Jupyter Cell..."})};J.defaultProps={autoStart:!0,source:"",outputs:[],showToolbar:!0,startDefaultKernel:!0,type:"code"}},99650:(e,t,n)=>{n.d(t,{M7:()=>m});var s,o,a=n(84939),r=n(85181),i=n(13855),l=n(88037),c=n(72879),d=n(14809),u=n(9387),h=n(80578),p=n(69474);!function(e){e.createInterruptButton=function(e,t){const n=(t=t||r.wK).load("jupyterlab");return new a.IB({icon:i.mU,onClick:()=>{var t,n;null===(n=null===(t=e.session)||void 0===t?void 0:t.kernel)||void 0===n||n.interrupt()},tooltip:n.__("Interrupt the kernel")})},e.createRestartButton=function(e,t,n){const s=(n=null!=n?n:r.wK).load("jupyterlab");return new a.IB({icon:i.he,onClick:()=>{(null!=t?t:new h.V({translator:n})).restart(e)},tooltip:s.__("Restart the kernel")})},e.createKernelNameItem=function(e,t,n){const s=l._Q.create(u.createElement(o.KernelNameComponent,{sessionContext:e,dialogs:null!=t?t:new h.V({translator:n}),translator:n}));return s.addClass("jp-KernelName"),s},e.createKernelStatusItem=function(e,t){return new o.KernelStatus(e,t)}}(s||(s={})),function(e){e.KernelNameComponent=function(e){const t=(e.translator||r.wK).load("jupyterlab"),n=()=>{e.dialogs.selectKernel(e.sessionContext)};return u.createElement(l.mE,{signal:e.sessionContext.kernelChanged,initialSender:e.sessionContext},e=>u.createElement(a.fQ,{className:"jp-Toolbar-kernelName",onClick:n,tooltip:t.__("Switch kernel"),label:null==e?void 0:e.kernelDisplayName}))};class t extends d.x0{constructor(e,t){super(),this.translator=t||r.wK,this._trans=this.translator.load("jupyterlab"),this.addClass("jp-Toolbar-kernelStatus"),this._statusNames=(0,p._)(this.translator),this._onStatusChanged(e),e.statusChanged.connect(this._onStatusChanged,this),e.connectionStatusChanged.connect(this._onStatusChanged,this)}_onStatusChanged(e){if(this.isDisposed)return;const t=e.kernelDisplayStatus,n={container:this.node,title:this._trans.__("Kernel %1",this._statusNames[t]||t),stylesheet:"toolbarButton",alignSelf:"normal",height:"24px"};c.Tl.remove(this.node),"busy"===t||"starting"===t||"terminating"===t||"restarting"===t||"initializing"===t?i.sF.element(n):"connecting"===t||"disconnected"===t||"unknown"===t?i.KN.element(n):i.Rt.element(n)}}e.KernelStatus=t}(o||(o={}));class m extends a.M7{}!function(e){e.createInterruptButton=s.createInterruptButton,e.createKernelNameItem=s.createKernelNameItem,e.createKernelStatusItem=s.createKernelStatusItem,e.createRestartButton=s.createRestartButton,e.createSpacerItem=a.M7.createSpacerItem}(m||(m={}))}}]);