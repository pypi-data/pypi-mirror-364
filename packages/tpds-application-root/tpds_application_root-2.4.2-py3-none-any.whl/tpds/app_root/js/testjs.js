"use strict";function customCertificateMsg(){alert("Due to the way the certificates are stored/retrieved from the ECC608 device, using Custom certificates will require some knowledge on compressed certificates and certificate templates.")}function cert10RadioHandler(){var e=getFormRadioValue(formNameMain,"slot10certopt");"custCert"===e?($("#10certname").show(),$("#10certcommonname").show(),$("#10certyear").show(),$("#10verify").show(),$("#device_custcert_notes").show(),$("#custCertPubkey").show(),$("#manIdHexId").show(),$("#cbid_devcertcn").show(),$("#cbid_devcertcn_pr").show(),$('label[for="cbid_devcertcn"]').show(),$('label[for="cbid_devcertcn_pr"]').show(),document.getElementById("cbid_devcertcn").checked=!0,change_devcertcn(),setRadioValue(formNameMain,"slot12certopt","custCert")):($("#10certname").hide(),$("#10certcommonname").hide(),$("#10certyear").hide(),$("#10verify").hide(),$("#device_custcert_notes").hide(),$("#custCertPubkey").hide(),$("#manIdHexId").hide(),$("#cbid_devcertcn").hide(),$("#cbid_devcertcn_pr").hide(),$('label[for="cbid_devcertcn"]').hide(),$('label[for="cbid_devcertcn_pr"]').hide(),document.getElementById("cbid_devcertcn").checked=!1,change_devcertcn(),setRadioValue(formNameMain,"slot12certopt","MCHPCert")),"custCert"===(e=getFormRadioValue(formNameMain,"slot12certopt"))?($("#12certname").show(),$("#12certcommonname").show(),$("#12certyear").show(),$("#12verify").show(),$("#signer_custcert_notes").show(),$("#custCertPubkey").show(),$("#manIdHexId").show(),setRadioValue(formNameMain,"slot10certopt","custCert")):($("#12certname").hide(),$("#12certcommonname").hide(),$("#12certyear").hide(),$("#12verify").hide(),$("#signer_custcert_notes").hide(),$("#custCertPubkey").hide(),$("#manIdHexId").hide(),setRadioValue(formNameMain,"slot10certopt","MCHPCert"))}function cert12RadioHandler(){var e=getFormRadioValue(formNameMain,"slot12certopt");"custCert"===e?($("#12certname").show(),$("#12certcommonname").show(),$("#12certyear").show(),$("#12verify").show(),$("#signer_custcert_notes").show(),$("#custCertPubkey").show(),$("#manIdHexId").show(),setRadioValue(formNameMain,"slot10certopt","custCert")):($("#12certname").hide(),$("#12certcommonname").hide(),$("#12certyear").hide(),$("#12verify").hide(),$("#signer_custcert_notes").hide(),$("#custCertPubkey").hide(),$("#manIdHexId").hide(),setRadioValue(formNameMain,"slot10certopt","MCHPCert")),"custCert"===(e=getFormRadioValue(formNameMain,"slot10certopt"))?($("#10certname").show(),$("#10certcommonname").show(),$("#10certyear").show(),$("#10verify").show(),$("#device_custcert_notes").show(),$("#custCertPubkey").show(),$("#manIdHexId").show(),$("#cbid_devcertcn").show(),$("#cbid_devcertcn").show(),$('label[for="cbid_devcertcn"]').show(),document.getElementById("cbid_devcertcn").checked=!0,change_devcertcn(),setRadioValue(formNameMain,"slot12certopt","custCert")):($("#10certname").hide(),$("#10certcommonname").hide(),$("#10certyear").hide(),$("#10verify").hide(),$("#device_custcert_notes").hide(),$("#custCertPubkey").hide(),$("#manIdHexId").hide(),$("#cbid_devcertcn").hide(),$('label[for="cbid_devcertcn"]').hide(),document.getElementById("cbid_devcertcn").checked=!1,change_devcertcn(),setRadioValue(formNameMain,"slot12certopt","MCHPCert"))}function certVerify(){if("Verify"==this.value){var e=!1,t=!1,r=!1;if(0==document.getElementById(this.id.replace("verify","certname")).value.length?(alert("Error: Org name field cannot be empty"),e=!1):e=!0,0==document.getElementById(this.id.replace("verify","certcommonname")).value.length?(alert("Error: Common name field cannot be empty"),r=!1):r=!0,null!=document.getElementById(this.id.replace("verify","certyear"))){var n=document.getElementById(this.id.replace("verify","certyear")).value;parseInt(n)<=127&&parseInt(n)>=0?t=!0:(alert("Error: Certificate validity can be 0 to 127 years, entering 0 will set the certificate expiry date to year 9999"),t=!1)}else t=!0;1==e&&1==t&&1==r&&(document.getElementById(this.id.replace("verify","certname")).disabled=!0,document.getElementById(this.id.replace("verify","certyear")).disabled=!0,document.getElementById(this.id.replace("verify","certcommonname")).disabled=!0,this.value="Modify")}else"Modify"==this.value&&(document.getElementById(this.id.replace("verify","certname")).disabled=!1,document.getElementById(this.id.replace("verify","certyear")).disabled=!1,document.getElementById(this.id.replace("verify","certcommonname")).disabled=!1,this.value="Verify")}function rootVerify(){if("Verify"==this.value){var e=!1,t=!1;0==document.getElementById(this.id.replace("verify","certname")).value.length?(alert("Error: Org name field cannot be empty"),e=!1):e=!0,0==document.getElementById(this.id.replace("verify","certcommonname")).value.length?(alert("Error: Common name field cannot be empty"),t=!1):t=!0,1==e&&1==t&&(document.getElementById(this.id.replace("verify","certname")).disabled=!0,document.getElementById(this.id.replace("verify","certcommonname")).disabled=!0,this.value="Modify")}else"Modify"==this.value&&(document.getElementById(this.id.replace("verify","certname")).disabled=!1,document.getElementById(this.id.replace("verify","certcommonname")).disabled=!1,this.value="Verify")}function addInputElement(e,t,r,n,a){var i=document.createElement(e);null!=t&&null!=n&&null!=a||console.error("Input cannot be null"),i.setAttribute("name",t),i.setAttribute("id",n),null!=r&&i.setAttribute("type",r),document.getElementById(a).appendChild(i)}function removeElement(e){var t=document.getElementById(e);null!=t&&t.parentNode.removeChild(t)}function addRadioListners(e){for(var t=document.getElementsByName(e),r=t.length;r--;)t[r].onchange=radioEventHandler}function radioEventHandler(){var e=parseInt(this.name.replaceAll("slot",""),10);if("unused"==this.value)removeElement(this.name+"id"),removeElement(this.name+"idverify"),removeElement(this.name+"idButton"),slotValidateDict[e]="none";else if("hexdata"==this.value){removeElement(this.name+"id"),removeElement(this.name+"idverify"),removeElement(this.name+"idButton"),addInputElement("textarea",this.name+"name",null,this.name+"id",this.name+"span"),(r=document.getElementById(this.name+"id")).className+="slotTextArea",r.placeholder="Input hex data here:\nSlot expects "+slotsize[parseInt(this.name.replace("slot",""),10)]+" bytes of data.\n\nExample: \n42 94 A8 92 20 CB 2C 7A\n....  .... .... .... .... .... .... .... ....",r.rows="8",addInputElement("input",this.name+"nameverify","button",this.name+"idverify",this.name+"verify");var t=document.getElementById(this.name+"idverify");t.value="Verify",t.className+="opt1button",t.onclick=verifyButtonHandler,slotValidateDict[e]="invalid"}else if("pemdata"==this.value){var r;removeElement(this.name+"id"),removeElement(this.name+"idverify"),removeElement(this.name+"idButton"),addInputElement("input",this.name+"name","button",this.name+"idButton",this.name+"span"),(r=document.getElementById(this.name+"idButton")).className+="opt1button",r.onchange=pemKeyHandler,r.setAttribute("type","file"),r.accept=".pem",r.multiple=!1,addInputElement("textarea",this.name+"name",null,this.name+"id",this.name+"span"),(r=document.getElementById(this.name+"id")).className+="slotTextArea",r.rows="8",r.style.display="none",slotValidateDict[e]="invalid"}else console.error("Unknown radio value")}function stripPemHeadnFoot(e){var t;if(e.length>30||e.replaceAll("\n","").startsWith("-----BEGIN")||e.replaceAll("\n","").endsWith("-----")||null!=e.match("-----BEGIN(.*)-----")||null!=e.match("-----END(.*)-----")){var r=e.match("-----BEGIN(.*)-----"),n=e.match("-----END(.*)-----");t=r[0].replaceAll("-----","").replaceAll("BEGIN","")==n[0].replaceAll("-----","").replaceAll("END","")?(t=e.replaceAll(r[0],"").replaceAll(n[0],"")).replaceAll("\n","").replaceAll("\t","").replaceAll(" ",""):null}else t=null;return t}function getPemBeginName(e){if(e.length>30||e.replaceAll("\n","").startsWith("-----BEGIN")||e.replaceAll("\n","").endsWith("-----")||null!=e.match("-----BEGIN(.*)-----")||null!=e.match("-----END(.*)-----")){var t=e.match("-----BEGIN(.*)-----"),r=e.match("-----END(.*)-----"),n=t[0].replaceAll("-----","").replaceAll("BEGIN","");return n==r[0].replaceAll("-----","").replaceAll("END","")?n:null}return null}function b64ToArrayBuffer(e){return new Promise((t,r)=>{var n=new XMLHttpRequest;n.open("GET","data:application/octet-stream;base64,"+e),n.responseType="arraybuffer",n.addEventListener("load",e=>t(n.response)),n.addEventListener("error",e=>r(n)),n.send()})}function _base64ToArrayBuffer(e){for(var t=window.atob(e),r=t.length,n=new Uint8Array(r),a=0;a<r;a++)n[a]=t.charCodeAt(a);return n.buffer}function buf2hex(e){return Array.prototype.map.call(new Uint8Array(e),e=>("00"+e.toString(16)).slice(-2)).join("")}function handlePemPrivate(e){var t=buf2hex(_base64ToArrayBuffer(e)).toUpperCase();return 4==parseInt(t[t.length-134],16)?t.slice(t.length-128,t.length):null}function handlePemSymmetric(e){var t,r=buf2hex(_base64ToArrayBuffer(e)).toUpperCase();if(r.includes("300906072A8648CE4C030103")){t=r.slice(28,r.length);var n=parseInt(t.slice(0,2),16)-2;if(4==parseInt(t.slice(4,6),16))return t.slice(6,6+2*n)}}function loadPemKeyTextArea(e,t){document.getElementById(t).value=e}function pemKeyHandler(e){var t=parseInt(e.target.name.replace("slot",""),10),r=e.target,n=new FileReader,a="slot"+t+"dataoptid";n.onload=function(){var e=n.result,r=stripPemHeadnFoot(e),i=null;null!=getPemBeginName(e)?(1==getPemBeginName(e).toUpperCase().includes("PRIVATE")||1==getPemBeginName(e).toUpperCase().includes("PUBLIC")?i=handlePemPrivate(r):1==getPemBeginName(e).toUpperCase().includes("SYMMETRIC")?i=handlePemSymmetric(r):console.error("Undefined pem name"),null!=i&&(loadPemKeyTextArea(i,a),slotValidateDict[t]="valid")):console.error("invalid pem")},n.readAsText(r.files[0])}function verifyButtonHandler(){var e=parseInt(this.name.replace("slot",""),10);"Verify"==this.value?1==checkTextAreaString(getDataFromSlot(this.name.replace("nameverify","")),slotsize[parseInt(this.name.replace("slot",""),10)])&&(document.getElementById(this.id.replace("verify","")).disabled=!0,this.value="Modify",slotValidateDict[e]="valid"):"Modify"==this.value&&(document.getElementById(this.id.replace("verify","")).disabled=!1,this.value="Verify")}function checkTextAreaString(e,t){var r=e.replaceAll(" ","").replaceAll("\n","").replaceAll("\r","").replaceAll("\t","").replaceAll("0x","").replaceAll(",","").toUpperCase(),n=!1;if(2*t==r.length)if(is_hex(r)){var a="Data valid,";a+=" entered values are:\n",a+=prettyPrintHex(r,32),alert(a),n=!0}else alert("Error: Data contains non-hex characters"),n=!1;else alert("The slot expects: "+t+"bytes\nYou have entered: "+r.length/2+"bytes"),n=!1;return n}function formatedPrettyPrintHex(e,t){for(var r=e.replaceAll(" ","").replaceAll("\n","").replaceAll("\r","").replaceAll("\t","").replaceAll("0x","").replaceAll(",","").toUpperCase(),n="",a=0;a<r.length;a++)isEven(a)||(a+1)%t!=0?isEven(a)?n+=r[a]:(n+=r[a],n+=" "):(n+=r[a],n+="\n");return n}function prettyPrintHex(e,t){for(var r="",n=0;n<e.length;n++)isEven(n)||(n+1)%t==0||(n+1)%16!=0?isEven(n)||(n+1)%t!=0?isEven(n)?r+=e[n]:(r+=e[n],r+=" "):(r+=e[n],r+="\n"):(r+=e[n],r+="  ");return r}function isEven(e){return e==parseFloat(e)?!(e%2):void 0}function is_hex(e){return/^[0-9a-fA-F]+$/.test(e)}function invokeRadioListners(){addRadioListners("slot5dataopt"),addRadioListners("slot6dataopt"),addRadioListners("slot8dataopt"),addRadioListners("slot9dataopt"),addRadioListners("slot13dataopt"),addRadioListners("slot14dataopt"),addRadioListners("slot15dataopt"),addRadioListners("slot16dataopt");for(var e=document.getElementsByName("slot10certopt"),t=e.length;t--;)e[t].onchange=cert10RadioHandler;var r=document.getElementsByName("slot12certopt");for(t=e.length;t--;)r[t].onchange=cert12RadioHandler;change_devcertcn(),document.getElementById("10verify").addEventListener("click",certVerify),document.getElementById("12verify").addEventListener("click",certVerify),document.getElementById("16verify").addEventListener("click",rootVerify),document.getElementById("proto_xml").addEventListener("click",generate_sep),document.getElementById("prod_xml").addEventListener("click",generate_sep),document.getElementById("id_version_license").innerHTML=TPDS_LICENSE}function generate_sep(){gererateXML(this.id)}$("#10certname").hide(),$("#10certcommonname").hide(),$("#10certyear").hide(),$("#10verify").hide(),$("#custCertPubkey").hide(),$("#manIdHexId").hide(),$("#device_custcert_notes").hide(),$("#cbid_devcertcn").hide(),$('label[for="cbid_devcertcn"]').hide(),$("#cbid_devcertcn_pr").hide(),$('label[for="cbid_devcertcn_pr"]').hide(),$("#12certname").hide(),$("#12certcommonname").hide(),$("#12certyear").hide(),$("#12verify").hide(),$("#custCertPubkey").hide(),$("#manIdHexId").hide(),$("#signer_custcert_notes").hide(),String.prototype.replaceAll=function(e,t){return this.replace(new RegExp(e,"g"),t)};