Metadata-Version: 2.4
Name: cognihub-pyeffectref
Version: 0.2.0
Summary: A reactive programming library inspired by Vue 3's Composition API, featuring low-level (Ref/effect) and high-level (ReactiveDict/ReadOnlyView) interfaces
Author-email: hsz1273327 <hsz1273327@163.com>
Maintainer-email: hsz1273327 <hsz1273327@163.com>
License: MIT License
        
        Copyright (c) 2025 HUANG SIZHE
        
        Permission is hereby granted, free of charge, to any person obtaining a copy
        of this software and associated documentation files (the "Software"), to deal
        in the Software without restriction, including without limitation the rights
        to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
        copies of the Software, and to permit persons to whom the Software is
        furnished to do so, subject to the following conditions:
        
        The above copyright notice and this permission notice shall be included in all
        copies or substantial portions of the Software.
        
        THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
        IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
        FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
        AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
        LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
        OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
        SOFTWARE.
        
Project-URL: Homepage, https://github.com/hsz1273327/cognihub_pyeffectref
Project-URL: Repository, https://github.com/hsz1273327/cognihub_pyeffectref
Project-URL: Issues, https://github.com/hsz1273327/cognihub_pyeffectref/issues
Keywords: reactive,vue,effect,ref,cognihub,reactivedict,readonly,async,threading
Classifier: Development Status :: 4 - Beta
Classifier: Intended Audience :: Developers
Classifier: License :: OSI Approved :: MIT License
Classifier: Operating System :: OS Independent
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Classifier: Programming Language :: Python :: 3.12
Classifier: Programming Language :: Python :: 3.13
Classifier: Topic :: Software Development :: Libraries :: Python Modules
Classifier: Topic :: Software Development :: User Interfaces
Classifier: Topic :: Software Development :: Libraries :: Application Frameworks
Classifier: Typing :: Typed
Requires-Python: >=3.10
Description-Content-Type: text/markdown
License-File: LICENSE
Provides-Extra: dev
Requires-Dist: mypy>=1.8.0; extra == "dev"
Requires-Dist: coverage>=7.3.0; extra == "dev"
Requires-Dist: build>=0.10.0; extra == "dev"
Requires-Dist: twine>=4.0.0; extra == "dev"
Provides-Extra: test
Requires-Dist: mypy>=1.8.0; extra == "test"
Requires-Dist: coverage>=7.3.0; extra == "test"
Dynamic: license-file

# CogniHub PyEffectRef

CogniHub é¡¹ç›®çš„å“åº”å¼ç¼–ç¨‹åº“,æä¾›ç±»ä¼¼ Vue 3 Composition API çš„å“åº”å¼ç³»ç»Ÿ.æœ¬åº“åˆ†ä¸º**åº•å±‚æ¥å£**å’Œ**é«˜çº§æ¥å£**ä¸¤ä¸ªå±‚æ¬¡,æ»¡è¶³ä¸åŒå¤æ‚åº¦çš„ä½¿ç”¨éœ€æ±‚.

## ç‰¹æ€§

- ğŸ”„ **å“åº”å¼ç¼–ç¨‹**: ç±»ä¼¼ Vue 3 Composition API çš„å“åº”å¼ç³»ç»Ÿ
- ğŸ”’ **çº¿ç¨‹å®‰å…¨**: æ”¯æŒå¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„å®‰å…¨æ“ä½œ  
- âš¡ **å¼‚æ­¥æ”¯æŒ**: å®Œæ•´æ”¯æŒ asyncio åç¨‹ç¯å¢ƒ
- ğŸ¯ **ç±»å‹æç¤º**: å®Œæ•´çš„ TypeScript é£æ ¼ç±»å‹æç¤ºæ”¯æŒ
- ğŸ—ï¸ **åˆ†å±‚è®¾è®¡**: åº•å±‚æ¥å£(Ref/effect) + é«˜çº§æ¥å£(ReactiveDict/ReadOnlyView)
- ğŸ›ï¸ **æ‰§è¡Œæ§åˆ¶**: æ”¯æŒåŒæ­¥ã€å¼‚æ­¥ã€é¡ºåºæ‰§è¡Œç­‰å¤šç§æ¨¡å¼

## å®‰è£…

```bash
pip install cognihub-pyeffectref
```

æˆ–ä»æºç å®‰è£…ï¼š

```bash
git clone https://github.com/hsz1273327/cognihub_pyeffectref.git
cd cognihub_pyeffectref
pip install -e .
```

## ğŸ“š æ¶æ„æ¦‚è§ˆ

æœ¬åº“é‡‡ç”¨åˆ†å±‚è®¾è®¡,æä¾›ä¸¤ä¸ªå±‚æ¬¡çš„æ¥å£ï¼š

### ğŸ”§ åº•å±‚æ¥å£ (Low-level APIs)

- **`Ref[T]`**: å“åº”å¼æ•°æ®å®¹å™¨,æ”¯æŒæ³›å‹ç±»å‹æŒ‡å®š
- **`effect`**: å‰¯ä½œç”¨è£…é¥°å™¨,è‡ªåŠ¨è¿½è¸ªä¾èµ–å…³ç³»
- **`ReadOnlyRef[T]`**: åªè¯»å“åº”å¼å¼•ç”¨

**ç‰¹ç‚¹**: ç›´æ¥ä½¿ç”¨æ³›å‹æŒ‡å®šç±»å‹,é€‚åˆç®€å•æ•°æ®ç»“æ„å’Œæ€§èƒ½æ•æ„Ÿåœºæ™¯

### ğŸ—ï¸ é«˜çº§æ¥å£ (High-level APIs)

- **`ReactiveDict`**: å“åº”å¼å­—å…¸,æ”¯æŒåµŒå¥—ç»“æ„,é…åˆ TypedDict å’Œ cast ä½¿ç”¨
- **`ReadOnlyView`**: åªè¯»è§†å›¾,é…åˆ Protocol å’Œ cast ä½¿ç”¨

**ç‰¹ç‚¹**: éœ€è¦ç»“åˆ `TypedDict` å’Œ `Protocol` æŒ‡å®šå¤æ‚ç±»å‹ç»“æ„,é€‚åˆå¤æ‚åº”ç”¨åœºæ™¯

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1ï¸âƒ£ åº•å±‚æ¥å£ç¤ºä¾‹

#### åŸºæœ¬ç”¨æ³• - æ³›å‹ç±»å‹æŒ‡å®š

```python
from cognihub_pyeffectref import Ref, effect
from typing import List, Dict

# ä½¿ç”¨æ³›å‹æŒ‡å®šç±»å‹
count: Ref[int] = Ref(0)
name: Ref[str] = Ref("Alice") 
items: Ref[List[str]] = Ref(["apple", "banana"])

# åˆ›å»ºå‰¯ä½œç”¨å‡½æ•°
@effect
def log_count() -> None:
    print(f"Count is: {count.value}")

@effect  
def log_greeting() -> None:
    print(f"Hello, {name.value}!")

# åˆå§‹æ‰§è¡Œ
log_count()      # è¾“å‡º: Count is: 0
log_greeting()   # è¾“å‡º: Hello, Alice!

# ä¿®æ”¹æ•°æ®,è‡ªåŠ¨è§¦å‘å‰¯ä½œç”¨
count.value = 5        # è¾“å‡º: Count is: 5
name.value = "Bob"     # è¾“å‡º: Hello, Bob!
```

#### åŒæ­¥/å¼‚æ­¥/å¤šçº¿ç¨‹æ”¯æŒ

é»˜è®¤å•çº¿ç¨‹åŒæ­¥æ‰§è¡Œ,é€šè¿‡`Ref.configure_sync_task_executor`å¯é…ç½®ä¸ºå¼‚æ­¥æˆ–å¤šçº¿ç¨‹æ‰§è¡Œ.

**æ³¨æ„:**

1. è¯·ä»…åœ¨éœ€è¦æ—¶ä½¿ç”¨å¼‚æ­¥æˆ–å¤šçº¿ç¨‹,å› ä¸ºè¿™ä¼šå¢åŠ å¤æ‚æ€§å’Œè°ƒè¯•éš¾åº¦.
2. ä»…åœ¨åº”ç”¨å…¥å£å¤„è®¾ç½®ä¸€æ¬¡æ‰§è¡Œå™¨é…ç½®å³å¯,ä¸éœ€è¦åœ¨æ¯ä¸ªæ¨¡å—ä¸­é‡å¤è®¾ç½®.è®¾ç½®æ¥å£æ˜¯ä¸€æ¬¡æ€§çš„,ä¸€æ—¦è®¾ç½®è¿‡äº†å°±æ— æ³•æ”¹å˜

```python
import asyncio
import threading
import time
from cognihub_pyeffectref import Ref, effect

data: Ref[str] = Ref("initial")

# 1. åŒæ­¥ä½¿ç”¨
@effect
def sync_effect() -> None:
    print(f"Sync effect: {data.value}")

# 2. å¼‚æ­¥ä½¿ç”¨  
@effect
async def async_effect() -> None:
    print(f"Async effect: {data.value}")
    await asyncio.sleep(0.1)  # å¼‚æ­¥æ“ä½œ

# 3. å¤šçº¿ç¨‹ä½¿ç”¨
def thread_worker(thread_id: int) -> None:
    @effect
    def thread_effect() -> None:
        print(f"Thread {thread_id} effect: {data.value}")
    
    thread_effect()  # å»ºç«‹ä¾èµ–
    time.sleep(0.1)

async def main():
    # åŒæ­¥æ‰§è¡Œ
    sync_effect()
    
    # å¼‚æ­¥æ‰§è¡Œ  
    await async_effect()
    
    # å¤šçº¿ç¨‹æ‰§è¡Œ
    threads = []
    for i in range(3):
        thread = threading.Thread(target=thread_worker, args=(i,))
        thread.start()
        threads.append(thread)
    
    # è§¦å‘æ‰€æœ‰å‰¯ä½œç”¨
    data.value = "updated"
    await asyncio.sleep(0.2)  # ç­‰å¾…å¼‚æ­¥å’Œçº¿ç¨‹å®Œæˆ
    
    for thread in threads:
        thread.join()

# asyncio.run(main())
```

#### æ‰§è¡Œå™¨é…ç½® - æ§åˆ¶å›è°ƒæ‰§è¡Œæ–¹å¼

> é»˜è®¤çš„å›è°ƒæ‰§è¡Œæ–¹å¼:

1. åœ¨æœªè®¾ç½®æ‰§è¡Œå™¨æ—¶
   1. åŒæ­¥å›è°ƒåœ¨å½“å‰çº¿ç¨‹åŒæ­¥æ‰§è¡Œ.
   2. å¼‚æ­¥å›è°ƒåœ¨ asyncio äº‹ä»¶å¾ªç¯ä¸­å¼‚æ­¥æ‰§è¡Œ.

2. åœ¨è®¾ç½®äº†æ‰§è¡Œå™¨çš„æƒ…å†µä¸‹
   1. åŒæ­¥å›è°ƒä¼šåœ¨æ‰§è¡Œå™¨ä¸­å¤šçº¿ç¨‹åå°æ‰§è¡Œ.
   2. å¼‚æ­¥å›è°ƒä¼šåœ¨ asyncio äº‹ä»¶å¾ªç¯ä¸­å¼‚æ­¥æ‰§è¡Œ.

> å®ä¾‹çš„ç²¾ç»†åŒ–å›è°ƒæ‰§è¡Œæ§åˆ¶

å®ä¾‹å¯ä»¥åœ¨åˆå§‹åŒ–æ—¶é¢å¤–æŒ‡å®šå…¶ç”¨`subscribe`æ³¨å†Œçš„åŒæ­¥å›è°ƒå‡½æ•°çš„æ‰§è¡Œæ–¹å¼.

1. `subscribe_immediate=True`: å¼ºåˆ¶åœ¨å½“å‰çº¿ç¨‹åŒæ­¥æ‰§è¡Œå›è°ƒ,å¿½ç•¥å…¨å±€æ‰§è¡Œå™¨é…ç½®.
2. `subscribe_sequential=True`: ä¿è¯åŒæ­¥å›è°ƒå‡½æ•°æŒ‰æ³¨å†Œé¡ºåºåœ¨åå°æ‰§è¡Œ,é€‚ç”¨äºéœ€è¦é¡ºåºæ‰§è¡Œçš„åœºæ™¯.

```python
import concurrent.futures
from cognihub_pyeffectref import Ref

# é…ç½®å…¨å±€æ‰§è¡Œå™¨ - ä½¿ç”¨ asyncio çº¿ç¨‹æ± 
Ref.configure_sync_task_executor('asyncio')

# æˆ–ä½¿ç”¨è‡ªå®šä¹‰çº¿ç¨‹æ± 
executor = concurrent.futures.ThreadPoolExecutor(max_workers=4)
Ref.configure_sync_task_executor(executor)

# å¼ºåˆ¶ç«‹å³åŒæ­¥æ‰§è¡Œ (å¿½ç•¥æ‰§è¡Œå™¨é…ç½®)
immediate_ref = Ref(0, subscribe_immediate=True)

# ä¿è¯é¡ºåºæ‰§è¡Œ (åœ¨æ‰§è¡Œå™¨ä¸­æŒ‰é¡ºåºæ‰§è¡Œ)
sequential_ref = Ref(0, subscribe_sequential=True)
```

### 2ï¸âƒ£ é«˜çº§æ¥å£ç¤ºä¾‹

#### ReactiveDict - ç»“åˆ TypedDict æŒ‡å®šç»“æ„

```python
from cognihub_pyeffectref import ReactiveDict, effect
from typing import TypedDict, cast

# 1. å®šä¹‰æ•°æ®ç»“æ„
class UserData(TypedDict):
    name: str
    email: str  
    age: int
    is_active: bool

# 2. åˆ›å»ºå“åº”å¼å­—å…¸
user_dict = ReactiveDict({
    'name': 'Alice',
    'email': 'alice@example.com', 
    'age': 25,
    'is_active': True
})

# 3. ç±»å‹è½¬æ¢ä»¥è·å¾—ç±»å‹æç¤º
user: UserData = cast(UserData, user_dict)

# 4. ä½¿ç”¨æ—¶äº«å—å®Œæ•´ç±»å‹æç¤º
@effect
def watch_user() -> None:
    print(f"User: {user['name']} ({user['age']})")
    print(f"Email: {user['email']}")
    print(f"Active: {user['is_active']}")

watch_user()

# 5. ä¿®æ”¹æ•°æ®
user['name'] = 'Bob'      # è‡ªåŠ¨è§¦å‘å‰¯ä½œç”¨
user['age'] = 26          # è‡ªåŠ¨è§¦å‘å‰¯ä½œç”¨
```

#### ReadOnlyView - ç»“åˆ Protocol åˆ›å»ºåªè¯»è§†å›¾

```python
from cognihub_pyeffectref import ReactiveDict, ReadOnlyView, ReadOnlyRef, effect
from typing import Protocol, cast, Any

# 1. å®šä¹‰ Protocol æè¿°åªè¯»è§†å›¾ç»“æ„
class UserViewProtocol(Protocol):
    name: ReadOnlyRef[str]
    email: ReadOnlyRef[str] 
    age: ReadOnlyRef[int]
    is_active: ReadOnlyRef[bool]
    
    def __call__(self) -> dict[str, Any]: ...

# 2. åˆ›å»ºåŸå§‹æ•°æ®
user_data = ReactiveDict({
    'name': 'Alice',
    'email': 'alice@example.com',
    'age': 25, 
    'is_active': True
})

# 3. åˆ›å»ºåªè¯»è§†å›¾
user_view = cast(UserViewProtocol, ReadOnlyView(user_data))

# 4. åªè¯»è®¿é—® - äº«å—å®Œæ•´ç±»å‹æç¤ºå’Œé˜²æŠ¤
@effect  
def watch_user_view() -> None:
    print(f"Name: {user_view.name.value}")
    print(f"Email: {user_view.email.value}")
    print(f"Age: {user_view.age.value}")

watch_user_view()

# 5. æ— æ³•ä¿®æ”¹ (ç¼–è¯‘æ—¶å’Œè¿è¡Œæ—¶éƒ½ä¼šæŠ¥é”™)
# user_view.name.value = "Bob"     # AttributeError: ReadOnlyRef has no setter
# user_view['name'] = "Bob"        # TypeError: ReadOnlyView is not subscriptable

# 6. åªèƒ½é€šè¿‡åŸå§‹æ•°æ®ä¿®æ”¹
user_data.name = "Bob"  # è‡ªåŠ¨è§¦å‘åªè¯»è§†å›¾çš„å‰¯ä½œç”¨
```

#### å¤æ‚åµŒå¥—æ•°æ®ç»“æ„

```python
from cognihub_pyeffectref import ReactiveDict, ReadOnlyView, ReadOnlyRef, effect
from typing import Protocol, cast, Any

# 1. å®šä¹‰åµŒå¥—çš„ Protocol ç»“æ„
class DatabaseConfig(Protocol):
    host: ReadOnlyRef[str]
    port: ReadOnlyRef[int]
    name: ReadOnlyRef[str]

class ApiConfig(Protocol):  
    base_url: ReadOnlyRef[str]
    timeout: ReadOnlyRef[int]
    retry_count: ReadOnlyRef[int]

class AppConfig(Protocol):
    database: DatabaseConfig
    api: ApiConfig
    debug_mode: ReadOnlyRef[bool]
    
    def __call__(self) -> dict[str, Any]: ...

# 2. åˆ›å»ºåµŒå¥—æ•°æ®
config_data = ReactiveDict({
    'database': {
        'host': 'localhost',
        'port': 5432,
        'name': 'myapp'
    },
    'api': {
        'base_url': 'https://api.example.com',
        'timeout': 30,
        'retry_count': 3
    },
    'debug_mode': False
})

# 3. åˆ›å»ºç±»å‹åŒ–çš„åªè¯»è§†å›¾
config_view = cast(AppConfig, ReadOnlyView(config_data))

# 4. è®¿é—®åµŒå¥—æ•°æ® - å®Œæ•´ç±»å‹æç¤º
@effect
def watch_config() -> None:
    db_host = config_view.database.host.value
    api_url = config_view.api.base_url.value  
    debug = config_view.debug_mode.value
    
    print(f"Database: {db_host}")
    print(f"API: {api_url}")
    print(f"Debug: {debug}")

watch_config()

# 5. ä¿®æ”¹åŸå§‹æ•°æ®è§¦å‘å˜æ›´
config_data.database.host = 'production-db'
config_data.debug_mode = True
```

## ğŸ“– API å‚è€ƒ

### ğŸ”§ åº•å±‚æ¥å£ (Low-level APIs)

#### Ref[T]

å“åº”å¼æ•°æ®å®¹å™¨ç±»,æ”¯æŒæ³›å‹ç±»å‹æŒ‡å®š.

**æ„é€ å‡½æ•°**

- `Ref(initial_value: T, subscribe_immediate: bool = False, subscribe_sequential: bool = False)`
  - `initial_value`: åˆå§‹å€¼
  - `subscribe_immediate`: æ˜¯å¦å¼ºåˆ¶åœ¨å½“å‰çº¿ç¨‹åŒæ­¥æ‰§è¡Œå›è°ƒ (å¿½ç•¥å…¨å±€æ‰§è¡Œå™¨é…ç½®)
  - `subscribe_sequential`: æ˜¯å¦ä¿è¯å›è°ƒæŒ‰æ³¨å†Œé¡ºåºæ‰§è¡Œ

**å±æ€§**

- `value: T`: è·å–æˆ–è®¾ç½®å¼•ç”¨çš„å€¼

**æ–¹æ³•**

- `subscribe(callback: Callable[[T, T], None])`: è®¢é˜…å€¼å˜åŒ–
- `unsubscribe(callback: Callable[[T, T], None])`: å–æ¶ˆè®¢é˜…
- `configure_sync_task_executor(executor)`: é…ç½®å…¨å±€åŒæ­¥ä»»åŠ¡æ‰§è¡Œå™¨

**ç±»æ–¹æ³•**

- `Ref.configure_sync_task_executor('asyncio' | ThreadPoolExecutor)`: é…ç½®å…¨å±€æ‰§è¡Œå™¨

#### ReadOnlyRef[T] 

åªè¯»å“åº”å¼å¼•ç”¨,ä» Ref åˆ›å»º.

**æ„é€ å‡½æ•°**

- `ReadOnlyRef(ref: Ref[T])`: ä»ç°æœ‰ Ref åˆ›å»ºåªè¯»å¼•ç”¨

**å±æ€§**

- `value: T`: åªè¯»è®¿é—®å¼•ç”¨çš„å€¼ (æ—  setter)

**æ–¹æ³•**

- `subscribe(callback: Callable[[T, T], None])`: è®¢é˜…å€¼å˜åŒ–
- `unsubscribe(callback: Callable[[T, T], None])`: å–æ¶ˆè®¢é˜…

#### effect

å‰¯ä½œç”¨è£…é¥°å™¨,è‡ªåŠ¨è¿½è¸ª Ref ä¾èµ–å…³ç³».

```python
@effect
def my_effect() -> None:
    # è®¿é—® Ref.value ä¼šè‡ªåŠ¨å»ºç«‹ä¾èµ–å…³ç³»
    pass

# æˆ–æ‰‹åŠ¨è°ƒç”¨
effect_wrapper = effect(my_function)
effect_wrapper()
```

#### EffectWrapper

effect è£…é¥°å™¨è¿”å›çš„åŒ…è£…å™¨ç±».

**æ–¹æ³•**

- `stop()`: åœæ­¢å‰¯ä½œç”¨,ä½¿å…¶ä¸å†å“åº”æ•°æ®å˜åŒ–

### ğŸ—ï¸ é«˜çº§æ¥å£ (High-level APIs)

#### ReactiveDict

å“åº”å¼å­—å…¸,æ”¯æŒåµŒå¥—ç»“æ„å’ŒåŠ¨æ€é”®.

**æ„é€ å‡½æ•°**

- `ReactiveDict(initial_data: dict = None)`: åˆ›å»ºå“åº”å¼å­—å…¸

**æ–¹æ³•**

- `to_dict() -> dict`: è½¬æ¢ä¸ºæ™®é€šå­—å…¸
- `keys()`, `values()`, `items()`: å­—å…¸æ¥å£æ–¹æ³•
- `get(key, default=None)`: è·å–å€¼
- `pop(key, default=None)`: åˆ é™¤å¹¶è¿”å›å€¼
- `clear()`: æ¸…ç©ºå­—å…¸
- `update(other)`: æ›´æ–°å­—å…¸

**ç‰¹æ€§**

- æ”¯æŒåµŒå¥—ç»“æ„è‡ªåŠ¨è½¬æ¢ä¸º ReactiveDict
- åŠ¨æ€å±æ€§è®¿é—®: `obj.key` ç­‰ä»·äº `obj['key']`
- ä¸ TypedDict ç»“åˆä½¿ç”¨è·å¾—ç±»å‹æç¤º

#### ReadOnlyView

åªè¯»è§†å›¾,ä» ReactiveDict åˆ›å»ºç»“æ„åŒ–çš„åªè¯»è®¿é—®.

**æ„é€ å‡½æ•°**

- `ReadOnlyView(reactive_dict: ReactiveDict)`: åˆ›å»ºåªè¯»è§†å›¾

**ç‰¹æ€§**

- é€’å½’å°†æ‰€æœ‰å€¼è½¬æ¢ä¸º ReadOnlyRef
- æ”¯æŒåµŒå¥—ç»“æ„çš„åªè¯»è®¿é—®  
- ä¸ Protocol ç»“åˆè·å¾—å®Œæ•´ç±»å‹æç¤º
- è°ƒç”¨ `view()` è¿”å›å½“å‰çŠ¶æ€çš„å­—å…¸å¿«ç…§

**ä½¿ç”¨æ¨¡å¼**

```python
# 1. å®šä¹‰ç»“æ„ Protocol
class MyDataProtocol(Protocol):
    field: ReadOnlyRef[str]
    def __call__(self) -> dict[str, Any]: ...

# 2. åˆ›å»ºå¹¶è½¬æ¢
data = ReactiveDict({'field': 'value'})
view = cast(MyDataProtocol, ReadOnlyView(data))

# 3. ç±»å‹å®‰å…¨è®¿é—®
print(view.field.value)  # å®Œæ•´ç±»å‹æç¤º
snapshot = view()        # è·å–å½“å‰çŠ¶æ€å¿«ç…§
```

## âš¡ æ‰§è¡Œæ¨¡å¼è¯¦è§£

### åŒæ­¥æ‰§è¡Œ (é»˜è®¤)

```python
from cognihub_pyeffectref import Ref, effect

# é»˜è®¤æ¨¡å¼ï¼šå›è°ƒåœ¨å½“å‰çº¿ç¨‹ä¸­æ‰§è¡Œ
data = Ref("initial")

@effect
def sync_effect() -> None:
    print(f"Current value: {data.value}")

sync_effect()  # ç«‹å³æ‰§è¡Œ
data.value = "changed"  # åœ¨å½“å‰çº¿ç¨‹ä¸­è§¦å‘å›è°ƒ
```

### å¼‚æ­¥æ‰§è¡Œ (asyncio ç¯å¢ƒ)

```python
import asyncio
from cognihub_pyeffectref import Ref, effect

# é…ç½®ä½¿ç”¨ asyncio çº¿ç¨‹æ± 
Ref.configure_sync_task_executor('asyncio')

data = Ref("initial")

@effect
async def async_effect() -> None:
    print(f"Async value: {data.value}")
    await asyncio.sleep(0.1)

async def main():
    await async_effect()  # å»ºç«‹ä¾èµ–
    data.value = "changed"  # å›è°ƒå°†åœ¨ asyncio.to_thread ä¸­æ‰§è¡Œ
    await asyncio.sleep(0.2)  # ç­‰å¾…å¼‚æ­¥å›è°ƒå®Œæˆ

asyncio.run(main())
```

### å¤šçº¿ç¨‹æ‰§è¡Œ

```python
import threading
import concurrent.futures
from cognihub_pyeffectref import Ref, effect

# é…ç½®è‡ªå®šä¹‰çº¿ç¨‹æ± 
executor = concurrent.futures.ThreadPoolExecutor(max_workers=4)
Ref.configure_sync_task_executor(executor)

data = Ref(0)

@effect
def thread_effect() -> None:
    thread_id = threading.get_ident()
    value = data.value
    print(f"Thread {thread_id}: {value}")

# åœ¨å¤šä¸ªçº¿ç¨‹ä¸­å»ºç«‹ä¾èµ–
threads = []
for i in range(3):
    thread = threading.Thread(target=thread_effect)
    thread.start()
    threads.append(thread)

# è§¦å‘å›è°ƒ - å°†åœ¨çº¿ç¨‹æ± ä¸­æ‰§è¡Œ
data.value = 42

for thread in threads:
    thread.join()
    
executor.shutdown(wait=True)
```

### æ‰§è¡Œæ§åˆ¶é€‰é¡¹

```python
from cognihub_pyeffectref import Ref

# 1. å¼ºåˆ¶ç«‹å³åŒæ­¥æ‰§è¡Œ (å¿½ç•¥å…¨å±€æ‰§è¡Œå™¨)
immediate_ref = Ref(0, subscribe_immediate=True)

# 2. ä¿è¯é¡ºåºæ‰§è¡Œ (åœ¨æ‰§è¡Œå™¨ä¸­æŒ‰æ³¨å†Œé¡ºåºæ‰§è¡Œ)  
sequential_ref = Ref(0, subscribe_sequential=True)

# 3. ç»„åˆä½¿ç”¨ (immediate ä¼˜å…ˆçº§æ›´é«˜)
combined_ref = Ref(0, subscribe_immediate=True, subscribe_sequential=True)
```

## ğŸ”’ çº¿ç¨‹å®‰å…¨ç‰¹æ€§

æœ¬åº“åœ¨è®¾è®¡æ—¶å……åˆ†è€ƒè™‘äº†çº¿ç¨‹å®‰å…¨ï¼š

### å†…éƒ¨é”æœºåˆ¶

- `Ref` ä½¿ç”¨å†…éƒ¨é”ä¿æŠ¤è®¢é˜…è€…é›†åˆçš„å¹¶å‘ä¿®æ”¹
- æ”¯æŒåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­å®‰å…¨åœ°è¯»å†™å“åº”å¼æ•°æ®
- `ReactiveDict` çš„åµŒå¥—æ“ä½œä¹Ÿæ˜¯çº¿ç¨‹å®‰å…¨çš„

### ä¸Šä¸‹æ–‡éš”ç¦»

- å¼‚æ­¥ç¯å¢ƒä½¿ç”¨ `contextvars` éš”ç¦» effect ä¸Šä¸‹æ–‡
- å¤šçº¿ç¨‹ç¯å¢ƒä½¿ç”¨ `threading.local` è¿›è¡Œçº¿ç¨‹éš”ç¦»
- ç¡®ä¿å‰¯ä½œç”¨å‡½æ•°åœ¨æ­£ç¡®çš„ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œ

### æ‰§è¡Œå™¨é…ç½®

- å…¨å±€æ‰§è¡Œå™¨é…ç½®æ”¯æŒ `'asyncio'` å’Œè‡ªå®šä¹‰ `ThreadPoolExecutor`
- `subscribe_immediate=True` å¯å¼ºåˆ¶åœ¨å½“å‰çº¿ç¨‹åŒæ­¥æ‰§è¡Œ,æä¾›ç¡®å®šæ€§è¡Œä¸º
- `subscribe_sequential=True` ä¿è¯å›è°ƒæŒ‰æ³¨å†Œé¡ºåºæ‰§è¡Œ,é¿å…ç«æ€æ¡ä»¶

## ğŸ¯ ä½¿ç”¨åœºæ™¯æ¨è

### ä½•æ—¶ä½¿ç”¨åº•å±‚æ¥å£ (Ref/effect)

âœ… **é€‚åˆåœºæ™¯**:

- ç®€å•çš„å“åº”å¼çŠ¶æ€ç®¡ç†
- æ€§èƒ½æ•æ„Ÿçš„åº”ç”¨
- éœ€è¦ç²¾ç¡®æ§åˆ¶æ‰§è¡Œæ—¶æœº
- ä¸ç°æœ‰ä»£ç é›†æˆ

```python
# é€‚åˆï¼šç®€å•è®¡æ•°å™¨
counter: Ref[int] = Ref(0)
user_name: Ref[str] = Ref("Anonymous")
```

### ä½•æ—¶ä½¿ç”¨é«˜çº§æ¥å£ (ReactiveDict/ReadOnlyView)

âœ… **é€‚åˆåœºæ™¯**:

- å¤æ‚çš„åµŒå¥—æ•°æ®ç»“æ„
- éœ€è¦ç»“æ„åŒ–çš„æ•°æ®è®¿é—®
- é…ç½®ç®¡ç†ç³»ç»Ÿ
- å¤§å‹åº”ç”¨çš„çŠ¶æ€ç®¡ç†

```python
# é€‚åˆï¼šå¤æ‚é…ç½®å¯¹è±¡
app_config = ReactiveDict({
    'database': {'host': 'localhost', 'port': 5432},
    'cache': {'ttl': 3600, 'max_size': 1000},
    'features': {'debug': False, 'analytics': True}
})
```

### æ··åˆä½¿ç”¨æ¨¡å¼

```python
# ç»„åˆä½¿ç”¨ï¼šåº•å±‚æ¥å£å¤„ç†æ ¸å¿ƒçŠ¶æ€,é«˜çº§æ¥å£ç®¡ç†é…ç½®
from cognihub_pyeffectref import Ref, ReactiveDict, ReadOnlyView, effect
from typing import Protocol, cast

# åº•å±‚ï¼šæ ¸å¿ƒåº”ç”¨çŠ¶æ€
app_state: Ref[str] = Ref("initializing")
user_count: Ref[int] = Ref(0)

# é«˜çº§ï¼šå¤æ‚é…ç½®ç®¡ç†
config_data = ReactiveDict({
    'ui': {'theme': 'dark', 'language': 'en'},
    'api': {'timeout': 30, 'retries': 3}
})

class ConfigProtocol(Protocol):
    ui: dict[str, str]
    api: dict[str, int]

config = cast(ConfigProtocol, config_data)

@effect
def sync_state() -> None:
    state = app_state.value
    theme = config['ui']['theme']
    print(f"App {state} with {theme} theme")

sync_state()
```

## ğŸ› ï¸ å¼€å‘æŒ‡å—

### ç¯å¢ƒè®¾ç½®

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/hsz1273327/cognihub_pyeffectref.git
cd cognihub_pyeffectref

# å®‰è£…å¼€å‘ä¾èµ–
pip install -e ".[dev]"
```

### è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
pytest

# è¿è¡Œæµ‹è¯•å¹¶ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
pytest --cov=cognihub_pyeffectref --cov-report=html

# è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶
pytest tests/test_ref.py -v
```

### ä»£ç è´¨é‡æ£€æŸ¥

```bash
# æ ¼å¼åŒ–ä»£ç 
black .
isort .

# ç±»å‹æ£€æŸ¥
mypy cognihub_pyeffectref

# ä»£ç é£æ ¼æ£€æŸ¥
flake8 cognihub_pyeffectref
```

### é¡¹ç›®ç»“æ„

```
cognihub_pyeffectref/
â”œâ”€â”€ cognihub_pyeffectref/    # ä¸»è¦æºç 
â”‚   â”œâ”€â”€ __init__.py         # å…¬å…±æ¥å£å¯¼å‡º
â”‚   â”œâ”€â”€ ref.py              # åº•å±‚æ¥å£ï¼šRef, ReadOnlyRef
â”‚   â”œâ”€â”€ effect.py           # effect è£…é¥°å™¨å’Œ EffectWrapper
â”‚   â”œâ”€â”€ reactive_dict.py    # é«˜çº§æ¥å£ï¼šReactiveDict
â”‚   â””â”€â”€ local.py            # ä¸Šä¸‹æ–‡ç®¡ç†ï¼ˆthreading.local ç­‰ï¼‰
â”œâ”€â”€ tests/                  # æµ‹è¯•æ–‡ä»¶
â”‚   â”œâ”€â”€ test_ref.py         # Ref ç›¸å…³æµ‹è¯•
â”‚   â”œâ”€â”€ test_effect.py      # effect ç›¸å…³æµ‹è¯•
â”‚   â””â”€â”€ test_reactive_dict.py # ReactiveDict ç›¸å…³æµ‹è¯•
â”œâ”€â”€ examples/               # ä½¿ç”¨ç¤ºä¾‹
â””â”€â”€ docs/                   # æ–‡æ¡£
```

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿è´¡çŒ®ä»£ç ï¼è¯·éµå¾ªä»¥ä¸‹æµç¨‹ï¼š

### å¼€å‘æµç¨‹

1. **Fork é¡¹ç›®**å¹¶åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
2. **ç¼–å†™ä»£ç **å¹¶ç¡®ä¿æµ‹è¯•é€šè¿‡
3. **æ·»åŠ æµ‹è¯•**è¦†ç›–æ–°åŠŸèƒ½
4. **æ›´æ–°æ–‡æ¡£**å¦‚æœ‰å¿…è¦
5. **æäº¤ Pull Request**

### ä»£ç è§„èŒƒ

- ä½¿ç”¨ **ç±»å‹æç¤º** (`typing` æ¨¡å—)
- éµå¾ª **PEP 8** ä»£ç é£æ ¼
- ç¼–å†™ **docstring** æè¿°å‡½æ•°å’Œç±»
- ä¿æŒ **æµ‹è¯•è¦†ç›–ç‡** > 90%
- ç¡®ä¿æ‰€æœ‰æµ‹è¯•é€šè¿‡

### æäº¤ä¿¡æ¯è§„èŒƒ

ä½¿ç”¨è¯­ä¹‰åŒ–æäº¤ä¿¡æ¯ï¼š

```bash
feat: æ·»åŠ æ–°åŠŸèƒ½
fix: ä¿®å¤ bug  
docs: æ›´æ–°æ–‡æ¡£
test: æ·»åŠ æµ‹è¯•
refactor: é‡æ„ä»£ç 
style: ä»£ç æ ¼å¼è°ƒæ•´
```

### Issue å’Œ PR æ¨¡æ¿

- **Bug æŠ¥å‘Š**: æä¾›å¤ç°æ­¥éª¤ã€é¢„æœŸè¡Œä¸ºã€å®é™…è¡Œä¸º
- **åŠŸèƒ½è¯·æ±‚**: æè¿°ç”¨ä¾‹ã€æœŸæœ› APIã€å®ç°å»ºè®®
- **Pull Request**: å…³è” Issueã€è¯´æ˜å˜æ›´ã€æ·»åŠ æµ‹è¯•

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯.è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶.

## ğŸ“š ç›¸å…³èµ„æº

- **GitHub**: [cognihub_pyeffectref](https://github.com/hsz1273327/cognihub_pyeffectref)
- **PyPI**: [cognihub-pyeffectref](https://pypi.org/project/cognihub-pyeffectref/)
- **ç¤ºä¾‹**: [examples/](https://github.com/hsz1273327/cognihub_pyeffectref/tree/master/examples)

## ğŸ”„ å˜æ›´æ—¥å¿—

æŸ¥çœ‹ [CHANGELOG.md](CHANGELOG.md) äº†è§£å®Œæ•´å˜æ›´å†å².

---

**æ„Ÿè°¢ä½¿ç”¨ CogniHub PyEffectRefï¼** ğŸš€

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®,æ¬¢è¿æäº¤ [Issue](https://github.com/hsz1273327/cognihub_pyeffectref/issues) æˆ–å‚ä¸è®¨è®º.
