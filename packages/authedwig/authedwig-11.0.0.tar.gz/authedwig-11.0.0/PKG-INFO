Metadata-Version: 2.2
Name: authedwig
Version: 11.0.0
Summary: Hedwig Python Library
Home-page: https://github.com/cloudchacho/hedwig-python
Author: Cloudchacho
Maintainer: Aniruddha Maru
Maintainer-email: maru@aniruddhamaru.com
License: Apache Software License (Apache License 2.0)
Keywords: python authedwig hedwig
Classifier: Natural Language :: English
Classifier: Development Status :: 5 - Production/Stable
Classifier: Intended Audience :: Developers
Classifier: Intended Audience :: System Administrators
Classifier: Topic :: Software Development :: Libraries :: Python Modules
Classifier: Programming Language :: Python
Classifier: Programming Language :: Python :: 3.9
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Classifier: Programming Language :: Python :: 3.12
Classifier: Programming Language :: Python :: 3.13
Classifier: License :: OSI Approved :: Apache Software License
Requires-Python: >=3.9
License-File: LICENSE.md
Requires-Dist: funcy
Requires-Dist: dataclasses; python_version < "3.7"
Provides-Extra: aws
Requires-Dist: boto3; extra == "aws"
Requires-Dist: retrying; extra == "aws"
Provides-Extra: gcp
Requires-Dist: google-cloud-pubsub>=2.0.0; extra == "gcp"
Requires-Dist: grpcio-status; extra == "gcp"
Provides-Extra: dev
Requires-Dist: boto3-stubs[sns,sqs]; extra == "dev"
Requires-Dist: docutils<0.18; python_version < "3.8" and extra == "dev"
Requires-Dist: flake8; extra == "dev"
Requires-Dist: jinja2<3.1; (python_version >= "3.7" and python_version < "3.8") and extra == "dev"
Requires-Dist: mypy-protobuf; extra == "dev"
Requires-Dist: pip-tools; extra == "dev"
Requires-Dist: protobuf~=6.0; extra == "dev"
Requires-Dist: Sphinx==3.2.1; python_version < "3.8" and extra == "dev"
Requires-Dist: Sphinx>3; python_version >= "3.8" and extra == "dev"
Requires-Dist: sphinx-autodoc-typehints<1.13.0; python_version < "3.8" and extra == "dev"
Requires-Dist: sphinx-autodoc-typehints; python_version >= "3.8" and extra == "dev"
Requires-Dist: types-dataclasses; extra == "dev"
Requires-Dist: types-protobuf<3.20.0; extra == "dev"
Requires-Dist: wheel; extra == "dev"
Provides-Extra: jsonschema
Requires-Dist: jsonpointer; extra == "jsonschema"
Requires-Dist: jsonschema; extra == "jsonschema"
Provides-Extra: protobuf
Requires-Dist: protobuf~=6.0; extra == "protobuf"
Provides-Extra: redis
Requires-Dist: redis; extra == "redis"
Provides-Extra: test
Requires-Dist: black; extra == "test"
Requires-Dist: coverage; extra == "test"
Requires-Dist: coveralls; extra == "test"
Requires-Dist: factory-boy; extra == "test"
Requires-Dist: flake8; extra == "test"
Requires-Dist: freezegun; extra == "test"
Requires-Dist: ipdb; extra == "test"
Requires-Dist: moto[sns,sqs]; extra == "test"
Requires-Dist: mypy; extra == "test"
Requires-Dist: opentelemetry-sdk; extra == "test"
Requires-Dist: protobuf; extra == "test"
Requires-Dist: pytest; extra == "test"
Requires-Dist: pytest-cov; extra == "test"
Requires-Dist: pytest-env; extra == "test"
Requires-Dist: structlog; extra == "test"
Provides-Extra: publish
Requires-Dist: bumpversion; extra == "publish"
Requires-Dist: twine; extra == "publish"
Provides-Extra: opentelemetry
Requires-Dist: opentelemetry-api; extra == "opentelemetry"
Dynamic: author
Dynamic: classifier
Dynamic: description
Dynamic: home-page
Dynamic: keywords
Dynamic: license
Dynamic: maintainer
Dynamic: maintainer-email
Dynamic: provides-extra
Dynamic: requires-dist
Dynamic: requires-python
Dynamic: summary

Hedwig Library for Python
=========================

.. image:: https://github.com/cloudchacho/hedwig-python/workflows/Pytest/badge.svg
    :target: https://github.com/cloudchacho/hedwig-python/actions?query=workflow%3APytest

.. image:: https://codecov.io/gh/cloudchacho/hedwig-python/branch/main/graph/badge.svg?token=81LqiGysSn
    :target: https://codecov.io/gh/cloudchacho/hedwig-python

.. image:: https://img.shields.io/pypi/v/authedwig.svg?style=flat-square
    :target: https://pypi.python.org/pypi/authedwig

.. image:: https://img.shields.io/pypi/pyversions/authedwig.svg?style=flat-square
    :target: https://pypi.python.org/pypi/authedwig

.. image:: https://img.shields.io/pypi/implementation/authedwig.svg?style=flat-square
    :target: https://pypi.python.org/pypi/authedwig

.. image:: https://img.shields.io/badge/code%20style-black-000000.svg
    :target: https://github.com/ambv/black

Hedwig is a inter-service communication bus that works on AWS SQS/SNS, while keeping things pretty simple and
straight forward. It uses `json schema`_ `draft v4`_ for schema validation so all incoming
and outgoing messages are validated against pre-defined schema.

Hedwig allows separation of concerns between consumers and publishers so your services are loosely coupled, and the
contract is enforced by the schema validation. Hedwig may also be used to build asynchronous APIs.

For intra-service messaging, see Taskhawk_.

Only Python 3.6+ is supported currently.

You can find the latest, most up to date, documentation at `Read the Docs`_.

Quick Start
-----------

First, install the library:

.. code:: sh

    $ pip install authedwig[aws,jsonschema]

Next, set up a few configuration settings:

Common required settings:

.. code:: python

    HEDWIG_QUEUE = "DEV-MYAPP"

    HEDWIG_CALLBACKS = {
        ("email.send", "1.*"): "send_email",
    }

    HEDWIG_MESSAGE_ROUTING = {
        ("email.send", "1.*"): "send-email-v1",
    }

    HEDWIG_JSONSCHEMA_FILE = "schema.json"


When using AWS, additional required settings are:

.. code:: python

    AWS_ACCESS_KEY = <YOUR AWS KEY>
    AWS_ACCOUNT_ID = <YOUR AWS ACCOUNT ID>
    AWS_REGION = <YOUR AWS REGION>
    AWS_SECRET_KEY = <YOUR AWS SECRET KEY>

    HEDWIG_CONSUMER_BACKEND = 'hedwig.backends.aws.AWSSQSConsumerBackend'
    HEDWIG_PUBLISHER_BACKEND = 'hedwig.backends.aws.AWSSNSPublisherBackend'


In case of GCP, additional required settings are:

.. code:: python

    HEDWIG_CONSUMER_BACKEND = 'hedwig.backends.gcp.GooglePubSubConsumerBackend'
    HEDWIG_PUBLISHER_BACKEND = 'hedwig.backends.gcp.GooglePubSubPublisherBackend'

    HEDWIG_SUBSCRIPTIONS = ["dev-user-created-v1"]


If running outside Google Cloud (e.g. locally), set ``GOOGLE_APPLICATION_CREDENTIALS``.

Within Google Cloud, these credentials and permissions are managed by Google using IAM.

If the Pub/Sub resources lie in a different project, set ``GOOGLE_CLOUD_PROJECT`` to the project id.

For Django projects, simple use `Django settings`_ to configure Hedwig. For Flask projects, use `Flask config`_.
For other frameworks, you can either declare an environment variable called ``SETTINGS_MODULE`` that points to a
module where settings may be found, or manually configure using ``hedwig.conf.settings.configure_with_object``.

Create a JSON-schema and save as ``schema.json``:

.. code:: json

    {
        "id": "https://github.com/cloudchacho/hedwig-python/schema#",
        "$schema": "http://json-schema.org/draft-04/schema",
        "schemas": {
            "email.send": {
                "1.*": {
                    "description": "Request to send email",
                    "type": "object",
                    "required": [
                        "to",
                        "subject"
                    ],
                    "properties": {
                        "to": {
                            "type": "string",
                            "pattern": "^\\S+@\\S+$"
                        },
                        "subject": {
                            "type": "string",
                            "minLength": 2
                        }
                    }
                }
            }
        }
    }

Then, simply define your topic handler:

.. code:: python

   def send_email(message: hedwig.Message = None) -> None:
       # send email

And finally, send a message:

.. code:: python

    message = hedwig.Message.new(
        "email.send",
        StrictVersion('1.0'),
        {
            'to': 'example@email.com',
            'subject': 'Hello!',
        },
    )
    message.publish()


Development
-----------

Getting Started
~~~~~~~~~~~~~~~
Assuming that you have Python, ``pyenv`` and ``pyenv-virtualenv``, and `protoc installed`_, set up your
environment and install the required dependencies like this instead of
the ``pip install authedwig`` defined above:

.. code:: sh

    $ git clone https://github.com/cloudchacho/hedwig.git /usr/local/lib/protobuf/include/hedwig
    ...
    $ git clone https://github.com/cloudchacho/hedwig-python.git
    $ cd hedwig-python
    $ pyenv virtualenv 3.10.8 hedwig-python-3.10
    ...
    $ pyenv activate hedwig-python-3.10
    $ pip install -r requirements/dev-3.10.txt

Re-compile protobuf
~~~~~~~~~~~~~~~~~~~
On making any change to test protobufs or container protobuf, the file would need to be re-compiled:

.. code:: sh

    $ make proto_compile

Running Tests
~~~~~~~~~~~~~
You can run tests in using ``make test``. By default,
it will run all of the unit and functional tests, but you can also specify your own
``py.test`` options.

.. code:: sh

    $ py.test
    $ py.test tests/test_consumer.py

Generating Documentation
~~~~~~~~~~~~~~~~~~~~~~~~
Sphinx is used for documentation. You can generate HTML locally with the
following:

.. code:: sh

    $ pip install -e .[dev]
    $ make docs


Getting Help
------------

We use GitHub issues for tracking bugs and feature requests.

* If it turns out that you may have found a bug, please `open an issue <https://github.com/cloudchacho/hedwig-python/issues/new>`__

.. _Read the Docs: https://authedwig.readthedocs.io/en/latest/
.. _Django settings: https://docs.djangoproject.com/en/2.0/topics/settings/
.. _Flask config: https://flask.palletsprojects.com/en/1.1.x/config/
.. _draft v4: http://json-schema.org/specification-links.html#draft-4
.. _json schema: http://json-schema.org/
.. _Taskhawk: https://github.com/cloudchacho/taskhawk-python
.. _protoc installed: https://github.com/protocolbuffers/protobuf/
